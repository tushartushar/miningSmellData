Implementation smell,Namespace,Class,File,Method,Description
Long Method,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The method has 209 lines of code.
Complex Method,Ichari.Web,AccountController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\AccountController.cs,DrawDetail,Cyclomatic complexity of the method is 9
Complex Method,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,ChariDraw,Cyclomatic complexity of the method is 18
Complex Method,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,Cyclomatic complexity of the method is 16
Complex Method,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,ClaimPrizeStep2,Cyclomatic complexity of the method is 8
Long Parameter List,Ichari.Web,AccountController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\AccountController.cs,UnionDonations,The method has 6 parameters.
Long Parameter List,Ichari.Web,AccountController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\AccountController.cs,MyDrawings,The method has 5 parameters.
Long Parameter List,Ichari.Web,AccountController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\AccountController.cs,DrawDetail,The method has 5 parameters.
Long Parameter List,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The method has 8 parameters.
Long Parameter List,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,ClaimPrize,The method has 5 parameters.
Long Parameter List,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,ClaimPrizeStep2,The method has 6 parameters.
Long Parameter List,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,ClaimPrizeStep2,The method has 5 parameters.
Long Parameter List,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,SendCard,The method has 5 parameters.
Long Statement,Ichari.Web,AppGlobal,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\AppGlobal.cs,CreateUnityContainer,The length of the statement  "	UnityConfigurationSection section = (UnityConfigurationSection)System.Configuration.ConfigurationManager.GetSection ("unity"); " is 126.
Long Statement,Ichari.Web,AccountController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\AccountController.cs,ChangeCaptcha,The length of the statement  "	return "<img id=\"capImg\" src=\"\\Account\\CaptchaImg?" + new Random ().Next (100).ToString () + "\" alt=\"验证码\" style=\"vertical-align:top;\" />"; " is 148.
Long Statement,Ichari.Web,AccountController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\AccountController.cs,UnionDonations,The length of the statement  "	LoveChange old_lc = _uow.LoveChangeService.Get (o => o.UnionOrder == cgvm.DonationId && o.Amount == cgvm.DonationAmount); " is 121.
Long Statement,Ichari.Web,AccountController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\AccountController.cs,MyDrawings,The length of the statement  "	vm.PageList = new Common.Helper.PageList<Drawings> (list.OrderByDescending (t => t.CreateTime)' vm.PageIndex' vm.PageCount); " is 124.
Long Statement,Ichari.Web,AccountController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\AccountController.cs,Register,The length of the statement  "		var isExistEmail = !string.IsNullOrEmpty (usr.Email) && _uow.UserInfoService.GetQueryList (t => t.Email == usr.Email).Count () > 0; " is 131.
Long Statement,Ichari.Web,AccountController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\AccountController.cs,UserInfo,The length of the statement  "	if (!string.IsNullOrWhiteSpace (usr.TrueName) && !string.IsNullOrWhiteSpace (usr.IdentityCardNo) && !string.IsNullOrWhiteSpace (usr.Phone)) { " is 141.
Long Statement,Ichari.Web,AccountController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\AccountController.cs,Login,The length of the statement  "		var str = Ichari.Common.DataEncryption.HashString (string.Format ("{0}{1}{2}"' x.UserName' x.Password' Ichari.Common.WebUtils.GetAppSettingValue ("UserSalt"))); " is 160.
Long Statement,Ichari.Web,AccountController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\AccountController.cs,Login,The length of the statement  "		else if (string.IsNullOrWhiteSpace (x.TrueName) || string.IsNullOrWhiteSpace (x.IdentityCardNo) || string.IsNullOrWhiteSpace (x.Phone)) " is 135.
Long Statement,Ichari.Web,AccountController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\AccountController.cs,Logout,The length of the statement  "	System.Web.HttpCookie ck = new System.Web.HttpCookie (Ichari.Common.WebUtils.GetAppSettingValue (StaticKey.AkSiteCookieName)); " is 126.
Long Statement,Ichari.Web,HomeController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\HomeController.cs,ForgotPassword,The length of the statement  "			string resetLink = DataEncryption.EncryptAES (dt.ToBinary ().ToString () + "?" + fpwd.Email + "?" + rnd.Next (100' 10000).ToString () + "?" + fpwd.UserName + "?" + dt.ToShortTimeString ()); " is 189.
Long Statement,Ichari.Web,HomeController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\HomeController.cs,ForgotPassword,The length of the statement  "			eMailMsg.Body = "尊敬的集善网客户: <br />您好! <br />系统已收到您的密码找回申请，请点击链接 <br /><p>" + "http://" + Request.Url.Host + "/Account/ResetPassword?en=" + resetLink + "</p>重设您的密码。<br /><br />为了您的安全，该邮件通知地址将在 48 小时后失效，谢谢合作。<br /><p>--------------------------------------------------<br />" + "此邮件由系统发出，请勿直接回复! <br />集善网 版权所有(C) 2008-2009</p>"; " is 325.
Long Statement,Ichari.Web,HomeController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\HomeController.cs,CheckCookie,The length of the statement  "		if (sign == Ichari.Common.DataEncryption.HashString (string.Format ("{0}{1}{2}"' userName' usr.Password' Ichari.Common.WebUtils.GetAppSettingValue (StaticKey.AkUserSalt)))) { " is 174.
Long Statement,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,GoPay,The length of the statement  "		Response.Redirect (string.Format (WebUtils.GetAppSettingValue (StaticKey.PayUrlFormatter)' order.OrderId' order.TradeNo' PaySource.Donation)); " is 142.
Long Statement,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,GoPay,The length of the statement  "	Response.Redirect (string.Format (WebUtils.GetAppSettingValue (StaticKey.PayUrlFormatter)' oldOrder.OrderId' oldOrder.TradeNo' PaySource.Donation)); " is 148.
Long Statement,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,ChariDraw,The length of the statement  "	if (Request.Headers ["Referer"] != null && Request.Headers ["Referer"].Contains (ConfigurationManager.AppSettings ["UPOPHost"])) { " is 130.
Long Statement,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,ChariDraw,The length of the statement  "		string svar = "orderAmount=" + oAmt.ToString () + "&orderCurrency=" + Request.Form.Get ("orderCurrency") + "&qid=" + oQid; " is 122.
Long Statement,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The length of the statement  "				//List<LoveChange> donations = _uow.LoveChangeService.GetQueryList(o => o.UserId == dbusr.Id  && o.IsGame != true).OrderBy(o => o.CreateTime).ToList(); " is 151.
Long Statement,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The length of the statement  "				var donation = _uow.LoveChangeService.GetQueryList (o => o.UserId == dbusr.Id && o.IsGame != true).OrderBy (o => o.CreateTime).FirstOrDefault (); " is 145.
Long Statement,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The length of the statement  "				//List<Order> orderList = _uow.OrderService.GetQueryList(o => o.UserId == dbusr.Id && o.IsGame != true && o.OrderType == dtype && o.Status == 10).OrderBy(o => o.PayTime).ToList(); " is 179.
Long Statement,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The length of the statement  "				var donationOrder = _uow.OrderService.GetQueryList (t => t.UserId == dbusr.Id && t.IsGame == false && t.OrderType == (int)OrderType.Donation && t.Status >= (int)OrderState.Paid).OrderBy (t => t.PayTime).FirstOrDefault (); " is 221.
Long Statement,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The length of the statement  "							return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }"; " is 150.
Long Statement,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The length of the statement  "							return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }"; " is 131.
Long Statement,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The length of the statement  "						return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }"; " is 131.
Long Statement,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The length of the statement  "							return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }"; " is 150.
Long Statement,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The length of the statement  "							return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }"; " is 131.
Long Statement,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The length of the statement  "						return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }"; " is 131.
Long Statement,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The length of the statement  "							Session [SessionKey.DrawId] = _uow.DrawingsService.Get (o => o.PrizeId == NewDraw.PrizeId && o.OrderNo == NewDraw.OrderNo).Id; " is 126.
Long Statement,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The length of the statement  "							return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"win\" }"; " is 150.
Long Statement,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The length of the statement  "							return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"lose\" }"; " is 132.
Long Statement,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The length of the statement  "						return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"lose\" }"; " is 132.
Long Statement,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,VerifyUPOPOrder,The length of the statement  "	if (Session [SessionKey.UPOPChari] != null && Session [SessionKey.ID] != null && Session [SessionKey.DonationAmt] != null) { " is 124.
Long Statement,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,LoginPanel,The length of the statement  "	//else if (Session[SessionKey.UPOPChari] != null && Session[SessionKey.ID] != null && Session[SessionKey.DonationAmt] != null) " is 126.
Long Statement,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,LoginPanel,The length of the statement  "	if (Session [SessionKey.UPOPChari] != null && Session [SessionKey.ID] != null && Session [SessionKey.DonationAmt] != null && Session [SessionKey.UPOPChari].ToString () == "Verified") { " is 184.
Long Statement,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,GamePanel,The length of the statement  "		cgvm.DList = _uow.LoveChangeService.GetQueryList (o => o.UserId == usr.Id && o.IsGame == false).OrderByDescending (o => o.CreateTime).ToList (); " is 144.
Long Statement,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,GamePanel,The length of the statement  "		cgvm.OList = _uow.OrderService.GetQueryList (o => o.UserId == usr.Id && o.IsGame != true && o.OrderType == dtype && o.Status == 10).OrderBy (o => o.PayTime).ToList (); " is 167.
Long Statement,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,DonationPanel,The length of the statement  "	_log.Info (string.Format ("SessionKey.DonationId : {0} ' SessionKey.DonationAmt : {1}"' donId' Session [SessionKey.DonationAmt])); " is 130.
Long Statement,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,DonationPanel,The length of the statement  "	if (!string.IsNullOrWhiteSpace (donId) && decimal.TryParse (Session [SessionKey.DonationAmt].ToString ()' out donAmt)) { " is 120.
Long Statement,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,ClaimPrize,The length of the statement  "		if (_uow.UserInfoService.Get (o => o.Id == usr.Id && o.UserName == usr.UserName && o.Password == usr.Password) != null) { " is 121.
Long Statement,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,ClaimPrize,The length of the statement  "			Address ad = _uow.AddressService.Get (o => o.UserId == u.Id && o.Address1 == winReg.Street && o.City == winReg.City && o.PostCode == winReg.Postal); " is 148.
Long Statement,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,ClaimPrizeStep2,The length of the statement  "		if (_uow.UserInfoService.Get (o => o.Id == usr.Id && o.UserName == usr.UserName && o.Password == usr.Password) != null) { " is 121.
Long Statement,Ichari.Web,LogonFilterAttribute,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Filter\LogonFilterAttribute.cs,IsLogon,The length of the statement  "		context.Result = new RedirectResult (string.Format ("/Account/Login?returnUrl={0}"' context.HttpContext.Server.UrlEncode (rawUrl))); " is 132.
Complex Conditional,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,LoginPanel,The conditional expression  "Session [SessionKey.UPOPChari] != null && Session [SessionKey.ID] != null && Session [SessionKey.DonationAmt] != null && Session [SessionKey.UPOPChari].ToString () == "Verified""  is complex.
Magic Number,Ichari.Web,AccountController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\AccountController.cs,ChangeCaptcha,The following statement contains a magic number: return "<img id=\"capImg\" src=\"\\Account\\CaptchaImg?" + new Random ().Next (100).ToString () + "\" alt=\"验证码\" style=\"vertical-align:top;\" />";  
Magic Number,Ichari.Web,AccountController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\AccountController.cs,DeleteOrder,The following statement contains a magic number: if (order == null) {  	base.RenderTip ("订单不存在:" + tn' 2);  	return RedirectToAction ("mydonations");  }  
Magic Number,Ichari.Web,AccountController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\AccountController.cs,DeleteOrder,The following statement contains a magic number: base.RenderTip ("订单不存在:" + tn' 2);  
Magic Number,Ichari.Web,AccountController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\AccountController.cs,DeleteOrder,The following statement contains a magic number: if (order.Status != (int)Ichari.Model.Enum.OrderState.Create) {  	base.RenderTip ("订单状态错误:" + order.Status.ToString ()' 2);  	return RedirectToAction ("mydonations");  }  
Magic Number,Ichari.Web,AccountController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\AccountController.cs,DeleteOrder,The following statement contains a magic number: base.RenderTip ("订单状态错误:" + order.Status.ToString ()' 2);  
Magic Number,Ichari.Web,AccountController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\AccountController.cs,ResetPassword,The following statement contains a magic number: if (str_var.Length != 5)  	return RedirectToAction ("Index"' "Home"' new {  		len = "!5"  	});  
Magic Number,Ichari.Web,AccountController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\AccountController.cs,ResetPassword,The following statement contains a magic number: if (dt < DateTime.Now.AddDays (-2))  	return RedirectToAction ("Index"' "Home"' new {  		tm = "expired"  	});  
Magic Number,Ichari.Web,AccountController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\AccountController.cs,ResetPassword,The following statement contains a magic number: if (dt.ToShortTimeString () != str_var [4])  	return RedirectToAction ("Index"' "Home"' new {  		st = "different"  	});  
Magic Number,Ichari.Web,AccountController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\AccountController.cs,ResetPassword,The following statement contains a magic number: if (str_var.Length != 5)  	return RedirectToAction ("Index"' "Home"' new {  		len = "!5"  	});  
Magic Number,Ichari.Web,AccountController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\AccountController.cs,ResetPassword,The following statement contains a magic number: if (dt < DateTime.Now.AddDays (-2))  	return RedirectToAction ("Index"' "Home"' new {  		tm = "expired"  	});  
Magic Number,Ichari.Web,AccountController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\AccountController.cs,ResetPassword,The following statement contains a magic number: if (dt.ToShortTimeString () != str_var [4])  	return RedirectToAction ("Index"' "Home"' new {  		st = "different"  	});  
Magic Number,Ichari.Web,AccountController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\AccountController.cs,ResetPassword,The following statement contains a magic number: if (old_usr == null || old_usr.Email != str_var [1] || old_usr.UserName != str_var [3])  	return RedirectToAction ("Error"' "Home"' new {  		err = "User_Not_Found"  	});  //if (usr.UserName != resPwd.UserName || usr.Email != resPwd.Email)  //    ModelState.AddModelError(""' "UserName/Email not verified");  else {  	old_usr.Password = DataEncryption.HashString (resPwd.NewPassword);  	old_usr.UpdateTime = DateTime.Now;  	_uow.Commit ();  	Session.Abandon ();  	Session.RemoveAll ();  	return RedirectToAction ("Login"' "Account"' new {  		mg = "Password_reset_successfully"  	});  }  
Magic Number,Ichari.Web,HomeController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\HomeController.cs,ForgotPassword,The following statement contains a magic number: if (ModelState.IsValid) {  	Model.UserInfo usr = _uow.UserInfoService.Get (o => o.UserName == fpwd.UserName);  	if (usr != null && usr.UserName == fpwd.UserName && usr.Email == fpwd.Email) {  		SmtpClient smtpm = new SmtpClient ();  		smtpm.Host = "mail.charilot.cc";  		smtpm.Port = 1025;  		smtpm.EnableSsl = false;  		smtpm.Credentials = new NetworkCredential ("jay@charilot.cc"' "");  		smtpm.DeliveryMethod = SmtpDeliveryMethod.Network;  		MailAddress sender = new MailAddress ("jay@charilot.cc"' "集善网系统"' Encoding.UTF8);  		MailAddress receiver = new MailAddress (fpwd.Email);  		MailMessage eMailMsg = new MailMessage (sender' receiver);  		eMailMsg.Subject = "集善网忘记密码，密码重置系统邮件";  		eMailMsg.Bcc.Add ("jay@charilot.cc");  		//eMailMsg.Bcc.Add("j.ct.sheu@gmail.com");  		eMailMsg.IsBodyHtml = true;  		Random rnd = new Random ();  		DateTime dt = DateTime.Now;  		string resetLink = DataEncryption.EncryptAES (dt.ToBinary ().ToString () + "?" + fpwd.Email + "?" + rnd.Next (100' 10000).ToString () + "?" + fpwd.UserName + "?" + dt.ToShortTimeString ());  		eMailMsg.Body = "尊敬的集善网客户: <br />您好! <br />系统已收到您的密码找回申请，请点击链接 <br /><p>" + "http://" + Request.Url.Host + "/Account/ResetPassword?en=" + resetLink + "</p>重设您的密码。<br /><br />为了您的安全，该邮件通知地址将在 48 小时后失效，谢谢合作。<br /><p>--------------------------------------------------<br />" + "此邮件由系统发出，请勿直接回复! <br />集善网 版权所有(C) 2008-2009</p>";  		eMailMsg.DeliveryNotificationOptions = DeliveryNotificationOptions.OnFailure;  		try {  			smtpm.Send (eMailMsg);  		}  		catch (Exception fre) {  			ModelState.AddModelError (""' fre.Message);  		}  	}  	else  		ModelState.AddModelError (""' "*UserName/Email not found");  }  else  	ModelState.AddModelError (""' "Error 99");  
Magic Number,Ichari.Web,HomeController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\HomeController.cs,ForgotPassword,The following statement contains a magic number: if (ModelState.IsValid) {  	Model.UserInfo usr = _uow.UserInfoService.Get (o => o.UserName == fpwd.UserName);  	if (usr != null && usr.UserName == fpwd.UserName && usr.Email == fpwd.Email) {  		SmtpClient smtpm = new SmtpClient ();  		smtpm.Host = "mail.charilot.cc";  		smtpm.Port = 1025;  		smtpm.EnableSsl = false;  		smtpm.Credentials = new NetworkCredential ("jay@charilot.cc"' "");  		smtpm.DeliveryMethod = SmtpDeliveryMethod.Network;  		MailAddress sender = new MailAddress ("jay@charilot.cc"' "集善网系统"' Encoding.UTF8);  		MailAddress receiver = new MailAddress (fpwd.Email);  		MailMessage eMailMsg = new MailMessage (sender' receiver);  		eMailMsg.Subject = "集善网忘记密码，密码重置系统邮件";  		eMailMsg.Bcc.Add ("jay@charilot.cc");  		//eMailMsg.Bcc.Add("j.ct.sheu@gmail.com");  		eMailMsg.IsBodyHtml = true;  		Random rnd = new Random ();  		DateTime dt = DateTime.Now;  		string resetLink = DataEncryption.EncryptAES (dt.ToBinary ().ToString () + "?" + fpwd.Email + "?" + rnd.Next (100' 10000).ToString () + "?" + fpwd.UserName + "?" + dt.ToShortTimeString ());  		eMailMsg.Body = "尊敬的集善网客户: <br />您好! <br />系统已收到您的密码找回申请，请点击链接 <br /><p>" + "http://" + Request.Url.Host + "/Account/ResetPassword?en=" + resetLink + "</p>重设您的密码。<br /><br />为了您的安全，该邮件通知地址将在 48 小时后失效，谢谢合作。<br /><p>--------------------------------------------------<br />" + "此邮件由系统发出，请勿直接回复! <br />集善网 版权所有(C) 2008-2009</p>";  		eMailMsg.DeliveryNotificationOptions = DeliveryNotificationOptions.OnFailure;  		try {  			smtpm.Send (eMailMsg);  		}  		catch (Exception fre) {  			ModelState.AddModelError (""' fre.Message);  		}  	}  	else  		ModelState.AddModelError (""' "*UserName/Email not found");  }  else  	ModelState.AddModelError (""' "Error 99");  
Magic Number,Ichari.Web,HomeController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\HomeController.cs,ForgotPassword,The following statement contains a magic number: if (ModelState.IsValid) {  	Model.UserInfo usr = _uow.UserInfoService.Get (o => o.UserName == fpwd.UserName);  	if (usr != null && usr.UserName == fpwd.UserName && usr.Email == fpwd.Email) {  		SmtpClient smtpm = new SmtpClient ();  		smtpm.Host = "mail.charilot.cc";  		smtpm.Port = 1025;  		smtpm.EnableSsl = false;  		smtpm.Credentials = new NetworkCredential ("jay@charilot.cc"' "");  		smtpm.DeliveryMethod = SmtpDeliveryMethod.Network;  		MailAddress sender = new MailAddress ("jay@charilot.cc"' "集善网系统"' Encoding.UTF8);  		MailAddress receiver = new MailAddress (fpwd.Email);  		MailMessage eMailMsg = new MailMessage (sender' receiver);  		eMailMsg.Subject = "集善网忘记密码，密码重置系统邮件";  		eMailMsg.Bcc.Add ("jay@charilot.cc");  		//eMailMsg.Bcc.Add("j.ct.sheu@gmail.com");  		eMailMsg.IsBodyHtml = true;  		Random rnd = new Random ();  		DateTime dt = DateTime.Now;  		string resetLink = DataEncryption.EncryptAES (dt.ToBinary ().ToString () + "?" + fpwd.Email + "?" + rnd.Next (100' 10000).ToString () + "?" + fpwd.UserName + "?" + dt.ToShortTimeString ());  		eMailMsg.Body = "尊敬的集善网客户: <br />您好! <br />系统已收到您的密码找回申请，请点击链接 <br /><p>" + "http://" + Request.Url.Host + "/Account/ResetPassword?en=" + resetLink + "</p>重设您的密码。<br /><br />为了您的安全，该邮件通知地址将在 48 小时后失效，谢谢合作。<br /><p>--------------------------------------------------<br />" + "此邮件由系统发出，请勿直接回复! <br />集善网 版权所有(C) 2008-2009</p>";  		eMailMsg.DeliveryNotificationOptions = DeliveryNotificationOptions.OnFailure;  		try {  			smtpm.Send (eMailMsg);  		}  		catch (Exception fre) {  			ModelState.AddModelError (""' fre.Message);  		}  	}  	else  		ModelState.AddModelError (""' "*UserName/Email not found");  }  else  	ModelState.AddModelError (""' "Error 99");  
Magic Number,Ichari.Web,HomeController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\HomeController.cs,ForgotPassword,The following statement contains a magic number: if (usr != null && usr.UserName == fpwd.UserName && usr.Email == fpwd.Email) {  	SmtpClient smtpm = new SmtpClient ();  	smtpm.Host = "mail.charilot.cc";  	smtpm.Port = 1025;  	smtpm.EnableSsl = false;  	smtpm.Credentials = new NetworkCredential ("jay@charilot.cc"' "");  	smtpm.DeliveryMethod = SmtpDeliveryMethod.Network;  	MailAddress sender = new MailAddress ("jay@charilot.cc"' "集善网系统"' Encoding.UTF8);  	MailAddress receiver = new MailAddress (fpwd.Email);  	MailMessage eMailMsg = new MailMessage (sender' receiver);  	eMailMsg.Subject = "集善网忘记密码，密码重置系统邮件";  	eMailMsg.Bcc.Add ("jay@charilot.cc");  	//eMailMsg.Bcc.Add("j.ct.sheu@gmail.com");  	eMailMsg.IsBodyHtml = true;  	Random rnd = new Random ();  	DateTime dt = DateTime.Now;  	string resetLink = DataEncryption.EncryptAES (dt.ToBinary ().ToString () + "?" + fpwd.Email + "?" + rnd.Next (100' 10000).ToString () + "?" + fpwd.UserName + "?" + dt.ToShortTimeString ());  	eMailMsg.Body = "尊敬的集善网客户: <br />您好! <br />系统已收到您的密码找回申请，请点击链接 <br /><p>" + "http://" + Request.Url.Host + "/Account/ResetPassword?en=" + resetLink + "</p>重设您的密码。<br /><br />为了您的安全，该邮件通知地址将在 48 小时后失效，谢谢合作。<br /><p>--------------------------------------------------<br />" + "此邮件由系统发出，请勿直接回复! <br />集善网 版权所有(C) 2008-2009</p>";  	eMailMsg.DeliveryNotificationOptions = DeliveryNotificationOptions.OnFailure;  	try {  		smtpm.Send (eMailMsg);  	}  	catch (Exception fre) {  		ModelState.AddModelError (""' fre.Message);  	}  }  else  	ModelState.AddModelError (""' "*UserName/Email not found");  
Magic Number,Ichari.Web,HomeController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\HomeController.cs,ForgotPassword,The following statement contains a magic number: if (usr != null && usr.UserName == fpwd.UserName && usr.Email == fpwd.Email) {  	SmtpClient smtpm = new SmtpClient ();  	smtpm.Host = "mail.charilot.cc";  	smtpm.Port = 1025;  	smtpm.EnableSsl = false;  	smtpm.Credentials = new NetworkCredential ("jay@charilot.cc"' "");  	smtpm.DeliveryMethod = SmtpDeliveryMethod.Network;  	MailAddress sender = new MailAddress ("jay@charilot.cc"' "集善网系统"' Encoding.UTF8);  	MailAddress receiver = new MailAddress (fpwd.Email);  	MailMessage eMailMsg = new MailMessage (sender' receiver);  	eMailMsg.Subject = "集善网忘记密码，密码重置系统邮件";  	eMailMsg.Bcc.Add ("jay@charilot.cc");  	//eMailMsg.Bcc.Add("j.ct.sheu@gmail.com");  	eMailMsg.IsBodyHtml = true;  	Random rnd = new Random ();  	DateTime dt = DateTime.Now;  	string resetLink = DataEncryption.EncryptAES (dt.ToBinary ().ToString () + "?" + fpwd.Email + "?" + rnd.Next (100' 10000).ToString () + "?" + fpwd.UserName + "?" + dt.ToShortTimeString ());  	eMailMsg.Body = "尊敬的集善网客户: <br />您好! <br />系统已收到您的密码找回申请，请点击链接 <br /><p>" + "http://" + Request.Url.Host + "/Account/ResetPassword?en=" + resetLink + "</p>重设您的密码。<br /><br />为了您的安全，该邮件通知地址将在 48 小时后失效，谢谢合作。<br /><p>--------------------------------------------------<br />" + "此邮件由系统发出，请勿直接回复! <br />集善网 版权所有(C) 2008-2009</p>";  	eMailMsg.DeliveryNotificationOptions = DeliveryNotificationOptions.OnFailure;  	try {  		smtpm.Send (eMailMsg);  	}  	catch (Exception fre) {  		ModelState.AddModelError (""' fre.Message);  	}  }  else  	ModelState.AddModelError (""' "*UserName/Email not found");  
Magic Number,Ichari.Web,HomeController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\HomeController.cs,ForgotPassword,The following statement contains a magic number: if (usr != null && usr.UserName == fpwd.UserName && usr.Email == fpwd.Email) {  	SmtpClient smtpm = new SmtpClient ();  	smtpm.Host = "mail.charilot.cc";  	smtpm.Port = 1025;  	smtpm.EnableSsl = false;  	smtpm.Credentials = new NetworkCredential ("jay@charilot.cc"' "");  	smtpm.DeliveryMethod = SmtpDeliveryMethod.Network;  	MailAddress sender = new MailAddress ("jay@charilot.cc"' "集善网系统"' Encoding.UTF8);  	MailAddress receiver = new MailAddress (fpwd.Email);  	MailMessage eMailMsg = new MailMessage (sender' receiver);  	eMailMsg.Subject = "集善网忘记密码，密码重置系统邮件";  	eMailMsg.Bcc.Add ("jay@charilot.cc");  	//eMailMsg.Bcc.Add("j.ct.sheu@gmail.com");  	eMailMsg.IsBodyHtml = true;  	Random rnd = new Random ();  	DateTime dt = DateTime.Now;  	string resetLink = DataEncryption.EncryptAES (dt.ToBinary ().ToString () + "?" + fpwd.Email + "?" + rnd.Next (100' 10000).ToString () + "?" + fpwd.UserName + "?" + dt.ToShortTimeString ());  	eMailMsg.Body = "尊敬的集善网客户: <br />您好! <br />系统已收到您的密码找回申请，请点击链接 <br /><p>" + "http://" + Request.Url.Host + "/Account/ResetPassword?en=" + resetLink + "</p>重设您的密码。<br /><br />为了您的安全，该邮件通知地址将在 48 小时后失效，谢谢合作。<br /><p>--------------------------------------------------<br />" + "此邮件由系统发出，请勿直接回复! <br />集善网 版权所有(C) 2008-2009</p>";  	eMailMsg.DeliveryNotificationOptions = DeliveryNotificationOptions.OnFailure;  	try {  		smtpm.Send (eMailMsg);  	}  	catch (Exception fre) {  		ModelState.AddModelError (""' fre.Message);  	}  }  else  	ModelState.AddModelError (""' "*UserName/Email not found");  
Magic Number,Ichari.Web,HomeController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\HomeController.cs,ForgotPassword,The following statement contains a magic number: smtpm.Port = 1025;  
Magic Number,Ichari.Web,HomeController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\HomeController.cs,Top,The following statement contains a magic number: if (q != null) {  	var m = new Regex ("^[\\?|&]returnUrl=([^&]*|$)");  	var mm = m.Match (q.Query);  	if (mm != null && mm.Groups.Count == 2) {  		ru = mm.Groups [1].Value;  	}  }  
Magic Number,Ichari.Web,HomeController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\HomeController.cs,Top,The following statement contains a magic number: if (mm != null && mm.Groups.Count == 2) {  	ru = mm.Groups [1].Value;  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,ChariDraw,The following statement contains a magic number: if (Request.Headers ["Referer"] != null && Request.Headers ["Referer"].Contains (ConfigurationManager.AppSettings ["UPOPHost"])) {  	cwvm.IsFromChinaUnion = true;  	base.RenderTip ("完成抽奖前，请先不要关闭本页面，或点击其他链接"' 3);  	_log.Info ("from china union");  	string oAmt = Request.Form.Get ("orderAmount");  	string oQid = Request.Form.Get ("qid");  	string svar = "orderAmount=" + oAmt.ToString () + "&orderCurrency=" + Request.Form.Get ("orderCurrency") + "&qid=" + oQid;  	string sig_in = Request.Form.Get ("signature");  	string sig = DataEncryption.HashUPOPChariOrder (svar).Replace ("-"' "").ToLower ();  	if (sig_in.Equals (sig)) {  		_log.Info ("china union sign ok");  		//signatures equal' writes variables to session  		Session [SessionKey.ID] = oQid;  		Session [SessionKey.DonationAmt] = decimal.Parse (oAmt) / 100;  		Session [SessionKey.UPOPChari] = "Verified";  	}  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,ChariDraw,The following statement contains a magic number: if (Request.Headers ["Referer"] != null && Request.Headers ["Referer"].Contains (ConfigurationManager.AppSettings ["UPOPHost"])) {  	cwvm.IsFromChinaUnion = true;  	base.RenderTip ("完成抽奖前，请先不要关闭本页面，或点击其他链接"' 3);  	_log.Info ("from china union");  	string oAmt = Request.Form.Get ("orderAmount");  	string oQid = Request.Form.Get ("qid");  	string svar = "orderAmount=" + oAmt.ToString () + "&orderCurrency=" + Request.Form.Get ("orderCurrency") + "&qid=" + oQid;  	string sig_in = Request.Form.Get ("signature");  	string sig = DataEncryption.HashUPOPChariOrder (svar).Replace ("-"' "").ToLower ();  	if (sig_in.Equals (sig)) {  		_log.Info ("china union sign ok");  		//signatures equal' writes variables to session  		Session [SessionKey.ID] = oQid;  		Session [SessionKey.DonationAmt] = decimal.Parse (oAmt) / 100;  		Session [SessionKey.UPOPChari] = "Verified";  	}  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,ChariDraw,The following statement contains a magic number: base.RenderTip ("完成抽奖前，请先不要关闭本页面，或点击其他链接"' 3);  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,ChariDraw,The following statement contains a magic number: if (sig_in.Equals (sig)) {  	_log.Info ("china union sign ok");  	//signatures equal' writes variables to session  	Session [SessionKey.ID] = oQid;  	Session [SessionKey.DonationAmt] = decimal.Parse (oAmt) / 100;  	Session [SessionKey.UPOPChari] = "Verified";  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,ChariDraw,The following statement contains a magic number: Session [SessionKey.DonationAmt] = decimal.Parse (oAmt) / 100;  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,ChariDraw,The following statement contains a magic number: for (int i = cwvm.WinList.Count; i < 10; i++) {  	switch (i % 5) {  	case 0:  		ViewBag.WinList += "<ul><li>wahaha</il><li>4天前</li><li>HTC 手机</li></ul>";  		break;  	case 1:  		ViewBag.WinList += "<ul><li>iamgod</il><li>5天前</li><li>Sony TV</li></ul>";  		break;  	case 2:  		ViewBag.WinList += "<ul><li>willywanker</il><li>7天前</li><li>笔记本</li></ul>";  		break;  	case 3:  		ViewBag.WinList += "<ul><li>seanc</il><li>10天前</li><li>自行车</li></ul>";  		break;  	case 4:  		ViewBag.WinList += "<ul><li>jaschen</il><li>13天前</li><li>iPad</li></ul>";  		break;  	}  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,ChariDraw,The following statement contains a magic number: for (int i = cwvm.WinList.Count; i < 10; i++) {  	switch (i % 5) {  	case 0:  		ViewBag.WinList += "<ul><li>wahaha</il><li>4天前</li><li>HTC 手机</li></ul>";  		break;  	case 1:  		ViewBag.WinList += "<ul><li>iamgod</il><li>5天前</li><li>Sony TV</li></ul>";  		break;  	case 2:  		ViewBag.WinList += "<ul><li>willywanker</il><li>7天前</li><li>笔记本</li></ul>";  		break;  	case 3:  		ViewBag.WinList += "<ul><li>seanc</il><li>10天前</li><li>自行车</li></ul>";  		break;  	case 4:  		ViewBag.WinList += "<ul><li>jaschen</il><li>13天前</li><li>iPad</li></ul>";  		break;  	}  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,ChariDraw,The following statement contains a magic number: for (int i = cwvm.WinList.Count; i < 10; i++) {  	switch (i % 5) {  	case 0:  		ViewBag.WinList += "<ul><li>wahaha</il><li>4天前</li><li>HTC 手机</li></ul>";  		break;  	case 1:  		ViewBag.WinList += "<ul><li>iamgod</il><li>5天前</li><li>Sony TV</li></ul>";  		break;  	case 2:  		ViewBag.WinList += "<ul><li>willywanker</il><li>7天前</li><li>笔记本</li></ul>";  		break;  	case 3:  		ViewBag.WinList += "<ul><li>seanc</il><li>10天前</li><li>自行车</li></ul>";  		break;  	case 4:  		ViewBag.WinList += "<ul><li>jaschen</il><li>13天前</li><li>iPad</li></ul>";  		break;  	}  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,ChariDraw,The following statement contains a magic number: for (int i = cwvm.WinList.Count; i < 10; i++) {  	switch (i % 5) {  	case 0:  		ViewBag.WinList += "<ul><li>wahaha</il><li>4天前</li><li>HTC 手机</li></ul>";  		break;  	case 1:  		ViewBag.WinList += "<ul><li>iamgod</il><li>5天前</li><li>Sony TV</li></ul>";  		break;  	case 2:  		ViewBag.WinList += "<ul><li>willywanker</il><li>7天前</li><li>笔记本</li></ul>";  		break;  	case 3:  		ViewBag.WinList += "<ul><li>seanc</il><li>10天前</li><li>自行车</li></ul>";  		break;  	case 4:  		ViewBag.WinList += "<ul><li>jaschen</il><li>13天前</li><li>iPad</li></ul>";  		break;  	}  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,ChariDraw,The following statement contains a magic number: for (int i = cwvm.WinList.Count; i < 10; i++) {  	switch (i % 5) {  	case 0:  		ViewBag.WinList += "<ul><li>wahaha</il><li>4天前</li><li>HTC 手机</li></ul>";  		break;  	case 1:  		ViewBag.WinList += "<ul><li>iamgod</il><li>5天前</li><li>Sony TV</li></ul>";  		break;  	case 2:  		ViewBag.WinList += "<ul><li>willywanker</il><li>7天前</li><li>笔记本</li></ul>";  		break;  	case 3:  		ViewBag.WinList += "<ul><li>seanc</il><li>10天前</li><li>自行车</li></ul>";  		break;  	case 4:  		ViewBag.WinList += "<ul><li>jaschen</il><li>13天前</li><li>iPad</li></ul>";  		break;  	}  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,ChariDraw,The following statement contains a magic number: switch (i % 5) {  case 0:  	ViewBag.WinList += "<ul><li>wahaha</il><li>4天前</li><li>HTC 手机</li></ul>";  	break;  case 1:  	ViewBag.WinList += "<ul><li>iamgod</il><li>5天前</li><li>Sony TV</li></ul>";  	break;  case 2:  	ViewBag.WinList += "<ul><li>willywanker</il><li>7天前</li><li>笔记本</li></ul>";  	break;  case 3:  	ViewBag.WinList += "<ul><li>seanc</il><li>10天前</li><li>自行车</li></ul>";  	break;  case 4:  	ViewBag.WinList += "<ul><li>jaschen</il><li>13天前</li><li>iPad</li></ul>";  	break;  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,ChariDraw,The following statement contains a magic number: switch (i % 5) {  case 0:  	ViewBag.WinList += "<ul><li>wahaha</il><li>4天前</li><li>HTC 手机</li></ul>";  	break;  case 1:  	ViewBag.WinList += "<ul><li>iamgod</il><li>5天前</li><li>Sony TV</li></ul>";  	break;  case 2:  	ViewBag.WinList += "<ul><li>willywanker</il><li>7天前</li><li>笔记本</li></ul>";  	break;  case 3:  	ViewBag.WinList += "<ul><li>seanc</il><li>10天前</li><li>自行车</li></ul>";  	break;  case 4:  	ViewBag.WinList += "<ul><li>jaschen</il><li>13天前</li><li>iPad</li></ul>";  	break;  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,ChariDraw,The following statement contains a magic number: switch (i % 5) {  case 0:  	ViewBag.WinList += "<ul><li>wahaha</il><li>4天前</li><li>HTC 手机</li></ul>";  	break;  case 1:  	ViewBag.WinList += "<ul><li>iamgod</il><li>5天前</li><li>Sony TV</li></ul>";  	break;  case 2:  	ViewBag.WinList += "<ul><li>willywanker</il><li>7天前</li><li>笔记本</li></ul>";  	break;  case 3:  	ViewBag.WinList += "<ul><li>seanc</il><li>10天前</li><li>自行车</li></ul>";  	break;  case 4:  	ViewBag.WinList += "<ul><li>jaschen</il><li>13天前</li><li>iPad</li></ul>";  	break;  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,ChariDraw,The following statement contains a magic number: switch (i % 5) {  case 0:  	ViewBag.WinList += "<ul><li>wahaha</il><li>4天前</li><li>HTC 手机</li></ul>";  	break;  case 1:  	ViewBag.WinList += "<ul><li>iamgod</il><li>5天前</li><li>Sony TV</li></ul>";  	break;  case 2:  	ViewBag.WinList += "<ul><li>willywanker</il><li>7天前</li><li>笔记本</li></ul>";  	break;  case 3:  	ViewBag.WinList += "<ul><li>seanc</il><li>10天前</li><li>自行车</li></ul>";  	break;  case 4:  	ViewBag.WinList += "<ul><li>jaschen</il><li>13天前</li><li>iPad</li></ul>";  	break;  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The following statement contains a magic number: if (Session ["ChariGame"].ToString () == DataEncryption.HashString ("chari.game")) {  	//直接输入捐赠号  	UserInfo usr = (UserInfo)Session [SessionKey.User];  	string DonationId = (string)Session [SessionKey.DonationId];  	decimal DonationAmt = 0;  	if (Session [SessionKey.DonationAmt] != null)  		DonationAmt = (decimal)Session [SessionKey.DonationAmt];  	#region User Logged In  	if (usr != null) {  		//user logged in  		UserInfo dbusr = _uow.UserInfoService.Get (o => o.Id == usr.Id);  		if (dbusr != null && usr.Password == dbusr.Password && usr.UserName == dbusr.UserName) {  			//user valid' get user's donations  			//List<LoveChange> donations = _uow.LoveChangeService.GetQueryList(o => o.UserId == dbusr.Id  && o.IsGame != true).OrderBy(o => o.CreateTime).ToList();  			var donation = _uow.LoveChangeService.GetQueryList (o => o.UserId == dbusr.Id && o.IsGame != true).OrderBy (o => o.CreateTime).FirstOrDefault ();  			//int dtype = (int)OrderType.Donation;  			//List<Order> orderList = _uow.OrderService.GetQueryList(o => o.UserId == dbusr.Id && o.IsGame != true && o.OrderType == dtype && o.Status == 10).OrderBy(o => o.PayTime).ToList();  			var donationOrder = _uow.OrderService.GetQueryList (t => t.UserId == dbusr.Id && t.IsGame == false && t.OrderType == (int)OrderType.Donation && t.Status >= (int)OrderState.Paid).OrderBy (t => t.PayTime).FirstOrDefault ();  			#region 愛心零錢 UnionPay  			//if (donations.Count > 0)  			if (donation != null) {  				//愛心零錢 available for drawings' select earliest and create drawing entry  				Drawings NewDraw = new Drawings ();  				NewDraw.Source = (int)GameSource.ChangeOfCare;  				NewDraw.UserId = dbusr.Id;  				NewDraw.OrderNo = donation.UnionOrder;  				//get available prizes  				List<Prize> przList = _uow.PrizeService.SelectPrizeList (true);  				if (przList.Count > 0) {  					//prize available' calculate winning result  					bool DrawResult = DataEncryption.GetDrawingResult ();  					NewDraw.IsWinner = DrawResult;  					if (DrawResult) {  						//user won a prize' selects a random prize from the list  						Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  						NewDraw.PrizeId = wPrize.Id;  						//increase used prize count  						wPrize.UsedCount += 1;  						NewDraw.CreateTime = DateTime.Now;  						donation.GameTime = NewDraw.CreateTime;  						donation.IsGame = true;  						_uow.DrawingsService.Add (NewDraw);  						_uow.Commit ();  						int ang = wPrize.Angle + 720;  						return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }";  					}  					else {  						//user did not win  						NewDraw.CreateTime = DateTime.Now;  						donation.GameTime = NewDraw.CreateTime;  						NewDraw.IsConfirrmed = true;  						donation.IsGame = true;  						_uow.DrawingsService.Add (NewDraw);  						_uow.Commit ();  						return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  					}  				}  				else {  					//no prize available' user set to not win  					NewDraw.CreateTime = DateTime.Now;  					donation.GameTime = NewDraw.CreateTime;  					NewDraw.IsConfirrmed = true;  					donation.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  				}  			}  			#endregion  			#region 愛心捐贈 ichari  			else if (donationOrder != null) {  				//愛心捐贈 available for drawings' select earliest and create drawing entry  				Drawings NewDraw = new Drawings ();  				NewDraw.Source = (int)GameSource.IchariDonation;  				NewDraw.UserId = dbusr.Id;  				NewDraw.OrderNo = donationOrder.TradeNo;  				//get available prizes  				List<Prize> przList = _uow.PrizeService.SelectRandomPrizeList (11' true);  				if (przList.Count > 0) {  					//prize available' calculate winning result  					bool DrawResult = DataEncryption.GetDrawingResult ();  					NewDraw.IsWinner = DrawResult;  					if (DrawResult) {  						//user won a prize' selects a random prize from the list  						Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  						//end prize selection  						NewDraw.PrizeId = wPrize.Id;  						//increase used prize count  						wPrize.UsedCount += 1;  						NewDraw.CreateTime = DateTime.Now;  						_uow.DrawingsService.Add (NewDraw);  						//更新捐赠订单  						donationOrder.UpdateTime = NewDraw.CreateTime;  						donationOrder.IsGame = true;  						_uow.Commit ();  						int ang = wPrize.Angle + 720;  						return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }";  					}  					else {  						//user did not win  						NewDraw.CreateTime = DateTime.Now;  						NewDraw.IsConfirrmed = true;  						//更新捐赠订单  						donationOrder.UpdateTime = NewDraw.CreateTime;  						donationOrder.IsGame = true;  						_uow.DrawingsService.Add (NewDraw);  						_uow.Commit ();  						return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  					}  				}  				else {  					//no prize available' user set to not win  					NewDraw.CreateTime = DateTime.Now;  					donationOrder.UpdateTime = NewDraw.CreateTime;  					NewDraw.IsConfirrmed = true;  					donationOrder.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  				}  			}  			#endregion  			else {  				_log.Info ("user is logon'but not exist donation order");  				//no donations available for drawing  				return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"对不起，您已经没有抽奖机会了\" }";  			}  		}  	}  	#endregion  	#region Donation Entered or from UPOP  	else if (!string.IsNullOrWhiteSpace (DonationId) && DonationAmt > 0) {  		//donation entered  		LoveChange lc = _uow.LoveChangeService.Get (o => o.UnionOrder == DonationId & o.Amount == DonationAmt);  		if (lc != null && lc.Amount == DonationAmt && lc.UnionOrder == DonationId) {  			//donation valid'   			if (lc.IsGame != true) {  				//check if prize available' create drawing entry  				Drawings NewDraw = new Drawings ();  				NewDraw.OrderNo = DonationId;  				NewDraw.Source = (int)GameSource.ChangeOfCare;  				List<Prize> przList = _uow.PrizeService.SelectRandomPrizeList (11' true);  				if (przList.Count > 0) {  					//prize available' get drawing result  					bool drawResult = DataEncryption.GetDrawingResult ();  					NewDraw.IsWinner = drawResult;  					if (drawResult) {  						//user won' randomly selects a prize  						Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  						NewDraw.PrizeId = wPrize.Id;  						//increase used count  						wPrize.UsedCount += 1;  						NewDraw.CreateTime = DateTime.Now;  						lc.GameTime = NewDraw.CreateTime;  						lc.IsGame = true;  						_uow.DrawingsService.Add (NewDraw);  						_uow.Commit ();  						Session [SessionKey.DrawId] = _uow.DrawingsService.Get (o => o.PrizeId == NewDraw.PrizeId && o.OrderNo == NewDraw.OrderNo).Id;  						int ang = wPrize.Angle + 720;  						return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"win\" }";  					}  					else {  						//user did not win  						NewDraw.CreateTime = DateTime.Now;  						lc.GameTime = NewDraw.CreateTime;  						NewDraw.IsConfirrmed = true;  						lc.IsGame = true;  						_uow.DrawingsService.Add (NewDraw);  						_uow.Commit ();  						return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"lose\" }";  					}  				}  				else {  					//prize not available' user set to lost  					NewDraw.CreateTime = DateTime.Now;  					lc.GameTime = NewDraw.CreateTime;  					NewDraw.IsConfirrmed = true;  					lc.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"lose\" }";  				}  			}  			else {  				//game played  				return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"此捐赠单已抽奖，请登录查询中奖记录。\" }";  			}  		}  		else {  			//donation invalid  			return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"请重新确认您的捐赠单号。（或凭证号）。\" }";  		}  	}  	#endregion  	else {  		//user not logged in and no donation entered' disable flash  		return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"《请登陆用户》 或 《填写捐赠单》\"' \"url\" : \"login\" }";  	}  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The following statement contains a magic number: if (Session ["ChariGame"].ToString () == DataEncryption.HashString ("chari.game")) {  	//直接输入捐赠号  	UserInfo usr = (UserInfo)Session [SessionKey.User];  	string DonationId = (string)Session [SessionKey.DonationId];  	decimal DonationAmt = 0;  	if (Session [SessionKey.DonationAmt] != null)  		DonationAmt = (decimal)Session [SessionKey.DonationAmt];  	#region User Logged In  	if (usr != null) {  		//user logged in  		UserInfo dbusr = _uow.UserInfoService.Get (o => o.Id == usr.Id);  		if (dbusr != null && usr.Password == dbusr.Password && usr.UserName == dbusr.UserName) {  			//user valid' get user's donations  			//List<LoveChange> donations = _uow.LoveChangeService.GetQueryList(o => o.UserId == dbusr.Id  && o.IsGame != true).OrderBy(o => o.CreateTime).ToList();  			var donation = _uow.LoveChangeService.GetQueryList (o => o.UserId == dbusr.Id && o.IsGame != true).OrderBy (o => o.CreateTime).FirstOrDefault ();  			//int dtype = (int)OrderType.Donation;  			//List<Order> orderList = _uow.OrderService.GetQueryList(o => o.UserId == dbusr.Id && o.IsGame != true && o.OrderType == dtype && o.Status == 10).OrderBy(o => o.PayTime).ToList();  			var donationOrder = _uow.OrderService.GetQueryList (t => t.UserId == dbusr.Id && t.IsGame == false && t.OrderType == (int)OrderType.Donation && t.Status >= (int)OrderState.Paid).OrderBy (t => t.PayTime).FirstOrDefault ();  			#region 愛心零錢 UnionPay  			//if (donations.Count > 0)  			if (donation != null) {  				//愛心零錢 available for drawings' select earliest and create drawing entry  				Drawings NewDraw = new Drawings ();  				NewDraw.Source = (int)GameSource.ChangeOfCare;  				NewDraw.UserId = dbusr.Id;  				NewDraw.OrderNo = donation.UnionOrder;  				//get available prizes  				List<Prize> przList = _uow.PrizeService.SelectPrizeList (true);  				if (przList.Count > 0) {  					//prize available' calculate winning result  					bool DrawResult = DataEncryption.GetDrawingResult ();  					NewDraw.IsWinner = DrawResult;  					if (DrawResult) {  						//user won a prize' selects a random prize from the list  						Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  						NewDraw.PrizeId = wPrize.Id;  						//increase used prize count  						wPrize.UsedCount += 1;  						NewDraw.CreateTime = DateTime.Now;  						donation.GameTime = NewDraw.CreateTime;  						donation.IsGame = true;  						_uow.DrawingsService.Add (NewDraw);  						_uow.Commit ();  						int ang = wPrize.Angle + 720;  						return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }";  					}  					else {  						//user did not win  						NewDraw.CreateTime = DateTime.Now;  						donation.GameTime = NewDraw.CreateTime;  						NewDraw.IsConfirrmed = true;  						donation.IsGame = true;  						_uow.DrawingsService.Add (NewDraw);  						_uow.Commit ();  						return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  					}  				}  				else {  					//no prize available' user set to not win  					NewDraw.CreateTime = DateTime.Now;  					donation.GameTime = NewDraw.CreateTime;  					NewDraw.IsConfirrmed = true;  					donation.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  				}  			}  			#endregion  			#region 愛心捐贈 ichari  			else if (donationOrder != null) {  				//愛心捐贈 available for drawings' select earliest and create drawing entry  				Drawings NewDraw = new Drawings ();  				NewDraw.Source = (int)GameSource.IchariDonation;  				NewDraw.UserId = dbusr.Id;  				NewDraw.OrderNo = donationOrder.TradeNo;  				//get available prizes  				List<Prize> przList = _uow.PrizeService.SelectRandomPrizeList (11' true);  				if (przList.Count > 0) {  					//prize available' calculate winning result  					bool DrawResult = DataEncryption.GetDrawingResult ();  					NewDraw.IsWinner = DrawResult;  					if (DrawResult) {  						//user won a prize' selects a random prize from the list  						Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  						//end prize selection  						NewDraw.PrizeId = wPrize.Id;  						//increase used prize count  						wPrize.UsedCount += 1;  						NewDraw.CreateTime = DateTime.Now;  						_uow.DrawingsService.Add (NewDraw);  						//更新捐赠订单  						donationOrder.UpdateTime = NewDraw.CreateTime;  						donationOrder.IsGame = true;  						_uow.Commit ();  						int ang = wPrize.Angle + 720;  						return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }";  					}  					else {  						//user did not win  						NewDraw.CreateTime = DateTime.Now;  						NewDraw.IsConfirrmed = true;  						//更新捐赠订单  						donationOrder.UpdateTime = NewDraw.CreateTime;  						donationOrder.IsGame = true;  						_uow.DrawingsService.Add (NewDraw);  						_uow.Commit ();  						return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  					}  				}  				else {  					//no prize available' user set to not win  					NewDraw.CreateTime = DateTime.Now;  					donationOrder.UpdateTime = NewDraw.CreateTime;  					NewDraw.IsConfirrmed = true;  					donationOrder.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  				}  			}  			#endregion  			else {  				_log.Info ("user is logon'but not exist donation order");  				//no donations available for drawing  				return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"对不起，您已经没有抽奖机会了\" }";  			}  		}  	}  	#endregion  	#region Donation Entered or from UPOP  	else if (!string.IsNullOrWhiteSpace (DonationId) && DonationAmt > 0) {  		//donation entered  		LoveChange lc = _uow.LoveChangeService.Get (o => o.UnionOrder == DonationId & o.Amount == DonationAmt);  		if (lc != null && lc.Amount == DonationAmt && lc.UnionOrder == DonationId) {  			//donation valid'   			if (lc.IsGame != true) {  				//check if prize available' create drawing entry  				Drawings NewDraw = new Drawings ();  				NewDraw.OrderNo = DonationId;  				NewDraw.Source = (int)GameSource.ChangeOfCare;  				List<Prize> przList = _uow.PrizeService.SelectRandomPrizeList (11' true);  				if (przList.Count > 0) {  					//prize available' get drawing result  					bool drawResult = DataEncryption.GetDrawingResult ();  					NewDraw.IsWinner = drawResult;  					if (drawResult) {  						//user won' randomly selects a prize  						Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  						NewDraw.PrizeId = wPrize.Id;  						//increase used count  						wPrize.UsedCount += 1;  						NewDraw.CreateTime = DateTime.Now;  						lc.GameTime = NewDraw.CreateTime;  						lc.IsGame = true;  						_uow.DrawingsService.Add (NewDraw);  						_uow.Commit ();  						Session [SessionKey.DrawId] = _uow.DrawingsService.Get (o => o.PrizeId == NewDraw.PrizeId && o.OrderNo == NewDraw.OrderNo).Id;  						int ang = wPrize.Angle + 720;  						return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"win\" }";  					}  					else {  						//user did not win  						NewDraw.CreateTime = DateTime.Now;  						lc.GameTime = NewDraw.CreateTime;  						NewDraw.IsConfirrmed = true;  						lc.IsGame = true;  						_uow.DrawingsService.Add (NewDraw);  						_uow.Commit ();  						return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"lose\" }";  					}  				}  				else {  					//prize not available' user set to lost  					NewDraw.CreateTime = DateTime.Now;  					lc.GameTime = NewDraw.CreateTime;  					NewDraw.IsConfirrmed = true;  					lc.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"lose\" }";  				}  			}  			else {  				//game played  				return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"此捐赠单已抽奖，请登录查询中奖记录。\" }";  			}  		}  		else {  			//donation invalid  			return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"请重新确认您的捐赠单号。（或凭证号）。\" }";  		}  	}  	#endregion  	else {  		//user not logged in and no donation entered' disable flash  		return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"《请登陆用户》 或 《填写捐赠单》\"' \"url\" : \"login\" }";  	}  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The following statement contains a magic number: if (Session ["ChariGame"].ToString () == DataEncryption.HashString ("chari.game")) {  	//直接输入捐赠号  	UserInfo usr = (UserInfo)Session [SessionKey.User];  	string DonationId = (string)Session [SessionKey.DonationId];  	decimal DonationAmt = 0;  	if (Session [SessionKey.DonationAmt] != null)  		DonationAmt = (decimal)Session [SessionKey.DonationAmt];  	#region User Logged In  	if (usr != null) {  		//user logged in  		UserInfo dbusr = _uow.UserInfoService.Get (o => o.Id == usr.Id);  		if (dbusr != null && usr.Password == dbusr.Password && usr.UserName == dbusr.UserName) {  			//user valid' get user's donations  			//List<LoveChange> donations = _uow.LoveChangeService.GetQueryList(o => o.UserId == dbusr.Id  && o.IsGame != true).OrderBy(o => o.CreateTime).ToList();  			var donation = _uow.LoveChangeService.GetQueryList (o => o.UserId == dbusr.Id && o.IsGame != true).OrderBy (o => o.CreateTime).FirstOrDefault ();  			//int dtype = (int)OrderType.Donation;  			//List<Order> orderList = _uow.OrderService.GetQueryList(o => o.UserId == dbusr.Id && o.IsGame != true && o.OrderType == dtype && o.Status == 10).OrderBy(o => o.PayTime).ToList();  			var donationOrder = _uow.OrderService.GetQueryList (t => t.UserId == dbusr.Id && t.IsGame == false && t.OrderType == (int)OrderType.Donation && t.Status >= (int)OrderState.Paid).OrderBy (t => t.PayTime).FirstOrDefault ();  			#region 愛心零錢 UnionPay  			//if (donations.Count > 0)  			if (donation != null) {  				//愛心零錢 available for drawings' select earliest and create drawing entry  				Drawings NewDraw = new Drawings ();  				NewDraw.Source = (int)GameSource.ChangeOfCare;  				NewDraw.UserId = dbusr.Id;  				NewDraw.OrderNo = donation.UnionOrder;  				//get available prizes  				List<Prize> przList = _uow.PrizeService.SelectPrizeList (true);  				if (przList.Count > 0) {  					//prize available' calculate winning result  					bool DrawResult = DataEncryption.GetDrawingResult ();  					NewDraw.IsWinner = DrawResult;  					if (DrawResult) {  						//user won a prize' selects a random prize from the list  						Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  						NewDraw.PrizeId = wPrize.Id;  						//increase used prize count  						wPrize.UsedCount += 1;  						NewDraw.CreateTime = DateTime.Now;  						donation.GameTime = NewDraw.CreateTime;  						donation.IsGame = true;  						_uow.DrawingsService.Add (NewDraw);  						_uow.Commit ();  						int ang = wPrize.Angle + 720;  						return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }";  					}  					else {  						//user did not win  						NewDraw.CreateTime = DateTime.Now;  						donation.GameTime = NewDraw.CreateTime;  						NewDraw.IsConfirrmed = true;  						donation.IsGame = true;  						_uow.DrawingsService.Add (NewDraw);  						_uow.Commit ();  						return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  					}  				}  				else {  					//no prize available' user set to not win  					NewDraw.CreateTime = DateTime.Now;  					donation.GameTime = NewDraw.CreateTime;  					NewDraw.IsConfirrmed = true;  					donation.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  				}  			}  			#endregion  			#region 愛心捐贈 ichari  			else if (donationOrder != null) {  				//愛心捐贈 available for drawings' select earliest and create drawing entry  				Drawings NewDraw = new Drawings ();  				NewDraw.Source = (int)GameSource.IchariDonation;  				NewDraw.UserId = dbusr.Id;  				NewDraw.OrderNo = donationOrder.TradeNo;  				//get available prizes  				List<Prize> przList = _uow.PrizeService.SelectRandomPrizeList (11' true);  				if (przList.Count > 0) {  					//prize available' calculate winning result  					bool DrawResult = DataEncryption.GetDrawingResult ();  					NewDraw.IsWinner = DrawResult;  					if (DrawResult) {  						//user won a prize' selects a random prize from the list  						Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  						//end prize selection  						NewDraw.PrizeId = wPrize.Id;  						//increase used prize count  						wPrize.UsedCount += 1;  						NewDraw.CreateTime = DateTime.Now;  						_uow.DrawingsService.Add (NewDraw);  						//更新捐赠订单  						donationOrder.UpdateTime = NewDraw.CreateTime;  						donationOrder.IsGame = true;  						_uow.Commit ();  						int ang = wPrize.Angle + 720;  						return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }";  					}  					else {  						//user did not win  						NewDraw.CreateTime = DateTime.Now;  						NewDraw.IsConfirrmed = true;  						//更新捐赠订单  						donationOrder.UpdateTime = NewDraw.CreateTime;  						donationOrder.IsGame = true;  						_uow.DrawingsService.Add (NewDraw);  						_uow.Commit ();  						return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  					}  				}  				else {  					//no prize available' user set to not win  					NewDraw.CreateTime = DateTime.Now;  					donationOrder.UpdateTime = NewDraw.CreateTime;  					NewDraw.IsConfirrmed = true;  					donationOrder.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  				}  			}  			#endregion  			else {  				_log.Info ("user is logon'but not exist donation order");  				//no donations available for drawing  				return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"对不起，您已经没有抽奖机会了\" }";  			}  		}  	}  	#endregion  	#region Donation Entered or from UPOP  	else if (!string.IsNullOrWhiteSpace (DonationId) && DonationAmt > 0) {  		//donation entered  		LoveChange lc = _uow.LoveChangeService.Get (o => o.UnionOrder == DonationId & o.Amount == DonationAmt);  		if (lc != null && lc.Amount == DonationAmt && lc.UnionOrder == DonationId) {  			//donation valid'   			if (lc.IsGame != true) {  				//check if prize available' create drawing entry  				Drawings NewDraw = new Drawings ();  				NewDraw.OrderNo = DonationId;  				NewDraw.Source = (int)GameSource.ChangeOfCare;  				List<Prize> przList = _uow.PrizeService.SelectRandomPrizeList (11' true);  				if (przList.Count > 0) {  					//prize available' get drawing result  					bool drawResult = DataEncryption.GetDrawingResult ();  					NewDraw.IsWinner = drawResult;  					if (drawResult) {  						//user won' randomly selects a prize  						Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  						NewDraw.PrizeId = wPrize.Id;  						//increase used count  						wPrize.UsedCount += 1;  						NewDraw.CreateTime = DateTime.Now;  						lc.GameTime = NewDraw.CreateTime;  						lc.IsGame = true;  						_uow.DrawingsService.Add (NewDraw);  						_uow.Commit ();  						Session [SessionKey.DrawId] = _uow.DrawingsService.Get (o => o.PrizeId == NewDraw.PrizeId && o.OrderNo == NewDraw.OrderNo).Id;  						int ang = wPrize.Angle + 720;  						return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"win\" }";  					}  					else {  						//user did not win  						NewDraw.CreateTime = DateTime.Now;  						lc.GameTime = NewDraw.CreateTime;  						NewDraw.IsConfirrmed = true;  						lc.IsGame = true;  						_uow.DrawingsService.Add (NewDraw);  						_uow.Commit ();  						return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"lose\" }";  					}  				}  				else {  					//prize not available' user set to lost  					NewDraw.CreateTime = DateTime.Now;  					lc.GameTime = NewDraw.CreateTime;  					NewDraw.IsConfirrmed = true;  					lc.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"lose\" }";  				}  			}  			else {  				//game played  				return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"此捐赠单已抽奖，请登录查询中奖记录。\" }";  			}  		}  		else {  			//donation invalid  			return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"请重新确认您的捐赠单号。（或凭证号）。\" }";  		}  	}  	#endregion  	else {  		//user not logged in and no donation entered' disable flash  		return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"《请登陆用户》 或 《填写捐赠单》\"' \"url\" : \"login\" }";  	}  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The following statement contains a magic number: if (Session ["ChariGame"].ToString () == DataEncryption.HashString ("chari.game")) {  	//直接输入捐赠号  	UserInfo usr = (UserInfo)Session [SessionKey.User];  	string DonationId = (string)Session [SessionKey.DonationId];  	decimal DonationAmt = 0;  	if (Session [SessionKey.DonationAmt] != null)  		DonationAmt = (decimal)Session [SessionKey.DonationAmt];  	#region User Logged In  	if (usr != null) {  		//user logged in  		UserInfo dbusr = _uow.UserInfoService.Get (o => o.Id == usr.Id);  		if (dbusr != null && usr.Password == dbusr.Password && usr.UserName == dbusr.UserName) {  			//user valid' get user's donations  			//List<LoveChange> donations = _uow.LoveChangeService.GetQueryList(o => o.UserId == dbusr.Id  && o.IsGame != true).OrderBy(o => o.CreateTime).ToList();  			var donation = _uow.LoveChangeService.GetQueryList (o => o.UserId == dbusr.Id && o.IsGame != true).OrderBy (o => o.CreateTime).FirstOrDefault ();  			//int dtype = (int)OrderType.Donation;  			//List<Order> orderList = _uow.OrderService.GetQueryList(o => o.UserId == dbusr.Id && o.IsGame != true && o.OrderType == dtype && o.Status == 10).OrderBy(o => o.PayTime).ToList();  			var donationOrder = _uow.OrderService.GetQueryList (t => t.UserId == dbusr.Id && t.IsGame == false && t.OrderType == (int)OrderType.Donation && t.Status >= (int)OrderState.Paid).OrderBy (t => t.PayTime).FirstOrDefault ();  			#region 愛心零錢 UnionPay  			//if (donations.Count > 0)  			if (donation != null) {  				//愛心零錢 available for drawings' select earliest and create drawing entry  				Drawings NewDraw = new Drawings ();  				NewDraw.Source = (int)GameSource.ChangeOfCare;  				NewDraw.UserId = dbusr.Id;  				NewDraw.OrderNo = donation.UnionOrder;  				//get available prizes  				List<Prize> przList = _uow.PrizeService.SelectPrizeList (true);  				if (przList.Count > 0) {  					//prize available' calculate winning result  					bool DrawResult = DataEncryption.GetDrawingResult ();  					NewDraw.IsWinner = DrawResult;  					if (DrawResult) {  						//user won a prize' selects a random prize from the list  						Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  						NewDraw.PrizeId = wPrize.Id;  						//increase used prize count  						wPrize.UsedCount += 1;  						NewDraw.CreateTime = DateTime.Now;  						donation.GameTime = NewDraw.CreateTime;  						donation.IsGame = true;  						_uow.DrawingsService.Add (NewDraw);  						_uow.Commit ();  						int ang = wPrize.Angle + 720;  						return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }";  					}  					else {  						//user did not win  						NewDraw.CreateTime = DateTime.Now;  						donation.GameTime = NewDraw.CreateTime;  						NewDraw.IsConfirrmed = true;  						donation.IsGame = true;  						_uow.DrawingsService.Add (NewDraw);  						_uow.Commit ();  						return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  					}  				}  				else {  					//no prize available' user set to not win  					NewDraw.CreateTime = DateTime.Now;  					donation.GameTime = NewDraw.CreateTime;  					NewDraw.IsConfirrmed = true;  					donation.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  				}  			}  			#endregion  			#region 愛心捐贈 ichari  			else if (donationOrder != null) {  				//愛心捐贈 available for drawings' select earliest and create drawing entry  				Drawings NewDraw = new Drawings ();  				NewDraw.Source = (int)GameSource.IchariDonation;  				NewDraw.UserId = dbusr.Id;  				NewDraw.OrderNo = donationOrder.TradeNo;  				//get available prizes  				List<Prize> przList = _uow.PrizeService.SelectRandomPrizeList (11' true);  				if (przList.Count > 0) {  					//prize available' calculate winning result  					bool DrawResult = DataEncryption.GetDrawingResult ();  					NewDraw.IsWinner = DrawResult;  					if (DrawResult) {  						//user won a prize' selects a random prize from the list  						Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  						//end prize selection  						NewDraw.PrizeId = wPrize.Id;  						//increase used prize count  						wPrize.UsedCount += 1;  						NewDraw.CreateTime = DateTime.Now;  						_uow.DrawingsService.Add (NewDraw);  						//更新捐赠订单  						donationOrder.UpdateTime = NewDraw.CreateTime;  						donationOrder.IsGame = true;  						_uow.Commit ();  						int ang = wPrize.Angle + 720;  						return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }";  					}  					else {  						//user did not win  						NewDraw.CreateTime = DateTime.Now;  						NewDraw.IsConfirrmed = true;  						//更新捐赠订单  						donationOrder.UpdateTime = NewDraw.CreateTime;  						donationOrder.IsGame = true;  						_uow.DrawingsService.Add (NewDraw);  						_uow.Commit ();  						return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  					}  				}  				else {  					//no prize available' user set to not win  					NewDraw.CreateTime = DateTime.Now;  					donationOrder.UpdateTime = NewDraw.CreateTime;  					NewDraw.IsConfirrmed = true;  					donationOrder.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  				}  			}  			#endregion  			else {  				_log.Info ("user is logon'but not exist donation order");  				//no donations available for drawing  				return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"对不起，您已经没有抽奖机会了\" }";  			}  		}  	}  	#endregion  	#region Donation Entered or from UPOP  	else if (!string.IsNullOrWhiteSpace (DonationId) && DonationAmt > 0) {  		//donation entered  		LoveChange lc = _uow.LoveChangeService.Get (o => o.UnionOrder == DonationId & o.Amount == DonationAmt);  		if (lc != null && lc.Amount == DonationAmt && lc.UnionOrder == DonationId) {  			//donation valid'   			if (lc.IsGame != true) {  				//check if prize available' create drawing entry  				Drawings NewDraw = new Drawings ();  				NewDraw.OrderNo = DonationId;  				NewDraw.Source = (int)GameSource.ChangeOfCare;  				List<Prize> przList = _uow.PrizeService.SelectRandomPrizeList (11' true);  				if (przList.Count > 0) {  					//prize available' get drawing result  					bool drawResult = DataEncryption.GetDrawingResult ();  					NewDraw.IsWinner = drawResult;  					if (drawResult) {  						//user won' randomly selects a prize  						Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  						NewDraw.PrizeId = wPrize.Id;  						//increase used count  						wPrize.UsedCount += 1;  						NewDraw.CreateTime = DateTime.Now;  						lc.GameTime = NewDraw.CreateTime;  						lc.IsGame = true;  						_uow.DrawingsService.Add (NewDraw);  						_uow.Commit ();  						Session [SessionKey.DrawId] = _uow.DrawingsService.Get (o => o.PrizeId == NewDraw.PrizeId && o.OrderNo == NewDraw.OrderNo).Id;  						int ang = wPrize.Angle + 720;  						return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"win\" }";  					}  					else {  						//user did not win  						NewDraw.CreateTime = DateTime.Now;  						lc.GameTime = NewDraw.CreateTime;  						NewDraw.IsConfirrmed = true;  						lc.IsGame = true;  						_uow.DrawingsService.Add (NewDraw);  						_uow.Commit ();  						return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"lose\" }";  					}  				}  				else {  					//prize not available' user set to lost  					NewDraw.CreateTime = DateTime.Now;  					lc.GameTime = NewDraw.CreateTime;  					NewDraw.IsConfirrmed = true;  					lc.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"lose\" }";  				}  			}  			else {  				//game played  				return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"此捐赠单已抽奖，请登录查询中奖记录。\" }";  			}  		}  		else {  			//donation invalid  			return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"请重新确认您的捐赠单号。（或凭证号）。\" }";  		}  	}  	#endregion  	else {  		//user not logged in and no donation entered' disable flash  		return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"《请登陆用户》 或 《填写捐赠单》\"' \"url\" : \"login\" }";  	}  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The following statement contains a magic number: if (Session ["ChariGame"].ToString () == DataEncryption.HashString ("chari.game")) {  	//直接输入捐赠号  	UserInfo usr = (UserInfo)Session [SessionKey.User];  	string DonationId = (string)Session [SessionKey.DonationId];  	decimal DonationAmt = 0;  	if (Session [SessionKey.DonationAmt] != null)  		DonationAmt = (decimal)Session [SessionKey.DonationAmt];  	#region User Logged In  	if (usr != null) {  		//user logged in  		UserInfo dbusr = _uow.UserInfoService.Get (o => o.Id == usr.Id);  		if (dbusr != null && usr.Password == dbusr.Password && usr.UserName == dbusr.UserName) {  			//user valid' get user's donations  			//List<LoveChange> donations = _uow.LoveChangeService.GetQueryList(o => o.UserId == dbusr.Id  && o.IsGame != true).OrderBy(o => o.CreateTime).ToList();  			var donation = _uow.LoveChangeService.GetQueryList (o => o.UserId == dbusr.Id && o.IsGame != true).OrderBy (o => o.CreateTime).FirstOrDefault ();  			//int dtype = (int)OrderType.Donation;  			//List<Order> orderList = _uow.OrderService.GetQueryList(o => o.UserId == dbusr.Id && o.IsGame != true && o.OrderType == dtype && o.Status == 10).OrderBy(o => o.PayTime).ToList();  			var donationOrder = _uow.OrderService.GetQueryList (t => t.UserId == dbusr.Id && t.IsGame == false && t.OrderType == (int)OrderType.Donation && t.Status >= (int)OrderState.Paid).OrderBy (t => t.PayTime).FirstOrDefault ();  			#region 愛心零錢 UnionPay  			//if (donations.Count > 0)  			if (donation != null) {  				//愛心零錢 available for drawings' select earliest and create drawing entry  				Drawings NewDraw = new Drawings ();  				NewDraw.Source = (int)GameSource.ChangeOfCare;  				NewDraw.UserId = dbusr.Id;  				NewDraw.OrderNo = donation.UnionOrder;  				//get available prizes  				List<Prize> przList = _uow.PrizeService.SelectPrizeList (true);  				if (przList.Count > 0) {  					//prize available' calculate winning result  					bool DrawResult = DataEncryption.GetDrawingResult ();  					NewDraw.IsWinner = DrawResult;  					if (DrawResult) {  						//user won a prize' selects a random prize from the list  						Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  						NewDraw.PrizeId = wPrize.Id;  						//increase used prize count  						wPrize.UsedCount += 1;  						NewDraw.CreateTime = DateTime.Now;  						donation.GameTime = NewDraw.CreateTime;  						donation.IsGame = true;  						_uow.DrawingsService.Add (NewDraw);  						_uow.Commit ();  						int ang = wPrize.Angle + 720;  						return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }";  					}  					else {  						//user did not win  						NewDraw.CreateTime = DateTime.Now;  						donation.GameTime = NewDraw.CreateTime;  						NewDraw.IsConfirrmed = true;  						donation.IsGame = true;  						_uow.DrawingsService.Add (NewDraw);  						_uow.Commit ();  						return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  					}  				}  				else {  					//no prize available' user set to not win  					NewDraw.CreateTime = DateTime.Now;  					donation.GameTime = NewDraw.CreateTime;  					NewDraw.IsConfirrmed = true;  					donation.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  				}  			}  			#endregion  			#region 愛心捐贈 ichari  			else if (donationOrder != null) {  				//愛心捐贈 available for drawings' select earliest and create drawing entry  				Drawings NewDraw = new Drawings ();  				NewDraw.Source = (int)GameSource.IchariDonation;  				NewDraw.UserId = dbusr.Id;  				NewDraw.OrderNo = donationOrder.TradeNo;  				//get available prizes  				List<Prize> przList = _uow.PrizeService.SelectRandomPrizeList (11' true);  				if (przList.Count > 0) {  					//prize available' calculate winning result  					bool DrawResult = DataEncryption.GetDrawingResult ();  					NewDraw.IsWinner = DrawResult;  					if (DrawResult) {  						//user won a prize' selects a random prize from the list  						Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  						//end prize selection  						NewDraw.PrizeId = wPrize.Id;  						//increase used prize count  						wPrize.UsedCount += 1;  						NewDraw.CreateTime = DateTime.Now;  						_uow.DrawingsService.Add (NewDraw);  						//更新捐赠订单  						donationOrder.UpdateTime = NewDraw.CreateTime;  						donationOrder.IsGame = true;  						_uow.Commit ();  						int ang = wPrize.Angle + 720;  						return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }";  					}  					else {  						//user did not win  						NewDraw.CreateTime = DateTime.Now;  						NewDraw.IsConfirrmed = true;  						//更新捐赠订单  						donationOrder.UpdateTime = NewDraw.CreateTime;  						donationOrder.IsGame = true;  						_uow.DrawingsService.Add (NewDraw);  						_uow.Commit ();  						return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  					}  				}  				else {  					//no prize available' user set to not win  					NewDraw.CreateTime = DateTime.Now;  					donationOrder.UpdateTime = NewDraw.CreateTime;  					NewDraw.IsConfirrmed = true;  					donationOrder.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  				}  			}  			#endregion  			else {  				_log.Info ("user is logon'but not exist donation order");  				//no donations available for drawing  				return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"对不起，您已经没有抽奖机会了\" }";  			}  		}  	}  	#endregion  	#region Donation Entered or from UPOP  	else if (!string.IsNullOrWhiteSpace (DonationId) && DonationAmt > 0) {  		//donation entered  		LoveChange lc = _uow.LoveChangeService.Get (o => o.UnionOrder == DonationId & o.Amount == DonationAmt);  		if (lc != null && lc.Amount == DonationAmt && lc.UnionOrder == DonationId) {  			//donation valid'   			if (lc.IsGame != true) {  				//check if prize available' create drawing entry  				Drawings NewDraw = new Drawings ();  				NewDraw.OrderNo = DonationId;  				NewDraw.Source = (int)GameSource.ChangeOfCare;  				List<Prize> przList = _uow.PrizeService.SelectRandomPrizeList (11' true);  				if (przList.Count > 0) {  					//prize available' get drawing result  					bool drawResult = DataEncryption.GetDrawingResult ();  					NewDraw.IsWinner = drawResult;  					if (drawResult) {  						//user won' randomly selects a prize  						Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  						NewDraw.PrizeId = wPrize.Id;  						//increase used count  						wPrize.UsedCount += 1;  						NewDraw.CreateTime = DateTime.Now;  						lc.GameTime = NewDraw.CreateTime;  						lc.IsGame = true;  						_uow.DrawingsService.Add (NewDraw);  						_uow.Commit ();  						Session [SessionKey.DrawId] = _uow.DrawingsService.Get (o => o.PrizeId == NewDraw.PrizeId && o.OrderNo == NewDraw.OrderNo).Id;  						int ang = wPrize.Angle + 720;  						return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"win\" }";  					}  					else {  						//user did not win  						NewDraw.CreateTime = DateTime.Now;  						lc.GameTime = NewDraw.CreateTime;  						NewDraw.IsConfirrmed = true;  						lc.IsGame = true;  						_uow.DrawingsService.Add (NewDraw);  						_uow.Commit ();  						return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"lose\" }";  					}  				}  				else {  					//prize not available' user set to lost  					NewDraw.CreateTime = DateTime.Now;  					lc.GameTime = NewDraw.CreateTime;  					NewDraw.IsConfirrmed = true;  					lc.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"lose\" }";  				}  			}  			else {  				//game played  				return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"此捐赠单已抽奖，请登录查询中奖记录。\" }";  			}  		}  		else {  			//donation invalid  			return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"请重新确认您的捐赠单号。（或凭证号）。\" }";  		}  	}  	#endregion  	else {  		//user not logged in and no donation entered' disable flash  		return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"《请登陆用户》 或 《填写捐赠单》\"' \"url\" : \"login\" }";  	}  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The following statement contains a magic number: if (usr != null) {  	//user logged in  	UserInfo dbusr = _uow.UserInfoService.Get (o => o.Id == usr.Id);  	if (dbusr != null && usr.Password == dbusr.Password && usr.UserName == dbusr.UserName) {  		//user valid' get user's donations  		//List<LoveChange> donations = _uow.LoveChangeService.GetQueryList(o => o.UserId == dbusr.Id  && o.IsGame != true).OrderBy(o => o.CreateTime).ToList();  		var donation = _uow.LoveChangeService.GetQueryList (o => o.UserId == dbusr.Id && o.IsGame != true).OrderBy (o => o.CreateTime).FirstOrDefault ();  		//int dtype = (int)OrderType.Donation;  		//List<Order> orderList = _uow.OrderService.GetQueryList(o => o.UserId == dbusr.Id && o.IsGame != true && o.OrderType == dtype && o.Status == 10).OrderBy(o => o.PayTime).ToList();  		var donationOrder = _uow.OrderService.GetQueryList (t => t.UserId == dbusr.Id && t.IsGame == false && t.OrderType == (int)OrderType.Donation && t.Status >= (int)OrderState.Paid).OrderBy (t => t.PayTime).FirstOrDefault ();  		#region 愛心零錢 UnionPay  		//if (donations.Count > 0)  		if (donation != null) {  			//愛心零錢 available for drawings' select earliest and create drawing entry  			Drawings NewDraw = new Drawings ();  			NewDraw.Source = (int)GameSource.ChangeOfCare;  			NewDraw.UserId = dbusr.Id;  			NewDraw.OrderNo = donation.UnionOrder;  			//get available prizes  			List<Prize> przList = _uow.PrizeService.SelectPrizeList (true);  			if (przList.Count > 0) {  				//prize available' calculate winning result  				bool DrawResult = DataEncryption.GetDrawingResult ();  				NewDraw.IsWinner = DrawResult;  				if (DrawResult) {  					//user won a prize' selects a random prize from the list  					Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  					NewDraw.PrizeId = wPrize.Id;  					//increase used prize count  					wPrize.UsedCount += 1;  					NewDraw.CreateTime = DateTime.Now;  					donation.GameTime = NewDraw.CreateTime;  					donation.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					int ang = wPrize.Angle + 720;  					return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }";  				}  				else {  					//user did not win  					NewDraw.CreateTime = DateTime.Now;  					donation.GameTime = NewDraw.CreateTime;  					NewDraw.IsConfirrmed = true;  					donation.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  				}  			}  			else {  				//no prize available' user set to not win  				NewDraw.CreateTime = DateTime.Now;  				donation.GameTime = NewDraw.CreateTime;  				NewDraw.IsConfirrmed = true;  				donation.IsGame = true;  				_uow.DrawingsService.Add (NewDraw);  				_uow.Commit ();  				return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  			}  		}  		#endregion  		#region 愛心捐贈 ichari  		else if (donationOrder != null) {  			//愛心捐贈 available for drawings' select earliest and create drawing entry  			Drawings NewDraw = new Drawings ();  			NewDraw.Source = (int)GameSource.IchariDonation;  			NewDraw.UserId = dbusr.Id;  			NewDraw.OrderNo = donationOrder.TradeNo;  			//get available prizes  			List<Prize> przList = _uow.PrizeService.SelectRandomPrizeList (11' true);  			if (przList.Count > 0) {  				//prize available' calculate winning result  				bool DrawResult = DataEncryption.GetDrawingResult ();  				NewDraw.IsWinner = DrawResult;  				if (DrawResult) {  					//user won a prize' selects a random prize from the list  					Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  					//end prize selection  					NewDraw.PrizeId = wPrize.Id;  					//increase used prize count  					wPrize.UsedCount += 1;  					NewDraw.CreateTime = DateTime.Now;  					_uow.DrawingsService.Add (NewDraw);  					//更新捐赠订单  					donationOrder.UpdateTime = NewDraw.CreateTime;  					donationOrder.IsGame = true;  					_uow.Commit ();  					int ang = wPrize.Angle + 720;  					return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }";  				}  				else {  					//user did not win  					NewDraw.CreateTime = DateTime.Now;  					NewDraw.IsConfirrmed = true;  					//更新捐赠订单  					donationOrder.UpdateTime = NewDraw.CreateTime;  					donationOrder.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  				}  			}  			else {  				//no prize available' user set to not win  				NewDraw.CreateTime = DateTime.Now;  				donationOrder.UpdateTime = NewDraw.CreateTime;  				NewDraw.IsConfirrmed = true;  				donationOrder.IsGame = true;  				_uow.DrawingsService.Add (NewDraw);  				_uow.Commit ();  				return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  			}  		}  		#endregion  		else {  			_log.Info ("user is logon'but not exist donation order");  			//no donations available for drawing  			return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"对不起，您已经没有抽奖机会了\" }";  		}  	}  }  #endregion  #region Donation Entered or from UPOP  else if (!string.IsNullOrWhiteSpace (DonationId) && DonationAmt > 0) {  	//donation entered  	LoveChange lc = _uow.LoveChangeService.Get (o => o.UnionOrder == DonationId & o.Amount == DonationAmt);  	if (lc != null && lc.Amount == DonationAmt && lc.UnionOrder == DonationId) {  		//donation valid'   		if (lc.IsGame != true) {  			//check if prize available' create drawing entry  			Drawings NewDraw = new Drawings ();  			NewDraw.OrderNo = DonationId;  			NewDraw.Source = (int)GameSource.ChangeOfCare;  			List<Prize> przList = _uow.PrizeService.SelectRandomPrizeList (11' true);  			if (przList.Count > 0) {  				//prize available' get drawing result  				bool drawResult = DataEncryption.GetDrawingResult ();  				NewDraw.IsWinner = drawResult;  				if (drawResult) {  					//user won' randomly selects a prize  					Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  					NewDraw.PrizeId = wPrize.Id;  					//increase used count  					wPrize.UsedCount += 1;  					NewDraw.CreateTime = DateTime.Now;  					lc.GameTime = NewDraw.CreateTime;  					lc.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					Session [SessionKey.DrawId] = _uow.DrawingsService.Get (o => o.PrizeId == NewDraw.PrizeId && o.OrderNo == NewDraw.OrderNo).Id;  					int ang = wPrize.Angle + 720;  					return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"win\" }";  				}  				else {  					//user did not win  					NewDraw.CreateTime = DateTime.Now;  					lc.GameTime = NewDraw.CreateTime;  					NewDraw.IsConfirrmed = true;  					lc.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"lose\" }";  				}  			}  			else {  				//prize not available' user set to lost  				NewDraw.CreateTime = DateTime.Now;  				lc.GameTime = NewDraw.CreateTime;  				NewDraw.IsConfirrmed = true;  				lc.IsGame = true;  				_uow.DrawingsService.Add (NewDraw);  				_uow.Commit ();  				return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"lose\" }";  			}  		}  		else {  			//game played  			return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"此捐赠单已抽奖，请登录查询中奖记录。\" }";  		}  	}  	else {  		//donation invalid  		return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"请重新确认您的捐赠单号。（或凭证号）。\" }";  	}  }  #endregion  else {  	//user not logged in and no donation entered' disable flash  	return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"《请登陆用户》 或 《填写捐赠单》\"' \"url\" : \"login\" }";  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The following statement contains a magic number: if (usr != null) {  	//user logged in  	UserInfo dbusr = _uow.UserInfoService.Get (o => o.Id == usr.Id);  	if (dbusr != null && usr.Password == dbusr.Password && usr.UserName == dbusr.UserName) {  		//user valid' get user's donations  		//List<LoveChange> donations = _uow.LoveChangeService.GetQueryList(o => o.UserId == dbusr.Id  && o.IsGame != true).OrderBy(o => o.CreateTime).ToList();  		var donation = _uow.LoveChangeService.GetQueryList (o => o.UserId == dbusr.Id && o.IsGame != true).OrderBy (o => o.CreateTime).FirstOrDefault ();  		//int dtype = (int)OrderType.Donation;  		//List<Order> orderList = _uow.OrderService.GetQueryList(o => o.UserId == dbusr.Id && o.IsGame != true && o.OrderType == dtype && o.Status == 10).OrderBy(o => o.PayTime).ToList();  		var donationOrder = _uow.OrderService.GetQueryList (t => t.UserId == dbusr.Id && t.IsGame == false && t.OrderType == (int)OrderType.Donation && t.Status >= (int)OrderState.Paid).OrderBy (t => t.PayTime).FirstOrDefault ();  		#region 愛心零錢 UnionPay  		//if (donations.Count > 0)  		if (donation != null) {  			//愛心零錢 available for drawings' select earliest and create drawing entry  			Drawings NewDraw = new Drawings ();  			NewDraw.Source = (int)GameSource.ChangeOfCare;  			NewDraw.UserId = dbusr.Id;  			NewDraw.OrderNo = donation.UnionOrder;  			//get available prizes  			List<Prize> przList = _uow.PrizeService.SelectPrizeList (true);  			if (przList.Count > 0) {  				//prize available' calculate winning result  				bool DrawResult = DataEncryption.GetDrawingResult ();  				NewDraw.IsWinner = DrawResult;  				if (DrawResult) {  					//user won a prize' selects a random prize from the list  					Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  					NewDraw.PrizeId = wPrize.Id;  					//increase used prize count  					wPrize.UsedCount += 1;  					NewDraw.CreateTime = DateTime.Now;  					donation.GameTime = NewDraw.CreateTime;  					donation.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					int ang = wPrize.Angle + 720;  					return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }";  				}  				else {  					//user did not win  					NewDraw.CreateTime = DateTime.Now;  					donation.GameTime = NewDraw.CreateTime;  					NewDraw.IsConfirrmed = true;  					donation.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  				}  			}  			else {  				//no prize available' user set to not win  				NewDraw.CreateTime = DateTime.Now;  				donation.GameTime = NewDraw.CreateTime;  				NewDraw.IsConfirrmed = true;  				donation.IsGame = true;  				_uow.DrawingsService.Add (NewDraw);  				_uow.Commit ();  				return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  			}  		}  		#endregion  		#region 愛心捐贈 ichari  		else if (donationOrder != null) {  			//愛心捐贈 available for drawings' select earliest and create drawing entry  			Drawings NewDraw = new Drawings ();  			NewDraw.Source = (int)GameSource.IchariDonation;  			NewDraw.UserId = dbusr.Id;  			NewDraw.OrderNo = donationOrder.TradeNo;  			//get available prizes  			List<Prize> przList = _uow.PrizeService.SelectRandomPrizeList (11' true);  			if (przList.Count > 0) {  				//prize available' calculate winning result  				bool DrawResult = DataEncryption.GetDrawingResult ();  				NewDraw.IsWinner = DrawResult;  				if (DrawResult) {  					//user won a prize' selects a random prize from the list  					Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  					//end prize selection  					NewDraw.PrizeId = wPrize.Id;  					//increase used prize count  					wPrize.UsedCount += 1;  					NewDraw.CreateTime = DateTime.Now;  					_uow.DrawingsService.Add (NewDraw);  					//更新捐赠订单  					donationOrder.UpdateTime = NewDraw.CreateTime;  					donationOrder.IsGame = true;  					_uow.Commit ();  					int ang = wPrize.Angle + 720;  					return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }";  				}  				else {  					//user did not win  					NewDraw.CreateTime = DateTime.Now;  					NewDraw.IsConfirrmed = true;  					//更新捐赠订单  					donationOrder.UpdateTime = NewDraw.CreateTime;  					donationOrder.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  				}  			}  			else {  				//no prize available' user set to not win  				NewDraw.CreateTime = DateTime.Now;  				donationOrder.UpdateTime = NewDraw.CreateTime;  				NewDraw.IsConfirrmed = true;  				donationOrder.IsGame = true;  				_uow.DrawingsService.Add (NewDraw);  				_uow.Commit ();  				return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  			}  		}  		#endregion  		else {  			_log.Info ("user is logon'but not exist donation order");  			//no donations available for drawing  			return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"对不起，您已经没有抽奖机会了\" }";  		}  	}  }  #endregion  #region Donation Entered or from UPOP  else if (!string.IsNullOrWhiteSpace (DonationId) && DonationAmt > 0) {  	//donation entered  	LoveChange lc = _uow.LoveChangeService.Get (o => o.UnionOrder == DonationId & o.Amount == DonationAmt);  	if (lc != null && lc.Amount == DonationAmt && lc.UnionOrder == DonationId) {  		//donation valid'   		if (lc.IsGame != true) {  			//check if prize available' create drawing entry  			Drawings NewDraw = new Drawings ();  			NewDraw.OrderNo = DonationId;  			NewDraw.Source = (int)GameSource.ChangeOfCare;  			List<Prize> przList = _uow.PrizeService.SelectRandomPrizeList (11' true);  			if (przList.Count > 0) {  				//prize available' get drawing result  				bool drawResult = DataEncryption.GetDrawingResult ();  				NewDraw.IsWinner = drawResult;  				if (drawResult) {  					//user won' randomly selects a prize  					Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  					NewDraw.PrizeId = wPrize.Id;  					//increase used count  					wPrize.UsedCount += 1;  					NewDraw.CreateTime = DateTime.Now;  					lc.GameTime = NewDraw.CreateTime;  					lc.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					Session [SessionKey.DrawId] = _uow.DrawingsService.Get (o => o.PrizeId == NewDraw.PrizeId && o.OrderNo == NewDraw.OrderNo).Id;  					int ang = wPrize.Angle + 720;  					return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"win\" }";  				}  				else {  					//user did not win  					NewDraw.CreateTime = DateTime.Now;  					lc.GameTime = NewDraw.CreateTime;  					NewDraw.IsConfirrmed = true;  					lc.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"lose\" }";  				}  			}  			else {  				//prize not available' user set to lost  				NewDraw.CreateTime = DateTime.Now;  				lc.GameTime = NewDraw.CreateTime;  				NewDraw.IsConfirrmed = true;  				lc.IsGame = true;  				_uow.DrawingsService.Add (NewDraw);  				_uow.Commit ();  				return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"lose\" }";  			}  		}  		else {  			//game played  			return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"此捐赠单已抽奖，请登录查询中奖记录。\" }";  		}  	}  	else {  		//donation invalid  		return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"请重新确认您的捐赠单号。（或凭证号）。\" }";  	}  }  #endregion  else {  	//user not logged in and no donation entered' disable flash  	return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"《请登陆用户》 或 《填写捐赠单》\"' \"url\" : \"login\" }";  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The following statement contains a magic number: if (usr != null) {  	//user logged in  	UserInfo dbusr = _uow.UserInfoService.Get (o => o.Id == usr.Id);  	if (dbusr != null && usr.Password == dbusr.Password && usr.UserName == dbusr.UserName) {  		//user valid' get user's donations  		//List<LoveChange> donations = _uow.LoveChangeService.GetQueryList(o => o.UserId == dbusr.Id  && o.IsGame != true).OrderBy(o => o.CreateTime).ToList();  		var donation = _uow.LoveChangeService.GetQueryList (o => o.UserId == dbusr.Id && o.IsGame != true).OrderBy (o => o.CreateTime).FirstOrDefault ();  		//int dtype = (int)OrderType.Donation;  		//List<Order> orderList = _uow.OrderService.GetQueryList(o => o.UserId == dbusr.Id && o.IsGame != true && o.OrderType == dtype && o.Status == 10).OrderBy(o => o.PayTime).ToList();  		var donationOrder = _uow.OrderService.GetQueryList (t => t.UserId == dbusr.Id && t.IsGame == false && t.OrderType == (int)OrderType.Donation && t.Status >= (int)OrderState.Paid).OrderBy (t => t.PayTime).FirstOrDefault ();  		#region 愛心零錢 UnionPay  		//if (donations.Count > 0)  		if (donation != null) {  			//愛心零錢 available for drawings' select earliest and create drawing entry  			Drawings NewDraw = new Drawings ();  			NewDraw.Source = (int)GameSource.ChangeOfCare;  			NewDraw.UserId = dbusr.Id;  			NewDraw.OrderNo = donation.UnionOrder;  			//get available prizes  			List<Prize> przList = _uow.PrizeService.SelectPrizeList (true);  			if (przList.Count > 0) {  				//prize available' calculate winning result  				bool DrawResult = DataEncryption.GetDrawingResult ();  				NewDraw.IsWinner = DrawResult;  				if (DrawResult) {  					//user won a prize' selects a random prize from the list  					Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  					NewDraw.PrizeId = wPrize.Id;  					//increase used prize count  					wPrize.UsedCount += 1;  					NewDraw.CreateTime = DateTime.Now;  					donation.GameTime = NewDraw.CreateTime;  					donation.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					int ang = wPrize.Angle + 720;  					return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }";  				}  				else {  					//user did not win  					NewDraw.CreateTime = DateTime.Now;  					donation.GameTime = NewDraw.CreateTime;  					NewDraw.IsConfirrmed = true;  					donation.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  				}  			}  			else {  				//no prize available' user set to not win  				NewDraw.CreateTime = DateTime.Now;  				donation.GameTime = NewDraw.CreateTime;  				NewDraw.IsConfirrmed = true;  				donation.IsGame = true;  				_uow.DrawingsService.Add (NewDraw);  				_uow.Commit ();  				return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  			}  		}  		#endregion  		#region 愛心捐贈 ichari  		else if (donationOrder != null) {  			//愛心捐贈 available for drawings' select earliest and create drawing entry  			Drawings NewDraw = new Drawings ();  			NewDraw.Source = (int)GameSource.IchariDonation;  			NewDraw.UserId = dbusr.Id;  			NewDraw.OrderNo = donationOrder.TradeNo;  			//get available prizes  			List<Prize> przList = _uow.PrizeService.SelectRandomPrizeList (11' true);  			if (przList.Count > 0) {  				//prize available' calculate winning result  				bool DrawResult = DataEncryption.GetDrawingResult ();  				NewDraw.IsWinner = DrawResult;  				if (DrawResult) {  					//user won a prize' selects a random prize from the list  					Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  					//end prize selection  					NewDraw.PrizeId = wPrize.Id;  					//increase used prize count  					wPrize.UsedCount += 1;  					NewDraw.CreateTime = DateTime.Now;  					_uow.DrawingsService.Add (NewDraw);  					//更新捐赠订单  					donationOrder.UpdateTime = NewDraw.CreateTime;  					donationOrder.IsGame = true;  					_uow.Commit ();  					int ang = wPrize.Angle + 720;  					return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }";  				}  				else {  					//user did not win  					NewDraw.CreateTime = DateTime.Now;  					NewDraw.IsConfirrmed = true;  					//更新捐赠订单  					donationOrder.UpdateTime = NewDraw.CreateTime;  					donationOrder.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  				}  			}  			else {  				//no prize available' user set to not win  				NewDraw.CreateTime = DateTime.Now;  				donationOrder.UpdateTime = NewDraw.CreateTime;  				NewDraw.IsConfirrmed = true;  				donationOrder.IsGame = true;  				_uow.DrawingsService.Add (NewDraw);  				_uow.Commit ();  				return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  			}  		}  		#endregion  		else {  			_log.Info ("user is logon'but not exist donation order");  			//no donations available for drawing  			return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"对不起，您已经没有抽奖机会了\" }";  		}  	}  }  #endregion  #region Donation Entered or from UPOP  else if (!string.IsNullOrWhiteSpace (DonationId) && DonationAmt > 0) {  	//donation entered  	LoveChange lc = _uow.LoveChangeService.Get (o => o.UnionOrder == DonationId & o.Amount == DonationAmt);  	if (lc != null && lc.Amount == DonationAmt && lc.UnionOrder == DonationId) {  		//donation valid'   		if (lc.IsGame != true) {  			//check if prize available' create drawing entry  			Drawings NewDraw = new Drawings ();  			NewDraw.OrderNo = DonationId;  			NewDraw.Source = (int)GameSource.ChangeOfCare;  			List<Prize> przList = _uow.PrizeService.SelectRandomPrizeList (11' true);  			if (przList.Count > 0) {  				//prize available' get drawing result  				bool drawResult = DataEncryption.GetDrawingResult ();  				NewDraw.IsWinner = drawResult;  				if (drawResult) {  					//user won' randomly selects a prize  					Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  					NewDraw.PrizeId = wPrize.Id;  					//increase used count  					wPrize.UsedCount += 1;  					NewDraw.CreateTime = DateTime.Now;  					lc.GameTime = NewDraw.CreateTime;  					lc.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					Session [SessionKey.DrawId] = _uow.DrawingsService.Get (o => o.PrizeId == NewDraw.PrizeId && o.OrderNo == NewDraw.OrderNo).Id;  					int ang = wPrize.Angle + 720;  					return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"win\" }";  				}  				else {  					//user did not win  					NewDraw.CreateTime = DateTime.Now;  					lc.GameTime = NewDraw.CreateTime;  					NewDraw.IsConfirrmed = true;  					lc.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"lose\" }";  				}  			}  			else {  				//prize not available' user set to lost  				NewDraw.CreateTime = DateTime.Now;  				lc.GameTime = NewDraw.CreateTime;  				NewDraw.IsConfirrmed = true;  				lc.IsGame = true;  				_uow.DrawingsService.Add (NewDraw);  				_uow.Commit ();  				return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"lose\" }";  			}  		}  		else {  			//game played  			return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"此捐赠单已抽奖，请登录查询中奖记录。\" }";  		}  	}  	else {  		//donation invalid  		return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"请重新确认您的捐赠单号。（或凭证号）。\" }";  	}  }  #endregion  else {  	//user not logged in and no donation entered' disable flash  	return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"《请登陆用户》 或 《填写捐赠单》\"' \"url\" : \"login\" }";  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The following statement contains a magic number: if (usr != null) {  	//user logged in  	UserInfo dbusr = _uow.UserInfoService.Get (o => o.Id == usr.Id);  	if (dbusr != null && usr.Password == dbusr.Password && usr.UserName == dbusr.UserName) {  		//user valid' get user's donations  		//List<LoveChange> donations = _uow.LoveChangeService.GetQueryList(o => o.UserId == dbusr.Id  && o.IsGame != true).OrderBy(o => o.CreateTime).ToList();  		var donation = _uow.LoveChangeService.GetQueryList (o => o.UserId == dbusr.Id && o.IsGame != true).OrderBy (o => o.CreateTime).FirstOrDefault ();  		//int dtype = (int)OrderType.Donation;  		//List<Order> orderList = _uow.OrderService.GetQueryList(o => o.UserId == dbusr.Id && o.IsGame != true && o.OrderType == dtype && o.Status == 10).OrderBy(o => o.PayTime).ToList();  		var donationOrder = _uow.OrderService.GetQueryList (t => t.UserId == dbusr.Id && t.IsGame == false && t.OrderType == (int)OrderType.Donation && t.Status >= (int)OrderState.Paid).OrderBy (t => t.PayTime).FirstOrDefault ();  		#region 愛心零錢 UnionPay  		//if (donations.Count > 0)  		if (donation != null) {  			//愛心零錢 available for drawings' select earliest and create drawing entry  			Drawings NewDraw = new Drawings ();  			NewDraw.Source = (int)GameSource.ChangeOfCare;  			NewDraw.UserId = dbusr.Id;  			NewDraw.OrderNo = donation.UnionOrder;  			//get available prizes  			List<Prize> przList = _uow.PrizeService.SelectPrizeList (true);  			if (przList.Count > 0) {  				//prize available' calculate winning result  				bool DrawResult = DataEncryption.GetDrawingResult ();  				NewDraw.IsWinner = DrawResult;  				if (DrawResult) {  					//user won a prize' selects a random prize from the list  					Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  					NewDraw.PrizeId = wPrize.Id;  					//increase used prize count  					wPrize.UsedCount += 1;  					NewDraw.CreateTime = DateTime.Now;  					donation.GameTime = NewDraw.CreateTime;  					donation.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					int ang = wPrize.Angle + 720;  					return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }";  				}  				else {  					//user did not win  					NewDraw.CreateTime = DateTime.Now;  					donation.GameTime = NewDraw.CreateTime;  					NewDraw.IsConfirrmed = true;  					donation.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  				}  			}  			else {  				//no prize available' user set to not win  				NewDraw.CreateTime = DateTime.Now;  				donation.GameTime = NewDraw.CreateTime;  				NewDraw.IsConfirrmed = true;  				donation.IsGame = true;  				_uow.DrawingsService.Add (NewDraw);  				_uow.Commit ();  				return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  			}  		}  		#endregion  		#region 愛心捐贈 ichari  		else if (donationOrder != null) {  			//愛心捐贈 available for drawings' select earliest and create drawing entry  			Drawings NewDraw = new Drawings ();  			NewDraw.Source = (int)GameSource.IchariDonation;  			NewDraw.UserId = dbusr.Id;  			NewDraw.OrderNo = donationOrder.TradeNo;  			//get available prizes  			List<Prize> przList = _uow.PrizeService.SelectRandomPrizeList (11' true);  			if (przList.Count > 0) {  				//prize available' calculate winning result  				bool DrawResult = DataEncryption.GetDrawingResult ();  				NewDraw.IsWinner = DrawResult;  				if (DrawResult) {  					//user won a prize' selects a random prize from the list  					Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  					//end prize selection  					NewDraw.PrizeId = wPrize.Id;  					//increase used prize count  					wPrize.UsedCount += 1;  					NewDraw.CreateTime = DateTime.Now;  					_uow.DrawingsService.Add (NewDraw);  					//更新捐赠订单  					donationOrder.UpdateTime = NewDraw.CreateTime;  					donationOrder.IsGame = true;  					_uow.Commit ();  					int ang = wPrize.Angle + 720;  					return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }";  				}  				else {  					//user did not win  					NewDraw.CreateTime = DateTime.Now;  					NewDraw.IsConfirrmed = true;  					//更新捐赠订单  					donationOrder.UpdateTime = NewDraw.CreateTime;  					donationOrder.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  				}  			}  			else {  				//no prize available' user set to not win  				NewDraw.CreateTime = DateTime.Now;  				donationOrder.UpdateTime = NewDraw.CreateTime;  				NewDraw.IsConfirrmed = true;  				donationOrder.IsGame = true;  				_uow.DrawingsService.Add (NewDraw);  				_uow.Commit ();  				return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  			}  		}  		#endregion  		else {  			_log.Info ("user is logon'but not exist donation order");  			//no donations available for drawing  			return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"对不起，您已经没有抽奖机会了\" }";  		}  	}  }  #endregion  #region Donation Entered or from UPOP  else if (!string.IsNullOrWhiteSpace (DonationId) && DonationAmt > 0) {  	//donation entered  	LoveChange lc = _uow.LoveChangeService.Get (o => o.UnionOrder == DonationId & o.Amount == DonationAmt);  	if (lc != null && lc.Amount == DonationAmt && lc.UnionOrder == DonationId) {  		//donation valid'   		if (lc.IsGame != true) {  			//check if prize available' create drawing entry  			Drawings NewDraw = new Drawings ();  			NewDraw.OrderNo = DonationId;  			NewDraw.Source = (int)GameSource.ChangeOfCare;  			List<Prize> przList = _uow.PrizeService.SelectRandomPrizeList (11' true);  			if (przList.Count > 0) {  				//prize available' get drawing result  				bool drawResult = DataEncryption.GetDrawingResult ();  				NewDraw.IsWinner = drawResult;  				if (drawResult) {  					//user won' randomly selects a prize  					Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  					NewDraw.PrizeId = wPrize.Id;  					//increase used count  					wPrize.UsedCount += 1;  					NewDraw.CreateTime = DateTime.Now;  					lc.GameTime = NewDraw.CreateTime;  					lc.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					Session [SessionKey.DrawId] = _uow.DrawingsService.Get (o => o.PrizeId == NewDraw.PrizeId && o.OrderNo == NewDraw.OrderNo).Id;  					int ang = wPrize.Angle + 720;  					return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"win\" }";  				}  				else {  					//user did not win  					NewDraw.CreateTime = DateTime.Now;  					lc.GameTime = NewDraw.CreateTime;  					NewDraw.IsConfirrmed = true;  					lc.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"lose\" }";  				}  			}  			else {  				//prize not available' user set to lost  				NewDraw.CreateTime = DateTime.Now;  				lc.GameTime = NewDraw.CreateTime;  				NewDraw.IsConfirrmed = true;  				lc.IsGame = true;  				_uow.DrawingsService.Add (NewDraw);  				_uow.Commit ();  				return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"lose\" }";  			}  		}  		else {  			//game played  			return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"此捐赠单已抽奖，请登录查询中奖记录。\" }";  		}  	}  	else {  		//donation invalid  		return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"请重新确认您的捐赠单号。（或凭证号）。\" }";  	}  }  #endregion  else {  	//user not logged in and no donation entered' disable flash  	return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"《请登陆用户》 或 《填写捐赠单》\"' \"url\" : \"login\" }";  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The following statement contains a magic number: if (usr != null) {  	//user logged in  	UserInfo dbusr = _uow.UserInfoService.Get (o => o.Id == usr.Id);  	if (dbusr != null && usr.Password == dbusr.Password && usr.UserName == dbusr.UserName) {  		//user valid' get user's donations  		//List<LoveChange> donations = _uow.LoveChangeService.GetQueryList(o => o.UserId == dbusr.Id  && o.IsGame != true).OrderBy(o => o.CreateTime).ToList();  		var donation = _uow.LoveChangeService.GetQueryList (o => o.UserId == dbusr.Id && o.IsGame != true).OrderBy (o => o.CreateTime).FirstOrDefault ();  		//int dtype = (int)OrderType.Donation;  		//List<Order> orderList = _uow.OrderService.GetQueryList(o => o.UserId == dbusr.Id && o.IsGame != true && o.OrderType == dtype && o.Status == 10).OrderBy(o => o.PayTime).ToList();  		var donationOrder = _uow.OrderService.GetQueryList (t => t.UserId == dbusr.Id && t.IsGame == false && t.OrderType == (int)OrderType.Donation && t.Status >= (int)OrderState.Paid).OrderBy (t => t.PayTime).FirstOrDefault ();  		#region 愛心零錢 UnionPay  		//if (donations.Count > 0)  		if (donation != null) {  			//愛心零錢 available for drawings' select earliest and create drawing entry  			Drawings NewDraw = new Drawings ();  			NewDraw.Source = (int)GameSource.ChangeOfCare;  			NewDraw.UserId = dbusr.Id;  			NewDraw.OrderNo = donation.UnionOrder;  			//get available prizes  			List<Prize> przList = _uow.PrizeService.SelectPrizeList (true);  			if (przList.Count > 0) {  				//prize available' calculate winning result  				bool DrawResult = DataEncryption.GetDrawingResult ();  				NewDraw.IsWinner = DrawResult;  				if (DrawResult) {  					//user won a prize' selects a random prize from the list  					Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  					NewDraw.PrizeId = wPrize.Id;  					//increase used prize count  					wPrize.UsedCount += 1;  					NewDraw.CreateTime = DateTime.Now;  					donation.GameTime = NewDraw.CreateTime;  					donation.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					int ang = wPrize.Angle + 720;  					return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }";  				}  				else {  					//user did not win  					NewDraw.CreateTime = DateTime.Now;  					donation.GameTime = NewDraw.CreateTime;  					NewDraw.IsConfirrmed = true;  					donation.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  				}  			}  			else {  				//no prize available' user set to not win  				NewDraw.CreateTime = DateTime.Now;  				donation.GameTime = NewDraw.CreateTime;  				NewDraw.IsConfirrmed = true;  				donation.IsGame = true;  				_uow.DrawingsService.Add (NewDraw);  				_uow.Commit ();  				return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  			}  		}  		#endregion  		#region 愛心捐贈 ichari  		else if (donationOrder != null) {  			//愛心捐贈 available for drawings' select earliest and create drawing entry  			Drawings NewDraw = new Drawings ();  			NewDraw.Source = (int)GameSource.IchariDonation;  			NewDraw.UserId = dbusr.Id;  			NewDraw.OrderNo = donationOrder.TradeNo;  			//get available prizes  			List<Prize> przList = _uow.PrizeService.SelectRandomPrizeList (11' true);  			if (przList.Count > 0) {  				//prize available' calculate winning result  				bool DrawResult = DataEncryption.GetDrawingResult ();  				NewDraw.IsWinner = DrawResult;  				if (DrawResult) {  					//user won a prize' selects a random prize from the list  					Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  					//end prize selection  					NewDraw.PrizeId = wPrize.Id;  					//increase used prize count  					wPrize.UsedCount += 1;  					NewDraw.CreateTime = DateTime.Now;  					_uow.DrawingsService.Add (NewDraw);  					//更新捐赠订单  					donationOrder.UpdateTime = NewDraw.CreateTime;  					donationOrder.IsGame = true;  					_uow.Commit ();  					int ang = wPrize.Angle + 720;  					return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }";  				}  				else {  					//user did not win  					NewDraw.CreateTime = DateTime.Now;  					NewDraw.IsConfirrmed = true;  					//更新捐赠订单  					donationOrder.UpdateTime = NewDraw.CreateTime;  					donationOrder.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  				}  			}  			else {  				//no prize available' user set to not win  				NewDraw.CreateTime = DateTime.Now;  				donationOrder.UpdateTime = NewDraw.CreateTime;  				NewDraw.IsConfirrmed = true;  				donationOrder.IsGame = true;  				_uow.DrawingsService.Add (NewDraw);  				_uow.Commit ();  				return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  			}  		}  		#endregion  		else {  			_log.Info ("user is logon'but not exist donation order");  			//no donations available for drawing  			return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"对不起，您已经没有抽奖机会了\" }";  		}  	}  }  #endregion  #region Donation Entered or from UPOP  else if (!string.IsNullOrWhiteSpace (DonationId) && DonationAmt > 0) {  	//donation entered  	LoveChange lc = _uow.LoveChangeService.Get (o => o.UnionOrder == DonationId & o.Amount == DonationAmt);  	if (lc != null && lc.Amount == DonationAmt && lc.UnionOrder == DonationId) {  		//donation valid'   		if (lc.IsGame != true) {  			//check if prize available' create drawing entry  			Drawings NewDraw = new Drawings ();  			NewDraw.OrderNo = DonationId;  			NewDraw.Source = (int)GameSource.ChangeOfCare;  			List<Prize> przList = _uow.PrizeService.SelectRandomPrizeList (11' true);  			if (przList.Count > 0) {  				//prize available' get drawing result  				bool drawResult = DataEncryption.GetDrawingResult ();  				NewDraw.IsWinner = drawResult;  				if (drawResult) {  					//user won' randomly selects a prize  					Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  					NewDraw.PrizeId = wPrize.Id;  					//increase used count  					wPrize.UsedCount += 1;  					NewDraw.CreateTime = DateTime.Now;  					lc.GameTime = NewDraw.CreateTime;  					lc.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					Session [SessionKey.DrawId] = _uow.DrawingsService.Get (o => o.PrizeId == NewDraw.PrizeId && o.OrderNo == NewDraw.OrderNo).Id;  					int ang = wPrize.Angle + 720;  					return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"win\" }";  				}  				else {  					//user did not win  					NewDraw.CreateTime = DateTime.Now;  					lc.GameTime = NewDraw.CreateTime;  					NewDraw.IsConfirrmed = true;  					lc.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"lose\" }";  				}  			}  			else {  				//prize not available' user set to lost  				NewDraw.CreateTime = DateTime.Now;  				lc.GameTime = NewDraw.CreateTime;  				NewDraw.IsConfirrmed = true;  				lc.IsGame = true;  				_uow.DrawingsService.Add (NewDraw);  				_uow.Commit ();  				return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"lose\" }";  			}  		}  		else {  			//game played  			return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"此捐赠单已抽奖，请登录查询中奖记录。\" }";  		}  	}  	else {  		//donation invalid  		return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"请重新确认您的捐赠单号。（或凭证号）。\" }";  	}  }  #endregion  else {  	//user not logged in and no donation entered' disable flash  	return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"《请登陆用户》 或 《填写捐赠单》\"' \"url\" : \"login\" }";  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The following statement contains a magic number: if (dbusr != null && usr.Password == dbusr.Password && usr.UserName == dbusr.UserName) {  	//user valid' get user's donations  	//List<LoveChange> donations = _uow.LoveChangeService.GetQueryList(o => o.UserId == dbusr.Id  && o.IsGame != true).OrderBy(o => o.CreateTime).ToList();  	var donation = _uow.LoveChangeService.GetQueryList (o => o.UserId == dbusr.Id && o.IsGame != true).OrderBy (o => o.CreateTime).FirstOrDefault ();  	//int dtype = (int)OrderType.Donation;  	//List<Order> orderList = _uow.OrderService.GetQueryList(o => o.UserId == dbusr.Id && o.IsGame != true && o.OrderType == dtype && o.Status == 10).OrderBy(o => o.PayTime).ToList();  	var donationOrder = _uow.OrderService.GetQueryList (t => t.UserId == dbusr.Id && t.IsGame == false && t.OrderType == (int)OrderType.Donation && t.Status >= (int)OrderState.Paid).OrderBy (t => t.PayTime).FirstOrDefault ();  	#region 愛心零錢 UnionPay  	//if (donations.Count > 0)  	if (donation != null) {  		//愛心零錢 available for drawings' select earliest and create drawing entry  		Drawings NewDraw = new Drawings ();  		NewDraw.Source = (int)GameSource.ChangeOfCare;  		NewDraw.UserId = dbusr.Id;  		NewDraw.OrderNo = donation.UnionOrder;  		//get available prizes  		List<Prize> przList = _uow.PrizeService.SelectPrizeList (true);  		if (przList.Count > 0) {  			//prize available' calculate winning result  			bool DrawResult = DataEncryption.GetDrawingResult ();  			NewDraw.IsWinner = DrawResult;  			if (DrawResult) {  				//user won a prize' selects a random prize from the list  				Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  				NewDraw.PrizeId = wPrize.Id;  				//increase used prize count  				wPrize.UsedCount += 1;  				NewDraw.CreateTime = DateTime.Now;  				donation.GameTime = NewDraw.CreateTime;  				donation.IsGame = true;  				_uow.DrawingsService.Add (NewDraw);  				_uow.Commit ();  				int ang = wPrize.Angle + 720;  				return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }";  			}  			else {  				//user did not win  				NewDraw.CreateTime = DateTime.Now;  				donation.GameTime = NewDraw.CreateTime;  				NewDraw.IsConfirrmed = true;  				donation.IsGame = true;  				_uow.DrawingsService.Add (NewDraw);  				_uow.Commit ();  				return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  			}  		}  		else {  			//no prize available' user set to not win  			NewDraw.CreateTime = DateTime.Now;  			donation.GameTime = NewDraw.CreateTime;  			NewDraw.IsConfirrmed = true;  			donation.IsGame = true;  			_uow.DrawingsService.Add (NewDraw);  			_uow.Commit ();  			return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  		}  	}  	#endregion  	#region 愛心捐贈 ichari  	else if (donationOrder != null) {  		//愛心捐贈 available for drawings' select earliest and create drawing entry  		Drawings NewDraw = new Drawings ();  		NewDraw.Source = (int)GameSource.IchariDonation;  		NewDraw.UserId = dbusr.Id;  		NewDraw.OrderNo = donationOrder.TradeNo;  		//get available prizes  		List<Prize> przList = _uow.PrizeService.SelectRandomPrizeList (11' true);  		if (przList.Count > 0) {  			//prize available' calculate winning result  			bool DrawResult = DataEncryption.GetDrawingResult ();  			NewDraw.IsWinner = DrawResult;  			if (DrawResult) {  				//user won a prize' selects a random prize from the list  				Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  				//end prize selection  				NewDraw.PrizeId = wPrize.Id;  				//increase used prize count  				wPrize.UsedCount += 1;  				NewDraw.CreateTime = DateTime.Now;  				_uow.DrawingsService.Add (NewDraw);  				//更新捐赠订单  				donationOrder.UpdateTime = NewDraw.CreateTime;  				donationOrder.IsGame = true;  				_uow.Commit ();  				int ang = wPrize.Angle + 720;  				return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }";  			}  			else {  				//user did not win  				NewDraw.CreateTime = DateTime.Now;  				NewDraw.IsConfirrmed = true;  				//更新捐赠订单  				donationOrder.UpdateTime = NewDraw.CreateTime;  				donationOrder.IsGame = true;  				_uow.DrawingsService.Add (NewDraw);  				_uow.Commit ();  				return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  			}  		}  		else {  			//no prize available' user set to not win  			NewDraw.CreateTime = DateTime.Now;  			donationOrder.UpdateTime = NewDraw.CreateTime;  			NewDraw.IsConfirrmed = true;  			donationOrder.IsGame = true;  			_uow.DrawingsService.Add (NewDraw);  			_uow.Commit ();  			return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  		}  	}  	#endregion  	else {  		_log.Info ("user is logon'but not exist donation order");  		//no donations available for drawing  		return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"对不起，您已经没有抽奖机会了\" }";  	}  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The following statement contains a magic number: if (dbusr != null && usr.Password == dbusr.Password && usr.UserName == dbusr.UserName) {  	//user valid' get user's donations  	//List<LoveChange> donations = _uow.LoveChangeService.GetQueryList(o => o.UserId == dbusr.Id  && o.IsGame != true).OrderBy(o => o.CreateTime).ToList();  	var donation = _uow.LoveChangeService.GetQueryList (o => o.UserId == dbusr.Id && o.IsGame != true).OrderBy (o => o.CreateTime).FirstOrDefault ();  	//int dtype = (int)OrderType.Donation;  	//List<Order> orderList = _uow.OrderService.GetQueryList(o => o.UserId == dbusr.Id && o.IsGame != true && o.OrderType == dtype && o.Status == 10).OrderBy(o => o.PayTime).ToList();  	var donationOrder = _uow.OrderService.GetQueryList (t => t.UserId == dbusr.Id && t.IsGame == false && t.OrderType == (int)OrderType.Donation && t.Status >= (int)OrderState.Paid).OrderBy (t => t.PayTime).FirstOrDefault ();  	#region 愛心零錢 UnionPay  	//if (donations.Count > 0)  	if (donation != null) {  		//愛心零錢 available for drawings' select earliest and create drawing entry  		Drawings NewDraw = new Drawings ();  		NewDraw.Source = (int)GameSource.ChangeOfCare;  		NewDraw.UserId = dbusr.Id;  		NewDraw.OrderNo = donation.UnionOrder;  		//get available prizes  		List<Prize> przList = _uow.PrizeService.SelectPrizeList (true);  		if (przList.Count > 0) {  			//prize available' calculate winning result  			bool DrawResult = DataEncryption.GetDrawingResult ();  			NewDraw.IsWinner = DrawResult;  			if (DrawResult) {  				//user won a prize' selects a random prize from the list  				Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  				NewDraw.PrizeId = wPrize.Id;  				//increase used prize count  				wPrize.UsedCount += 1;  				NewDraw.CreateTime = DateTime.Now;  				donation.GameTime = NewDraw.CreateTime;  				donation.IsGame = true;  				_uow.DrawingsService.Add (NewDraw);  				_uow.Commit ();  				int ang = wPrize.Angle + 720;  				return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }";  			}  			else {  				//user did not win  				NewDraw.CreateTime = DateTime.Now;  				donation.GameTime = NewDraw.CreateTime;  				NewDraw.IsConfirrmed = true;  				donation.IsGame = true;  				_uow.DrawingsService.Add (NewDraw);  				_uow.Commit ();  				return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  			}  		}  		else {  			//no prize available' user set to not win  			NewDraw.CreateTime = DateTime.Now;  			donation.GameTime = NewDraw.CreateTime;  			NewDraw.IsConfirrmed = true;  			donation.IsGame = true;  			_uow.DrawingsService.Add (NewDraw);  			_uow.Commit ();  			return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  		}  	}  	#endregion  	#region 愛心捐贈 ichari  	else if (donationOrder != null) {  		//愛心捐贈 available for drawings' select earliest and create drawing entry  		Drawings NewDraw = new Drawings ();  		NewDraw.Source = (int)GameSource.IchariDonation;  		NewDraw.UserId = dbusr.Id;  		NewDraw.OrderNo = donationOrder.TradeNo;  		//get available prizes  		List<Prize> przList = _uow.PrizeService.SelectRandomPrizeList (11' true);  		if (przList.Count > 0) {  			//prize available' calculate winning result  			bool DrawResult = DataEncryption.GetDrawingResult ();  			NewDraw.IsWinner = DrawResult;  			if (DrawResult) {  				//user won a prize' selects a random prize from the list  				Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  				//end prize selection  				NewDraw.PrizeId = wPrize.Id;  				//increase used prize count  				wPrize.UsedCount += 1;  				NewDraw.CreateTime = DateTime.Now;  				_uow.DrawingsService.Add (NewDraw);  				//更新捐赠订单  				donationOrder.UpdateTime = NewDraw.CreateTime;  				donationOrder.IsGame = true;  				_uow.Commit ();  				int ang = wPrize.Angle + 720;  				return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }";  			}  			else {  				//user did not win  				NewDraw.CreateTime = DateTime.Now;  				NewDraw.IsConfirrmed = true;  				//更新捐赠订单  				donationOrder.UpdateTime = NewDraw.CreateTime;  				donationOrder.IsGame = true;  				_uow.DrawingsService.Add (NewDraw);  				_uow.Commit ();  				return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  			}  		}  		else {  			//no prize available' user set to not win  			NewDraw.CreateTime = DateTime.Now;  			donationOrder.UpdateTime = NewDraw.CreateTime;  			NewDraw.IsConfirrmed = true;  			donationOrder.IsGame = true;  			_uow.DrawingsService.Add (NewDraw);  			_uow.Commit ();  			return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  		}  	}  	#endregion  	else {  		_log.Info ("user is logon'but not exist donation order");  		//no donations available for drawing  		return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"对不起，您已经没有抽奖机会了\" }";  	}  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The following statement contains a magic number: if (dbusr != null && usr.Password == dbusr.Password && usr.UserName == dbusr.UserName) {  	//user valid' get user's donations  	//List<LoveChange> donations = _uow.LoveChangeService.GetQueryList(o => o.UserId == dbusr.Id  && o.IsGame != true).OrderBy(o => o.CreateTime).ToList();  	var donation = _uow.LoveChangeService.GetQueryList (o => o.UserId == dbusr.Id && o.IsGame != true).OrderBy (o => o.CreateTime).FirstOrDefault ();  	//int dtype = (int)OrderType.Donation;  	//List<Order> orderList = _uow.OrderService.GetQueryList(o => o.UserId == dbusr.Id && o.IsGame != true && o.OrderType == dtype && o.Status == 10).OrderBy(o => o.PayTime).ToList();  	var donationOrder = _uow.OrderService.GetQueryList (t => t.UserId == dbusr.Id && t.IsGame == false && t.OrderType == (int)OrderType.Donation && t.Status >= (int)OrderState.Paid).OrderBy (t => t.PayTime).FirstOrDefault ();  	#region 愛心零錢 UnionPay  	//if (donations.Count > 0)  	if (donation != null) {  		//愛心零錢 available for drawings' select earliest and create drawing entry  		Drawings NewDraw = new Drawings ();  		NewDraw.Source = (int)GameSource.ChangeOfCare;  		NewDraw.UserId = dbusr.Id;  		NewDraw.OrderNo = donation.UnionOrder;  		//get available prizes  		List<Prize> przList = _uow.PrizeService.SelectPrizeList (true);  		if (przList.Count > 0) {  			//prize available' calculate winning result  			bool DrawResult = DataEncryption.GetDrawingResult ();  			NewDraw.IsWinner = DrawResult;  			if (DrawResult) {  				//user won a prize' selects a random prize from the list  				Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  				NewDraw.PrizeId = wPrize.Id;  				//increase used prize count  				wPrize.UsedCount += 1;  				NewDraw.CreateTime = DateTime.Now;  				donation.GameTime = NewDraw.CreateTime;  				donation.IsGame = true;  				_uow.DrawingsService.Add (NewDraw);  				_uow.Commit ();  				int ang = wPrize.Angle + 720;  				return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }";  			}  			else {  				//user did not win  				NewDraw.CreateTime = DateTime.Now;  				donation.GameTime = NewDraw.CreateTime;  				NewDraw.IsConfirrmed = true;  				donation.IsGame = true;  				_uow.DrawingsService.Add (NewDraw);  				_uow.Commit ();  				return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  			}  		}  		else {  			//no prize available' user set to not win  			NewDraw.CreateTime = DateTime.Now;  			donation.GameTime = NewDraw.CreateTime;  			NewDraw.IsConfirrmed = true;  			donation.IsGame = true;  			_uow.DrawingsService.Add (NewDraw);  			_uow.Commit ();  			return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  		}  	}  	#endregion  	#region 愛心捐贈 ichari  	else if (donationOrder != null) {  		//愛心捐贈 available for drawings' select earliest and create drawing entry  		Drawings NewDraw = new Drawings ();  		NewDraw.Source = (int)GameSource.IchariDonation;  		NewDraw.UserId = dbusr.Id;  		NewDraw.OrderNo = donationOrder.TradeNo;  		//get available prizes  		List<Prize> przList = _uow.PrizeService.SelectRandomPrizeList (11' true);  		if (przList.Count > 0) {  			//prize available' calculate winning result  			bool DrawResult = DataEncryption.GetDrawingResult ();  			NewDraw.IsWinner = DrawResult;  			if (DrawResult) {  				//user won a prize' selects a random prize from the list  				Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  				//end prize selection  				NewDraw.PrizeId = wPrize.Id;  				//increase used prize count  				wPrize.UsedCount += 1;  				NewDraw.CreateTime = DateTime.Now;  				_uow.DrawingsService.Add (NewDraw);  				//更新捐赠订单  				donationOrder.UpdateTime = NewDraw.CreateTime;  				donationOrder.IsGame = true;  				_uow.Commit ();  				int ang = wPrize.Angle + 720;  				return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }";  			}  			else {  				//user did not win  				NewDraw.CreateTime = DateTime.Now;  				NewDraw.IsConfirrmed = true;  				//更新捐赠订单  				donationOrder.UpdateTime = NewDraw.CreateTime;  				donationOrder.IsGame = true;  				_uow.DrawingsService.Add (NewDraw);  				_uow.Commit ();  				return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  			}  		}  		else {  			//no prize available' user set to not win  			NewDraw.CreateTime = DateTime.Now;  			donationOrder.UpdateTime = NewDraw.CreateTime;  			NewDraw.IsConfirrmed = true;  			donationOrder.IsGame = true;  			_uow.DrawingsService.Add (NewDraw);  			_uow.Commit ();  			return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  		}  	}  	#endregion  	else {  		_log.Info ("user is logon'but not exist donation order");  		//no donations available for drawing  		return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"对不起，您已经没有抽奖机会了\" }";  	}  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The following statement contains a magic number: if (donation != null) {  	//愛心零錢 available for drawings' select earliest and create drawing entry  	Drawings NewDraw = new Drawings ();  	NewDraw.Source = (int)GameSource.ChangeOfCare;  	NewDraw.UserId = dbusr.Id;  	NewDraw.OrderNo = donation.UnionOrder;  	//get available prizes  	List<Prize> przList = _uow.PrizeService.SelectPrizeList (true);  	if (przList.Count > 0) {  		//prize available' calculate winning result  		bool DrawResult = DataEncryption.GetDrawingResult ();  		NewDraw.IsWinner = DrawResult;  		if (DrawResult) {  			//user won a prize' selects a random prize from the list  			Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  			NewDraw.PrizeId = wPrize.Id;  			//increase used prize count  			wPrize.UsedCount += 1;  			NewDraw.CreateTime = DateTime.Now;  			donation.GameTime = NewDraw.CreateTime;  			donation.IsGame = true;  			_uow.DrawingsService.Add (NewDraw);  			_uow.Commit ();  			int ang = wPrize.Angle + 720;  			return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }";  		}  		else {  			//user did not win  			NewDraw.CreateTime = DateTime.Now;  			donation.GameTime = NewDraw.CreateTime;  			NewDraw.IsConfirrmed = true;  			donation.IsGame = true;  			_uow.DrawingsService.Add (NewDraw);  			_uow.Commit ();  			return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  		}  	}  	else {  		//no prize available' user set to not win  		NewDraw.CreateTime = DateTime.Now;  		donation.GameTime = NewDraw.CreateTime;  		NewDraw.IsConfirrmed = true;  		donation.IsGame = true;  		_uow.DrawingsService.Add (NewDraw);  		_uow.Commit ();  		return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  	}  }  #endregion  #region 愛心捐贈 ichari  else if (donationOrder != null) {  	//愛心捐贈 available for drawings' select earliest and create drawing entry  	Drawings NewDraw = new Drawings ();  	NewDraw.Source = (int)GameSource.IchariDonation;  	NewDraw.UserId = dbusr.Id;  	NewDraw.OrderNo = donationOrder.TradeNo;  	//get available prizes  	List<Prize> przList = _uow.PrizeService.SelectRandomPrizeList (11' true);  	if (przList.Count > 0) {  		//prize available' calculate winning result  		bool DrawResult = DataEncryption.GetDrawingResult ();  		NewDraw.IsWinner = DrawResult;  		if (DrawResult) {  			//user won a prize' selects a random prize from the list  			Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  			//end prize selection  			NewDraw.PrizeId = wPrize.Id;  			//increase used prize count  			wPrize.UsedCount += 1;  			NewDraw.CreateTime = DateTime.Now;  			_uow.DrawingsService.Add (NewDraw);  			//更新捐赠订单  			donationOrder.UpdateTime = NewDraw.CreateTime;  			donationOrder.IsGame = true;  			_uow.Commit ();  			int ang = wPrize.Angle + 720;  			return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }";  		}  		else {  			//user did not win  			NewDraw.CreateTime = DateTime.Now;  			NewDraw.IsConfirrmed = true;  			//更新捐赠订单  			donationOrder.UpdateTime = NewDraw.CreateTime;  			donationOrder.IsGame = true;  			_uow.DrawingsService.Add (NewDraw);  			_uow.Commit ();  			return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  		}  	}  	else {  		//no prize available' user set to not win  		NewDraw.CreateTime = DateTime.Now;  		donationOrder.UpdateTime = NewDraw.CreateTime;  		NewDraw.IsConfirrmed = true;  		donationOrder.IsGame = true;  		_uow.DrawingsService.Add (NewDraw);  		_uow.Commit ();  		return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  	}  }  #endregion  else {  	_log.Info ("user is logon'but not exist donation order");  	//no donations available for drawing  	return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"对不起，您已经没有抽奖机会了\" }";  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The following statement contains a magic number: if (donation != null) {  	//愛心零錢 available for drawings' select earliest and create drawing entry  	Drawings NewDraw = new Drawings ();  	NewDraw.Source = (int)GameSource.ChangeOfCare;  	NewDraw.UserId = dbusr.Id;  	NewDraw.OrderNo = donation.UnionOrder;  	//get available prizes  	List<Prize> przList = _uow.PrizeService.SelectPrizeList (true);  	if (przList.Count > 0) {  		//prize available' calculate winning result  		bool DrawResult = DataEncryption.GetDrawingResult ();  		NewDraw.IsWinner = DrawResult;  		if (DrawResult) {  			//user won a prize' selects a random prize from the list  			Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  			NewDraw.PrizeId = wPrize.Id;  			//increase used prize count  			wPrize.UsedCount += 1;  			NewDraw.CreateTime = DateTime.Now;  			donation.GameTime = NewDraw.CreateTime;  			donation.IsGame = true;  			_uow.DrawingsService.Add (NewDraw);  			_uow.Commit ();  			int ang = wPrize.Angle + 720;  			return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }";  		}  		else {  			//user did not win  			NewDraw.CreateTime = DateTime.Now;  			donation.GameTime = NewDraw.CreateTime;  			NewDraw.IsConfirrmed = true;  			donation.IsGame = true;  			_uow.DrawingsService.Add (NewDraw);  			_uow.Commit ();  			return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  		}  	}  	else {  		//no prize available' user set to not win  		NewDraw.CreateTime = DateTime.Now;  		donation.GameTime = NewDraw.CreateTime;  		NewDraw.IsConfirrmed = true;  		donation.IsGame = true;  		_uow.DrawingsService.Add (NewDraw);  		_uow.Commit ();  		return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  	}  }  #endregion  #region 愛心捐贈 ichari  else if (donationOrder != null) {  	//愛心捐贈 available for drawings' select earliest and create drawing entry  	Drawings NewDraw = new Drawings ();  	NewDraw.Source = (int)GameSource.IchariDonation;  	NewDraw.UserId = dbusr.Id;  	NewDraw.OrderNo = donationOrder.TradeNo;  	//get available prizes  	List<Prize> przList = _uow.PrizeService.SelectRandomPrizeList (11' true);  	if (przList.Count > 0) {  		//prize available' calculate winning result  		bool DrawResult = DataEncryption.GetDrawingResult ();  		NewDraw.IsWinner = DrawResult;  		if (DrawResult) {  			//user won a prize' selects a random prize from the list  			Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  			//end prize selection  			NewDraw.PrizeId = wPrize.Id;  			//increase used prize count  			wPrize.UsedCount += 1;  			NewDraw.CreateTime = DateTime.Now;  			_uow.DrawingsService.Add (NewDraw);  			//更新捐赠订单  			donationOrder.UpdateTime = NewDraw.CreateTime;  			donationOrder.IsGame = true;  			_uow.Commit ();  			int ang = wPrize.Angle + 720;  			return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }";  		}  		else {  			//user did not win  			NewDraw.CreateTime = DateTime.Now;  			NewDraw.IsConfirrmed = true;  			//更新捐赠订单  			donationOrder.UpdateTime = NewDraw.CreateTime;  			donationOrder.IsGame = true;  			_uow.DrawingsService.Add (NewDraw);  			_uow.Commit ();  			return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  		}  	}  	else {  		//no prize available' user set to not win  		NewDraw.CreateTime = DateTime.Now;  		donationOrder.UpdateTime = NewDraw.CreateTime;  		NewDraw.IsConfirrmed = true;  		donationOrder.IsGame = true;  		_uow.DrawingsService.Add (NewDraw);  		_uow.Commit ();  		return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  	}  }  #endregion  else {  	_log.Info ("user is logon'but not exist donation order");  	//no donations available for drawing  	return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"对不起，您已经没有抽奖机会了\" }";  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The following statement contains a magic number: if (donation != null) {  	//愛心零錢 available for drawings' select earliest and create drawing entry  	Drawings NewDraw = new Drawings ();  	NewDraw.Source = (int)GameSource.ChangeOfCare;  	NewDraw.UserId = dbusr.Id;  	NewDraw.OrderNo = donation.UnionOrder;  	//get available prizes  	List<Prize> przList = _uow.PrizeService.SelectPrizeList (true);  	if (przList.Count > 0) {  		//prize available' calculate winning result  		bool DrawResult = DataEncryption.GetDrawingResult ();  		NewDraw.IsWinner = DrawResult;  		if (DrawResult) {  			//user won a prize' selects a random prize from the list  			Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  			NewDraw.PrizeId = wPrize.Id;  			//increase used prize count  			wPrize.UsedCount += 1;  			NewDraw.CreateTime = DateTime.Now;  			donation.GameTime = NewDraw.CreateTime;  			donation.IsGame = true;  			_uow.DrawingsService.Add (NewDraw);  			_uow.Commit ();  			int ang = wPrize.Angle + 720;  			return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }";  		}  		else {  			//user did not win  			NewDraw.CreateTime = DateTime.Now;  			donation.GameTime = NewDraw.CreateTime;  			NewDraw.IsConfirrmed = true;  			donation.IsGame = true;  			_uow.DrawingsService.Add (NewDraw);  			_uow.Commit ();  			return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  		}  	}  	else {  		//no prize available' user set to not win  		NewDraw.CreateTime = DateTime.Now;  		donation.GameTime = NewDraw.CreateTime;  		NewDraw.IsConfirrmed = true;  		donation.IsGame = true;  		_uow.DrawingsService.Add (NewDraw);  		_uow.Commit ();  		return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  	}  }  #endregion  #region 愛心捐贈 ichari  else if (donationOrder != null) {  	//愛心捐贈 available for drawings' select earliest and create drawing entry  	Drawings NewDraw = new Drawings ();  	NewDraw.Source = (int)GameSource.IchariDonation;  	NewDraw.UserId = dbusr.Id;  	NewDraw.OrderNo = donationOrder.TradeNo;  	//get available prizes  	List<Prize> przList = _uow.PrizeService.SelectRandomPrizeList (11' true);  	if (przList.Count > 0) {  		//prize available' calculate winning result  		bool DrawResult = DataEncryption.GetDrawingResult ();  		NewDraw.IsWinner = DrawResult;  		if (DrawResult) {  			//user won a prize' selects a random prize from the list  			Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  			//end prize selection  			NewDraw.PrizeId = wPrize.Id;  			//increase used prize count  			wPrize.UsedCount += 1;  			NewDraw.CreateTime = DateTime.Now;  			_uow.DrawingsService.Add (NewDraw);  			//更新捐赠订单  			donationOrder.UpdateTime = NewDraw.CreateTime;  			donationOrder.IsGame = true;  			_uow.Commit ();  			int ang = wPrize.Angle + 720;  			return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }";  		}  		else {  			//user did not win  			NewDraw.CreateTime = DateTime.Now;  			NewDraw.IsConfirrmed = true;  			//更新捐赠订单  			donationOrder.UpdateTime = NewDraw.CreateTime;  			donationOrder.IsGame = true;  			_uow.DrawingsService.Add (NewDraw);  			_uow.Commit ();  			return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  		}  	}  	else {  		//no prize available' user set to not win  		NewDraw.CreateTime = DateTime.Now;  		donationOrder.UpdateTime = NewDraw.CreateTime;  		NewDraw.IsConfirrmed = true;  		donationOrder.IsGame = true;  		_uow.DrawingsService.Add (NewDraw);  		_uow.Commit ();  		return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  	}  }  #endregion  else {  	_log.Info ("user is logon'but not exist donation order");  	//no donations available for drawing  	return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"对不起，您已经没有抽奖机会了\" }";  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The following statement contains a magic number: if (przList.Count > 0) {  	//prize available' calculate winning result  	bool DrawResult = DataEncryption.GetDrawingResult ();  	NewDraw.IsWinner = DrawResult;  	if (DrawResult) {  		//user won a prize' selects a random prize from the list  		Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  		NewDraw.PrizeId = wPrize.Id;  		//increase used prize count  		wPrize.UsedCount += 1;  		NewDraw.CreateTime = DateTime.Now;  		donation.GameTime = NewDraw.CreateTime;  		donation.IsGame = true;  		_uow.DrawingsService.Add (NewDraw);  		_uow.Commit ();  		int ang = wPrize.Angle + 720;  		return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }";  	}  	else {  		//user did not win  		NewDraw.CreateTime = DateTime.Now;  		donation.GameTime = NewDraw.CreateTime;  		NewDraw.IsConfirrmed = true;  		donation.IsGame = true;  		_uow.DrawingsService.Add (NewDraw);  		_uow.Commit ();  		return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  	}  }  else {  	//no prize available' user set to not win  	NewDraw.CreateTime = DateTime.Now;  	donation.GameTime = NewDraw.CreateTime;  	NewDraw.IsConfirrmed = true;  	donation.IsGame = true;  	_uow.DrawingsService.Add (NewDraw);  	_uow.Commit ();  	return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The following statement contains a magic number: if (DrawResult) {  	//user won a prize' selects a random prize from the list  	Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  	NewDraw.PrizeId = wPrize.Id;  	//increase used prize count  	wPrize.UsedCount += 1;  	NewDraw.CreateTime = DateTime.Now;  	donation.GameTime = NewDraw.CreateTime;  	donation.IsGame = true;  	_uow.DrawingsService.Add (NewDraw);  	_uow.Commit ();  	int ang = wPrize.Angle + 720;  	return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }";  }  else {  	//user did not win  	NewDraw.CreateTime = DateTime.Now;  	donation.GameTime = NewDraw.CreateTime;  	NewDraw.IsConfirrmed = true;  	donation.IsGame = true;  	_uow.DrawingsService.Add (NewDraw);  	_uow.Commit ();  	return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The following statement contains a magic number: if (donationOrder != null) {  	//愛心捐贈 available for drawings' select earliest and create drawing entry  	Drawings NewDraw = new Drawings ();  	NewDraw.Source = (int)GameSource.IchariDonation;  	NewDraw.UserId = dbusr.Id;  	NewDraw.OrderNo = donationOrder.TradeNo;  	//get available prizes  	List<Prize> przList = _uow.PrizeService.SelectRandomPrizeList (11' true);  	if (przList.Count > 0) {  		//prize available' calculate winning result  		bool DrawResult = DataEncryption.GetDrawingResult ();  		NewDraw.IsWinner = DrawResult;  		if (DrawResult) {  			//user won a prize' selects a random prize from the list  			Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  			//end prize selection  			NewDraw.PrizeId = wPrize.Id;  			//increase used prize count  			wPrize.UsedCount += 1;  			NewDraw.CreateTime = DateTime.Now;  			_uow.DrawingsService.Add (NewDraw);  			//更新捐赠订单  			donationOrder.UpdateTime = NewDraw.CreateTime;  			donationOrder.IsGame = true;  			_uow.Commit ();  			int ang = wPrize.Angle + 720;  			return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }";  		}  		else {  			//user did not win  			NewDraw.CreateTime = DateTime.Now;  			NewDraw.IsConfirrmed = true;  			//更新捐赠订单  			donationOrder.UpdateTime = NewDraw.CreateTime;  			donationOrder.IsGame = true;  			_uow.DrawingsService.Add (NewDraw);  			_uow.Commit ();  			return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  		}  	}  	else {  		//no prize available' user set to not win  		NewDraw.CreateTime = DateTime.Now;  		donationOrder.UpdateTime = NewDraw.CreateTime;  		NewDraw.IsConfirrmed = true;  		donationOrder.IsGame = true;  		_uow.DrawingsService.Add (NewDraw);  		_uow.Commit ();  		return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  	}  }  #endregion  else {  	_log.Info ("user is logon'but not exist donation order");  	//no donations available for drawing  	return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"对不起，您已经没有抽奖机会了\" }";  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The following statement contains a magic number: if (donationOrder != null) {  	//愛心捐贈 available for drawings' select earliest and create drawing entry  	Drawings NewDraw = new Drawings ();  	NewDraw.Source = (int)GameSource.IchariDonation;  	NewDraw.UserId = dbusr.Id;  	NewDraw.OrderNo = donationOrder.TradeNo;  	//get available prizes  	List<Prize> przList = _uow.PrizeService.SelectRandomPrizeList (11' true);  	if (przList.Count > 0) {  		//prize available' calculate winning result  		bool DrawResult = DataEncryption.GetDrawingResult ();  		NewDraw.IsWinner = DrawResult;  		if (DrawResult) {  			//user won a prize' selects a random prize from the list  			Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  			//end prize selection  			NewDraw.PrizeId = wPrize.Id;  			//increase used prize count  			wPrize.UsedCount += 1;  			NewDraw.CreateTime = DateTime.Now;  			_uow.DrawingsService.Add (NewDraw);  			//更新捐赠订单  			donationOrder.UpdateTime = NewDraw.CreateTime;  			donationOrder.IsGame = true;  			_uow.Commit ();  			int ang = wPrize.Angle + 720;  			return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }";  		}  		else {  			//user did not win  			NewDraw.CreateTime = DateTime.Now;  			NewDraw.IsConfirrmed = true;  			//更新捐赠订单  			donationOrder.UpdateTime = NewDraw.CreateTime;  			donationOrder.IsGame = true;  			_uow.DrawingsService.Add (NewDraw);  			_uow.Commit ();  			return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  		}  	}  	else {  		//no prize available' user set to not win  		NewDraw.CreateTime = DateTime.Now;  		donationOrder.UpdateTime = NewDraw.CreateTime;  		NewDraw.IsConfirrmed = true;  		donationOrder.IsGame = true;  		_uow.DrawingsService.Add (NewDraw);  		_uow.Commit ();  		return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  	}  }  #endregion  else {  	_log.Info ("user is logon'but not exist donation order");  	//no donations available for drawing  	return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"对不起，您已经没有抽奖机会了\" }";  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The following statement contains a magic number: if (przList.Count > 0) {  	//prize available' calculate winning result  	bool DrawResult = DataEncryption.GetDrawingResult ();  	NewDraw.IsWinner = DrawResult;  	if (DrawResult) {  		//user won a prize' selects a random prize from the list  		Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  		//end prize selection  		NewDraw.PrizeId = wPrize.Id;  		//increase used prize count  		wPrize.UsedCount += 1;  		NewDraw.CreateTime = DateTime.Now;  		_uow.DrawingsService.Add (NewDraw);  		//更新捐赠订单  		donationOrder.UpdateTime = NewDraw.CreateTime;  		donationOrder.IsGame = true;  		_uow.Commit ();  		int ang = wPrize.Angle + 720;  		return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }";  	}  	else {  		//user did not win  		NewDraw.CreateTime = DateTime.Now;  		NewDraw.IsConfirrmed = true;  		//更新捐赠订单  		donationOrder.UpdateTime = NewDraw.CreateTime;  		donationOrder.IsGame = true;  		_uow.DrawingsService.Add (NewDraw);  		_uow.Commit ();  		return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  	}  }  else {  	//no prize available' user set to not win  	NewDraw.CreateTime = DateTime.Now;  	donationOrder.UpdateTime = NewDraw.CreateTime;  	NewDraw.IsConfirrmed = true;  	donationOrder.IsGame = true;  	_uow.DrawingsService.Add (NewDraw);  	_uow.Commit ();  	return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The following statement contains a magic number: if (DrawResult) {  	//user won a prize' selects a random prize from the list  	Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  	//end prize selection  	NewDraw.PrizeId = wPrize.Id;  	//increase used prize count  	wPrize.UsedCount += 1;  	NewDraw.CreateTime = DateTime.Now;  	_uow.DrawingsService.Add (NewDraw);  	//更新捐赠订单  	donationOrder.UpdateTime = NewDraw.CreateTime;  	donationOrder.IsGame = true;  	_uow.Commit ();  	int ang = wPrize.Angle + 720;  	return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"usr\" }";  }  else {  	//user did not win  	NewDraw.CreateTime = DateTime.Now;  	NewDraw.IsConfirrmed = true;  	//更新捐赠订单  	donationOrder.UpdateTime = NewDraw.CreateTime;  	donationOrder.IsGame = true;  	_uow.DrawingsService.Add (NewDraw);  	_uow.Commit ();  	return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"usr\" }";  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The following statement contains a magic number: if (!string.IsNullOrWhiteSpace (DonationId) && DonationAmt > 0) {  	//donation entered  	LoveChange lc = _uow.LoveChangeService.Get (o => o.UnionOrder == DonationId & o.Amount == DonationAmt);  	if (lc != null && lc.Amount == DonationAmt && lc.UnionOrder == DonationId) {  		//donation valid'   		if (lc.IsGame != true) {  			//check if prize available' create drawing entry  			Drawings NewDraw = new Drawings ();  			NewDraw.OrderNo = DonationId;  			NewDraw.Source = (int)GameSource.ChangeOfCare;  			List<Prize> przList = _uow.PrizeService.SelectRandomPrizeList (11' true);  			if (przList.Count > 0) {  				//prize available' get drawing result  				bool drawResult = DataEncryption.GetDrawingResult ();  				NewDraw.IsWinner = drawResult;  				if (drawResult) {  					//user won' randomly selects a prize  					Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  					NewDraw.PrizeId = wPrize.Id;  					//increase used count  					wPrize.UsedCount += 1;  					NewDraw.CreateTime = DateTime.Now;  					lc.GameTime = NewDraw.CreateTime;  					lc.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					Session [SessionKey.DrawId] = _uow.DrawingsService.Get (o => o.PrizeId == NewDraw.PrizeId && o.OrderNo == NewDraw.OrderNo).Id;  					int ang = wPrize.Angle + 720;  					return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"win\" }";  				}  				else {  					//user did not win  					NewDraw.CreateTime = DateTime.Now;  					lc.GameTime = NewDraw.CreateTime;  					NewDraw.IsConfirrmed = true;  					lc.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"lose\" }";  				}  			}  			else {  				//prize not available' user set to lost  				NewDraw.CreateTime = DateTime.Now;  				lc.GameTime = NewDraw.CreateTime;  				NewDraw.IsConfirrmed = true;  				lc.IsGame = true;  				_uow.DrawingsService.Add (NewDraw);  				_uow.Commit ();  				return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"lose\" }";  			}  		}  		else {  			//game played  			return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"此捐赠单已抽奖，请登录查询中奖记录。\" }";  		}  	}  	else {  		//donation invalid  		return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"请重新确认您的捐赠单号。（或凭证号）。\" }";  	}  }  #endregion  else {  	//user not logged in and no donation entered' disable flash  	return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"《请登陆用户》 或 《填写捐赠单》\"' \"url\" : \"login\" }";  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The following statement contains a magic number: if (!string.IsNullOrWhiteSpace (DonationId) && DonationAmt > 0) {  	//donation entered  	LoveChange lc = _uow.LoveChangeService.Get (o => o.UnionOrder == DonationId & o.Amount == DonationAmt);  	if (lc != null && lc.Amount == DonationAmt && lc.UnionOrder == DonationId) {  		//donation valid'   		if (lc.IsGame != true) {  			//check if prize available' create drawing entry  			Drawings NewDraw = new Drawings ();  			NewDraw.OrderNo = DonationId;  			NewDraw.Source = (int)GameSource.ChangeOfCare;  			List<Prize> przList = _uow.PrizeService.SelectRandomPrizeList (11' true);  			if (przList.Count > 0) {  				//prize available' get drawing result  				bool drawResult = DataEncryption.GetDrawingResult ();  				NewDraw.IsWinner = drawResult;  				if (drawResult) {  					//user won' randomly selects a prize  					Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  					NewDraw.PrizeId = wPrize.Id;  					//increase used count  					wPrize.UsedCount += 1;  					NewDraw.CreateTime = DateTime.Now;  					lc.GameTime = NewDraw.CreateTime;  					lc.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					Session [SessionKey.DrawId] = _uow.DrawingsService.Get (o => o.PrizeId == NewDraw.PrizeId && o.OrderNo == NewDraw.OrderNo).Id;  					int ang = wPrize.Angle + 720;  					return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"win\" }";  				}  				else {  					//user did not win  					NewDraw.CreateTime = DateTime.Now;  					lc.GameTime = NewDraw.CreateTime;  					NewDraw.IsConfirrmed = true;  					lc.IsGame = true;  					_uow.DrawingsService.Add (NewDraw);  					_uow.Commit ();  					return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"lose\" }";  				}  			}  			else {  				//prize not available' user set to lost  				NewDraw.CreateTime = DateTime.Now;  				lc.GameTime = NewDraw.CreateTime;  				NewDraw.IsConfirrmed = true;  				lc.IsGame = true;  				_uow.DrawingsService.Add (NewDraw);  				_uow.Commit ();  				return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"lose\" }";  			}  		}  		else {  			//game played  			return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"此捐赠单已抽奖，请登录查询中奖记录。\" }";  		}  	}  	else {  		//donation invalid  		return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"请重新确认您的捐赠单号。（或凭证号）。\" }";  	}  }  #endregion  else {  	//user not logged in and no donation entered' disable flash  	return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"《请登陆用户》 或 《填写捐赠单》\"' \"url\" : \"login\" }";  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The following statement contains a magic number: if (lc != null && lc.Amount == DonationAmt && lc.UnionOrder == DonationId) {  	//donation valid'   	if (lc.IsGame != true) {  		//check if prize available' create drawing entry  		Drawings NewDraw = new Drawings ();  		NewDraw.OrderNo = DonationId;  		NewDraw.Source = (int)GameSource.ChangeOfCare;  		List<Prize> przList = _uow.PrizeService.SelectRandomPrizeList (11' true);  		if (przList.Count > 0) {  			//prize available' get drawing result  			bool drawResult = DataEncryption.GetDrawingResult ();  			NewDraw.IsWinner = drawResult;  			if (drawResult) {  				//user won' randomly selects a prize  				Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  				NewDraw.PrizeId = wPrize.Id;  				//increase used count  				wPrize.UsedCount += 1;  				NewDraw.CreateTime = DateTime.Now;  				lc.GameTime = NewDraw.CreateTime;  				lc.IsGame = true;  				_uow.DrawingsService.Add (NewDraw);  				_uow.Commit ();  				Session [SessionKey.DrawId] = _uow.DrawingsService.Get (o => o.PrizeId == NewDraw.PrizeId && o.OrderNo == NewDraw.OrderNo).Id;  				int ang = wPrize.Angle + 720;  				return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"win\" }";  			}  			else {  				//user did not win  				NewDraw.CreateTime = DateTime.Now;  				lc.GameTime = NewDraw.CreateTime;  				NewDraw.IsConfirrmed = true;  				lc.IsGame = true;  				_uow.DrawingsService.Add (NewDraw);  				_uow.Commit ();  				return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"lose\" }";  			}  		}  		else {  			//prize not available' user set to lost  			NewDraw.CreateTime = DateTime.Now;  			lc.GameTime = NewDraw.CreateTime;  			NewDraw.IsConfirrmed = true;  			lc.IsGame = true;  			_uow.DrawingsService.Add (NewDraw);  			_uow.Commit ();  			return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"lose\" }";  		}  	}  	else {  		//game played  		return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"此捐赠单已抽奖，请登录查询中奖记录。\" }";  	}  }  else {  	//donation invalid  	return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"请重新确认您的捐赠单号。（或凭证号）。\" }";  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The following statement contains a magic number: if (lc != null && lc.Amount == DonationAmt && lc.UnionOrder == DonationId) {  	//donation valid'   	if (lc.IsGame != true) {  		//check if prize available' create drawing entry  		Drawings NewDraw = new Drawings ();  		NewDraw.OrderNo = DonationId;  		NewDraw.Source = (int)GameSource.ChangeOfCare;  		List<Prize> przList = _uow.PrizeService.SelectRandomPrizeList (11' true);  		if (przList.Count > 0) {  			//prize available' get drawing result  			bool drawResult = DataEncryption.GetDrawingResult ();  			NewDraw.IsWinner = drawResult;  			if (drawResult) {  				//user won' randomly selects a prize  				Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  				NewDraw.PrizeId = wPrize.Id;  				//increase used count  				wPrize.UsedCount += 1;  				NewDraw.CreateTime = DateTime.Now;  				lc.GameTime = NewDraw.CreateTime;  				lc.IsGame = true;  				_uow.DrawingsService.Add (NewDraw);  				_uow.Commit ();  				Session [SessionKey.DrawId] = _uow.DrawingsService.Get (o => o.PrizeId == NewDraw.PrizeId && o.OrderNo == NewDraw.OrderNo).Id;  				int ang = wPrize.Angle + 720;  				return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"win\" }";  			}  			else {  				//user did not win  				NewDraw.CreateTime = DateTime.Now;  				lc.GameTime = NewDraw.CreateTime;  				NewDraw.IsConfirrmed = true;  				lc.IsGame = true;  				_uow.DrawingsService.Add (NewDraw);  				_uow.Commit ();  				return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"lose\" }";  			}  		}  		else {  			//prize not available' user set to lost  			NewDraw.CreateTime = DateTime.Now;  			lc.GameTime = NewDraw.CreateTime;  			NewDraw.IsConfirrmed = true;  			lc.IsGame = true;  			_uow.DrawingsService.Add (NewDraw);  			_uow.Commit ();  			return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"lose\" }";  		}  	}  	else {  		//game played  		return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"此捐赠单已抽奖，请登录查询中奖记录。\" }";  	}  }  else {  	//donation invalid  	return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"请重新确认您的捐赠单号。（或凭证号）。\" }";  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The following statement contains a magic number: if (lc.IsGame != true) {  	//check if prize available' create drawing entry  	Drawings NewDraw = new Drawings ();  	NewDraw.OrderNo = DonationId;  	NewDraw.Source = (int)GameSource.ChangeOfCare;  	List<Prize> przList = _uow.PrizeService.SelectRandomPrizeList (11' true);  	if (przList.Count > 0) {  		//prize available' get drawing result  		bool drawResult = DataEncryption.GetDrawingResult ();  		NewDraw.IsWinner = drawResult;  		if (drawResult) {  			//user won' randomly selects a prize  			Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  			NewDraw.PrizeId = wPrize.Id;  			//increase used count  			wPrize.UsedCount += 1;  			NewDraw.CreateTime = DateTime.Now;  			lc.GameTime = NewDraw.CreateTime;  			lc.IsGame = true;  			_uow.DrawingsService.Add (NewDraw);  			_uow.Commit ();  			Session [SessionKey.DrawId] = _uow.DrawingsService.Get (o => o.PrizeId == NewDraw.PrizeId && o.OrderNo == NewDraw.OrderNo).Id;  			int ang = wPrize.Angle + 720;  			return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"win\" }";  		}  		else {  			//user did not win  			NewDraw.CreateTime = DateTime.Now;  			lc.GameTime = NewDraw.CreateTime;  			NewDraw.IsConfirrmed = true;  			lc.IsGame = true;  			_uow.DrawingsService.Add (NewDraw);  			_uow.Commit ();  			return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"lose\" }";  		}  	}  	else {  		//prize not available' user set to lost  		NewDraw.CreateTime = DateTime.Now;  		lc.GameTime = NewDraw.CreateTime;  		NewDraw.IsConfirrmed = true;  		lc.IsGame = true;  		_uow.DrawingsService.Add (NewDraw);  		_uow.Commit ();  		return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"lose\" }";  	}  }  else {  	//game played  	return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"此捐赠单已抽奖，请登录查询中奖记录。\" }";  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The following statement contains a magic number: if (lc.IsGame != true) {  	//check if prize available' create drawing entry  	Drawings NewDraw = new Drawings ();  	NewDraw.OrderNo = DonationId;  	NewDraw.Source = (int)GameSource.ChangeOfCare;  	List<Prize> przList = _uow.PrizeService.SelectRandomPrizeList (11' true);  	if (przList.Count > 0) {  		//prize available' get drawing result  		bool drawResult = DataEncryption.GetDrawingResult ();  		NewDraw.IsWinner = drawResult;  		if (drawResult) {  			//user won' randomly selects a prize  			Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  			NewDraw.PrizeId = wPrize.Id;  			//increase used count  			wPrize.UsedCount += 1;  			NewDraw.CreateTime = DateTime.Now;  			lc.GameTime = NewDraw.CreateTime;  			lc.IsGame = true;  			_uow.DrawingsService.Add (NewDraw);  			_uow.Commit ();  			Session [SessionKey.DrawId] = _uow.DrawingsService.Get (o => o.PrizeId == NewDraw.PrizeId && o.OrderNo == NewDraw.OrderNo).Id;  			int ang = wPrize.Angle + 720;  			return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"win\" }";  		}  		else {  			//user did not win  			NewDraw.CreateTime = DateTime.Now;  			lc.GameTime = NewDraw.CreateTime;  			NewDraw.IsConfirrmed = true;  			lc.IsGame = true;  			_uow.DrawingsService.Add (NewDraw);  			_uow.Commit ();  			return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"lose\" }";  		}  	}  	else {  		//prize not available' user set to lost  		NewDraw.CreateTime = DateTime.Now;  		lc.GameTime = NewDraw.CreateTime;  		NewDraw.IsConfirrmed = true;  		lc.IsGame = true;  		_uow.DrawingsService.Add (NewDraw);  		_uow.Commit ();  		return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"lose\" }";  	}  }  else {  	//game played  	return "{ \"type\" : \"checkLogin\"' \"status\" : 0' \"massage\" : \"此捐赠单已抽奖，请登录查询中奖记录。\" }";  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The following statement contains a magic number: if (przList.Count > 0) {  	//prize available' get drawing result  	bool drawResult = DataEncryption.GetDrawingResult ();  	NewDraw.IsWinner = drawResult;  	if (drawResult) {  		//user won' randomly selects a prize  		Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  		NewDraw.PrizeId = wPrize.Id;  		//increase used count  		wPrize.UsedCount += 1;  		NewDraw.CreateTime = DateTime.Now;  		lc.GameTime = NewDraw.CreateTime;  		lc.IsGame = true;  		_uow.DrawingsService.Add (NewDraw);  		_uow.Commit ();  		Session [SessionKey.DrawId] = _uow.DrawingsService.Get (o => o.PrizeId == NewDraw.PrizeId && o.OrderNo == NewDraw.OrderNo).Id;  		int ang = wPrize.Angle + 720;  		return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"win\" }";  	}  	else {  		//user did not win  		NewDraw.CreateTime = DateTime.Now;  		lc.GameTime = NewDraw.CreateTime;  		NewDraw.IsConfirrmed = true;  		lc.IsGame = true;  		_uow.DrawingsService.Add (NewDraw);  		_uow.Commit ();  		return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"lose\" }";  	}  }  else {  	//prize not available' user set to lost  	NewDraw.CreateTime = DateTime.Now;  	lc.GameTime = NewDraw.CreateTime;  	NewDraw.IsConfirrmed = true;  	lc.IsGame = true;  	_uow.DrawingsService.Add (NewDraw);  	_uow.Commit ();  	return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"lose\" }";  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,FlashGame,The following statement contains a magic number: if (drawResult) {  	//user won' randomly selects a prize  	Prize wPrize = _uow.PrizeService.SelectWinningPrize (przList);  	NewDraw.PrizeId = wPrize.Id;  	//increase used count  	wPrize.UsedCount += 1;  	NewDraw.CreateTime = DateTime.Now;  	lc.GameTime = NewDraw.CreateTime;  	lc.IsGame = true;  	_uow.DrawingsService.Add (NewDraw);  	_uow.Commit ();  	Session [SessionKey.DrawId] = _uow.DrawingsService.Get (o => o.PrizeId == NewDraw.PrizeId && o.OrderNo == NewDraw.OrderNo).Id;  	int ang = wPrize.Angle + 720;  	return "{ \"type\" : \"checkLogin\"' \"status\" : 1' \"massage\" : \"" + wPrize.Name + "\"' \"angle\" : " + ang.ToString () + "' \"url\" : \"win\" }";  }  else {  	//user did not win  	NewDraw.CreateTime = DateTime.Now;  	lc.GameTime = NewDraw.CreateTime;  	NewDraw.IsConfirrmed = true;  	lc.IsGame = true;  	_uow.DrawingsService.Add (NewDraw);  	_uow.Commit ();  	return "{ \"type\" : \"checkLogin\"' \"status\" : 2' \"massage\" : \"感谢您对慈善事业的大力支持，谢谢参与。\"' \"angle\" : 1050' \"url\" : \"lose\" }";  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,VerifyUPOPOrder,The following statement contains a magic number: if (Session [SessionKey.UPOPChari] != null && Session [SessionKey.ID] != null && Session [SessionKey.DonationAmt] != null) {  	//redirected from UPOP  	if (Session [SessionKey.UPOPChari].ToString () == "Verified") {  		string oId = Session [SessionKey.ID].ToString ();  		decimal amt = decimal.Parse (Session [SessionKey.DonationAmt].ToString ());  		if (_uow.LoveChangeService.Get (o => o.UnionOrder == oId && o.Amount == amt) == null) {  			LoveChange lc = new LoveChange ();  			lc.UnionOrder = oId;  			lc.Amount = amt;  			lc.CreateTime = DateTime.Now;  			lc.IsGame = false;  			lc.IsSuccess = true;  			if (base.CurrentUser != null) {  				lc.UserId = base.CurrentUser.Id;  			}  			lc.State = (int)OrderState.Paid;  			_uow.LoveChangeService.Add (lc);  			_uow.Commit ();  			_log.Info (string.Format ("ChinaUnion: {0}_{1}"' lc.UnionOrder' lc.Amount));  		}  		Session [SessionKey.UPOPChari] = "Verified";  		Session [SessionKey.DonationId] = oId;  		Session [SessionKey.DonationAmt] = amt;  		_log.Info ("upop order verified' redirect to donation panel");  		return RedirectToAction ("DonationPanel"' new {  			t = (DateTime.Now - new DateTime (1900' 1' 1)).Ticks  		});  	}  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,VerifyUPOPOrder,The following statement contains a magic number: if (Session [SessionKey.UPOPChari].ToString () == "Verified") {  	string oId = Session [SessionKey.ID].ToString ();  	decimal amt = decimal.Parse (Session [SessionKey.DonationAmt].ToString ());  	if (_uow.LoveChangeService.Get (o => o.UnionOrder == oId && o.Amount == amt) == null) {  		LoveChange lc = new LoveChange ();  		lc.UnionOrder = oId;  		lc.Amount = amt;  		lc.CreateTime = DateTime.Now;  		lc.IsGame = false;  		lc.IsSuccess = true;  		if (base.CurrentUser != null) {  			lc.UserId = base.CurrentUser.Id;  		}  		lc.State = (int)OrderState.Paid;  		_uow.LoveChangeService.Add (lc);  		_uow.Commit ();  		_log.Info (string.Format ("ChinaUnion: {0}_{1}"' lc.UnionOrder' lc.Amount));  	}  	Session [SessionKey.UPOPChari] = "Verified";  	Session [SessionKey.DonationId] = oId;  	Session [SessionKey.DonationAmt] = amt;  	_log.Info ("upop order verified' redirect to donation panel");  	return RedirectToAction ("DonationPanel"' new {  		t = (DateTime.Now - new DateTime (1900' 1' 1)).Ticks  	});  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,VerifyUPOPOrder,The following statement contains a magic number: return RedirectToAction ("DonationPanel"' new {  	t = (DateTime.Now - new DateTime (1900' 1' 1)).Ticks  });  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,GamePanel,The following statement contains a magic number: if (usr != null && !string.IsNullOrWhiteSpace (usr.UserName) && usr.Id > 0) {  	ChariGameViewModel cgvm = new ChariGameViewModel ();  	cgvm.DList = _uow.LoveChangeService.GetQueryList (o => o.UserId == usr.Id && o.IsGame == false).OrderByDescending (o => o.CreateTime).ToList ();  	int dtype = (int)OrderType.Donation;  	cgvm.OList = _uow.OrderService.GetQueryList (o => o.UserId == usr.Id && o.IsGame != true && o.OrderType == dtype && o.Status == 10).OrderBy (o => o.PayTime).ToList ();  	cgvm.Count = cgvm.DList.Count + cgvm.OList.Count;  	return View (cgvm);  }  
Magic Number,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,GamePanel,The following statement contains a magic number: cgvm.OList = _uow.OrderService.GetQueryList (o => o.UserId == usr.Id && o.IsGame != true && o.OrderType == dtype && o.Status == 10).OrderBy (o => o.PayTime).ToList ();  
Magic Number,Ichari.Web.ViewModel,BaseViewModel,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\ViewModel\BaseViewModel.cs,BaseViewModel,The following statement contains a magic number: this.PageCount = 10;  
Missing Default,Ichari.Web,CharityController,C:\repos\ichari_ichari\02工程\03代码\Charity\trunk\ichari\Ichari.Web\Controller\CharityController.cs,ChariDraw,The following switch statement is missing a default case: switch (i % 5) {  case 0:  	ViewBag.WinList += "<ul><li>wahaha</il><li>4天前</li><li>HTC 手机</li></ul>";  	break;  case 1:  	ViewBag.WinList += "<ul><li>iamgod</il><li>5天前</li><li>Sony TV</li></ul>";  	break;  case 2:  	ViewBag.WinList += "<ul><li>willywanker</il><li>7天前</li><li>笔记本</li></ul>";  	break;  case 3:  	ViewBag.WinList += "<ul><li>seanc</il><li>10天前</li><li>自行车</li></ul>";  	break;  case 4:  	ViewBag.WinList += "<ul><li>jaschen</il><li>13天前</li><li>iPad</li></ul>";  	break;  }  
