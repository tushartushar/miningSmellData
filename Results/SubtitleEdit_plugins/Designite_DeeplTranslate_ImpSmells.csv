Implementation smell,Namespace,Class,File,Method,Description
Long Method,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The method has 180 lines of code.
Long Method,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,EncodeNamed,The method has 273 lines of code.
Long Method,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The method has 249 lines of code.
Long Method,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The method has 168 lines of code.
Long Method,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,AutoBreakLine,The method has 201 lines of code.
Complex Method,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,GeneratePreview,Cyclomatic complexity of the method is 11
Complex Method,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,Cyclomatic complexity of the method is 39
Complex Method,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,Cyclomatic complexity of the method is 48
Complex Method,Nikse.SubtitleEdit.PluginLogic,SubRip,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\SubRip.cs,LoadSubtitle,Cyclomatic complexity of the method is 9
Complex Method,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,RemoveSpaceBeforeAfterTag,Cyclomatic complexity of the method is 12
Complex Method,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,AutoBreakLineMoreThanTwoLines,Cyclomatic complexity of the method is 13
Complex Method,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,AutoBreakLine,Cyclomatic complexity of the method is 46
Complex Method,SubtitleEdit.Logic,StringExtensions,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\StringExtensions.cs,FastIndexOf,Cyclomatic complexity of the method is 10
Long Parameter List,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,DeeplTranslate,The method has 5 parameters. Parameters: text' from' to' log' retryLevel
Long Parameter List,Nikse.SubtitleEdit.PluginLogic,IPlugin,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\IPlugin.cs,DoAction,The method has 7 parameters. Parameters: parentForm' subtitle' frameRate' listViewLineSeparatorString' subtitleFileName' videoFileName' rawText
Long Parameter List,Nikse.SubtitleEdit.PluginLogic,DeeplTranslate,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Plugin.cs,DoAction,The method has 7 parameters. Parameters: parentForm' subtitle' frameRate' listViewLineSeparatorString' subtitleFileName' videoFileName' rawText
Long Identifier,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,,The length of the parameter AutoDetectWordsCroatianAndSerbian is 33.
Long Identifier,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,,The length of the parameter AutoDetectWordsSerbianCyrillic is 30.
Long Statement,SubtitleEdit,DeeplTranslator,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\DeeplTranslator.cs,Translate,The length of the statement  "            string url = $"http://api.fanyi.baidu.com/api/trans/vip/translate?appid={_appid}&salt={salt}&from={@from}&to={to}&sign={sign}"; " is 127.
Long Statement,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,GeneratePreview,The length of the statement  "                    string text = SetFormattingTypeAndSplitting(index' p.Text' (comboBoxLanguageFrom.SelectedItem as TranslationLanguage).Code.StartsWith("ZH")); " is 141.
Long Statement,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,GeneratePreview,The length of the statement  "                            var arg = new BackgroundWorkerParameter { Text = textToTranslate.ToString().TrimEnd().TrimEnd('*').TrimEnd()' Indexes = indexesToTranslate' Log = new StringBuilder() }; " is 168.
Long Statement,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,GeneratePreview,The length of the statement  "                    var arg = new BackgroundWorkerParameter { Text = textToTranslate.ToString().TrimEnd().TrimEnd('*').TrimEnd()' Indexes = indexesToTranslate' Log = new StringBuilder() }; " is 168.
Long Statement,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,GetPostBody,The length of the statement  "            return @"{'jsonrpc':'2.0'''method':'LMT_handle_jobs'''params':{'jobs':[{'kind':'default'''raw_en_sentence':'TEXT_TO_TRANSLATE'}]''lang':{'user_preferred_langs':['EN']''source_lang_user_selected':'FROM_LANGUAGE'''target_lang':'TO_LANGUAGE'}''priority':-1}''id':1}';".Replace("'"' "\""); " is 285.
Long Statement,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,SetFormattingTypeAndSplitting,The length of the statement  "            if (text.StartsWith("<i>"' StringComparison.Ordinal) && text.EndsWith("</i>"' StringComparison.Ordinal) && text.Contains("</i>" + Environment.NewLine + "<i>") && Utilities.GetNumberOfLines(text) == 2 && Utilities.CountTagInText(text' "<i>") == 1) " is 246.
Long Statement,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,SetFormattingTypeAndSplitting,The length of the statement  "            else if (text.StartsWith("<i>"' StringComparison.Ordinal) && text.EndsWith("</i>"' StringComparison.Ordinal) && Utilities.CountTagInText(text' "<i>") == 1) " is 155.
Long Statement,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,SetFormattingTypeAndSplitting,The length of the statement  "            if (lines.Length == 2 && !string.IsNullOrEmpty(lines[0]) && (Utilities.AllLettersAndNumbers + "'").Contains(lines[0].Substring(lines[0].Length - 1))) " is 149.
Long Statement,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The length of the statement  "            this.listView1.Anchor = ((System.Windows.Forms.AnchorStyles)((((System.Windows.Forms.AnchorStyles.Top | System.Windows.Forms.AnchorStyles.Bottom)  " is 145.
Long Statement,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The length of the statement  "            this.buttonOk.Anchor = ((System.Windows.Forms.AnchorStyles)((System.Windows.Forms.AnchorStyles.Bottom | System.Windows.Forms.AnchorStyles.Right))); " is 147.
Long Statement,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The length of the statement  "            this.buttonCancel.Anchor = ((System.Windows.Forms.AnchorStyles)((System.Windows.Forms.AnchorStyles.Bottom | System.Windows.Forms.AnchorStyles.Right))); " is 151.
Long Statement,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The length of the statement  "            this.linkLabel1.Anchor = ((System.Windows.Forms.AnchorStyles)((System.Windows.Forms.AnchorStyles.Bottom | System.Windows.Forms.AnchorStyles.Left))); " is 148.
Long Statement,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The length of the statement  "            this.textBox1.Anchor = ((System.Windows.Forms.AnchorStyles)((((System.Windows.Forms.AnchorStyles.Top | System.Windows.Forms.AnchorStyles.Bottom)  " is 144.
Long Statement,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,IsUrl,The length of the statement  "            if (allLower.StartsWith("http://"' StringComparison.Ordinal) || allLower.StartsWith("https://"' StringComparison.Ordinal) || " is 124.
Long Statement,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The length of the statement  "                if (italicBeginTagCount == 1 && italicEndTagCount == 1 && text.IndexOf(beginTag' StringComparison.Ordinal) > text.IndexOf(endTag' StringComparison.Ordinal)) " is 156.
Long Statement,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The length of the statement  "                    int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length; " is 131.
Long Statement,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The length of the statement  "                    if (lines.Length == 2 && lines[0].StartsWith(beginTag' StringComparison.Ordinal) && lines[0].EndsWith(endTag' StringComparison.Ordinal) && " is 138.
Long Statement,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The length of the statement  "                    if (text.StartsWith(beginTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal) && text.Contains(endTag + Environment.NewLine + beginTag)) " is 165.
Long Statement,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The length of the statement  "                    int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length; " is 131.
Long Statement,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The length of the statement  "                    if (text.EndsWith(endTag' StringComparison.Ordinal) && !cleanText.StartsWith("-") && !cleanText.Contains(Environment.NewLine + "-")) " is 132.
Long Statement,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The length of the statement  "                if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.Contains(endTag + Environment.NewLine' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal)) " is 179.
Long Statement,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The length of the statement  "                if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.StartsWith(endTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal)) " is 159.
Long Statement,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The length of the statement  "                        if (firstLine.Length > 10 && firstLine.StartsWith("- <i>"' StringComparison.Ordinal) && firstLine.EndsWith(endTag' StringComparison.Ordinal)) " is 141.
Long Statement,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The length of the statement  "                        if (secondLine.Length > 10 && secondLine.StartsWith("- <i>"' StringComparison.Ordinal) && secondLine.EndsWith(endTag' StringComparison.Ordinal)) " is 144.
Long Statement,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The length of the statement  "                        if (Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag)) " is 128.
Long Statement,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The length of the statement  "                    if (colIdx >= 0 && Utilities.CountTagInText(text' beginTag) + Utilities.CountTagInText(text' endTag) == 4 && text.Length > colIdx + 1 && !char.IsDigit(text[colIdx + 1])) " is 169.
Long Statement,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The length of the statement  "                    if ((Utilities.StartsAndEndsWithTag(firstLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag)) || " is 134.
Long Statement,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The length of the statement  "                        (Utilities.StartsAndEndsWithTag(secondLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag))) " is 128.
Long Statement,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The length of the statement  "                int frenchCount = GetCount(text' "[Cc]'est"' "pas"' "vous"' "pour"' "suis"' "Pourquoi"' "maison"' "souviens"' "quelque"); // not spanish words " is 142.
Long Statement,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The length of the statement  "                int frenchCount = GetCount(text' "[Cc]'est"' "pas"' "vous"' "pour"' "suis"' "Pourquoi"' "maison"' "souviens"' "quelque"); // not italian words " is 142.
Long Statement,Nikse.SubtitleEdit.PluginLogic,SubRip,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\SubRip.cs,ReadLine,The length of the statement  "                        _paragraph.Text += RemoveBadChars(line).TrimEnd().Replace(Environment.NewLine + Environment.NewLine' Environment.NewLine); " is 122.
Long Statement,Nikse.SubtitleEdit.PluginLogic,SubRip,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\SubRip.cs,ReadLine,The length of the statement  "                        _paragraph.Text += RemoveBadChars(line).TrimEnd().Replace(Environment.NewLine + Environment.NewLine' Environment.NewLine); " is 122.
Long Statement,Nikse.SubtitleEdit.PluginLogic,TimeCode,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\TimeCode.cs,ToString,The length of the statement  "            string s = string.Format("{0:00}:{1:00}:{2:00}'{3:000}"' _time.Hours' _time.Minutes' _time.Seconds' _time.Milliseconds); " is 120.
Long Statement,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,StartsAndEndsWithTag,The length of the statement  "            if (text.StartsWith(startTag' StringComparison.Ordinal) || text.StartsWith(s1' StringComparison.Ordinal) || text.StartsWith(s2' StringComparison.Ordinal) || text.StartsWith(s3' StringComparison.Ordinal) || text.StartsWith(s4' StringComparison.Ordinal)) " is 252.
Long Statement,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,StartsAndEndsWithTag,The length of the statement  "            if (text.EndsWith(endTag' StringComparison.Ordinal) || text.EndsWith(e1' StringComparison.Ordinal) || text.EndsWith(e2' StringComparison.Ordinal) || text.EndsWith(e3' StringComparison.Ordinal) || text.EndsWith(e4' StringComparison.Ordinal) || text.EndsWith(e5' StringComparison.Ordinal)) " is 287.
Long Statement,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,CanBreak,The length of the statement  "            if (s2.EndsWith("? -"' StringComparison.Ordinal) || s2.EndsWith("! -"' StringComparison.Ordinal) || s2.EndsWith(". -"' StringComparison.Ordinal)) " is 145.
Long Statement,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,AutoBreakLineMoreThanTwoLines,The length of the statement  "            if ((arr.Length < 2 && arr[0].Length <= maximumLineLength) || (arr[0].Length <= maximumLineLength && arr[1].Length <= maximumLineLength)) " is 137.
Long Statement,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,AutoBreakLine,The length of the statement  "                    if (arr0.StartsWith('-') && noTagLines[1].TrimStart().StartsWith('-') && arr0.Length > 1 && (".?!)]".Contains(arr0[arr0.Length - 1]) || arr0.EndsWith("--"' StringComparison.Ordinal) || arr0.EndsWith('–'))) " is 205.
Long Statement,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,AutoBreakLine,The length of the statement  "                                    if (first.EndsWith(".\""' StringComparison.Ordinal) || first.EndsWith("!\""' StringComparison.Ordinal) || first.EndsWith("?\""' StringComparison.Ordinal)) " is 154.
Long Statement,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,AutoBreakLine,The length of the statement  "                if (splitPos != maximumLength + 1 || s[maximumLength] != ' ') // allow for maxlength+1 char to be space (does not count) " is 120.
Long Statement,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,AutoBreakLine,The length of the statement  "                        if (expectedChars1.Contains(s[mid + j]) && !IsPartOfNumber(s' mid + j) && s.Length > mid + j + 2 && CanBreak(s' mid + j' language)) " is 131.
Long Statement,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,AutoBreakLine,The length of the statement  "                        if (expectedChars1.Contains(s[mid - j]) && !IsPartOfNumber(s' mid - j) && s.Length > mid + j + 2 && CanBreak(s' mid - j' language)) " is 131.
Long Statement,SubtitleEdit.Logic,StringExtensions,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\StringExtensions.cs,StartsWithHtmlTag,The length of the statement  "            if (threeLengthTag && text.Length >= 3 && text[0] == '<' && text[2] == '>' && (text[1] == 'i' || text[1] == 'I' || text[1] == 'u' || text[1] == 'U' || text[1] == 'b' || text[1] == 'B')) " is 185.
Long Statement,SubtitleEdit.Logic,StringExtensions,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\StringExtensions.cs,CountWords,The length of the statement  "            return HtmlUtil.RemoveHtmlTags(source' true).Split(new[] { ' '' '\n'' '\r' }' StringSplitOptions.RemoveEmptyEntries).Length; " is 124.
Long Statement,SubtitleEdit.Logic,StringExtensions,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\StringExtensions.cs,ContainsLetter,The length of the statement  "                    if (uc == UnicodeCategory.LowercaseLetter || uc == UnicodeCategory.UppercaseLetter || uc == UnicodeCategory.TitlecaseLetter || uc == UnicodeCategory.ModifierLetter || uc == UnicodeCategory.OtherLetter) " is 201.
Long Statement,SubtitleEdit.Logic,StringExtensions,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\StringExtensions.cs,ToRtf,The length of the statement  "            return @"{\rtf1\ansi\ansicpg1252\deff0{\fonttbl\f0\fswiss Helvetica;}\f0\pard " + value.ToRtfPart() + @"\par" + Environment.NewLine + "}"; " is 138.
Complex Conditional,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,SetFormattingTypeAndSplitting,The conditional expression  "text.StartsWith("<i>"' StringComparison.Ordinal) && text.EndsWith("</i>"' StringComparison.Ordinal) && text.Contains("</i>" + Environment.NewLine + "<i>") && Utilities.GetNumberOfLines(text) == 2 && Utilities.CountTagInText(text' "<i>") == 1"  is complex.
Complex Conditional,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,EncodeNumeric,The conditional expression  "ch > 127 || ch == '<' || ch == '>' || ch == '"' || ch == '&' || ch == '\''"  is complex.
Complex Conditional,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,IsUrl,The conditional expression  "string.IsNullOrWhiteSpace(text) || text.Length < 6 || !text.Contains('.') || text.Contains(' ')"  is complex.
Complex Conditional,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,IsUrl,The conditional expression  "allLower.StartsWith("http://"' StringComparison.Ordinal) || allLower.StartsWith("https://"' StringComparison.Ordinal) ||                  allLower.StartsWith("www."' StringComparison.Ordinal) || allLower.EndsWith(".org"' StringComparison.Ordinal) ||                  allLower.EndsWith(".com"' StringComparison.Ordinal) || allLower.EndsWith(".net"' StringComparison.Ordinal)"  is complex.
Complex Conditional,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The conditional expression  "text.StartsWith("</i>-<i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i> -"' StringComparison.Ordinal) ||                          text.StartsWith("</i>-<i> -"' StringComparison.Ordinal)"  is complex.
Complex Conditional,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The conditional expression  "lines.Length == 2 && lines[0].StartsWith(beginTag' StringComparison.Ordinal) && lines[0].EndsWith(endTag' StringComparison.Ordinal) &&                          lines[1].StartsWith(beginTag' StringComparison.Ordinal)"  is complex.
Complex Conditional,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The conditional expression  "italicBeginTagCount == 0 && italicEndTagCount == 2 && text.Contains(endTag + Environment.NewLine' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal)"  is complex.
Complex Conditional,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The conditional expression  "italicBeginTagCount == 0 && italicEndTagCount == 2 && text.StartsWith(endTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal)"  is complex.
Complex Conditional,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The conditional expression  "colIdx >= 0 && Utilities.CountTagInText(text' beginTag) + Utilities.CountTagInText(text' endTag) == 4 && text.Length > colIdx + 1 && !char.IsDigit(text[colIdx + 1])"  is complex.
Complex Conditional,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The conditional expression  "(Utilities.StartsAndEndsWithTag(firstLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag)) ||                          (Utilities.StartsAndEndsWithTag(secondLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag))"  is complex.
Complex Conditional,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The conditional expression  "(italicBeginTagCount == 3 && italicEndTagCount == 2) || (italicBeginTagCount == 2 && italicEndTagCount == 3)"  is complex.
Complex Conditional,Nikse.SubtitleEdit.PluginLogic,SubRip,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\SubRip.cs,LoadSubtitle,The conditional expression  "_expecting == ExpectingLine.Text && i + 1 < lines.Count &&                      _paragraph != null && !string.IsNullOrEmpty(_paragraph.Text) && Utilities.IsInteger(line) &&                      _regexTimeCodes.IsMatch(lines[i + 1])"  is complex.
Complex Conditional,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,FixExtraSpaces,The conditional expression  "(ch == '\n' || ch == '\r') && i + 1 < s.Length && s[i + 1] == 0x20"  is complex.
Complex Conditional,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,FixExtraSpaces,The conditional expression  "ch == 0x20 && i + 1 < s.Length && (s[i + 1] == '\n' || s[i + 1] == '\r')"  is complex.
Complex Conditional,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,StartsAndEndsWithTag,The conditional expression  "text.StartsWith(startTag' StringComparison.Ordinal) || text.StartsWith(s1' StringComparison.Ordinal) || text.StartsWith(s2' StringComparison.Ordinal) || text.StartsWith(s3' StringComparison.Ordinal) || text.StartsWith(s4' StringComparison.Ordinal)"  is complex.
Complex Conditional,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,StartsAndEndsWithTag,The conditional expression  "text.EndsWith(endTag' StringComparison.Ordinal) || text.EndsWith(e1' StringComparison.Ordinal) || text.EndsWith(e2' StringComparison.Ordinal) || text.EndsWith(e3' StringComparison.Ordinal) || text.EndsWith(e4' StringComparison.Ordinal) || text.EndsWith(e5' StringComparison.Ordinal)"  is complex.
Complex Conditional,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,AutoBreakLineMoreThanTwoLines,The conditional expression  "(arr.Length < 2 && arr[0].Length <= maximumLineLength) || (arr[0].Length <= maximumLineLength && arr[1].Length <= maximumLineLength)"  is complex.
Complex Conditional,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,AutoBreakLine,The conditional expression  "arr0.StartsWith('-') && noTagLines[1].TrimStart().StartsWith('-') && arr0.Length > 1 && (".?!)]".Contains(arr0[arr0.Length - 1]) || arr0.EndsWith("--"' StringComparison.Ordinal) || arr0.EndsWith('–'))"  is complex.
Complex Conditional,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,AutoBreakLine,The conditional expression  "expectedChars1.Contains(s[mid + j]) && !IsPartOfNumber(s' mid + j) && s.Length > mid + j + 2 && CanBreak(s' mid + j' language)"  is complex.
Complex Conditional,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,AutoBreakLine,The conditional expression  "expectedChars1.Contains(s[mid - j]) && !IsPartOfNumber(s' mid - j) && s.Length > mid + j + 2 && CanBreak(s' mid - j' language)"  is complex.
Complex Conditional,SubtitleEdit.Logic,StringExtensions,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\StringExtensions.cs,LineEndsWithHtmlTag,The conditional expression  "threeLengthTag && len > 3 && text[len - 4] == '<' && text[len - 3] == '/'"  is complex.
Complex Conditional,SubtitleEdit.Logic,StringExtensions,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\StringExtensions.cs,LineEndsWithHtmlTag,The conditional expression  "includeFont && len > 8 && text[len - 7] == '<' && text[len - 6] == '/'"  is complex.
Complex Conditional,SubtitleEdit.Logic,StringExtensions,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\StringExtensions.cs,StartsWithHtmlTag,The conditional expression  "threeLengthTag && text.Length >= 3 && text[0] == '<' && text[2] == '>' && (text[1] == 'i' || text[1] == 'I' || text[1] == 'u' || text[1] == 'U' || text[1] == 'b' || text[1] == 'B')"  is complex.
Complex Conditional,SubtitleEdit.Logic,StringExtensions,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\StringExtensions.cs,FixExtraSpaces,The conditional expression  "(ch == '\n' || ch == '\r') && i + 1 < s.Length && s[i + 1] == 0x20"  is complex.
Complex Conditional,SubtitleEdit.Logic,StringExtensions,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\StringExtensions.cs,FixExtraSpaces,The conditional expression  "ch == 0x20 && i + 1 < s.Length && (s[i + 1] == '\n' || s[i + 1] == '\r')"  is complex.
Complex Conditional,SubtitleEdit.Logic,StringExtensions,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\StringExtensions.cs,ContainsLetter,The conditional expression  "uc == UnicodeCategory.LowercaseLetter || uc == UnicodeCategory.UppercaseLetter || uc == UnicodeCategory.TitlecaseLetter || uc == UnicodeCategory.ModifierLetter || uc == UnicodeCategory.OtherLetter"  is complex.
Complex Conditional,SubtitleEdit.Logic,StringExtensions,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\StringExtensions.cs,RemoveControlCharactersButWhiteSpace,The conditional expression  "!char.IsControl(ch) || ch == '\u000d' || ch == '\u000a' || ch == '\u0009'"  is complex.
Empty Catch Block,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,GeneratePreview,The method has an empty catch block.
Magic Number,SubtitleEdit,DeeplTranslator,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\DeeplTranslator.cs,MD5,The following statement contains a magic number: var sb = new StringBuilder(32);
Magic Number,SubtitleEdit,DeeplTranslator,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\DeeplTranslator.cs,MD5,The following statement contains a magic number: for (int i = 0; i < t.Length; i++)                  sb.Append(t[i].ToString("x").PadLeft(2' '0'));
Magic Number,SubtitleEdit,DeeplTranslator,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\DeeplTranslator.cs,Translate,The following statement contains a magic number: string salt = r.Next(1000000' int.MaxValue).ToString();
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,MainForm,The following statement contains a magic number: listView1.Columns[2].Width = -2;
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,MainForm,The following statement contains a magic number: listView1.Columns[2].Width = -2;
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,GeneratePreview,The following statement contains a magic number: try              {                  _abort = false;                  int numberOfThreads = 4;                  var threadPool = new List<BackgroundWorker>();                  for (int i = 0; i < numberOfThreads; i++)                  {                      var bw = new BackgroundWorker();                      bw.DoWork += OnBwOnDoWork;                      bw.RunWorkerCompleted += OnBwRunWorkerCompleted;                      threadPool.Add(bw);                  }                  var textToTranslate = new StringBuilder();                  var indexesToTranslate = new List<int>();                  for (int index = 0; index < _subtitle.Paragraphs.Count; index++)                  {                      Paragraph p = _subtitle.Paragraphs[index];                      string text = SetFormattingTypeAndSplitting(index' p.Text' (comboBoxLanguageFrom.SelectedItem as TranslationLanguage).Code.StartsWith("ZH"));                      var before = text;                      var after = string.Empty;                      if (setText)                      {                          //if (text.Length + textToTranslate.Length > max) - max is too low for merging texts to really have any effect                          {                              var arg = new BackgroundWorkerParameter { Text = textToTranslate.ToString().TrimEnd().TrimEnd('*').TrimEnd()' Indexes = indexesToTranslate' Log = new StringBuilder() };                              textToTranslate = new StringBuilder();                              indexesToTranslate = new List<int>();                              threadPool.First(bw => !bw.IsBusy).RunWorkerAsync(arg);                              while (threadPool.All(bw => bw.IsBusy))                              {                                  Application.DoEvents();                                  System.Threading.Thread.Sleep(100);                              }                          }                          textToTranslate.AppendLine(text);                          textToTranslate.AppendLine(ParagraphSplitter);                          indexesToTranslate.Add(index);                      }                      else                      {                          AddToListView(p' before' after);                      }                      if (_abort)                      {                          _abort = false;                          return;                      }                  }                  if (textToTranslate.Length > 0)                  {                      while (threadPool.All(bw => bw.IsBusy))                      {                          Application.DoEvents();                          System.Threading.Thread.Sleep(100);                      }                      var arg = new BackgroundWorkerParameter { Text = textToTranslate.ToString().TrimEnd().TrimEnd('*').TrimEnd()' Indexes = indexesToTranslate' Log = new StringBuilder() };                      threadPool.First(bw => !bw.IsBusy).RunWorkerAsync(arg);                  }                  while (threadPool.Any(bw => bw.IsBusy))                  {                      Application.DoEvents();                      System.Threading.Thread.Sleep(100);                  }                  try                  {                      foreach (var backgroundWorker in threadPool)                      {                          backgroundWorker.Dispose();                      }                  }                  catch                  {                  }              }              catch (Exception exception)              {                  MessageBox.Show(exception.Message + Environment.NewLine + exception.StackTrace);              }
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,GeneratePreview,The following statement contains a magic number: try              {                  _abort = false;                  int numberOfThreads = 4;                  var threadPool = new List<BackgroundWorker>();                  for (int i = 0; i < numberOfThreads; i++)                  {                      var bw = new BackgroundWorker();                      bw.DoWork += OnBwOnDoWork;                      bw.RunWorkerCompleted += OnBwRunWorkerCompleted;                      threadPool.Add(bw);                  }                  var textToTranslate = new StringBuilder();                  var indexesToTranslate = new List<int>();                  for (int index = 0; index < _subtitle.Paragraphs.Count; index++)                  {                      Paragraph p = _subtitle.Paragraphs[index];                      string text = SetFormattingTypeAndSplitting(index' p.Text' (comboBoxLanguageFrom.SelectedItem as TranslationLanguage).Code.StartsWith("ZH"));                      var before = text;                      var after = string.Empty;                      if (setText)                      {                          //if (text.Length + textToTranslate.Length > max) - max is too low for merging texts to really have any effect                          {                              var arg = new BackgroundWorkerParameter { Text = textToTranslate.ToString().TrimEnd().TrimEnd('*').TrimEnd()' Indexes = indexesToTranslate' Log = new StringBuilder() };                              textToTranslate = new StringBuilder();                              indexesToTranslate = new List<int>();                              threadPool.First(bw => !bw.IsBusy).RunWorkerAsync(arg);                              while (threadPool.All(bw => bw.IsBusy))                              {                                  Application.DoEvents();                                  System.Threading.Thread.Sleep(100);                              }                          }                          textToTranslate.AppendLine(text);                          textToTranslate.AppendLine(ParagraphSplitter);                          indexesToTranslate.Add(index);                      }                      else                      {                          AddToListView(p' before' after);                      }                      if (_abort)                      {                          _abort = false;                          return;                      }                  }                  if (textToTranslate.Length > 0)                  {                      while (threadPool.All(bw => bw.IsBusy))                      {                          Application.DoEvents();                          System.Threading.Thread.Sleep(100);                      }                      var arg = new BackgroundWorkerParameter { Text = textToTranslate.ToString().TrimEnd().TrimEnd('*').TrimEnd()' Indexes = indexesToTranslate' Log = new StringBuilder() };                      threadPool.First(bw => !bw.IsBusy).RunWorkerAsync(arg);                  }                  while (threadPool.Any(bw => bw.IsBusy))                  {                      Application.DoEvents();                      System.Threading.Thread.Sleep(100);                  }                  try                  {                      foreach (var backgroundWorker in threadPool)                      {                          backgroundWorker.Dispose();                      }                  }                  catch                  {                  }              }              catch (Exception exception)              {                  MessageBox.Show(exception.Message + Environment.NewLine + exception.StackTrace);              }
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,GeneratePreview,The following statement contains a magic number: try              {                  _abort = false;                  int numberOfThreads = 4;                  var threadPool = new List<BackgroundWorker>();                  for (int i = 0; i < numberOfThreads; i++)                  {                      var bw = new BackgroundWorker();                      bw.DoWork += OnBwOnDoWork;                      bw.RunWorkerCompleted += OnBwRunWorkerCompleted;                      threadPool.Add(bw);                  }                  var textToTranslate = new StringBuilder();                  var indexesToTranslate = new List<int>();                  for (int index = 0; index < _subtitle.Paragraphs.Count; index++)                  {                      Paragraph p = _subtitle.Paragraphs[index];                      string text = SetFormattingTypeAndSplitting(index' p.Text' (comboBoxLanguageFrom.SelectedItem as TranslationLanguage).Code.StartsWith("ZH"));                      var before = text;                      var after = string.Empty;                      if (setText)                      {                          //if (text.Length + textToTranslate.Length > max) - max is too low for merging texts to really have any effect                          {                              var arg = new BackgroundWorkerParameter { Text = textToTranslate.ToString().TrimEnd().TrimEnd('*').TrimEnd()' Indexes = indexesToTranslate' Log = new StringBuilder() };                              textToTranslate = new StringBuilder();                              indexesToTranslate = new List<int>();                              threadPool.First(bw => !bw.IsBusy).RunWorkerAsync(arg);                              while (threadPool.All(bw => bw.IsBusy))                              {                                  Application.DoEvents();                                  System.Threading.Thread.Sleep(100);                              }                          }                          textToTranslate.AppendLine(text);                          textToTranslate.AppendLine(ParagraphSplitter);                          indexesToTranslate.Add(index);                      }                      else                      {                          AddToListView(p' before' after);                      }                      if (_abort)                      {                          _abort = false;                          return;                      }                  }                  if (textToTranslate.Length > 0)                  {                      while (threadPool.All(bw => bw.IsBusy))                      {                          Application.DoEvents();                          System.Threading.Thread.Sleep(100);                      }                      var arg = new BackgroundWorkerParameter { Text = textToTranslate.ToString().TrimEnd().TrimEnd('*').TrimEnd()' Indexes = indexesToTranslate' Log = new StringBuilder() };                      threadPool.First(bw => !bw.IsBusy).RunWorkerAsync(arg);                  }                  while (threadPool.Any(bw => bw.IsBusy))                  {                      Application.DoEvents();                      System.Threading.Thread.Sleep(100);                  }                  try                  {                      foreach (var backgroundWorker in threadPool)                      {                          backgroundWorker.Dispose();                      }                  }                  catch                  {                  }              }              catch (Exception exception)              {                  MessageBox.Show(exception.Message + Environment.NewLine + exception.StackTrace);              }
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,GeneratePreview,The following statement contains a magic number: try              {                  _abort = false;                  int numberOfThreads = 4;                  var threadPool = new List<BackgroundWorker>();                  for (int i = 0; i < numberOfThreads; i++)                  {                      var bw = new BackgroundWorker();                      bw.DoWork += OnBwOnDoWork;                      bw.RunWorkerCompleted += OnBwRunWorkerCompleted;                      threadPool.Add(bw);                  }                  var textToTranslate = new StringBuilder();                  var indexesToTranslate = new List<int>();                  for (int index = 0; index < _subtitle.Paragraphs.Count; index++)                  {                      Paragraph p = _subtitle.Paragraphs[index];                      string text = SetFormattingTypeAndSplitting(index' p.Text' (comboBoxLanguageFrom.SelectedItem as TranslationLanguage).Code.StartsWith("ZH"));                      var before = text;                      var after = string.Empty;                      if (setText)                      {                          //if (text.Length + textToTranslate.Length > max) - max is too low for merging texts to really have any effect                          {                              var arg = new BackgroundWorkerParameter { Text = textToTranslate.ToString().TrimEnd().TrimEnd('*').TrimEnd()' Indexes = indexesToTranslate' Log = new StringBuilder() };                              textToTranslate = new StringBuilder();                              indexesToTranslate = new List<int>();                              threadPool.First(bw => !bw.IsBusy).RunWorkerAsync(arg);                              while (threadPool.All(bw => bw.IsBusy))                              {                                  Application.DoEvents();                                  System.Threading.Thread.Sleep(100);                              }                          }                          textToTranslate.AppendLine(text);                          textToTranslate.AppendLine(ParagraphSplitter);                          indexesToTranslate.Add(index);                      }                      else                      {                          AddToListView(p' before' after);                      }                      if (_abort)                      {                          _abort = false;                          return;                      }                  }                  if (textToTranslate.Length > 0)                  {                      while (threadPool.All(bw => bw.IsBusy))                      {                          Application.DoEvents();                          System.Threading.Thread.Sleep(100);                      }                      var arg = new BackgroundWorkerParameter { Text = textToTranslate.ToString().TrimEnd().TrimEnd('*').TrimEnd()' Indexes = indexesToTranslate' Log = new StringBuilder() };                      threadPool.First(bw => !bw.IsBusy).RunWorkerAsync(arg);                  }                  while (threadPool.Any(bw => bw.IsBusy))                  {                      Application.DoEvents();                      System.Threading.Thread.Sleep(100);                  }                  try                  {                      foreach (var backgroundWorker in threadPool)                      {                          backgroundWorker.Dispose();                      }                  }                  catch                  {                  }              }              catch (Exception exception)              {                  MessageBox.Show(exception.Message + Environment.NewLine + exception.StackTrace);              }
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,OnBwRunWorkerCompleted,The following statement contains a magic number: lock (_myLock)              {                  int i = 0;                  foreach (var index in parameter.Indexes)                  {                      var cleanText = results[i];                      if (_autoSplit[index])                      {                          cleanText = Utilities.AutoBreakLine(cleanText);                      }                      if (Utilities.GetNumberOfLines(cleanText) == 1 && Utilities.GetNumberOfLines(_subtitle.Paragraphs[index].Text) == 2)                      {                          if (!_autoSplit[index])                          {                              cleanText = Utilities.AutoBreakLine(cleanText);                          }                      }                        if (_formattingTypes[index] == FormattingType.ItalicTwoLines || _formattingTypes[index] == FormattingType.Italic)                      {                          _subtitle.Paragraphs[index].Text = "<i>" + cleanText + "</i>";                      }                      else if (_formattingTypes[index] == FormattingType.Parentheses)                      {                          _subtitle.Paragraphs[index].Text = "(" + cleanText + ")";                      }                      else if (_formattingTypes[index] == FormattingType.SquareBrackets)                      {                          _subtitle.Paragraphs[index].Text = "[" + cleanText + "]";                      }                      else                      {                          _subtitle.Paragraphs[index].Text = cleanText;                      }                        _subtitle.Paragraphs[index].Text = cleanText;                      var item = listView1.Items[index];                      item.SubItems[2].Text = _subtitle.Paragraphs[index].Text;                      i++;                  }              }
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,OnBwRunWorkerCompleted,The following statement contains a magic number: lock (_myLock)              {                  int i = 0;                  foreach (var index in parameter.Indexes)                  {                      var cleanText = results[i];                      if (_autoSplit[index])                      {                          cleanText = Utilities.AutoBreakLine(cleanText);                      }                      if (Utilities.GetNumberOfLines(cleanText) == 1 && Utilities.GetNumberOfLines(_subtitle.Paragraphs[index].Text) == 2)                      {                          if (!_autoSplit[index])                          {                              cleanText = Utilities.AutoBreakLine(cleanText);                          }                      }                        if (_formattingTypes[index] == FormattingType.ItalicTwoLines || _formattingTypes[index] == FormattingType.Italic)                      {                          _subtitle.Paragraphs[index].Text = "<i>" + cleanText + "</i>";                      }                      else if (_formattingTypes[index] == FormattingType.Parentheses)                      {                          _subtitle.Paragraphs[index].Text = "(" + cleanText + ")";                      }                      else if (_formattingTypes[index] == FormattingType.SquareBrackets)                      {                          _subtitle.Paragraphs[index].Text = "[" + cleanText + "]";                      }                      else                      {                          _subtitle.Paragraphs[index].Text = cleanText;                      }                        _subtitle.Paragraphs[index].Text = cleanText;                      var item = listView1.Items[index];                      item.SubItems[2].Text = _subtitle.Paragraphs[index].Text;                      i++;                  }              }
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,DeeplTranslate,The following statement contains a magic number: const int maxNumberOfRetries = 2;
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,listView1_Resize,The following statement contains a magic number: var size = (listView1.Width - listView1.Columns[0].Width) >> 2;
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,listView1_Resize,The following statement contains a magic number: listView1.Columns[2].Width = -2;
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,listView1_Resize,The following statement contains a magic number: listView1.Columns[2].Width = -2;
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,SetFormattingTypeAndSplitting,The following statement contains a magic number: if (text.StartsWith("<i>"' StringComparison.Ordinal) && text.EndsWith("</i>"' StringComparison.Ordinal) && text.Contains("</i>" + Environment.NewLine + "<i>") && Utilities.GetNumberOfLines(text) == 2 && Utilities.CountTagInText(text' "<i>") == 1)              {                  _formattingTypes[i] = FormattingType.ItalicTwoLines;                  text = HtmlUtil.RemoveOpenCloseTags(text' HtmlUtil.TagItalic);              }              else if (text.StartsWith("<i>"' StringComparison.Ordinal) && text.EndsWith("</i>"' StringComparison.Ordinal) && Utilities.CountTagInText(text' "<i>") == 1)              {                  _formattingTypes[i] = FormattingType.Italic;                  text = text.Substring(3' text.Length - 7);              }              else if (text.StartsWith("("' StringComparison.Ordinal) && text.EndsWith(")"' StringComparison.Ordinal))              {                  _formattingTypes[i] = FormattingType.Parentheses;                  text = text.Substring(1' text.Length - 2);              }              else if (text.StartsWith("["' StringComparison.Ordinal) && text.EndsWith("]"' StringComparison.Ordinal))              {                  _formattingTypes[i] = FormattingType.SquareBrackets;                  text = text.Substring(1' text.Length - 2);              }              else              {                  _formattingTypes[i] = FormattingType.None;              }
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,SetFormattingTypeAndSplitting,The following statement contains a magic number: if (text.StartsWith("<i>"' StringComparison.Ordinal) && text.EndsWith("</i>"' StringComparison.Ordinal) && text.Contains("</i>" + Environment.NewLine + "<i>") && Utilities.GetNumberOfLines(text) == 2 && Utilities.CountTagInText(text' "<i>") == 1)              {                  _formattingTypes[i] = FormattingType.ItalicTwoLines;                  text = HtmlUtil.RemoveOpenCloseTags(text' HtmlUtil.TagItalic);              }              else if (text.StartsWith("<i>"' StringComparison.Ordinal) && text.EndsWith("</i>"' StringComparison.Ordinal) && Utilities.CountTagInText(text' "<i>") == 1)              {                  _formattingTypes[i] = FormattingType.Italic;                  text = text.Substring(3' text.Length - 7);              }              else if (text.StartsWith("("' StringComparison.Ordinal) && text.EndsWith(")"' StringComparison.Ordinal))              {                  _formattingTypes[i] = FormattingType.Parentheses;                  text = text.Substring(1' text.Length - 2);              }              else if (text.StartsWith("["' StringComparison.Ordinal) && text.EndsWith("]"' StringComparison.Ordinal))              {                  _formattingTypes[i] = FormattingType.SquareBrackets;                  text = text.Substring(1' text.Length - 2);              }              else              {                  _formattingTypes[i] = FormattingType.None;              }
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,SetFormattingTypeAndSplitting,The following statement contains a magic number: if (text.StartsWith("<i>"' StringComparison.Ordinal) && text.EndsWith("</i>"' StringComparison.Ordinal) && text.Contains("</i>" + Environment.NewLine + "<i>") && Utilities.GetNumberOfLines(text) == 2 && Utilities.CountTagInText(text' "<i>") == 1)              {                  _formattingTypes[i] = FormattingType.ItalicTwoLines;                  text = HtmlUtil.RemoveOpenCloseTags(text' HtmlUtil.TagItalic);              }              else if (text.StartsWith("<i>"' StringComparison.Ordinal) && text.EndsWith("</i>"' StringComparison.Ordinal) && Utilities.CountTagInText(text' "<i>") == 1)              {                  _formattingTypes[i] = FormattingType.Italic;                  text = text.Substring(3' text.Length - 7);              }              else if (text.StartsWith("("' StringComparison.Ordinal) && text.EndsWith(")"' StringComparison.Ordinal))              {                  _formattingTypes[i] = FormattingType.Parentheses;                  text = text.Substring(1' text.Length - 2);              }              else if (text.StartsWith("["' StringComparison.Ordinal) && text.EndsWith("]"' StringComparison.Ordinal))              {                  _formattingTypes[i] = FormattingType.SquareBrackets;                  text = text.Substring(1' text.Length - 2);              }              else              {                  _formattingTypes[i] = FormattingType.None;              }
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,SetFormattingTypeAndSplitting,The following statement contains a magic number: if (text.StartsWith("<i>"' StringComparison.Ordinal) && text.EndsWith("</i>"' StringComparison.Ordinal) && text.Contains("</i>" + Environment.NewLine + "<i>") && Utilities.GetNumberOfLines(text) == 2 && Utilities.CountTagInText(text' "<i>") == 1)              {                  _formattingTypes[i] = FormattingType.ItalicTwoLines;                  text = HtmlUtil.RemoveOpenCloseTags(text' HtmlUtil.TagItalic);              }              else if (text.StartsWith("<i>"' StringComparison.Ordinal) && text.EndsWith("</i>"' StringComparison.Ordinal) && Utilities.CountTagInText(text' "<i>") == 1)              {                  _formattingTypes[i] = FormattingType.Italic;                  text = text.Substring(3' text.Length - 7);              }              else if (text.StartsWith("("' StringComparison.Ordinal) && text.EndsWith(")"' StringComparison.Ordinal))              {                  _formattingTypes[i] = FormattingType.Parentheses;                  text = text.Substring(1' text.Length - 2);              }              else if (text.StartsWith("["' StringComparison.Ordinal) && text.EndsWith("]"' StringComparison.Ordinal))              {                  _formattingTypes[i] = FormattingType.SquareBrackets;                  text = text.Substring(1' text.Length - 2);              }              else              {                  _formattingTypes[i] = FormattingType.None;              }
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,SetFormattingTypeAndSplitting,The following statement contains a magic number: if (text.StartsWith("<i>"' StringComparison.Ordinal) && text.EndsWith("</i>"' StringComparison.Ordinal) && text.Contains("</i>" + Environment.NewLine + "<i>") && Utilities.GetNumberOfLines(text) == 2 && Utilities.CountTagInText(text' "<i>") == 1)              {                  _formattingTypes[i] = FormattingType.ItalicTwoLines;                  text = HtmlUtil.RemoveOpenCloseTags(text' HtmlUtil.TagItalic);              }              else if (text.StartsWith("<i>"' StringComparison.Ordinal) && text.EndsWith("</i>"' StringComparison.Ordinal) && Utilities.CountTagInText(text' "<i>") == 1)              {                  _formattingTypes[i] = FormattingType.Italic;                  text = text.Substring(3' text.Length - 7);              }              else if (text.StartsWith("("' StringComparison.Ordinal) && text.EndsWith(")"' StringComparison.Ordinal))              {                  _formattingTypes[i] = FormattingType.Parentheses;                  text = text.Substring(1' text.Length - 2);              }              else if (text.StartsWith("["' StringComparison.Ordinal) && text.EndsWith("]"' StringComparison.Ordinal))              {                  _formattingTypes[i] = FormattingType.SquareBrackets;                  text = text.Substring(1' text.Length - 2);              }              else              {                  _formattingTypes[i] = FormattingType.None;              }
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,SetFormattingTypeAndSplitting,The following statement contains a magic number: if (lines.Length == 2 && !string.IsNullOrEmpty(lines[0]) && (Utilities.AllLettersAndNumbers + "'").Contains(lines[0].Substring(lines[0].Length - 1)))              {                  _autoSplit[i] = true;                  text = Utilities.RemoveLineBreaks(text);              }
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.listView1.Location = new System.Drawing.Point(15' 53);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.listView1.Location = new System.Drawing.Point(15' 53);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.listView1.Size = new System.Drawing.Size(804' 467);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.listView1.Size = new System.Drawing.Size(804' 467);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.columnHeader1.Width = 48;
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.columnHeader2.Width = 303;
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.columnHeader3.Width = 335;
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.buttonOk.Location = new System.Drawing.Point(663' 526);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.buttonOk.Location = new System.Drawing.Point(663' 526);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.buttonOk.Size = new System.Drawing.Size(75' 23);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.buttonOk.Size = new System.Drawing.Size(75' 23);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.buttonOk.TabIndex = 7;
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.buttonCancel.Location = new System.Drawing.Point(744' 526);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.buttonCancel.Location = new System.Drawing.Point(744' 526);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.buttonCancel.Size = new System.Drawing.Size(75' 23);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.buttonCancel.Size = new System.Drawing.Size(75' 23);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.buttonCancel.TabIndex = 8;
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.label1.Location = new System.Drawing.Point(12' 15);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.label1.Location = new System.Drawing.Point(12' 15);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.label1.Size = new System.Drawing.Size(129' 13);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.label1.Size = new System.Drawing.Size(129' 13);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.linkLabel1.Location = new System.Drawing.Point(9' 536);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.linkLabel1.Location = new System.Drawing.Point(9' 536);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.linkLabel1.Size = new System.Drawing.Size(98' 13);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.linkLabel1.Size = new System.Drawing.Size(98' 13);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.linkLabel1.TabIndex = 6;
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.comboBoxLanguageFrom.Location = new System.Drawing.Point(147' 12);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.comboBoxLanguageFrom.Location = new System.Drawing.Point(147' 12);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.comboBoxLanguageFrom.Size = new System.Drawing.Size(112' 21);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.comboBoxLanguageFrom.Size = new System.Drawing.Size(112' 21);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.buttonTranslate.Location = new System.Drawing.Point(383' 10);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.buttonTranslate.Location = new System.Drawing.Point(383' 10);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.buttonTranslate.Size = new System.Drawing.Size(113' 23);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.buttonTranslate.Size = new System.Drawing.Size(113' 23);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.buttonTranslate.TabIndex = 2;
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.textBox1.Location = new System.Drawing.Point(15' 53);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.textBox1.Location = new System.Drawing.Point(15' 53);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.textBox1.Size = new System.Drawing.Size(804' 467);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.textBox1.Size = new System.Drawing.Size(804' 467);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.textBox1.TabIndex = 5;
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.buttonCancelTranslate.Location = new System.Drawing.Point(502' 10);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.buttonCancelTranslate.Location = new System.Drawing.Point(502' 10);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.buttonCancelTranslate.Size = new System.Drawing.Size(99' 23);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.buttonCancelTranslate.Size = new System.Drawing.Size(99' 23);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.buttonCancelTranslate.TabIndex = 3;
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.progressBar1.Location = new System.Drawing.Point(607' 11);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.progressBar1.Location = new System.Drawing.Point(607' 11);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.progressBar1.Size = new System.Drawing.Size(212' 23);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.progressBar1.Size = new System.Drawing.Size(212' 23);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.progressBar1.TabIndex = 4;
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.comboBoxLanguageTo.Location = new System.Drawing.Point(265' 11);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.comboBoxLanguageTo.Location = new System.Drawing.Point(265' 11);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.comboBoxLanguageTo.Size = new System.Drawing.Size(112' 21);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.comboBoxLanguageTo.Size = new System.Drawing.Size(112' 21);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.comboBoxLanguageTo.TabIndex = 10;
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.ClientSize = new System.Drawing.Size(831' 557);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.ClientSize = new System.Drawing.Size(831' 557);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.MinimumSize = new System.Drawing.Size(733' 478);
Magic Number,SubtitleEdit,MainForm,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\MainForm.cs,InitializeComponent,The following statement contains a magic number: this.MinimumSize = new System.Drawing.Size(733' 478);
Magic Number,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,EncodeNamed,The following statement contains a magic number: foreach (var ch in source)              {                  switch (ch)                  {                      case '<':                          encoded.Append("&lt;");                          break;                      case '>':                          encoded.Append("&gt;");                          break;                      case '"':                          encoded.Append("&quot;");                          break;                      case '&':                          encoded.Append("&amp;");                          break;                      case '\'':                          encoded.Append("&apos;");                          break;                      case ' ':                          encoded.Append("&nbsp;");                          break;                      case '–':                          encoded.Append("&ndash;");                          break;                      case '—':                          encoded.Append("&mdash;");                          break;                      case '¡':                          encoded.Append("&iexcl;");                          break;                      case '¿':                          encoded.Append("&iquest;");                          break;                      case '“':                          encoded.Append("&ldquo;");                          break;                      case '”':                          encoded.Append("&rdquo;");                          break;                      case '‘':                          encoded.Append("&lsquo;");                          break;                      case '’':                          encoded.Append("&rsquo;");                          break;                      case '«':                          encoded.Append("&laquo;");                          break;                      case '»':                          encoded.Append("&raquo;");                          break;                      case '¢':                          encoded.Append("&cent;");                          break;                      case '©':                          encoded.Append("&copy;");                          break;                      case '÷':                          encoded.Append("&divide;");                          break;                      case 'µ':                          encoded.Append("&micro;");                          break;                      case '·':                          encoded.Append("&middot;");                          break;                      case '¶':                          encoded.Append("&para;");                          break;                      case '±':                          encoded.Append("&plusmn;");                          break;                      case '€':                          encoded.Append("&euro;");                          break;                      case '£':                          encoded.Append("&pound;");                          break;                      case '®':                          encoded.Append("&reg;");                          break;                      case '§':                          encoded.Append("&sect;");                          break;                      case '™':                          encoded.Append("&trade;");                          break;                      case '¥':                          encoded.Append("&yen;");                          break;                      case 'á':                          encoded.Append("&aacute;");                          break;                      case 'Á':                          encoded.Append("&Aacute;");                          break;                      case 'à':                          encoded.Append("&agrave;");                          break;                      case 'À':                          encoded.Append("&Agrave;");                          break;                      case 'â':                          encoded.Append("&acirc;");                          break;                      case 'Â':                          encoded.Append("&Acirc;");                          break;                      case 'å':                          encoded.Append("&aring;");                          break;                      case 'Å':                          encoded.Append("&Aring;");                          break;                      case 'ã':                          encoded.Append("&atilde;");                          break;                      case 'Ã':                          encoded.Append("&Atilde;");                          break;                      case 'ä':                          encoded.Append("&auml;");                          break;                      case 'Ä':                          encoded.Append("&Auml;");                          break;                      case 'æ':                          encoded.Append("&aelig;");                          break;                      case 'Æ':                          encoded.Append("&AElig;");                          break;                      case 'ç':                          encoded.Append("&ccedil;");                          break;                      case 'Ç':                          encoded.Append("&Ccedil;");                          break;                      case 'é':                          encoded.Append("&eacute;");                          break;                      case 'É':                          encoded.Append("&Eacute;");                          break;                      case 'è':                          encoded.Append("&egrave;");                          break;                      case 'È':                          encoded.Append("&Egrave;");                          break;                      case 'ê':                          encoded.Append("&ecirc;");                          break;                      case 'Ê':                          encoded.Append("&Ecirc;");                          break;                      case 'ë':                          encoded.Append("&euml;");                          break;                      case 'Ë':                          encoded.Append("&Euml;");                          break;                      case 'í':                          encoded.Append("&iacute;");                          break;                      case 'Í':                          encoded.Append("&Iacute;");                          break;                      case 'ì':                          encoded.Append("&igrave;");                          break;                      case 'Ì':                          encoded.Append("&Igrave;");                          break;                      case 'î':                          encoded.Append("&icirc;");                          break;                      case 'Î':                          encoded.Append("&Icirc;");                          break;                      case 'ï':                          encoded.Append("&iuml;");                          break;                      case 'Ï':                          encoded.Append("&Iuml;");                          break;                      case 'ñ':                          encoded.Append("&ntilde;");                          break;                      case 'Ñ':                          encoded.Append("&Ntilde;");                          break;                      case 'ó':                          encoded.Append("&oacute;");                          break;                      case 'Ó':                          encoded.Append("&Oacute;");                          break;                      case 'ò':                          encoded.Append("&ograve;");                          break;                      case 'Ò':                          encoded.Append("&Ograve;");                          break;                      case 'ô':                          encoded.Append("&ocirc;");                          break;                      case 'Ô':                          encoded.Append("&Ocirc;");                          break;                      case 'ø':                          encoded.Append("&oslash;");                          break;                      case 'Ø':                          encoded.Append("&Oslash;");                          break;                      case 'õ':                          encoded.Append("&otilde;");                          break;                      case 'Õ':                          encoded.Append("&Otilde;");                          break;                      case 'ö':                          encoded.Append("&ouml;");                          break;                      case 'Ö':                          encoded.Append("&Ouml;");                          break;                      case 'ß':                          encoded.Append("&szlig;");                          break;                      case 'ú':                          encoded.Append("&uacute;");                          break;                      case 'Ú':                          encoded.Append("&Uacute;");                          break;                      case 'ù':                          encoded.Append("&ugrave;");                          break;                      case 'Ù':                          encoded.Append("&Ugrave;");                          break;                      case 'û':                          encoded.Append("&ucirc;");                          break;                      case 'Û':                          encoded.Append("&Ucirc;");                          break;                      case 'ü':                          encoded.Append("&uuml;");                          break;                      case 'Ü':                          encoded.Append("&Uuml;");                          break;                      case 'ÿ':                          encoded.Append("&yuml;");                          break;                      default:                          if (ch > 127)                              encoded.Append("&#" + (int)ch + ";");                          else                              encoded.Append(ch);                          break;                  }              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,EncodeNumeric,The following statement contains a magic number: foreach (var ch in source)              {                  if (ch == ' ')                  {                      encoded.Append("&#");                      encoded.Append(160); // &nbsp;                      encoded.Append(';');                  }                  else if (ch > 127 || ch == '<' || ch == '>' || ch == '"' || ch == '&' || ch == '\'')                  {                      encoded.Append("&#");                      encoded.Append((int)ch);                      encoded.Append(';');                  }                  else                  {                      encoded.Append(ch);                  }              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,EncodeNumeric,The following statement contains a magic number: foreach (var ch in source)              {                  if (ch == ' ')                  {                      encoded.Append("&#");                      encoded.Append(160); // &nbsp;                      encoded.Append(';');                  }                  else if (ch > 127 || ch == '<' || ch == '>' || ch == '"' || ch == '&' || ch == '\'')                  {                      encoded.Append("&#");                      encoded.Append((int)ch);                      encoded.Append(';');                  }                  else                  {                      encoded.Append(ch);                  }              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,RemoveHtmlTags,The following statement contains a magic number: if (s == null || s.Length < 3)                  return s;
Magic Number,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,IsUrl,The following statement contains a magic number: if (string.IsNullOrWhiteSpace(text) || text.Length < 6 || !text.Contains('.') || text.Contains(' '))                  return false;
Magic Number,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixUpperTags,The following statement contains a magic number: while (idx >= 0)              {                  var endIdx = text.IndexOf('>'' idx + 2);                  if (endIdx < idx)                      break;                  var tag = text.Substring(idx' endIdx - idx).ToLowerInvariant();                  text = text.Remove(idx' endIdx - idx).Insert(idx' tag);                  idx = text.IndexOfAny(UppercaseTags' StringComparison.Ordinal);              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The following statement contains a magic number: if (italicBeginTagCount + italicEndTagCount > 0)              {                  if (italicBeginTagCount == 1 && italicEndTagCount == 1 && text.IndexOf(beginTag' StringComparison.Ordinal) > text.IndexOf(endTag' StringComparison.Ordinal))                  {                      const string pattern = "___________@";                      text = text.Replace(beginTag' pattern);                      text = text.Replace(endTag' beginTag);                      text = text.Replace(pattern' endTag);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 0)                  {                      int firstIndex = text.IndexOf(beginTag' StringComparison.Ordinal);                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      if (noOfLines == 2 && lastIndex == lastIndexWithNewLine && firstIndex < 2)                          text = text.Replace(Environment.NewLine' endTag + Environment.NewLine) + endTag;                      else                          text = text.Remove(lastIndex' beginTag.Length).Insert(lastIndex' endTag);                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 2)                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      if (text.StartsWith("</i>-<i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i> -"' StringComparison.Ordinal) ||                          text.StartsWith("</i>-<i> -"' StringComparison.Ordinal))                          text = text.Remove(0' 5);                      else if (firstIndex == 0)                          text = text.Remove(0' 4);                      else                          text = text.Substring(0' firstIndex) + text.Substring(firstIndex + endTag.Length);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 1)                  {                      var lines = text.SplitToLines();                      if (lines.Length == 2 && lines[0].StartsWith(beginTag' StringComparison.Ordinal) && lines[0].EndsWith(endTag' StringComparison.Ordinal) &&                          lines[1].StartsWith(beginTag' StringComparison.Ordinal))                      {                          text = text.TrimEnd() + endTag;                      }                      else                      {                          int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                          if (text.Length > lastIndex + endTag.Length)                              text = text.Substring(0' lastIndex) + text.Substring(lastIndex - 1 + endTag.Length);                          else                              text = text.Substring(0' lastIndex - 1) + endTag;                      }                      if (text.StartsWith(beginTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal) && text.Contains(endTag + Environment.NewLine + beginTag))                      {                          text = text.Replace(endTag + Environment.NewLine + beginTag' Environment.NewLine);                      }                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 0)                  {                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                        if (text.StartsWith(beginTag' StringComparison.Ordinal))                          text += endTag;                      else if (noOfLines == 2 && lastIndex == lastIndexWithNewLine)                          text += endTag;                      else                          text = text.Replace(beginTag' string.Empty);                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 1)                  {                      var cleanText = RemoveOpenCloseTags(text' TagItalic' TagBold' TagUnderline' TagCyrillicI);                      bool isFixed = false;                        // Foo.</i>                      if (text.EndsWith(endTag' StringComparison.Ordinal) && !cleanText.StartsWith("-") && !cleanText.Contains(Environment.NewLine + "-"))                      {                          text = beginTag + text;                          isFixed = true;                      }                        // - Foo</i> | - Foo.                      // - Bar.    | - Foo.</i>                      if (!isFixed && Utilities.GetNumberOfLines(cleanText) == 2)                      {                          int newLineIndex = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                          if (newLineIndex > 0)                          {                              var firstLine = text.Substring(0' newLineIndex).Trim();                              var secondLine = text.Substring(newLineIndex + 2).Trim();                              if (firstLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  firstLine = beginTag + firstLine;                                  isFixed = true;                              }                              if (secondLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  secondLine = beginTag + secondLine;                                  isFixed = true;                              }                              text = firstLine + Environment.NewLine + secondLine;                          }                      }                      if (!isFixed)                          text = text.Replace(endTag' string.Empty);                  }                    // - foo.</i>                  // - bar.</i>                  if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.Contains(endTag + Environment.NewLine' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      text = text.Replace(endTag' string.Empty);                      text = beginTag + text + endTag;                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.StartsWith(endTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      text = text.Remove(firstIndex' endTag.Length).Insert(firstIndex' beginTag);                  }                    // <i>Foo</i>                  // <i>Bar</i>                  if (italicBeginTagCount == 2 && italicEndTagCount == 2 && noOfLines == 2)                  {                      int index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      if (index > 0 && text.Length > index + (beginTag.Length + endTag.Length))                      {                          var firstLine = text.Substring(0' index).Trim();                          var secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                            if (firstLine.Length > 10 && firstLine.StartsWith("- <i>"' StringComparison.Ordinal) && firstLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = "<i>- " + firstLine.Remove(0' 5) + Environment.NewLine + secondLine;                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                          if (secondLine.Length > 10 && secondLine.StartsWith("- <i>"' StringComparison.Ordinal) && secondLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = firstLine + Environment.NewLine + "<i>- " + secondLine.Remove(0' 5);                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                            if (Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag))                          {                              text = text.Replace(beginTag' string.Empty).Replace(endTag' string.Empty).Trim();                              text = beginTag + text + endTag;                          }                      }                        //FALCONE:<i> I didn't think</i><br /><i>it was going to be you'</i>                      var colIdx = text.IndexOf(':');                      if (colIdx >= 0 && Utilities.CountTagInText(text' beginTag) + Utilities.CountTagInText(text' endTag) == 4 && text.Length > colIdx + 1 && !char.IsDigit(text[colIdx + 1]))                      {                          var firstLine = text.Substring(0' index);                          var secondLine = text.Substring(index).TrimStart();                            var secIdxCol = secondLine.IndexOf(':');                          if (secIdxCol < 0 || !Utilities.IsBetweenNumbers(secondLine' secIdxCol))                          {                              var idx = firstLine.IndexOf(':');                              if (idx > 1)                              {                                  var pre = text.Substring(0' idx + 1).TrimStart();                                  text = text.Remove(0' idx + 1);                                  text = FixInvalidItalicTags(text).Trim();                                  if (text.StartsWith("<i> "' StringComparison.OrdinalIgnoreCase))                                      text = Utilities.RemoveSpaceBeforeAfterTag(text' beginTag);                                  text = pre + " " + text;                              }                          }                      }                  }                    //<i>- You think they're they gone?<i>                  //<i>- That can't be.</i>                  if (italicBeginTagCount == 3 && italicEndTagCount == 1 && noOfLines == 2)                  {                      var newLineIdx = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      var firstLine = text.Substring(0' newLineIdx).Trim();                      var secondLine = text.Substring(newLineIdx).Trim();                        if ((Utilities.StartsAndEndsWithTag(firstLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag)) ||                          (Utilities.StartsAndEndsWithTag(secondLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag)))                      {                          text = text.Replace(beginTag' string.Empty);                          text = text.Replace(endTag' string.Empty);                          text = text.Replace("  "' " ").Trim();                          text = beginTag + text + endTag;                      }                  }                    if (noOfLines == 3)                  {                      var lines = text.SplitToLines();                      if ((italicBeginTagCount == 3 && italicEndTagCount == 2) || (italicBeginTagCount == 2 && italicEndTagCount == 3))                      {                          int numberOfItalics = 0;                          foreach (var line in lines)                          {                              if (line.StartsWith(beginTag' StringComparison.Ordinal))                                  numberOfItalics++;                              if (line.EndsWith(endTag' StringComparison.Ordinal))                                  numberOfItalics++;                          }                          if (numberOfItalics == 5)                          { // fix missing tag                              text = "<i>" + text.Replace("<i>"' string.Empty).Replace("</i>"' string.Empty) + "</i>";                          }                      }                  }                    text = text.Replace("<i></i>"' string.Empty);                  text = text.Replace("<i> </i>"' string.Empty);                  text = text.Replace("<i>  </i>"' string.Empty);              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The following statement contains a magic number: if (italicBeginTagCount + italicEndTagCount > 0)              {                  if (italicBeginTagCount == 1 && italicEndTagCount == 1 && text.IndexOf(beginTag' StringComparison.Ordinal) > text.IndexOf(endTag' StringComparison.Ordinal))                  {                      const string pattern = "___________@";                      text = text.Replace(beginTag' pattern);                      text = text.Replace(endTag' beginTag);                      text = text.Replace(pattern' endTag);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 0)                  {                      int firstIndex = text.IndexOf(beginTag' StringComparison.Ordinal);                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      if (noOfLines == 2 && lastIndex == lastIndexWithNewLine && firstIndex < 2)                          text = text.Replace(Environment.NewLine' endTag + Environment.NewLine) + endTag;                      else                          text = text.Remove(lastIndex' beginTag.Length).Insert(lastIndex' endTag);                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 2)                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      if (text.StartsWith("</i>-<i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i> -"' StringComparison.Ordinal) ||                          text.StartsWith("</i>-<i> -"' StringComparison.Ordinal))                          text = text.Remove(0' 5);                      else if (firstIndex == 0)                          text = text.Remove(0' 4);                      else                          text = text.Substring(0' firstIndex) + text.Substring(firstIndex + endTag.Length);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 1)                  {                      var lines = text.SplitToLines();                      if (lines.Length == 2 && lines[0].StartsWith(beginTag' StringComparison.Ordinal) && lines[0].EndsWith(endTag' StringComparison.Ordinal) &&                          lines[1].StartsWith(beginTag' StringComparison.Ordinal))                      {                          text = text.TrimEnd() + endTag;                      }                      else                      {                          int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                          if (text.Length > lastIndex + endTag.Length)                              text = text.Substring(0' lastIndex) + text.Substring(lastIndex - 1 + endTag.Length);                          else                              text = text.Substring(0' lastIndex - 1) + endTag;                      }                      if (text.StartsWith(beginTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal) && text.Contains(endTag + Environment.NewLine + beginTag))                      {                          text = text.Replace(endTag + Environment.NewLine + beginTag' Environment.NewLine);                      }                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 0)                  {                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                        if (text.StartsWith(beginTag' StringComparison.Ordinal))                          text += endTag;                      else if (noOfLines == 2 && lastIndex == lastIndexWithNewLine)                          text += endTag;                      else                          text = text.Replace(beginTag' string.Empty);                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 1)                  {                      var cleanText = RemoveOpenCloseTags(text' TagItalic' TagBold' TagUnderline' TagCyrillicI);                      bool isFixed = false;                        // Foo.</i>                      if (text.EndsWith(endTag' StringComparison.Ordinal) && !cleanText.StartsWith("-") && !cleanText.Contains(Environment.NewLine + "-"))                      {                          text = beginTag + text;                          isFixed = true;                      }                        // - Foo</i> | - Foo.                      // - Bar.    | - Foo.</i>                      if (!isFixed && Utilities.GetNumberOfLines(cleanText) == 2)                      {                          int newLineIndex = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                          if (newLineIndex > 0)                          {                              var firstLine = text.Substring(0' newLineIndex).Trim();                              var secondLine = text.Substring(newLineIndex + 2).Trim();                              if (firstLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  firstLine = beginTag + firstLine;                                  isFixed = true;                              }                              if (secondLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  secondLine = beginTag + secondLine;                                  isFixed = true;                              }                              text = firstLine + Environment.NewLine + secondLine;                          }                      }                      if (!isFixed)                          text = text.Replace(endTag' string.Empty);                  }                    // - foo.</i>                  // - bar.</i>                  if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.Contains(endTag + Environment.NewLine' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      text = text.Replace(endTag' string.Empty);                      text = beginTag + text + endTag;                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.StartsWith(endTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      text = text.Remove(firstIndex' endTag.Length).Insert(firstIndex' beginTag);                  }                    // <i>Foo</i>                  // <i>Bar</i>                  if (italicBeginTagCount == 2 && italicEndTagCount == 2 && noOfLines == 2)                  {                      int index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      if (index > 0 && text.Length > index + (beginTag.Length + endTag.Length))                      {                          var firstLine = text.Substring(0' index).Trim();                          var secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                            if (firstLine.Length > 10 && firstLine.StartsWith("- <i>"' StringComparison.Ordinal) && firstLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = "<i>- " + firstLine.Remove(0' 5) + Environment.NewLine + secondLine;                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                          if (secondLine.Length > 10 && secondLine.StartsWith("- <i>"' StringComparison.Ordinal) && secondLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = firstLine + Environment.NewLine + "<i>- " + secondLine.Remove(0' 5);                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                            if (Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag))                          {                              text = text.Replace(beginTag' string.Empty).Replace(endTag' string.Empty).Trim();                              text = beginTag + text + endTag;                          }                      }                        //FALCONE:<i> I didn't think</i><br /><i>it was going to be you'</i>                      var colIdx = text.IndexOf(':');                      if (colIdx >= 0 && Utilities.CountTagInText(text' beginTag) + Utilities.CountTagInText(text' endTag) == 4 && text.Length > colIdx + 1 && !char.IsDigit(text[colIdx + 1]))                      {                          var firstLine = text.Substring(0' index);                          var secondLine = text.Substring(index).TrimStart();                            var secIdxCol = secondLine.IndexOf(':');                          if (secIdxCol < 0 || !Utilities.IsBetweenNumbers(secondLine' secIdxCol))                          {                              var idx = firstLine.IndexOf(':');                              if (idx > 1)                              {                                  var pre = text.Substring(0' idx + 1).TrimStart();                                  text = text.Remove(0' idx + 1);                                  text = FixInvalidItalicTags(text).Trim();                                  if (text.StartsWith("<i> "' StringComparison.OrdinalIgnoreCase))                                      text = Utilities.RemoveSpaceBeforeAfterTag(text' beginTag);                                  text = pre + " " + text;                              }                          }                      }                  }                    //<i>- You think they're they gone?<i>                  //<i>- That can't be.</i>                  if (italicBeginTagCount == 3 && italicEndTagCount == 1 && noOfLines == 2)                  {                      var newLineIdx = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      var firstLine = text.Substring(0' newLineIdx).Trim();                      var secondLine = text.Substring(newLineIdx).Trim();                        if ((Utilities.StartsAndEndsWithTag(firstLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag)) ||                          (Utilities.StartsAndEndsWithTag(secondLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag)))                      {                          text = text.Replace(beginTag' string.Empty);                          text = text.Replace(endTag' string.Empty);                          text = text.Replace("  "' " ").Trim();                          text = beginTag + text + endTag;                      }                  }                    if (noOfLines == 3)                  {                      var lines = text.SplitToLines();                      if ((italicBeginTagCount == 3 && italicEndTagCount == 2) || (italicBeginTagCount == 2 && italicEndTagCount == 3))                      {                          int numberOfItalics = 0;                          foreach (var line in lines)                          {                              if (line.StartsWith(beginTag' StringComparison.Ordinal))                                  numberOfItalics++;                              if (line.EndsWith(endTag' StringComparison.Ordinal))                                  numberOfItalics++;                          }                          if (numberOfItalics == 5)                          { // fix missing tag                              text = "<i>" + text.Replace("<i>"' string.Empty).Replace("</i>"' string.Empty) + "</i>";                          }                      }                  }                    text = text.Replace("<i></i>"' string.Empty);                  text = text.Replace("<i> </i>"' string.Empty);                  text = text.Replace("<i>  </i>"' string.Empty);              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The following statement contains a magic number: if (italicBeginTagCount + italicEndTagCount > 0)              {                  if (italicBeginTagCount == 1 && italicEndTagCount == 1 && text.IndexOf(beginTag' StringComparison.Ordinal) > text.IndexOf(endTag' StringComparison.Ordinal))                  {                      const string pattern = "___________@";                      text = text.Replace(beginTag' pattern);                      text = text.Replace(endTag' beginTag);                      text = text.Replace(pattern' endTag);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 0)                  {                      int firstIndex = text.IndexOf(beginTag' StringComparison.Ordinal);                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      if (noOfLines == 2 && lastIndex == lastIndexWithNewLine && firstIndex < 2)                          text = text.Replace(Environment.NewLine' endTag + Environment.NewLine) + endTag;                      else                          text = text.Remove(lastIndex' beginTag.Length).Insert(lastIndex' endTag);                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 2)                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      if (text.StartsWith("</i>-<i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i> -"' StringComparison.Ordinal) ||                          text.StartsWith("</i>-<i> -"' StringComparison.Ordinal))                          text = text.Remove(0' 5);                      else if (firstIndex == 0)                          text = text.Remove(0' 4);                      else                          text = text.Substring(0' firstIndex) + text.Substring(firstIndex + endTag.Length);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 1)                  {                      var lines = text.SplitToLines();                      if (lines.Length == 2 && lines[0].StartsWith(beginTag' StringComparison.Ordinal) && lines[0].EndsWith(endTag' StringComparison.Ordinal) &&                          lines[1].StartsWith(beginTag' StringComparison.Ordinal))                      {                          text = text.TrimEnd() + endTag;                      }                      else                      {                          int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                          if (text.Length > lastIndex + endTag.Length)                              text = text.Substring(0' lastIndex) + text.Substring(lastIndex - 1 + endTag.Length);                          else                              text = text.Substring(0' lastIndex - 1) + endTag;                      }                      if (text.StartsWith(beginTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal) && text.Contains(endTag + Environment.NewLine + beginTag))                      {                          text = text.Replace(endTag + Environment.NewLine + beginTag' Environment.NewLine);                      }                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 0)                  {                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                        if (text.StartsWith(beginTag' StringComparison.Ordinal))                          text += endTag;                      else if (noOfLines == 2 && lastIndex == lastIndexWithNewLine)                          text += endTag;                      else                          text = text.Replace(beginTag' string.Empty);                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 1)                  {                      var cleanText = RemoveOpenCloseTags(text' TagItalic' TagBold' TagUnderline' TagCyrillicI);                      bool isFixed = false;                        // Foo.</i>                      if (text.EndsWith(endTag' StringComparison.Ordinal) && !cleanText.StartsWith("-") && !cleanText.Contains(Environment.NewLine + "-"))                      {                          text = beginTag + text;                          isFixed = true;                      }                        // - Foo</i> | - Foo.                      // - Bar.    | - Foo.</i>                      if (!isFixed && Utilities.GetNumberOfLines(cleanText) == 2)                      {                          int newLineIndex = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                          if (newLineIndex > 0)                          {                              var firstLine = text.Substring(0' newLineIndex).Trim();                              var secondLine = text.Substring(newLineIndex + 2).Trim();                              if (firstLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  firstLine = beginTag + firstLine;                                  isFixed = true;                              }                              if (secondLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  secondLine = beginTag + secondLine;                                  isFixed = true;                              }                              text = firstLine + Environment.NewLine + secondLine;                          }                      }                      if (!isFixed)                          text = text.Replace(endTag' string.Empty);                  }                    // - foo.</i>                  // - bar.</i>                  if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.Contains(endTag + Environment.NewLine' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      text = text.Replace(endTag' string.Empty);                      text = beginTag + text + endTag;                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.StartsWith(endTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      text = text.Remove(firstIndex' endTag.Length).Insert(firstIndex' beginTag);                  }                    // <i>Foo</i>                  // <i>Bar</i>                  if (italicBeginTagCount == 2 && italicEndTagCount == 2 && noOfLines == 2)                  {                      int index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      if (index > 0 && text.Length > index + (beginTag.Length + endTag.Length))                      {                          var firstLine = text.Substring(0' index).Trim();                          var secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                            if (firstLine.Length > 10 && firstLine.StartsWith("- <i>"' StringComparison.Ordinal) && firstLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = "<i>- " + firstLine.Remove(0' 5) + Environment.NewLine + secondLine;                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                          if (secondLine.Length > 10 && secondLine.StartsWith("- <i>"' StringComparison.Ordinal) && secondLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = firstLine + Environment.NewLine + "<i>- " + secondLine.Remove(0' 5);                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                            if (Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag))                          {                              text = text.Replace(beginTag' string.Empty).Replace(endTag' string.Empty).Trim();                              text = beginTag + text + endTag;                          }                      }                        //FALCONE:<i> I didn't think</i><br /><i>it was going to be you'</i>                      var colIdx = text.IndexOf(':');                      if (colIdx >= 0 && Utilities.CountTagInText(text' beginTag) + Utilities.CountTagInText(text' endTag) == 4 && text.Length > colIdx + 1 && !char.IsDigit(text[colIdx + 1]))                      {                          var firstLine = text.Substring(0' index);                          var secondLine = text.Substring(index).TrimStart();                            var secIdxCol = secondLine.IndexOf(':');                          if (secIdxCol < 0 || !Utilities.IsBetweenNumbers(secondLine' secIdxCol))                          {                              var idx = firstLine.IndexOf(':');                              if (idx > 1)                              {                                  var pre = text.Substring(0' idx + 1).TrimStart();                                  text = text.Remove(0' idx + 1);                                  text = FixInvalidItalicTags(text).Trim();                                  if (text.StartsWith("<i> "' StringComparison.OrdinalIgnoreCase))                                      text = Utilities.RemoveSpaceBeforeAfterTag(text' beginTag);                                  text = pre + " " + text;                              }                          }                      }                  }                    //<i>- You think they're they gone?<i>                  //<i>- That can't be.</i>                  if (italicBeginTagCount == 3 && italicEndTagCount == 1 && noOfLines == 2)                  {                      var newLineIdx = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      var firstLine = text.Substring(0' newLineIdx).Trim();                      var secondLine = text.Substring(newLineIdx).Trim();                        if ((Utilities.StartsAndEndsWithTag(firstLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag)) ||                          (Utilities.StartsAndEndsWithTag(secondLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag)))                      {                          text = text.Replace(beginTag' string.Empty);                          text = text.Replace(endTag' string.Empty);                          text = text.Replace("  "' " ").Trim();                          text = beginTag + text + endTag;                      }                  }                    if (noOfLines == 3)                  {                      var lines = text.SplitToLines();                      if ((italicBeginTagCount == 3 && italicEndTagCount == 2) || (italicBeginTagCount == 2 && italicEndTagCount == 3))                      {                          int numberOfItalics = 0;                          foreach (var line in lines)                          {                              if (line.StartsWith(beginTag' StringComparison.Ordinal))                                  numberOfItalics++;                              if (line.EndsWith(endTag' StringComparison.Ordinal))                                  numberOfItalics++;                          }                          if (numberOfItalics == 5)                          { // fix missing tag                              text = "<i>" + text.Replace("<i>"' string.Empty).Replace("</i>"' string.Empty) + "</i>";                          }                      }                  }                    text = text.Replace("<i></i>"' string.Empty);                  text = text.Replace("<i> </i>"' string.Empty);                  text = text.Replace("<i>  </i>"' string.Empty);              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The following statement contains a magic number: if (italicBeginTagCount + italicEndTagCount > 0)              {                  if (italicBeginTagCount == 1 && italicEndTagCount == 1 && text.IndexOf(beginTag' StringComparison.Ordinal) > text.IndexOf(endTag' StringComparison.Ordinal))                  {                      const string pattern = "___________@";                      text = text.Replace(beginTag' pattern);                      text = text.Replace(endTag' beginTag);                      text = text.Replace(pattern' endTag);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 0)                  {                      int firstIndex = text.IndexOf(beginTag' StringComparison.Ordinal);                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      if (noOfLines == 2 && lastIndex == lastIndexWithNewLine && firstIndex < 2)                          text = text.Replace(Environment.NewLine' endTag + Environment.NewLine) + endTag;                      else                          text = text.Remove(lastIndex' beginTag.Length).Insert(lastIndex' endTag);                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 2)                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      if (text.StartsWith("</i>-<i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i> -"' StringComparison.Ordinal) ||                          text.StartsWith("</i>-<i> -"' StringComparison.Ordinal))                          text = text.Remove(0' 5);                      else if (firstIndex == 0)                          text = text.Remove(0' 4);                      else                          text = text.Substring(0' firstIndex) + text.Substring(firstIndex + endTag.Length);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 1)                  {                      var lines = text.SplitToLines();                      if (lines.Length == 2 && lines[0].StartsWith(beginTag' StringComparison.Ordinal) && lines[0].EndsWith(endTag' StringComparison.Ordinal) &&                          lines[1].StartsWith(beginTag' StringComparison.Ordinal))                      {                          text = text.TrimEnd() + endTag;                      }                      else                      {                          int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                          if (text.Length > lastIndex + endTag.Length)                              text = text.Substring(0' lastIndex) + text.Substring(lastIndex - 1 + endTag.Length);                          else                              text = text.Substring(0' lastIndex - 1) + endTag;                      }                      if (text.StartsWith(beginTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal) && text.Contains(endTag + Environment.NewLine + beginTag))                      {                          text = text.Replace(endTag + Environment.NewLine + beginTag' Environment.NewLine);                      }                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 0)                  {                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                        if (text.StartsWith(beginTag' StringComparison.Ordinal))                          text += endTag;                      else if (noOfLines == 2 && lastIndex == lastIndexWithNewLine)                          text += endTag;                      else                          text = text.Replace(beginTag' string.Empty);                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 1)                  {                      var cleanText = RemoveOpenCloseTags(text' TagItalic' TagBold' TagUnderline' TagCyrillicI);                      bool isFixed = false;                        // Foo.</i>                      if (text.EndsWith(endTag' StringComparison.Ordinal) && !cleanText.StartsWith("-") && !cleanText.Contains(Environment.NewLine + "-"))                      {                          text = beginTag + text;                          isFixed = true;                      }                        // - Foo</i> | - Foo.                      // - Bar.    | - Foo.</i>                      if (!isFixed && Utilities.GetNumberOfLines(cleanText) == 2)                      {                          int newLineIndex = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                          if (newLineIndex > 0)                          {                              var firstLine = text.Substring(0' newLineIndex).Trim();                              var secondLine = text.Substring(newLineIndex + 2).Trim();                              if (firstLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  firstLine = beginTag + firstLine;                                  isFixed = true;                              }                              if (secondLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  secondLine = beginTag + secondLine;                                  isFixed = true;                              }                              text = firstLine + Environment.NewLine + secondLine;                          }                      }                      if (!isFixed)                          text = text.Replace(endTag' string.Empty);                  }                    // - foo.</i>                  // - bar.</i>                  if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.Contains(endTag + Environment.NewLine' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      text = text.Replace(endTag' string.Empty);                      text = beginTag + text + endTag;                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.StartsWith(endTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      text = text.Remove(firstIndex' endTag.Length).Insert(firstIndex' beginTag);                  }                    // <i>Foo</i>                  // <i>Bar</i>                  if (italicBeginTagCount == 2 && italicEndTagCount == 2 && noOfLines == 2)                  {                      int index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      if (index > 0 && text.Length > index + (beginTag.Length + endTag.Length))                      {                          var firstLine = text.Substring(0' index).Trim();                          var secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                            if (firstLine.Length > 10 && firstLine.StartsWith("- <i>"' StringComparison.Ordinal) && firstLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = "<i>- " + firstLine.Remove(0' 5) + Environment.NewLine + secondLine;                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                          if (secondLine.Length > 10 && secondLine.StartsWith("- <i>"' StringComparison.Ordinal) && secondLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = firstLine + Environment.NewLine + "<i>- " + secondLine.Remove(0' 5);                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                            if (Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag))                          {                              text = text.Replace(beginTag' string.Empty).Replace(endTag' string.Empty).Trim();                              text = beginTag + text + endTag;                          }                      }                        //FALCONE:<i> I didn't think</i><br /><i>it was going to be you'</i>                      var colIdx = text.IndexOf(':');                      if (colIdx >= 0 && Utilities.CountTagInText(text' beginTag) + Utilities.CountTagInText(text' endTag) == 4 && text.Length > colIdx + 1 && !char.IsDigit(text[colIdx + 1]))                      {                          var firstLine = text.Substring(0' index);                          var secondLine = text.Substring(index).TrimStart();                            var secIdxCol = secondLine.IndexOf(':');                          if (secIdxCol < 0 || !Utilities.IsBetweenNumbers(secondLine' secIdxCol))                          {                              var idx = firstLine.IndexOf(':');                              if (idx > 1)                              {                                  var pre = text.Substring(0' idx + 1).TrimStart();                                  text = text.Remove(0' idx + 1);                                  text = FixInvalidItalicTags(text).Trim();                                  if (text.StartsWith("<i> "' StringComparison.OrdinalIgnoreCase))                                      text = Utilities.RemoveSpaceBeforeAfterTag(text' beginTag);                                  text = pre + " " + text;                              }                          }                      }                  }                    //<i>- You think they're they gone?<i>                  //<i>- That can't be.</i>                  if (italicBeginTagCount == 3 && italicEndTagCount == 1 && noOfLines == 2)                  {                      var newLineIdx = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      var firstLine = text.Substring(0' newLineIdx).Trim();                      var secondLine = text.Substring(newLineIdx).Trim();                        if ((Utilities.StartsAndEndsWithTag(firstLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag)) ||                          (Utilities.StartsAndEndsWithTag(secondLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag)))                      {                          text = text.Replace(beginTag' string.Empty);                          text = text.Replace(endTag' string.Empty);                          text = text.Replace("  "' " ").Trim();                          text = beginTag + text + endTag;                      }                  }                    if (noOfLines == 3)                  {                      var lines = text.SplitToLines();                      if ((italicBeginTagCount == 3 && italicEndTagCount == 2) || (italicBeginTagCount == 2 && italicEndTagCount == 3))                      {                          int numberOfItalics = 0;                          foreach (var line in lines)                          {                              if (line.StartsWith(beginTag' StringComparison.Ordinal))                                  numberOfItalics++;                              if (line.EndsWith(endTag' StringComparison.Ordinal))                                  numberOfItalics++;                          }                          if (numberOfItalics == 5)                          { // fix missing tag                              text = "<i>" + text.Replace("<i>"' string.Empty).Replace("</i>"' string.Empty) + "</i>";                          }                      }                  }                    text = text.Replace("<i></i>"' string.Empty);                  text = text.Replace("<i> </i>"' string.Empty);                  text = text.Replace("<i>  </i>"' string.Empty);              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The following statement contains a magic number: if (italicBeginTagCount + italicEndTagCount > 0)              {                  if (italicBeginTagCount == 1 && italicEndTagCount == 1 && text.IndexOf(beginTag' StringComparison.Ordinal) > text.IndexOf(endTag' StringComparison.Ordinal))                  {                      const string pattern = "___________@";                      text = text.Replace(beginTag' pattern);                      text = text.Replace(endTag' beginTag);                      text = text.Replace(pattern' endTag);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 0)                  {                      int firstIndex = text.IndexOf(beginTag' StringComparison.Ordinal);                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      if (noOfLines == 2 && lastIndex == lastIndexWithNewLine && firstIndex < 2)                          text = text.Replace(Environment.NewLine' endTag + Environment.NewLine) + endTag;                      else                          text = text.Remove(lastIndex' beginTag.Length).Insert(lastIndex' endTag);                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 2)                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      if (text.StartsWith("</i>-<i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i> -"' StringComparison.Ordinal) ||                          text.StartsWith("</i>-<i> -"' StringComparison.Ordinal))                          text = text.Remove(0' 5);                      else if (firstIndex == 0)                          text = text.Remove(0' 4);                      else                          text = text.Substring(0' firstIndex) + text.Substring(firstIndex + endTag.Length);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 1)                  {                      var lines = text.SplitToLines();                      if (lines.Length == 2 && lines[0].StartsWith(beginTag' StringComparison.Ordinal) && lines[0].EndsWith(endTag' StringComparison.Ordinal) &&                          lines[1].StartsWith(beginTag' StringComparison.Ordinal))                      {                          text = text.TrimEnd() + endTag;                      }                      else                      {                          int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                          if (text.Length > lastIndex + endTag.Length)                              text = text.Substring(0' lastIndex) + text.Substring(lastIndex - 1 + endTag.Length);                          else                              text = text.Substring(0' lastIndex - 1) + endTag;                      }                      if (text.StartsWith(beginTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal) && text.Contains(endTag + Environment.NewLine + beginTag))                      {                          text = text.Replace(endTag + Environment.NewLine + beginTag' Environment.NewLine);                      }                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 0)                  {                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                        if (text.StartsWith(beginTag' StringComparison.Ordinal))                          text += endTag;                      else if (noOfLines == 2 && lastIndex == lastIndexWithNewLine)                          text += endTag;                      else                          text = text.Replace(beginTag' string.Empty);                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 1)                  {                      var cleanText = RemoveOpenCloseTags(text' TagItalic' TagBold' TagUnderline' TagCyrillicI);                      bool isFixed = false;                        // Foo.</i>                      if (text.EndsWith(endTag' StringComparison.Ordinal) && !cleanText.StartsWith("-") && !cleanText.Contains(Environment.NewLine + "-"))                      {                          text = beginTag + text;                          isFixed = true;                      }                        // - Foo</i> | - Foo.                      // - Bar.    | - Foo.</i>                      if (!isFixed && Utilities.GetNumberOfLines(cleanText) == 2)                      {                          int newLineIndex = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                          if (newLineIndex > 0)                          {                              var firstLine = text.Substring(0' newLineIndex).Trim();                              var secondLine = text.Substring(newLineIndex + 2).Trim();                              if (firstLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  firstLine = beginTag + firstLine;                                  isFixed = true;                              }                              if (secondLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  secondLine = beginTag + secondLine;                                  isFixed = true;                              }                              text = firstLine + Environment.NewLine + secondLine;                          }                      }                      if (!isFixed)                          text = text.Replace(endTag' string.Empty);                  }                    // - foo.</i>                  // - bar.</i>                  if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.Contains(endTag + Environment.NewLine' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      text = text.Replace(endTag' string.Empty);                      text = beginTag + text + endTag;                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.StartsWith(endTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      text = text.Remove(firstIndex' endTag.Length).Insert(firstIndex' beginTag);                  }                    // <i>Foo</i>                  // <i>Bar</i>                  if (italicBeginTagCount == 2 && italicEndTagCount == 2 && noOfLines == 2)                  {                      int index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      if (index > 0 && text.Length > index + (beginTag.Length + endTag.Length))                      {                          var firstLine = text.Substring(0' index).Trim();                          var secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                            if (firstLine.Length > 10 && firstLine.StartsWith("- <i>"' StringComparison.Ordinal) && firstLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = "<i>- " + firstLine.Remove(0' 5) + Environment.NewLine + secondLine;                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                          if (secondLine.Length > 10 && secondLine.StartsWith("- <i>"' StringComparison.Ordinal) && secondLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = firstLine + Environment.NewLine + "<i>- " + secondLine.Remove(0' 5);                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                            if (Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag))                          {                              text = text.Replace(beginTag' string.Empty).Replace(endTag' string.Empty).Trim();                              text = beginTag + text + endTag;                          }                      }                        //FALCONE:<i> I didn't think</i><br /><i>it was going to be you'</i>                      var colIdx = text.IndexOf(':');                      if (colIdx >= 0 && Utilities.CountTagInText(text' beginTag) + Utilities.CountTagInText(text' endTag) == 4 && text.Length > colIdx + 1 && !char.IsDigit(text[colIdx + 1]))                      {                          var firstLine = text.Substring(0' index);                          var secondLine = text.Substring(index).TrimStart();                            var secIdxCol = secondLine.IndexOf(':');                          if (secIdxCol < 0 || !Utilities.IsBetweenNumbers(secondLine' secIdxCol))                          {                              var idx = firstLine.IndexOf(':');                              if (idx > 1)                              {                                  var pre = text.Substring(0' idx + 1).TrimStart();                                  text = text.Remove(0' idx + 1);                                  text = FixInvalidItalicTags(text).Trim();                                  if (text.StartsWith("<i> "' StringComparison.OrdinalIgnoreCase))                                      text = Utilities.RemoveSpaceBeforeAfterTag(text' beginTag);                                  text = pre + " " + text;                              }                          }                      }                  }                    //<i>- You think they're they gone?<i>                  //<i>- That can't be.</i>                  if (italicBeginTagCount == 3 && italicEndTagCount == 1 && noOfLines == 2)                  {                      var newLineIdx = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      var firstLine = text.Substring(0' newLineIdx).Trim();                      var secondLine = text.Substring(newLineIdx).Trim();                        if ((Utilities.StartsAndEndsWithTag(firstLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag)) ||                          (Utilities.StartsAndEndsWithTag(secondLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag)))                      {                          text = text.Replace(beginTag' string.Empty);                          text = text.Replace(endTag' string.Empty);                          text = text.Replace("  "' " ").Trim();                          text = beginTag + text + endTag;                      }                  }                    if (noOfLines == 3)                  {                      var lines = text.SplitToLines();                      if ((italicBeginTagCount == 3 && italicEndTagCount == 2) || (italicBeginTagCount == 2 && italicEndTagCount == 3))                      {                          int numberOfItalics = 0;                          foreach (var line in lines)                          {                              if (line.StartsWith(beginTag' StringComparison.Ordinal))                                  numberOfItalics++;                              if (line.EndsWith(endTag' StringComparison.Ordinal))                                  numberOfItalics++;                          }                          if (numberOfItalics == 5)                          { // fix missing tag                              text = "<i>" + text.Replace("<i>"' string.Empty).Replace("</i>"' string.Empty) + "</i>";                          }                      }                  }                    text = text.Replace("<i></i>"' string.Empty);                  text = text.Replace("<i> </i>"' string.Empty);                  text = text.Replace("<i>  </i>"' string.Empty);              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The following statement contains a magic number: if (italicBeginTagCount + italicEndTagCount > 0)              {                  if (italicBeginTagCount == 1 && italicEndTagCount == 1 && text.IndexOf(beginTag' StringComparison.Ordinal) > text.IndexOf(endTag' StringComparison.Ordinal))                  {                      const string pattern = "___________@";                      text = text.Replace(beginTag' pattern);                      text = text.Replace(endTag' beginTag);                      text = text.Replace(pattern' endTag);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 0)                  {                      int firstIndex = text.IndexOf(beginTag' StringComparison.Ordinal);                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      if (noOfLines == 2 && lastIndex == lastIndexWithNewLine && firstIndex < 2)                          text = text.Replace(Environment.NewLine' endTag + Environment.NewLine) + endTag;                      else                          text = text.Remove(lastIndex' beginTag.Length).Insert(lastIndex' endTag);                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 2)                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      if (text.StartsWith("</i>-<i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i> -"' StringComparison.Ordinal) ||                          text.StartsWith("</i>-<i> -"' StringComparison.Ordinal))                          text = text.Remove(0' 5);                      else if (firstIndex == 0)                          text = text.Remove(0' 4);                      else                          text = text.Substring(0' firstIndex) + text.Substring(firstIndex + endTag.Length);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 1)                  {                      var lines = text.SplitToLines();                      if (lines.Length == 2 && lines[0].StartsWith(beginTag' StringComparison.Ordinal) && lines[0].EndsWith(endTag' StringComparison.Ordinal) &&                          lines[1].StartsWith(beginTag' StringComparison.Ordinal))                      {                          text = text.TrimEnd() + endTag;                      }                      else                      {                          int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                          if (text.Length > lastIndex + endTag.Length)                              text = text.Substring(0' lastIndex) + text.Substring(lastIndex - 1 + endTag.Length);                          else                              text = text.Substring(0' lastIndex - 1) + endTag;                      }                      if (text.StartsWith(beginTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal) && text.Contains(endTag + Environment.NewLine + beginTag))                      {                          text = text.Replace(endTag + Environment.NewLine + beginTag' Environment.NewLine);                      }                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 0)                  {                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                        if (text.StartsWith(beginTag' StringComparison.Ordinal))                          text += endTag;                      else if (noOfLines == 2 && lastIndex == lastIndexWithNewLine)                          text += endTag;                      else                          text = text.Replace(beginTag' string.Empty);                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 1)                  {                      var cleanText = RemoveOpenCloseTags(text' TagItalic' TagBold' TagUnderline' TagCyrillicI);                      bool isFixed = false;                        // Foo.</i>                      if (text.EndsWith(endTag' StringComparison.Ordinal) && !cleanText.StartsWith("-") && !cleanText.Contains(Environment.NewLine + "-"))                      {                          text = beginTag + text;                          isFixed = true;                      }                        // - Foo</i> | - Foo.                      // - Bar.    | - Foo.</i>                      if (!isFixed && Utilities.GetNumberOfLines(cleanText) == 2)                      {                          int newLineIndex = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                          if (newLineIndex > 0)                          {                              var firstLine = text.Substring(0' newLineIndex).Trim();                              var secondLine = text.Substring(newLineIndex + 2).Trim();                              if (firstLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  firstLine = beginTag + firstLine;                                  isFixed = true;                              }                              if (secondLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  secondLine = beginTag + secondLine;                                  isFixed = true;                              }                              text = firstLine + Environment.NewLine + secondLine;                          }                      }                      if (!isFixed)                          text = text.Replace(endTag' string.Empty);                  }                    // - foo.</i>                  // - bar.</i>                  if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.Contains(endTag + Environment.NewLine' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      text = text.Replace(endTag' string.Empty);                      text = beginTag + text + endTag;                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.StartsWith(endTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      text = text.Remove(firstIndex' endTag.Length).Insert(firstIndex' beginTag);                  }                    // <i>Foo</i>                  // <i>Bar</i>                  if (italicBeginTagCount == 2 && italicEndTagCount == 2 && noOfLines == 2)                  {                      int index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      if (index > 0 && text.Length > index + (beginTag.Length + endTag.Length))                      {                          var firstLine = text.Substring(0' index).Trim();                          var secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                            if (firstLine.Length > 10 && firstLine.StartsWith("- <i>"' StringComparison.Ordinal) && firstLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = "<i>- " + firstLine.Remove(0' 5) + Environment.NewLine + secondLine;                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                          if (secondLine.Length > 10 && secondLine.StartsWith("- <i>"' StringComparison.Ordinal) && secondLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = firstLine + Environment.NewLine + "<i>- " + secondLine.Remove(0' 5);                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                            if (Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag))                          {                              text = text.Replace(beginTag' string.Empty).Replace(endTag' string.Empty).Trim();                              text = beginTag + text + endTag;                          }                      }                        //FALCONE:<i> I didn't think</i><br /><i>it was going to be you'</i>                      var colIdx = text.IndexOf(':');                      if (colIdx >= 0 && Utilities.CountTagInText(text' beginTag) + Utilities.CountTagInText(text' endTag) == 4 && text.Length > colIdx + 1 && !char.IsDigit(text[colIdx + 1]))                      {                          var firstLine = text.Substring(0' index);                          var secondLine = text.Substring(index).TrimStart();                            var secIdxCol = secondLine.IndexOf(':');                          if (secIdxCol < 0 || !Utilities.IsBetweenNumbers(secondLine' secIdxCol))                          {                              var idx = firstLine.IndexOf(':');                              if (idx > 1)                              {                                  var pre = text.Substring(0' idx + 1).TrimStart();                                  text = text.Remove(0' idx + 1);                                  text = FixInvalidItalicTags(text).Trim();                                  if (text.StartsWith("<i> "' StringComparison.OrdinalIgnoreCase))                                      text = Utilities.RemoveSpaceBeforeAfterTag(text' beginTag);                                  text = pre + " " + text;                              }                          }                      }                  }                    //<i>- You think they're they gone?<i>                  //<i>- That can't be.</i>                  if (italicBeginTagCount == 3 && italicEndTagCount == 1 && noOfLines == 2)                  {                      var newLineIdx = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      var firstLine = text.Substring(0' newLineIdx).Trim();                      var secondLine = text.Substring(newLineIdx).Trim();                        if ((Utilities.StartsAndEndsWithTag(firstLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag)) ||                          (Utilities.StartsAndEndsWithTag(secondLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag)))                      {                          text = text.Replace(beginTag' string.Empty);                          text = text.Replace(endTag' string.Empty);                          text = text.Replace("  "' " ").Trim();                          text = beginTag + text + endTag;                      }                  }                    if (noOfLines == 3)                  {                      var lines = text.SplitToLines();                      if ((italicBeginTagCount == 3 && italicEndTagCount == 2) || (italicBeginTagCount == 2 && italicEndTagCount == 3))                      {                          int numberOfItalics = 0;                          foreach (var line in lines)                          {                              if (line.StartsWith(beginTag' StringComparison.Ordinal))                                  numberOfItalics++;                              if (line.EndsWith(endTag' StringComparison.Ordinal))                                  numberOfItalics++;                          }                          if (numberOfItalics == 5)                          { // fix missing tag                              text = "<i>" + text.Replace("<i>"' string.Empty).Replace("</i>"' string.Empty) + "</i>";                          }                      }                  }                    text = text.Replace("<i></i>"' string.Empty);                  text = text.Replace("<i> </i>"' string.Empty);                  text = text.Replace("<i>  </i>"' string.Empty);              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The following statement contains a magic number: if (italicBeginTagCount + italicEndTagCount > 0)              {                  if (italicBeginTagCount == 1 && italicEndTagCount == 1 && text.IndexOf(beginTag' StringComparison.Ordinal) > text.IndexOf(endTag' StringComparison.Ordinal))                  {                      const string pattern = "___________@";                      text = text.Replace(beginTag' pattern);                      text = text.Replace(endTag' beginTag);                      text = text.Replace(pattern' endTag);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 0)                  {                      int firstIndex = text.IndexOf(beginTag' StringComparison.Ordinal);                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      if (noOfLines == 2 && lastIndex == lastIndexWithNewLine && firstIndex < 2)                          text = text.Replace(Environment.NewLine' endTag + Environment.NewLine) + endTag;                      else                          text = text.Remove(lastIndex' beginTag.Length).Insert(lastIndex' endTag);                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 2)                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      if (text.StartsWith("</i>-<i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i> -"' StringComparison.Ordinal) ||                          text.StartsWith("</i>-<i> -"' StringComparison.Ordinal))                          text = text.Remove(0' 5);                      else if (firstIndex == 0)                          text = text.Remove(0' 4);                      else                          text = text.Substring(0' firstIndex) + text.Substring(firstIndex + endTag.Length);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 1)                  {                      var lines = text.SplitToLines();                      if (lines.Length == 2 && lines[0].StartsWith(beginTag' StringComparison.Ordinal) && lines[0].EndsWith(endTag' StringComparison.Ordinal) &&                          lines[1].StartsWith(beginTag' StringComparison.Ordinal))                      {                          text = text.TrimEnd() + endTag;                      }                      else                      {                          int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                          if (text.Length > lastIndex + endTag.Length)                              text = text.Substring(0' lastIndex) + text.Substring(lastIndex - 1 + endTag.Length);                          else                              text = text.Substring(0' lastIndex - 1) + endTag;                      }                      if (text.StartsWith(beginTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal) && text.Contains(endTag + Environment.NewLine + beginTag))                      {                          text = text.Replace(endTag + Environment.NewLine + beginTag' Environment.NewLine);                      }                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 0)                  {                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                        if (text.StartsWith(beginTag' StringComparison.Ordinal))                          text += endTag;                      else if (noOfLines == 2 && lastIndex == lastIndexWithNewLine)                          text += endTag;                      else                          text = text.Replace(beginTag' string.Empty);                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 1)                  {                      var cleanText = RemoveOpenCloseTags(text' TagItalic' TagBold' TagUnderline' TagCyrillicI);                      bool isFixed = false;                        // Foo.</i>                      if (text.EndsWith(endTag' StringComparison.Ordinal) && !cleanText.StartsWith("-") && !cleanText.Contains(Environment.NewLine + "-"))                      {                          text = beginTag + text;                          isFixed = true;                      }                        // - Foo</i> | - Foo.                      // - Bar.    | - Foo.</i>                      if (!isFixed && Utilities.GetNumberOfLines(cleanText) == 2)                      {                          int newLineIndex = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                          if (newLineIndex > 0)                          {                              var firstLine = text.Substring(0' newLineIndex).Trim();                              var secondLine = text.Substring(newLineIndex + 2).Trim();                              if (firstLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  firstLine = beginTag + firstLine;                                  isFixed = true;                              }                              if (secondLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  secondLine = beginTag + secondLine;                                  isFixed = true;                              }                              text = firstLine + Environment.NewLine + secondLine;                          }                      }                      if (!isFixed)                          text = text.Replace(endTag' string.Empty);                  }                    // - foo.</i>                  // - bar.</i>                  if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.Contains(endTag + Environment.NewLine' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      text = text.Replace(endTag' string.Empty);                      text = beginTag + text + endTag;                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.StartsWith(endTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      text = text.Remove(firstIndex' endTag.Length).Insert(firstIndex' beginTag);                  }                    // <i>Foo</i>                  // <i>Bar</i>                  if (italicBeginTagCount == 2 && italicEndTagCount == 2 && noOfLines == 2)                  {                      int index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      if (index > 0 && text.Length > index + (beginTag.Length + endTag.Length))                      {                          var firstLine = text.Substring(0' index).Trim();                          var secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                            if (firstLine.Length > 10 && firstLine.StartsWith("- <i>"' StringComparison.Ordinal) && firstLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = "<i>- " + firstLine.Remove(0' 5) + Environment.NewLine + secondLine;                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                          if (secondLine.Length > 10 && secondLine.StartsWith("- <i>"' StringComparison.Ordinal) && secondLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = firstLine + Environment.NewLine + "<i>- " + secondLine.Remove(0' 5);                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                            if (Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag))                          {                              text = text.Replace(beginTag' string.Empty).Replace(endTag' string.Empty).Trim();                              text = beginTag + text + endTag;                          }                      }                        //FALCONE:<i> I didn't think</i><br /><i>it was going to be you'</i>                      var colIdx = text.IndexOf(':');                      if (colIdx >= 0 && Utilities.CountTagInText(text' beginTag) + Utilities.CountTagInText(text' endTag) == 4 && text.Length > colIdx + 1 && !char.IsDigit(text[colIdx + 1]))                      {                          var firstLine = text.Substring(0' index);                          var secondLine = text.Substring(index).TrimStart();                            var secIdxCol = secondLine.IndexOf(':');                          if (secIdxCol < 0 || !Utilities.IsBetweenNumbers(secondLine' secIdxCol))                          {                              var idx = firstLine.IndexOf(':');                              if (idx > 1)                              {                                  var pre = text.Substring(0' idx + 1).TrimStart();                                  text = text.Remove(0' idx + 1);                                  text = FixInvalidItalicTags(text).Trim();                                  if (text.StartsWith("<i> "' StringComparison.OrdinalIgnoreCase))                                      text = Utilities.RemoveSpaceBeforeAfterTag(text' beginTag);                                  text = pre + " " + text;                              }                          }                      }                  }                    //<i>- You think they're they gone?<i>                  //<i>- That can't be.</i>                  if (italicBeginTagCount == 3 && italicEndTagCount == 1 && noOfLines == 2)                  {                      var newLineIdx = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      var firstLine = text.Substring(0' newLineIdx).Trim();                      var secondLine = text.Substring(newLineIdx).Trim();                        if ((Utilities.StartsAndEndsWithTag(firstLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag)) ||                          (Utilities.StartsAndEndsWithTag(secondLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag)))                      {                          text = text.Replace(beginTag' string.Empty);                          text = text.Replace(endTag' string.Empty);                          text = text.Replace("  "' " ").Trim();                          text = beginTag + text + endTag;                      }                  }                    if (noOfLines == 3)                  {                      var lines = text.SplitToLines();                      if ((italicBeginTagCount == 3 && italicEndTagCount == 2) || (italicBeginTagCount == 2 && italicEndTagCount == 3))                      {                          int numberOfItalics = 0;                          foreach (var line in lines)                          {                              if (line.StartsWith(beginTag' StringComparison.Ordinal))                                  numberOfItalics++;                              if (line.EndsWith(endTag' StringComparison.Ordinal))                                  numberOfItalics++;                          }                          if (numberOfItalics == 5)                          { // fix missing tag                              text = "<i>" + text.Replace("<i>"' string.Empty).Replace("</i>"' string.Empty) + "</i>";                          }                      }                  }                    text = text.Replace("<i></i>"' string.Empty);                  text = text.Replace("<i> </i>"' string.Empty);                  text = text.Replace("<i>  </i>"' string.Empty);              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The following statement contains a magic number: if (italicBeginTagCount + italicEndTagCount > 0)              {                  if (italicBeginTagCount == 1 && italicEndTagCount == 1 && text.IndexOf(beginTag' StringComparison.Ordinal) > text.IndexOf(endTag' StringComparison.Ordinal))                  {                      const string pattern = "___________@";                      text = text.Replace(beginTag' pattern);                      text = text.Replace(endTag' beginTag);                      text = text.Replace(pattern' endTag);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 0)                  {                      int firstIndex = text.IndexOf(beginTag' StringComparison.Ordinal);                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      if (noOfLines == 2 && lastIndex == lastIndexWithNewLine && firstIndex < 2)                          text = text.Replace(Environment.NewLine' endTag + Environment.NewLine) + endTag;                      else                          text = text.Remove(lastIndex' beginTag.Length).Insert(lastIndex' endTag);                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 2)                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      if (text.StartsWith("</i>-<i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i> -"' StringComparison.Ordinal) ||                          text.StartsWith("</i>-<i> -"' StringComparison.Ordinal))                          text = text.Remove(0' 5);                      else if (firstIndex == 0)                          text = text.Remove(0' 4);                      else                          text = text.Substring(0' firstIndex) + text.Substring(firstIndex + endTag.Length);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 1)                  {                      var lines = text.SplitToLines();                      if (lines.Length == 2 && lines[0].StartsWith(beginTag' StringComparison.Ordinal) && lines[0].EndsWith(endTag' StringComparison.Ordinal) &&                          lines[1].StartsWith(beginTag' StringComparison.Ordinal))                      {                          text = text.TrimEnd() + endTag;                      }                      else                      {                          int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                          if (text.Length > lastIndex + endTag.Length)                              text = text.Substring(0' lastIndex) + text.Substring(lastIndex - 1 + endTag.Length);                          else                              text = text.Substring(0' lastIndex - 1) + endTag;                      }                      if (text.StartsWith(beginTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal) && text.Contains(endTag + Environment.NewLine + beginTag))                      {                          text = text.Replace(endTag + Environment.NewLine + beginTag' Environment.NewLine);                      }                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 0)                  {                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                        if (text.StartsWith(beginTag' StringComparison.Ordinal))                          text += endTag;                      else if (noOfLines == 2 && lastIndex == lastIndexWithNewLine)                          text += endTag;                      else                          text = text.Replace(beginTag' string.Empty);                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 1)                  {                      var cleanText = RemoveOpenCloseTags(text' TagItalic' TagBold' TagUnderline' TagCyrillicI);                      bool isFixed = false;                        // Foo.</i>                      if (text.EndsWith(endTag' StringComparison.Ordinal) && !cleanText.StartsWith("-") && !cleanText.Contains(Environment.NewLine + "-"))                      {                          text = beginTag + text;                          isFixed = true;                      }                        // - Foo</i> | - Foo.                      // - Bar.    | - Foo.</i>                      if (!isFixed && Utilities.GetNumberOfLines(cleanText) == 2)                      {                          int newLineIndex = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                          if (newLineIndex > 0)                          {                              var firstLine = text.Substring(0' newLineIndex).Trim();                              var secondLine = text.Substring(newLineIndex + 2).Trim();                              if (firstLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  firstLine = beginTag + firstLine;                                  isFixed = true;                              }                              if (secondLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  secondLine = beginTag + secondLine;                                  isFixed = true;                              }                              text = firstLine + Environment.NewLine + secondLine;                          }                      }                      if (!isFixed)                          text = text.Replace(endTag' string.Empty);                  }                    // - foo.</i>                  // - bar.</i>                  if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.Contains(endTag + Environment.NewLine' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      text = text.Replace(endTag' string.Empty);                      text = beginTag + text + endTag;                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.StartsWith(endTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      text = text.Remove(firstIndex' endTag.Length).Insert(firstIndex' beginTag);                  }                    // <i>Foo</i>                  // <i>Bar</i>                  if (italicBeginTagCount == 2 && italicEndTagCount == 2 && noOfLines == 2)                  {                      int index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      if (index > 0 && text.Length > index + (beginTag.Length + endTag.Length))                      {                          var firstLine = text.Substring(0' index).Trim();                          var secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                            if (firstLine.Length > 10 && firstLine.StartsWith("- <i>"' StringComparison.Ordinal) && firstLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = "<i>- " + firstLine.Remove(0' 5) + Environment.NewLine + secondLine;                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                          if (secondLine.Length > 10 && secondLine.StartsWith("- <i>"' StringComparison.Ordinal) && secondLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = firstLine + Environment.NewLine + "<i>- " + secondLine.Remove(0' 5);                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                            if (Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag))                          {                              text = text.Replace(beginTag' string.Empty).Replace(endTag' string.Empty).Trim();                              text = beginTag + text + endTag;                          }                      }                        //FALCONE:<i> I didn't think</i><br /><i>it was going to be you'</i>                      var colIdx = text.IndexOf(':');                      if (colIdx >= 0 && Utilities.CountTagInText(text' beginTag) + Utilities.CountTagInText(text' endTag) == 4 && text.Length > colIdx + 1 && !char.IsDigit(text[colIdx + 1]))                      {                          var firstLine = text.Substring(0' index);                          var secondLine = text.Substring(index).TrimStart();                            var secIdxCol = secondLine.IndexOf(':');                          if (secIdxCol < 0 || !Utilities.IsBetweenNumbers(secondLine' secIdxCol))                          {                              var idx = firstLine.IndexOf(':');                              if (idx > 1)                              {                                  var pre = text.Substring(0' idx + 1).TrimStart();                                  text = text.Remove(0' idx + 1);                                  text = FixInvalidItalicTags(text).Trim();                                  if (text.StartsWith("<i> "' StringComparison.OrdinalIgnoreCase))                                      text = Utilities.RemoveSpaceBeforeAfterTag(text' beginTag);                                  text = pre + " " + text;                              }                          }                      }                  }                    //<i>- You think they're they gone?<i>                  //<i>- That can't be.</i>                  if (italicBeginTagCount == 3 && italicEndTagCount == 1 && noOfLines == 2)                  {                      var newLineIdx = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      var firstLine = text.Substring(0' newLineIdx).Trim();                      var secondLine = text.Substring(newLineIdx).Trim();                        if ((Utilities.StartsAndEndsWithTag(firstLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag)) ||                          (Utilities.StartsAndEndsWithTag(secondLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag)))                      {                          text = text.Replace(beginTag' string.Empty);                          text = text.Replace(endTag' string.Empty);                          text = text.Replace("  "' " ").Trim();                          text = beginTag + text + endTag;                      }                  }                    if (noOfLines == 3)                  {                      var lines = text.SplitToLines();                      if ((italicBeginTagCount == 3 && italicEndTagCount == 2) || (italicBeginTagCount == 2 && italicEndTagCount == 3))                      {                          int numberOfItalics = 0;                          foreach (var line in lines)                          {                              if (line.StartsWith(beginTag' StringComparison.Ordinal))                                  numberOfItalics++;                              if (line.EndsWith(endTag' StringComparison.Ordinal))                                  numberOfItalics++;                          }                          if (numberOfItalics == 5)                          { // fix missing tag                              text = "<i>" + text.Replace("<i>"' string.Empty).Replace("</i>"' string.Empty) + "</i>";                          }                      }                  }                    text = text.Replace("<i></i>"' string.Empty);                  text = text.Replace("<i> </i>"' string.Empty);                  text = text.Replace("<i>  </i>"' string.Empty);              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The following statement contains a magic number: if (italicBeginTagCount + italicEndTagCount > 0)              {                  if (italicBeginTagCount == 1 && italicEndTagCount == 1 && text.IndexOf(beginTag' StringComparison.Ordinal) > text.IndexOf(endTag' StringComparison.Ordinal))                  {                      const string pattern = "___________@";                      text = text.Replace(beginTag' pattern);                      text = text.Replace(endTag' beginTag);                      text = text.Replace(pattern' endTag);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 0)                  {                      int firstIndex = text.IndexOf(beginTag' StringComparison.Ordinal);                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      if (noOfLines == 2 && lastIndex == lastIndexWithNewLine && firstIndex < 2)                          text = text.Replace(Environment.NewLine' endTag + Environment.NewLine) + endTag;                      else                          text = text.Remove(lastIndex' beginTag.Length).Insert(lastIndex' endTag);                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 2)                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      if (text.StartsWith("</i>-<i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i> -"' StringComparison.Ordinal) ||                          text.StartsWith("</i>-<i> -"' StringComparison.Ordinal))                          text = text.Remove(0' 5);                      else if (firstIndex == 0)                          text = text.Remove(0' 4);                      else                          text = text.Substring(0' firstIndex) + text.Substring(firstIndex + endTag.Length);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 1)                  {                      var lines = text.SplitToLines();                      if (lines.Length == 2 && lines[0].StartsWith(beginTag' StringComparison.Ordinal) && lines[0].EndsWith(endTag' StringComparison.Ordinal) &&                          lines[1].StartsWith(beginTag' StringComparison.Ordinal))                      {                          text = text.TrimEnd() + endTag;                      }                      else                      {                          int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                          if (text.Length > lastIndex + endTag.Length)                              text = text.Substring(0' lastIndex) + text.Substring(lastIndex - 1 + endTag.Length);                          else                              text = text.Substring(0' lastIndex - 1) + endTag;                      }                      if (text.StartsWith(beginTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal) && text.Contains(endTag + Environment.NewLine + beginTag))                      {                          text = text.Replace(endTag + Environment.NewLine + beginTag' Environment.NewLine);                      }                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 0)                  {                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                        if (text.StartsWith(beginTag' StringComparison.Ordinal))                          text += endTag;                      else if (noOfLines == 2 && lastIndex == lastIndexWithNewLine)                          text += endTag;                      else                          text = text.Replace(beginTag' string.Empty);                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 1)                  {                      var cleanText = RemoveOpenCloseTags(text' TagItalic' TagBold' TagUnderline' TagCyrillicI);                      bool isFixed = false;                        // Foo.</i>                      if (text.EndsWith(endTag' StringComparison.Ordinal) && !cleanText.StartsWith("-") && !cleanText.Contains(Environment.NewLine + "-"))                      {                          text = beginTag + text;                          isFixed = true;                      }                        // - Foo</i> | - Foo.                      // - Bar.    | - Foo.</i>                      if (!isFixed && Utilities.GetNumberOfLines(cleanText) == 2)                      {                          int newLineIndex = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                          if (newLineIndex > 0)                          {                              var firstLine = text.Substring(0' newLineIndex).Trim();                              var secondLine = text.Substring(newLineIndex + 2).Trim();                              if (firstLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  firstLine = beginTag + firstLine;                                  isFixed = true;                              }                              if (secondLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  secondLine = beginTag + secondLine;                                  isFixed = true;                              }                              text = firstLine + Environment.NewLine + secondLine;                          }                      }                      if (!isFixed)                          text = text.Replace(endTag' string.Empty);                  }                    // - foo.</i>                  // - bar.</i>                  if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.Contains(endTag + Environment.NewLine' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      text = text.Replace(endTag' string.Empty);                      text = beginTag + text + endTag;                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.StartsWith(endTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      text = text.Remove(firstIndex' endTag.Length).Insert(firstIndex' beginTag);                  }                    // <i>Foo</i>                  // <i>Bar</i>                  if (italicBeginTagCount == 2 && italicEndTagCount == 2 && noOfLines == 2)                  {                      int index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      if (index > 0 && text.Length > index + (beginTag.Length + endTag.Length))                      {                          var firstLine = text.Substring(0' index).Trim();                          var secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                            if (firstLine.Length > 10 && firstLine.StartsWith("- <i>"' StringComparison.Ordinal) && firstLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = "<i>- " + firstLine.Remove(0' 5) + Environment.NewLine + secondLine;                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                          if (secondLine.Length > 10 && secondLine.StartsWith("- <i>"' StringComparison.Ordinal) && secondLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = firstLine + Environment.NewLine + "<i>- " + secondLine.Remove(0' 5);                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                            if (Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag))                          {                              text = text.Replace(beginTag' string.Empty).Replace(endTag' string.Empty).Trim();                              text = beginTag + text + endTag;                          }                      }                        //FALCONE:<i> I didn't think</i><br /><i>it was going to be you'</i>                      var colIdx = text.IndexOf(':');                      if (colIdx >= 0 && Utilities.CountTagInText(text' beginTag) + Utilities.CountTagInText(text' endTag) == 4 && text.Length > colIdx + 1 && !char.IsDigit(text[colIdx + 1]))                      {                          var firstLine = text.Substring(0' index);                          var secondLine = text.Substring(index).TrimStart();                            var secIdxCol = secondLine.IndexOf(':');                          if (secIdxCol < 0 || !Utilities.IsBetweenNumbers(secondLine' secIdxCol))                          {                              var idx = firstLine.IndexOf(':');                              if (idx > 1)                              {                                  var pre = text.Substring(0' idx + 1).TrimStart();                                  text = text.Remove(0' idx + 1);                                  text = FixInvalidItalicTags(text).Trim();                                  if (text.StartsWith("<i> "' StringComparison.OrdinalIgnoreCase))                                      text = Utilities.RemoveSpaceBeforeAfterTag(text' beginTag);                                  text = pre + " " + text;                              }                          }                      }                  }                    //<i>- You think they're they gone?<i>                  //<i>- That can't be.</i>                  if (italicBeginTagCount == 3 && italicEndTagCount == 1 && noOfLines == 2)                  {                      var newLineIdx = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      var firstLine = text.Substring(0' newLineIdx).Trim();                      var secondLine = text.Substring(newLineIdx).Trim();                        if ((Utilities.StartsAndEndsWithTag(firstLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag)) ||                          (Utilities.StartsAndEndsWithTag(secondLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag)))                      {                          text = text.Replace(beginTag' string.Empty);                          text = text.Replace(endTag' string.Empty);                          text = text.Replace("  "' " ").Trim();                          text = beginTag + text + endTag;                      }                  }                    if (noOfLines == 3)                  {                      var lines = text.SplitToLines();                      if ((italicBeginTagCount == 3 && italicEndTagCount == 2) || (italicBeginTagCount == 2 && italicEndTagCount == 3))                      {                          int numberOfItalics = 0;                          foreach (var line in lines)                          {                              if (line.StartsWith(beginTag' StringComparison.Ordinal))                                  numberOfItalics++;                              if (line.EndsWith(endTag' StringComparison.Ordinal))                                  numberOfItalics++;                          }                          if (numberOfItalics == 5)                          { // fix missing tag                              text = "<i>" + text.Replace("<i>"' string.Empty).Replace("</i>"' string.Empty) + "</i>";                          }                      }                  }                    text = text.Replace("<i></i>"' string.Empty);                  text = text.Replace("<i> </i>"' string.Empty);                  text = text.Replace("<i>  </i>"' string.Empty);              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The following statement contains a magic number: if (italicBeginTagCount + italicEndTagCount > 0)              {                  if (italicBeginTagCount == 1 && italicEndTagCount == 1 && text.IndexOf(beginTag' StringComparison.Ordinal) > text.IndexOf(endTag' StringComparison.Ordinal))                  {                      const string pattern = "___________@";                      text = text.Replace(beginTag' pattern);                      text = text.Replace(endTag' beginTag);                      text = text.Replace(pattern' endTag);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 0)                  {                      int firstIndex = text.IndexOf(beginTag' StringComparison.Ordinal);                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      if (noOfLines == 2 && lastIndex == lastIndexWithNewLine && firstIndex < 2)                          text = text.Replace(Environment.NewLine' endTag + Environment.NewLine) + endTag;                      else                          text = text.Remove(lastIndex' beginTag.Length).Insert(lastIndex' endTag);                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 2)                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      if (text.StartsWith("</i>-<i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i> -"' StringComparison.Ordinal) ||                          text.StartsWith("</i>-<i> -"' StringComparison.Ordinal))                          text = text.Remove(0' 5);                      else if (firstIndex == 0)                          text = text.Remove(0' 4);                      else                          text = text.Substring(0' firstIndex) + text.Substring(firstIndex + endTag.Length);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 1)                  {                      var lines = text.SplitToLines();                      if (lines.Length == 2 && lines[0].StartsWith(beginTag' StringComparison.Ordinal) && lines[0].EndsWith(endTag' StringComparison.Ordinal) &&                          lines[1].StartsWith(beginTag' StringComparison.Ordinal))                      {                          text = text.TrimEnd() + endTag;                      }                      else                      {                          int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                          if (text.Length > lastIndex + endTag.Length)                              text = text.Substring(0' lastIndex) + text.Substring(lastIndex - 1 + endTag.Length);                          else                              text = text.Substring(0' lastIndex - 1) + endTag;                      }                      if (text.StartsWith(beginTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal) && text.Contains(endTag + Environment.NewLine + beginTag))                      {                          text = text.Replace(endTag + Environment.NewLine + beginTag' Environment.NewLine);                      }                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 0)                  {                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                        if (text.StartsWith(beginTag' StringComparison.Ordinal))                          text += endTag;                      else if (noOfLines == 2 && lastIndex == lastIndexWithNewLine)                          text += endTag;                      else                          text = text.Replace(beginTag' string.Empty);                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 1)                  {                      var cleanText = RemoveOpenCloseTags(text' TagItalic' TagBold' TagUnderline' TagCyrillicI);                      bool isFixed = false;                        // Foo.</i>                      if (text.EndsWith(endTag' StringComparison.Ordinal) && !cleanText.StartsWith("-") && !cleanText.Contains(Environment.NewLine + "-"))                      {                          text = beginTag + text;                          isFixed = true;                      }                        // - Foo</i> | - Foo.                      // - Bar.    | - Foo.</i>                      if (!isFixed && Utilities.GetNumberOfLines(cleanText) == 2)                      {                          int newLineIndex = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                          if (newLineIndex > 0)                          {                              var firstLine = text.Substring(0' newLineIndex).Trim();                              var secondLine = text.Substring(newLineIndex + 2).Trim();                              if (firstLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  firstLine = beginTag + firstLine;                                  isFixed = true;                              }                              if (secondLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  secondLine = beginTag + secondLine;                                  isFixed = true;                              }                              text = firstLine + Environment.NewLine + secondLine;                          }                      }                      if (!isFixed)                          text = text.Replace(endTag' string.Empty);                  }                    // - foo.</i>                  // - bar.</i>                  if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.Contains(endTag + Environment.NewLine' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      text = text.Replace(endTag' string.Empty);                      text = beginTag + text + endTag;                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.StartsWith(endTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      text = text.Remove(firstIndex' endTag.Length).Insert(firstIndex' beginTag);                  }                    // <i>Foo</i>                  // <i>Bar</i>                  if (italicBeginTagCount == 2 && italicEndTagCount == 2 && noOfLines == 2)                  {                      int index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      if (index > 0 && text.Length > index + (beginTag.Length + endTag.Length))                      {                          var firstLine = text.Substring(0' index).Trim();                          var secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                            if (firstLine.Length > 10 && firstLine.StartsWith("- <i>"' StringComparison.Ordinal) && firstLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = "<i>- " + firstLine.Remove(0' 5) + Environment.NewLine + secondLine;                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                          if (secondLine.Length > 10 && secondLine.StartsWith("- <i>"' StringComparison.Ordinal) && secondLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = firstLine + Environment.NewLine + "<i>- " + secondLine.Remove(0' 5);                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                            if (Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag))                          {                              text = text.Replace(beginTag' string.Empty).Replace(endTag' string.Empty).Trim();                              text = beginTag + text + endTag;                          }                      }                        //FALCONE:<i> I didn't think</i><br /><i>it was going to be you'</i>                      var colIdx = text.IndexOf(':');                      if (colIdx >= 0 && Utilities.CountTagInText(text' beginTag) + Utilities.CountTagInText(text' endTag) == 4 && text.Length > colIdx + 1 && !char.IsDigit(text[colIdx + 1]))                      {                          var firstLine = text.Substring(0' index);                          var secondLine = text.Substring(index).TrimStart();                            var secIdxCol = secondLine.IndexOf(':');                          if (secIdxCol < 0 || !Utilities.IsBetweenNumbers(secondLine' secIdxCol))                          {                              var idx = firstLine.IndexOf(':');                              if (idx > 1)                              {                                  var pre = text.Substring(0' idx + 1).TrimStart();                                  text = text.Remove(0' idx + 1);                                  text = FixInvalidItalicTags(text).Trim();                                  if (text.StartsWith("<i> "' StringComparison.OrdinalIgnoreCase))                                      text = Utilities.RemoveSpaceBeforeAfterTag(text' beginTag);                                  text = pre + " " + text;                              }                          }                      }                  }                    //<i>- You think they're they gone?<i>                  //<i>- That can't be.</i>                  if (italicBeginTagCount == 3 && italicEndTagCount == 1 && noOfLines == 2)                  {                      var newLineIdx = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      var firstLine = text.Substring(0' newLineIdx).Trim();                      var secondLine = text.Substring(newLineIdx).Trim();                        if ((Utilities.StartsAndEndsWithTag(firstLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag)) ||                          (Utilities.StartsAndEndsWithTag(secondLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag)))                      {                          text = text.Replace(beginTag' string.Empty);                          text = text.Replace(endTag' string.Empty);                          text = text.Replace("  "' " ").Trim();                          text = beginTag + text + endTag;                      }                  }                    if (noOfLines == 3)                  {                      var lines = text.SplitToLines();                      if ((italicBeginTagCount == 3 && italicEndTagCount == 2) || (italicBeginTagCount == 2 && italicEndTagCount == 3))                      {                          int numberOfItalics = 0;                          foreach (var line in lines)                          {                              if (line.StartsWith(beginTag' StringComparison.Ordinal))                                  numberOfItalics++;                              if (line.EndsWith(endTag' StringComparison.Ordinal))                                  numberOfItalics++;                          }                          if (numberOfItalics == 5)                          { // fix missing tag                              text = "<i>" + text.Replace("<i>"' string.Empty).Replace("</i>"' string.Empty) + "</i>";                          }                      }                  }                    text = text.Replace("<i></i>"' string.Empty);                  text = text.Replace("<i> </i>"' string.Empty);                  text = text.Replace("<i>  </i>"' string.Empty);              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The following statement contains a magic number: if (italicBeginTagCount + italicEndTagCount > 0)              {                  if (italicBeginTagCount == 1 && italicEndTagCount == 1 && text.IndexOf(beginTag' StringComparison.Ordinal) > text.IndexOf(endTag' StringComparison.Ordinal))                  {                      const string pattern = "___________@";                      text = text.Replace(beginTag' pattern);                      text = text.Replace(endTag' beginTag);                      text = text.Replace(pattern' endTag);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 0)                  {                      int firstIndex = text.IndexOf(beginTag' StringComparison.Ordinal);                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      if (noOfLines == 2 && lastIndex == lastIndexWithNewLine && firstIndex < 2)                          text = text.Replace(Environment.NewLine' endTag + Environment.NewLine) + endTag;                      else                          text = text.Remove(lastIndex' beginTag.Length).Insert(lastIndex' endTag);                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 2)                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      if (text.StartsWith("</i>-<i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i> -"' StringComparison.Ordinal) ||                          text.StartsWith("</i>-<i> -"' StringComparison.Ordinal))                          text = text.Remove(0' 5);                      else if (firstIndex == 0)                          text = text.Remove(0' 4);                      else                          text = text.Substring(0' firstIndex) + text.Substring(firstIndex + endTag.Length);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 1)                  {                      var lines = text.SplitToLines();                      if (lines.Length == 2 && lines[0].StartsWith(beginTag' StringComparison.Ordinal) && lines[0].EndsWith(endTag' StringComparison.Ordinal) &&                          lines[1].StartsWith(beginTag' StringComparison.Ordinal))                      {                          text = text.TrimEnd() + endTag;                      }                      else                      {                          int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                          if (text.Length > lastIndex + endTag.Length)                              text = text.Substring(0' lastIndex) + text.Substring(lastIndex - 1 + endTag.Length);                          else                              text = text.Substring(0' lastIndex - 1) + endTag;                      }                      if (text.StartsWith(beginTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal) && text.Contains(endTag + Environment.NewLine + beginTag))                      {                          text = text.Replace(endTag + Environment.NewLine + beginTag' Environment.NewLine);                      }                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 0)                  {                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                        if (text.StartsWith(beginTag' StringComparison.Ordinal))                          text += endTag;                      else if (noOfLines == 2 && lastIndex == lastIndexWithNewLine)                          text += endTag;                      else                          text = text.Replace(beginTag' string.Empty);                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 1)                  {                      var cleanText = RemoveOpenCloseTags(text' TagItalic' TagBold' TagUnderline' TagCyrillicI);                      bool isFixed = false;                        // Foo.</i>                      if (text.EndsWith(endTag' StringComparison.Ordinal) && !cleanText.StartsWith("-") && !cleanText.Contains(Environment.NewLine + "-"))                      {                          text = beginTag + text;                          isFixed = true;                      }                        // - Foo</i> | - Foo.                      // - Bar.    | - Foo.</i>                      if (!isFixed && Utilities.GetNumberOfLines(cleanText) == 2)                      {                          int newLineIndex = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                          if (newLineIndex > 0)                          {                              var firstLine = text.Substring(0' newLineIndex).Trim();                              var secondLine = text.Substring(newLineIndex + 2).Trim();                              if (firstLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  firstLine = beginTag + firstLine;                                  isFixed = true;                              }                              if (secondLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  secondLine = beginTag + secondLine;                                  isFixed = true;                              }                              text = firstLine + Environment.NewLine + secondLine;                          }                      }                      if (!isFixed)                          text = text.Replace(endTag' string.Empty);                  }                    // - foo.</i>                  // - bar.</i>                  if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.Contains(endTag + Environment.NewLine' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      text = text.Replace(endTag' string.Empty);                      text = beginTag + text + endTag;                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.StartsWith(endTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      text = text.Remove(firstIndex' endTag.Length).Insert(firstIndex' beginTag);                  }                    // <i>Foo</i>                  // <i>Bar</i>                  if (italicBeginTagCount == 2 && italicEndTagCount == 2 && noOfLines == 2)                  {                      int index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      if (index > 0 && text.Length > index + (beginTag.Length + endTag.Length))                      {                          var firstLine = text.Substring(0' index).Trim();                          var secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                            if (firstLine.Length > 10 && firstLine.StartsWith("- <i>"' StringComparison.Ordinal) && firstLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = "<i>- " + firstLine.Remove(0' 5) + Environment.NewLine + secondLine;                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                          if (secondLine.Length > 10 && secondLine.StartsWith("- <i>"' StringComparison.Ordinal) && secondLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = firstLine + Environment.NewLine + "<i>- " + secondLine.Remove(0' 5);                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                            if (Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag))                          {                              text = text.Replace(beginTag' string.Empty).Replace(endTag' string.Empty).Trim();                              text = beginTag + text + endTag;                          }                      }                        //FALCONE:<i> I didn't think</i><br /><i>it was going to be you'</i>                      var colIdx = text.IndexOf(':');                      if (colIdx >= 0 && Utilities.CountTagInText(text' beginTag) + Utilities.CountTagInText(text' endTag) == 4 && text.Length > colIdx + 1 && !char.IsDigit(text[colIdx + 1]))                      {                          var firstLine = text.Substring(0' index);                          var secondLine = text.Substring(index).TrimStart();                            var secIdxCol = secondLine.IndexOf(':');                          if (secIdxCol < 0 || !Utilities.IsBetweenNumbers(secondLine' secIdxCol))                          {                              var idx = firstLine.IndexOf(':');                              if (idx > 1)                              {                                  var pre = text.Substring(0' idx + 1).TrimStart();                                  text = text.Remove(0' idx + 1);                                  text = FixInvalidItalicTags(text).Trim();                                  if (text.StartsWith("<i> "' StringComparison.OrdinalIgnoreCase))                                      text = Utilities.RemoveSpaceBeforeAfterTag(text' beginTag);                                  text = pre + " " + text;                              }                          }                      }                  }                    //<i>- You think they're they gone?<i>                  //<i>- That can't be.</i>                  if (italicBeginTagCount == 3 && italicEndTagCount == 1 && noOfLines == 2)                  {                      var newLineIdx = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      var firstLine = text.Substring(0' newLineIdx).Trim();                      var secondLine = text.Substring(newLineIdx).Trim();                        if ((Utilities.StartsAndEndsWithTag(firstLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag)) ||                          (Utilities.StartsAndEndsWithTag(secondLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag)))                      {                          text = text.Replace(beginTag' string.Empty);                          text = text.Replace(endTag' string.Empty);                          text = text.Replace("  "' " ").Trim();                          text = beginTag + text + endTag;                      }                  }                    if (noOfLines == 3)                  {                      var lines = text.SplitToLines();                      if ((italicBeginTagCount == 3 && italicEndTagCount == 2) || (italicBeginTagCount == 2 && italicEndTagCount == 3))                      {                          int numberOfItalics = 0;                          foreach (var line in lines)                          {                              if (line.StartsWith(beginTag' StringComparison.Ordinal))                                  numberOfItalics++;                              if (line.EndsWith(endTag' StringComparison.Ordinal))                                  numberOfItalics++;                          }                          if (numberOfItalics == 5)                          { // fix missing tag                              text = "<i>" + text.Replace("<i>"' string.Empty).Replace("</i>"' string.Empty) + "</i>";                          }                      }                  }                    text = text.Replace("<i></i>"' string.Empty);                  text = text.Replace("<i> </i>"' string.Empty);                  text = text.Replace("<i>  </i>"' string.Empty);              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The following statement contains a magic number: if (italicBeginTagCount + italicEndTagCount > 0)              {                  if (italicBeginTagCount == 1 && italicEndTagCount == 1 && text.IndexOf(beginTag' StringComparison.Ordinal) > text.IndexOf(endTag' StringComparison.Ordinal))                  {                      const string pattern = "___________@";                      text = text.Replace(beginTag' pattern);                      text = text.Replace(endTag' beginTag);                      text = text.Replace(pattern' endTag);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 0)                  {                      int firstIndex = text.IndexOf(beginTag' StringComparison.Ordinal);                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      if (noOfLines == 2 && lastIndex == lastIndexWithNewLine && firstIndex < 2)                          text = text.Replace(Environment.NewLine' endTag + Environment.NewLine) + endTag;                      else                          text = text.Remove(lastIndex' beginTag.Length).Insert(lastIndex' endTag);                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 2)                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      if (text.StartsWith("</i>-<i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i> -"' StringComparison.Ordinal) ||                          text.StartsWith("</i>-<i> -"' StringComparison.Ordinal))                          text = text.Remove(0' 5);                      else if (firstIndex == 0)                          text = text.Remove(0' 4);                      else                          text = text.Substring(0' firstIndex) + text.Substring(firstIndex + endTag.Length);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 1)                  {                      var lines = text.SplitToLines();                      if (lines.Length == 2 && lines[0].StartsWith(beginTag' StringComparison.Ordinal) && lines[0].EndsWith(endTag' StringComparison.Ordinal) &&                          lines[1].StartsWith(beginTag' StringComparison.Ordinal))                      {                          text = text.TrimEnd() + endTag;                      }                      else                      {                          int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                          if (text.Length > lastIndex + endTag.Length)                              text = text.Substring(0' lastIndex) + text.Substring(lastIndex - 1 + endTag.Length);                          else                              text = text.Substring(0' lastIndex - 1) + endTag;                      }                      if (text.StartsWith(beginTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal) && text.Contains(endTag + Environment.NewLine + beginTag))                      {                          text = text.Replace(endTag + Environment.NewLine + beginTag' Environment.NewLine);                      }                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 0)                  {                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                        if (text.StartsWith(beginTag' StringComparison.Ordinal))                          text += endTag;                      else if (noOfLines == 2 && lastIndex == lastIndexWithNewLine)                          text += endTag;                      else                          text = text.Replace(beginTag' string.Empty);                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 1)                  {                      var cleanText = RemoveOpenCloseTags(text' TagItalic' TagBold' TagUnderline' TagCyrillicI);                      bool isFixed = false;                        // Foo.</i>                      if (text.EndsWith(endTag' StringComparison.Ordinal) && !cleanText.StartsWith("-") && !cleanText.Contains(Environment.NewLine + "-"))                      {                          text = beginTag + text;                          isFixed = true;                      }                        // - Foo</i> | - Foo.                      // - Bar.    | - Foo.</i>                      if (!isFixed && Utilities.GetNumberOfLines(cleanText) == 2)                      {                          int newLineIndex = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                          if (newLineIndex > 0)                          {                              var firstLine = text.Substring(0' newLineIndex).Trim();                              var secondLine = text.Substring(newLineIndex + 2).Trim();                              if (firstLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  firstLine = beginTag + firstLine;                                  isFixed = true;                              }                              if (secondLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  secondLine = beginTag + secondLine;                                  isFixed = true;                              }                              text = firstLine + Environment.NewLine + secondLine;                          }                      }                      if (!isFixed)                          text = text.Replace(endTag' string.Empty);                  }                    // - foo.</i>                  // - bar.</i>                  if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.Contains(endTag + Environment.NewLine' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      text = text.Replace(endTag' string.Empty);                      text = beginTag + text + endTag;                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.StartsWith(endTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      text = text.Remove(firstIndex' endTag.Length).Insert(firstIndex' beginTag);                  }                    // <i>Foo</i>                  // <i>Bar</i>                  if (italicBeginTagCount == 2 && italicEndTagCount == 2 && noOfLines == 2)                  {                      int index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      if (index > 0 && text.Length > index + (beginTag.Length + endTag.Length))                      {                          var firstLine = text.Substring(0' index).Trim();                          var secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                            if (firstLine.Length > 10 && firstLine.StartsWith("- <i>"' StringComparison.Ordinal) && firstLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = "<i>- " + firstLine.Remove(0' 5) + Environment.NewLine + secondLine;                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                          if (secondLine.Length > 10 && secondLine.StartsWith("- <i>"' StringComparison.Ordinal) && secondLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = firstLine + Environment.NewLine + "<i>- " + secondLine.Remove(0' 5);                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                            if (Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag))                          {                              text = text.Replace(beginTag' string.Empty).Replace(endTag' string.Empty).Trim();                              text = beginTag + text + endTag;                          }                      }                        //FALCONE:<i> I didn't think</i><br /><i>it was going to be you'</i>                      var colIdx = text.IndexOf(':');                      if (colIdx >= 0 && Utilities.CountTagInText(text' beginTag) + Utilities.CountTagInText(text' endTag) == 4 && text.Length > colIdx + 1 && !char.IsDigit(text[colIdx + 1]))                      {                          var firstLine = text.Substring(0' index);                          var secondLine = text.Substring(index).TrimStart();                            var secIdxCol = secondLine.IndexOf(':');                          if (secIdxCol < 0 || !Utilities.IsBetweenNumbers(secondLine' secIdxCol))                          {                              var idx = firstLine.IndexOf(':');                              if (idx > 1)                              {                                  var pre = text.Substring(0' idx + 1).TrimStart();                                  text = text.Remove(0' idx + 1);                                  text = FixInvalidItalicTags(text).Trim();                                  if (text.StartsWith("<i> "' StringComparison.OrdinalIgnoreCase))                                      text = Utilities.RemoveSpaceBeforeAfterTag(text' beginTag);                                  text = pre + " " + text;                              }                          }                      }                  }                    //<i>- You think they're they gone?<i>                  //<i>- That can't be.</i>                  if (italicBeginTagCount == 3 && italicEndTagCount == 1 && noOfLines == 2)                  {                      var newLineIdx = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      var firstLine = text.Substring(0' newLineIdx).Trim();                      var secondLine = text.Substring(newLineIdx).Trim();                        if ((Utilities.StartsAndEndsWithTag(firstLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag)) ||                          (Utilities.StartsAndEndsWithTag(secondLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag)))                      {                          text = text.Replace(beginTag' string.Empty);                          text = text.Replace(endTag' string.Empty);                          text = text.Replace("  "' " ").Trim();                          text = beginTag + text + endTag;                      }                  }                    if (noOfLines == 3)                  {                      var lines = text.SplitToLines();                      if ((italicBeginTagCount == 3 && italicEndTagCount == 2) || (italicBeginTagCount == 2 && italicEndTagCount == 3))                      {                          int numberOfItalics = 0;                          foreach (var line in lines)                          {                              if (line.StartsWith(beginTag' StringComparison.Ordinal))                                  numberOfItalics++;                              if (line.EndsWith(endTag' StringComparison.Ordinal))                                  numberOfItalics++;                          }                          if (numberOfItalics == 5)                          { // fix missing tag                              text = "<i>" + text.Replace("<i>"' string.Empty).Replace("</i>"' string.Empty) + "</i>";                          }                      }                  }                    text = text.Replace("<i></i>"' string.Empty);                  text = text.Replace("<i> </i>"' string.Empty);                  text = text.Replace("<i>  </i>"' string.Empty);              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The following statement contains a magic number: if (italicBeginTagCount + italicEndTagCount > 0)              {                  if (italicBeginTagCount == 1 && italicEndTagCount == 1 && text.IndexOf(beginTag' StringComparison.Ordinal) > text.IndexOf(endTag' StringComparison.Ordinal))                  {                      const string pattern = "___________@";                      text = text.Replace(beginTag' pattern);                      text = text.Replace(endTag' beginTag);                      text = text.Replace(pattern' endTag);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 0)                  {                      int firstIndex = text.IndexOf(beginTag' StringComparison.Ordinal);                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      if (noOfLines == 2 && lastIndex == lastIndexWithNewLine && firstIndex < 2)                          text = text.Replace(Environment.NewLine' endTag + Environment.NewLine) + endTag;                      else                          text = text.Remove(lastIndex' beginTag.Length).Insert(lastIndex' endTag);                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 2)                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      if (text.StartsWith("</i>-<i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i> -"' StringComparison.Ordinal) ||                          text.StartsWith("</i>-<i> -"' StringComparison.Ordinal))                          text = text.Remove(0' 5);                      else if (firstIndex == 0)                          text = text.Remove(0' 4);                      else                          text = text.Substring(0' firstIndex) + text.Substring(firstIndex + endTag.Length);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 1)                  {                      var lines = text.SplitToLines();                      if (lines.Length == 2 && lines[0].StartsWith(beginTag' StringComparison.Ordinal) && lines[0].EndsWith(endTag' StringComparison.Ordinal) &&                          lines[1].StartsWith(beginTag' StringComparison.Ordinal))                      {                          text = text.TrimEnd() + endTag;                      }                      else                      {                          int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                          if (text.Length > lastIndex + endTag.Length)                              text = text.Substring(0' lastIndex) + text.Substring(lastIndex - 1 + endTag.Length);                          else                              text = text.Substring(0' lastIndex - 1) + endTag;                      }                      if (text.StartsWith(beginTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal) && text.Contains(endTag + Environment.NewLine + beginTag))                      {                          text = text.Replace(endTag + Environment.NewLine + beginTag' Environment.NewLine);                      }                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 0)                  {                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                        if (text.StartsWith(beginTag' StringComparison.Ordinal))                          text += endTag;                      else if (noOfLines == 2 && lastIndex == lastIndexWithNewLine)                          text += endTag;                      else                          text = text.Replace(beginTag' string.Empty);                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 1)                  {                      var cleanText = RemoveOpenCloseTags(text' TagItalic' TagBold' TagUnderline' TagCyrillicI);                      bool isFixed = false;                        // Foo.</i>                      if (text.EndsWith(endTag' StringComparison.Ordinal) && !cleanText.StartsWith("-") && !cleanText.Contains(Environment.NewLine + "-"))                      {                          text = beginTag + text;                          isFixed = true;                      }                        // - Foo</i> | - Foo.                      // - Bar.    | - Foo.</i>                      if (!isFixed && Utilities.GetNumberOfLines(cleanText) == 2)                      {                          int newLineIndex = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                          if (newLineIndex > 0)                          {                              var firstLine = text.Substring(0' newLineIndex).Trim();                              var secondLine = text.Substring(newLineIndex + 2).Trim();                              if (firstLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  firstLine = beginTag + firstLine;                                  isFixed = true;                              }                              if (secondLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  secondLine = beginTag + secondLine;                                  isFixed = true;                              }                              text = firstLine + Environment.NewLine + secondLine;                          }                      }                      if (!isFixed)                          text = text.Replace(endTag' string.Empty);                  }                    // - foo.</i>                  // - bar.</i>                  if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.Contains(endTag + Environment.NewLine' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      text = text.Replace(endTag' string.Empty);                      text = beginTag + text + endTag;                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.StartsWith(endTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      text = text.Remove(firstIndex' endTag.Length).Insert(firstIndex' beginTag);                  }                    // <i>Foo</i>                  // <i>Bar</i>                  if (italicBeginTagCount == 2 && italicEndTagCount == 2 && noOfLines == 2)                  {                      int index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      if (index > 0 && text.Length > index + (beginTag.Length + endTag.Length))                      {                          var firstLine = text.Substring(0' index).Trim();                          var secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                            if (firstLine.Length > 10 && firstLine.StartsWith("- <i>"' StringComparison.Ordinal) && firstLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = "<i>- " + firstLine.Remove(0' 5) + Environment.NewLine + secondLine;                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                          if (secondLine.Length > 10 && secondLine.StartsWith("- <i>"' StringComparison.Ordinal) && secondLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = firstLine + Environment.NewLine + "<i>- " + secondLine.Remove(0' 5);                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                            if (Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag))                          {                              text = text.Replace(beginTag' string.Empty).Replace(endTag' string.Empty).Trim();                              text = beginTag + text + endTag;                          }                      }                        //FALCONE:<i> I didn't think</i><br /><i>it was going to be you'</i>                      var colIdx = text.IndexOf(':');                      if (colIdx >= 0 && Utilities.CountTagInText(text' beginTag) + Utilities.CountTagInText(text' endTag) == 4 && text.Length > colIdx + 1 && !char.IsDigit(text[colIdx + 1]))                      {                          var firstLine = text.Substring(0' index);                          var secondLine = text.Substring(index).TrimStart();                            var secIdxCol = secondLine.IndexOf(':');                          if (secIdxCol < 0 || !Utilities.IsBetweenNumbers(secondLine' secIdxCol))                          {                              var idx = firstLine.IndexOf(':');                              if (idx > 1)                              {                                  var pre = text.Substring(0' idx + 1).TrimStart();                                  text = text.Remove(0' idx + 1);                                  text = FixInvalidItalicTags(text).Trim();                                  if (text.StartsWith("<i> "' StringComparison.OrdinalIgnoreCase))                                      text = Utilities.RemoveSpaceBeforeAfterTag(text' beginTag);                                  text = pre + " " + text;                              }                          }                      }                  }                    //<i>- You think they're they gone?<i>                  //<i>- That can't be.</i>                  if (italicBeginTagCount == 3 && italicEndTagCount == 1 && noOfLines == 2)                  {                      var newLineIdx = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      var firstLine = text.Substring(0' newLineIdx).Trim();                      var secondLine = text.Substring(newLineIdx).Trim();                        if ((Utilities.StartsAndEndsWithTag(firstLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag)) ||                          (Utilities.StartsAndEndsWithTag(secondLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag)))                      {                          text = text.Replace(beginTag' string.Empty);                          text = text.Replace(endTag' string.Empty);                          text = text.Replace("  "' " ").Trim();                          text = beginTag + text + endTag;                      }                  }                    if (noOfLines == 3)                  {                      var lines = text.SplitToLines();                      if ((italicBeginTagCount == 3 && italicEndTagCount == 2) || (italicBeginTagCount == 2 && italicEndTagCount == 3))                      {                          int numberOfItalics = 0;                          foreach (var line in lines)                          {                              if (line.StartsWith(beginTag' StringComparison.Ordinal))                                  numberOfItalics++;                              if (line.EndsWith(endTag' StringComparison.Ordinal))                                  numberOfItalics++;                          }                          if (numberOfItalics == 5)                          { // fix missing tag                              text = "<i>" + text.Replace("<i>"' string.Empty).Replace("</i>"' string.Empty) + "</i>";                          }                      }                  }                    text = text.Replace("<i></i>"' string.Empty);                  text = text.Replace("<i> </i>"' string.Empty);                  text = text.Replace("<i>  </i>"' string.Empty);              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The following statement contains a magic number: if (italicBeginTagCount + italicEndTagCount > 0)              {                  if (italicBeginTagCount == 1 && italicEndTagCount == 1 && text.IndexOf(beginTag' StringComparison.Ordinal) > text.IndexOf(endTag' StringComparison.Ordinal))                  {                      const string pattern = "___________@";                      text = text.Replace(beginTag' pattern);                      text = text.Replace(endTag' beginTag);                      text = text.Replace(pattern' endTag);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 0)                  {                      int firstIndex = text.IndexOf(beginTag' StringComparison.Ordinal);                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      if (noOfLines == 2 && lastIndex == lastIndexWithNewLine && firstIndex < 2)                          text = text.Replace(Environment.NewLine' endTag + Environment.NewLine) + endTag;                      else                          text = text.Remove(lastIndex' beginTag.Length).Insert(lastIndex' endTag);                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 2)                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      if (text.StartsWith("</i>-<i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i> -"' StringComparison.Ordinal) ||                          text.StartsWith("</i>-<i> -"' StringComparison.Ordinal))                          text = text.Remove(0' 5);                      else if (firstIndex == 0)                          text = text.Remove(0' 4);                      else                          text = text.Substring(0' firstIndex) + text.Substring(firstIndex + endTag.Length);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 1)                  {                      var lines = text.SplitToLines();                      if (lines.Length == 2 && lines[0].StartsWith(beginTag' StringComparison.Ordinal) && lines[0].EndsWith(endTag' StringComparison.Ordinal) &&                          lines[1].StartsWith(beginTag' StringComparison.Ordinal))                      {                          text = text.TrimEnd() + endTag;                      }                      else                      {                          int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                          if (text.Length > lastIndex + endTag.Length)                              text = text.Substring(0' lastIndex) + text.Substring(lastIndex - 1 + endTag.Length);                          else                              text = text.Substring(0' lastIndex - 1) + endTag;                      }                      if (text.StartsWith(beginTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal) && text.Contains(endTag + Environment.NewLine + beginTag))                      {                          text = text.Replace(endTag + Environment.NewLine + beginTag' Environment.NewLine);                      }                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 0)                  {                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                        if (text.StartsWith(beginTag' StringComparison.Ordinal))                          text += endTag;                      else if (noOfLines == 2 && lastIndex == lastIndexWithNewLine)                          text += endTag;                      else                          text = text.Replace(beginTag' string.Empty);                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 1)                  {                      var cleanText = RemoveOpenCloseTags(text' TagItalic' TagBold' TagUnderline' TagCyrillicI);                      bool isFixed = false;                        // Foo.</i>                      if (text.EndsWith(endTag' StringComparison.Ordinal) && !cleanText.StartsWith("-") && !cleanText.Contains(Environment.NewLine + "-"))                      {                          text = beginTag + text;                          isFixed = true;                      }                        // - Foo</i> | - Foo.                      // - Bar.    | - Foo.</i>                      if (!isFixed && Utilities.GetNumberOfLines(cleanText) == 2)                      {                          int newLineIndex = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                          if (newLineIndex > 0)                          {                              var firstLine = text.Substring(0' newLineIndex).Trim();                              var secondLine = text.Substring(newLineIndex + 2).Trim();                              if (firstLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  firstLine = beginTag + firstLine;                                  isFixed = true;                              }                              if (secondLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  secondLine = beginTag + secondLine;                                  isFixed = true;                              }                              text = firstLine + Environment.NewLine + secondLine;                          }                      }                      if (!isFixed)                          text = text.Replace(endTag' string.Empty);                  }                    // - foo.</i>                  // - bar.</i>                  if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.Contains(endTag + Environment.NewLine' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      text = text.Replace(endTag' string.Empty);                      text = beginTag + text + endTag;                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.StartsWith(endTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      text = text.Remove(firstIndex' endTag.Length).Insert(firstIndex' beginTag);                  }                    // <i>Foo</i>                  // <i>Bar</i>                  if (italicBeginTagCount == 2 && italicEndTagCount == 2 && noOfLines == 2)                  {                      int index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      if (index > 0 && text.Length > index + (beginTag.Length + endTag.Length))                      {                          var firstLine = text.Substring(0' index).Trim();                          var secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                            if (firstLine.Length > 10 && firstLine.StartsWith("- <i>"' StringComparison.Ordinal) && firstLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = "<i>- " + firstLine.Remove(0' 5) + Environment.NewLine + secondLine;                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                          if (secondLine.Length > 10 && secondLine.StartsWith("- <i>"' StringComparison.Ordinal) && secondLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = firstLine + Environment.NewLine + "<i>- " + secondLine.Remove(0' 5);                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                            if (Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag))                          {                              text = text.Replace(beginTag' string.Empty).Replace(endTag' string.Empty).Trim();                              text = beginTag + text + endTag;                          }                      }                        //FALCONE:<i> I didn't think</i><br /><i>it was going to be you'</i>                      var colIdx = text.IndexOf(':');                      if (colIdx >= 0 && Utilities.CountTagInText(text' beginTag) + Utilities.CountTagInText(text' endTag) == 4 && text.Length > colIdx + 1 && !char.IsDigit(text[colIdx + 1]))                      {                          var firstLine = text.Substring(0' index);                          var secondLine = text.Substring(index).TrimStart();                            var secIdxCol = secondLine.IndexOf(':');                          if (secIdxCol < 0 || !Utilities.IsBetweenNumbers(secondLine' secIdxCol))                          {                              var idx = firstLine.IndexOf(':');                              if (idx > 1)                              {                                  var pre = text.Substring(0' idx + 1).TrimStart();                                  text = text.Remove(0' idx + 1);                                  text = FixInvalidItalicTags(text).Trim();                                  if (text.StartsWith("<i> "' StringComparison.OrdinalIgnoreCase))                                      text = Utilities.RemoveSpaceBeforeAfterTag(text' beginTag);                                  text = pre + " " + text;                              }                          }                      }                  }                    //<i>- You think they're they gone?<i>                  //<i>- That can't be.</i>                  if (italicBeginTagCount == 3 && italicEndTagCount == 1 && noOfLines == 2)                  {                      var newLineIdx = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      var firstLine = text.Substring(0' newLineIdx).Trim();                      var secondLine = text.Substring(newLineIdx).Trim();                        if ((Utilities.StartsAndEndsWithTag(firstLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag)) ||                          (Utilities.StartsAndEndsWithTag(secondLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag)))                      {                          text = text.Replace(beginTag' string.Empty);                          text = text.Replace(endTag' string.Empty);                          text = text.Replace("  "' " ").Trim();                          text = beginTag + text + endTag;                      }                  }                    if (noOfLines == 3)                  {                      var lines = text.SplitToLines();                      if ((italicBeginTagCount == 3 && italicEndTagCount == 2) || (italicBeginTagCount == 2 && italicEndTagCount == 3))                      {                          int numberOfItalics = 0;                          foreach (var line in lines)                          {                              if (line.StartsWith(beginTag' StringComparison.Ordinal))                                  numberOfItalics++;                              if (line.EndsWith(endTag' StringComparison.Ordinal))                                  numberOfItalics++;                          }                          if (numberOfItalics == 5)                          { // fix missing tag                              text = "<i>" + text.Replace("<i>"' string.Empty).Replace("</i>"' string.Empty) + "</i>";                          }                      }                  }                    text = text.Replace("<i></i>"' string.Empty);                  text = text.Replace("<i> </i>"' string.Empty);                  text = text.Replace("<i>  </i>"' string.Empty);              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The following statement contains a magic number: if (italicBeginTagCount + italicEndTagCount > 0)              {                  if (italicBeginTagCount == 1 && italicEndTagCount == 1 && text.IndexOf(beginTag' StringComparison.Ordinal) > text.IndexOf(endTag' StringComparison.Ordinal))                  {                      const string pattern = "___________@";                      text = text.Replace(beginTag' pattern);                      text = text.Replace(endTag' beginTag);                      text = text.Replace(pattern' endTag);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 0)                  {                      int firstIndex = text.IndexOf(beginTag' StringComparison.Ordinal);                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      if (noOfLines == 2 && lastIndex == lastIndexWithNewLine && firstIndex < 2)                          text = text.Replace(Environment.NewLine' endTag + Environment.NewLine) + endTag;                      else                          text = text.Remove(lastIndex' beginTag.Length).Insert(lastIndex' endTag);                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 2)                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      if (text.StartsWith("</i>-<i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i> -"' StringComparison.Ordinal) ||                          text.StartsWith("</i>-<i> -"' StringComparison.Ordinal))                          text = text.Remove(0' 5);                      else if (firstIndex == 0)                          text = text.Remove(0' 4);                      else                          text = text.Substring(0' firstIndex) + text.Substring(firstIndex + endTag.Length);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 1)                  {                      var lines = text.SplitToLines();                      if (lines.Length == 2 && lines[0].StartsWith(beginTag' StringComparison.Ordinal) && lines[0].EndsWith(endTag' StringComparison.Ordinal) &&                          lines[1].StartsWith(beginTag' StringComparison.Ordinal))                      {                          text = text.TrimEnd() + endTag;                      }                      else                      {                          int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                          if (text.Length > lastIndex + endTag.Length)                              text = text.Substring(0' lastIndex) + text.Substring(lastIndex - 1 + endTag.Length);                          else                              text = text.Substring(0' lastIndex - 1) + endTag;                      }                      if (text.StartsWith(beginTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal) && text.Contains(endTag + Environment.NewLine + beginTag))                      {                          text = text.Replace(endTag + Environment.NewLine + beginTag' Environment.NewLine);                      }                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 0)                  {                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                        if (text.StartsWith(beginTag' StringComparison.Ordinal))                          text += endTag;                      else if (noOfLines == 2 && lastIndex == lastIndexWithNewLine)                          text += endTag;                      else                          text = text.Replace(beginTag' string.Empty);                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 1)                  {                      var cleanText = RemoveOpenCloseTags(text' TagItalic' TagBold' TagUnderline' TagCyrillicI);                      bool isFixed = false;                        // Foo.</i>                      if (text.EndsWith(endTag' StringComparison.Ordinal) && !cleanText.StartsWith("-") && !cleanText.Contains(Environment.NewLine + "-"))                      {                          text = beginTag + text;                          isFixed = true;                      }                        // - Foo</i> | - Foo.                      // - Bar.    | - Foo.</i>                      if (!isFixed && Utilities.GetNumberOfLines(cleanText) == 2)                      {                          int newLineIndex = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                          if (newLineIndex > 0)                          {                              var firstLine = text.Substring(0' newLineIndex).Trim();                              var secondLine = text.Substring(newLineIndex + 2).Trim();                              if (firstLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  firstLine = beginTag + firstLine;                                  isFixed = true;                              }                              if (secondLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  secondLine = beginTag + secondLine;                                  isFixed = true;                              }                              text = firstLine + Environment.NewLine + secondLine;                          }                      }                      if (!isFixed)                          text = text.Replace(endTag' string.Empty);                  }                    // - foo.</i>                  // - bar.</i>                  if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.Contains(endTag + Environment.NewLine' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      text = text.Replace(endTag' string.Empty);                      text = beginTag + text + endTag;                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.StartsWith(endTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      text = text.Remove(firstIndex' endTag.Length).Insert(firstIndex' beginTag);                  }                    // <i>Foo</i>                  // <i>Bar</i>                  if (italicBeginTagCount == 2 && italicEndTagCount == 2 && noOfLines == 2)                  {                      int index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      if (index > 0 && text.Length > index + (beginTag.Length + endTag.Length))                      {                          var firstLine = text.Substring(0' index).Trim();                          var secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                            if (firstLine.Length > 10 && firstLine.StartsWith("- <i>"' StringComparison.Ordinal) && firstLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = "<i>- " + firstLine.Remove(0' 5) + Environment.NewLine + secondLine;                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                          if (secondLine.Length > 10 && secondLine.StartsWith("- <i>"' StringComparison.Ordinal) && secondLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = firstLine + Environment.NewLine + "<i>- " + secondLine.Remove(0' 5);                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                            if (Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag))                          {                              text = text.Replace(beginTag' string.Empty).Replace(endTag' string.Empty).Trim();                              text = beginTag + text + endTag;                          }                      }                        //FALCONE:<i> I didn't think</i><br /><i>it was going to be you'</i>                      var colIdx = text.IndexOf(':');                      if (colIdx >= 0 && Utilities.CountTagInText(text' beginTag) + Utilities.CountTagInText(text' endTag) == 4 && text.Length > colIdx + 1 && !char.IsDigit(text[colIdx + 1]))                      {                          var firstLine = text.Substring(0' index);                          var secondLine = text.Substring(index).TrimStart();                            var secIdxCol = secondLine.IndexOf(':');                          if (secIdxCol < 0 || !Utilities.IsBetweenNumbers(secondLine' secIdxCol))                          {                              var idx = firstLine.IndexOf(':');                              if (idx > 1)                              {                                  var pre = text.Substring(0' idx + 1).TrimStart();                                  text = text.Remove(0' idx + 1);                                  text = FixInvalidItalicTags(text).Trim();                                  if (text.StartsWith("<i> "' StringComparison.OrdinalIgnoreCase))                                      text = Utilities.RemoveSpaceBeforeAfterTag(text' beginTag);                                  text = pre + " " + text;                              }                          }                      }                  }                    //<i>- You think they're they gone?<i>                  //<i>- That can't be.</i>                  if (italicBeginTagCount == 3 && italicEndTagCount == 1 && noOfLines == 2)                  {                      var newLineIdx = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      var firstLine = text.Substring(0' newLineIdx).Trim();                      var secondLine = text.Substring(newLineIdx).Trim();                        if ((Utilities.StartsAndEndsWithTag(firstLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag)) ||                          (Utilities.StartsAndEndsWithTag(secondLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag)))                      {                          text = text.Replace(beginTag' string.Empty);                          text = text.Replace(endTag' string.Empty);                          text = text.Replace("  "' " ").Trim();                          text = beginTag + text + endTag;                      }                  }                    if (noOfLines == 3)                  {                      var lines = text.SplitToLines();                      if ((italicBeginTagCount == 3 && italicEndTagCount == 2) || (italicBeginTagCount == 2 && italicEndTagCount == 3))                      {                          int numberOfItalics = 0;                          foreach (var line in lines)                          {                              if (line.StartsWith(beginTag' StringComparison.Ordinal))                                  numberOfItalics++;                              if (line.EndsWith(endTag' StringComparison.Ordinal))                                  numberOfItalics++;                          }                          if (numberOfItalics == 5)                          { // fix missing tag                              text = "<i>" + text.Replace("<i>"' string.Empty).Replace("</i>"' string.Empty) + "</i>";                          }                      }                  }                    text = text.Replace("<i></i>"' string.Empty);                  text = text.Replace("<i> </i>"' string.Empty);                  text = text.Replace("<i>  </i>"' string.Empty);              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The following statement contains a magic number: if (italicBeginTagCount + italicEndTagCount > 0)              {                  if (italicBeginTagCount == 1 && italicEndTagCount == 1 && text.IndexOf(beginTag' StringComparison.Ordinal) > text.IndexOf(endTag' StringComparison.Ordinal))                  {                      const string pattern = "___________@";                      text = text.Replace(beginTag' pattern);                      text = text.Replace(endTag' beginTag);                      text = text.Replace(pattern' endTag);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 0)                  {                      int firstIndex = text.IndexOf(beginTag' StringComparison.Ordinal);                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      if (noOfLines == 2 && lastIndex == lastIndexWithNewLine && firstIndex < 2)                          text = text.Replace(Environment.NewLine' endTag + Environment.NewLine) + endTag;                      else                          text = text.Remove(lastIndex' beginTag.Length).Insert(lastIndex' endTag);                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 2)                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      if (text.StartsWith("</i>-<i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i> -"' StringComparison.Ordinal) ||                          text.StartsWith("</i>-<i> -"' StringComparison.Ordinal))                          text = text.Remove(0' 5);                      else if (firstIndex == 0)                          text = text.Remove(0' 4);                      else                          text = text.Substring(0' firstIndex) + text.Substring(firstIndex + endTag.Length);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 1)                  {                      var lines = text.SplitToLines();                      if (lines.Length == 2 && lines[0].StartsWith(beginTag' StringComparison.Ordinal) && lines[0].EndsWith(endTag' StringComparison.Ordinal) &&                          lines[1].StartsWith(beginTag' StringComparison.Ordinal))                      {                          text = text.TrimEnd() + endTag;                      }                      else                      {                          int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                          if (text.Length > lastIndex + endTag.Length)                              text = text.Substring(0' lastIndex) + text.Substring(lastIndex - 1 + endTag.Length);                          else                              text = text.Substring(0' lastIndex - 1) + endTag;                      }                      if (text.StartsWith(beginTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal) && text.Contains(endTag + Environment.NewLine + beginTag))                      {                          text = text.Replace(endTag + Environment.NewLine + beginTag' Environment.NewLine);                      }                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 0)                  {                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                        if (text.StartsWith(beginTag' StringComparison.Ordinal))                          text += endTag;                      else if (noOfLines == 2 && lastIndex == lastIndexWithNewLine)                          text += endTag;                      else                          text = text.Replace(beginTag' string.Empty);                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 1)                  {                      var cleanText = RemoveOpenCloseTags(text' TagItalic' TagBold' TagUnderline' TagCyrillicI);                      bool isFixed = false;                        // Foo.</i>                      if (text.EndsWith(endTag' StringComparison.Ordinal) && !cleanText.StartsWith("-") && !cleanText.Contains(Environment.NewLine + "-"))                      {                          text = beginTag + text;                          isFixed = true;                      }                        // - Foo</i> | - Foo.                      // - Bar.    | - Foo.</i>                      if (!isFixed && Utilities.GetNumberOfLines(cleanText) == 2)                      {                          int newLineIndex = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                          if (newLineIndex > 0)                          {                              var firstLine = text.Substring(0' newLineIndex).Trim();                              var secondLine = text.Substring(newLineIndex + 2).Trim();                              if (firstLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  firstLine = beginTag + firstLine;                                  isFixed = true;                              }                              if (secondLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  secondLine = beginTag + secondLine;                                  isFixed = true;                              }                              text = firstLine + Environment.NewLine + secondLine;                          }                      }                      if (!isFixed)                          text = text.Replace(endTag' string.Empty);                  }                    // - foo.</i>                  // - bar.</i>                  if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.Contains(endTag + Environment.NewLine' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      text = text.Replace(endTag' string.Empty);                      text = beginTag + text + endTag;                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.StartsWith(endTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      text = text.Remove(firstIndex' endTag.Length).Insert(firstIndex' beginTag);                  }                    // <i>Foo</i>                  // <i>Bar</i>                  if (italicBeginTagCount == 2 && italicEndTagCount == 2 && noOfLines == 2)                  {                      int index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      if (index > 0 && text.Length > index + (beginTag.Length + endTag.Length))                      {                          var firstLine = text.Substring(0' index).Trim();                          var secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                            if (firstLine.Length > 10 && firstLine.StartsWith("- <i>"' StringComparison.Ordinal) && firstLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = "<i>- " + firstLine.Remove(0' 5) + Environment.NewLine + secondLine;                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                          if (secondLine.Length > 10 && secondLine.StartsWith("- <i>"' StringComparison.Ordinal) && secondLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = firstLine + Environment.NewLine + "<i>- " + secondLine.Remove(0' 5);                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                            if (Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag))                          {                              text = text.Replace(beginTag' string.Empty).Replace(endTag' string.Empty).Trim();                              text = beginTag + text + endTag;                          }                      }                        //FALCONE:<i> I didn't think</i><br /><i>it was going to be you'</i>                      var colIdx = text.IndexOf(':');                      if (colIdx >= 0 && Utilities.CountTagInText(text' beginTag) + Utilities.CountTagInText(text' endTag) == 4 && text.Length > colIdx + 1 && !char.IsDigit(text[colIdx + 1]))                      {                          var firstLine = text.Substring(0' index);                          var secondLine = text.Substring(index).TrimStart();                            var secIdxCol = secondLine.IndexOf(':');                          if (secIdxCol < 0 || !Utilities.IsBetweenNumbers(secondLine' secIdxCol))                          {                              var idx = firstLine.IndexOf(':');                              if (idx > 1)                              {                                  var pre = text.Substring(0' idx + 1).TrimStart();                                  text = text.Remove(0' idx + 1);                                  text = FixInvalidItalicTags(text).Trim();                                  if (text.StartsWith("<i> "' StringComparison.OrdinalIgnoreCase))                                      text = Utilities.RemoveSpaceBeforeAfterTag(text' beginTag);                                  text = pre + " " + text;                              }                          }                      }                  }                    //<i>- You think they're they gone?<i>                  //<i>- That can't be.</i>                  if (italicBeginTagCount == 3 && italicEndTagCount == 1 && noOfLines == 2)                  {                      var newLineIdx = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      var firstLine = text.Substring(0' newLineIdx).Trim();                      var secondLine = text.Substring(newLineIdx).Trim();                        if ((Utilities.StartsAndEndsWithTag(firstLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag)) ||                          (Utilities.StartsAndEndsWithTag(secondLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag)))                      {                          text = text.Replace(beginTag' string.Empty);                          text = text.Replace(endTag' string.Empty);                          text = text.Replace("  "' " ").Trim();                          text = beginTag + text + endTag;                      }                  }                    if (noOfLines == 3)                  {                      var lines = text.SplitToLines();                      if ((italicBeginTagCount == 3 && italicEndTagCount == 2) || (italicBeginTagCount == 2 && italicEndTagCount == 3))                      {                          int numberOfItalics = 0;                          foreach (var line in lines)                          {                              if (line.StartsWith(beginTag' StringComparison.Ordinal))                                  numberOfItalics++;                              if (line.EndsWith(endTag' StringComparison.Ordinal))                                  numberOfItalics++;                          }                          if (numberOfItalics == 5)                          { // fix missing tag                              text = "<i>" + text.Replace("<i>"' string.Empty).Replace("</i>"' string.Empty) + "</i>";                          }                      }                  }                    text = text.Replace("<i></i>"' string.Empty);                  text = text.Replace("<i> </i>"' string.Empty);                  text = text.Replace("<i>  </i>"' string.Empty);              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The following statement contains a magic number: if (italicBeginTagCount + italicEndTagCount > 0)              {                  if (italicBeginTagCount == 1 && italicEndTagCount == 1 && text.IndexOf(beginTag' StringComparison.Ordinal) > text.IndexOf(endTag' StringComparison.Ordinal))                  {                      const string pattern = "___________@";                      text = text.Replace(beginTag' pattern);                      text = text.Replace(endTag' beginTag);                      text = text.Replace(pattern' endTag);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 0)                  {                      int firstIndex = text.IndexOf(beginTag' StringComparison.Ordinal);                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      if (noOfLines == 2 && lastIndex == lastIndexWithNewLine && firstIndex < 2)                          text = text.Replace(Environment.NewLine' endTag + Environment.NewLine) + endTag;                      else                          text = text.Remove(lastIndex' beginTag.Length).Insert(lastIndex' endTag);                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 2)                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      if (text.StartsWith("</i>-<i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i> -"' StringComparison.Ordinal) ||                          text.StartsWith("</i>-<i> -"' StringComparison.Ordinal))                          text = text.Remove(0' 5);                      else if (firstIndex == 0)                          text = text.Remove(0' 4);                      else                          text = text.Substring(0' firstIndex) + text.Substring(firstIndex + endTag.Length);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 1)                  {                      var lines = text.SplitToLines();                      if (lines.Length == 2 && lines[0].StartsWith(beginTag' StringComparison.Ordinal) && lines[0].EndsWith(endTag' StringComparison.Ordinal) &&                          lines[1].StartsWith(beginTag' StringComparison.Ordinal))                      {                          text = text.TrimEnd() + endTag;                      }                      else                      {                          int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                          if (text.Length > lastIndex + endTag.Length)                              text = text.Substring(0' lastIndex) + text.Substring(lastIndex - 1 + endTag.Length);                          else                              text = text.Substring(0' lastIndex - 1) + endTag;                      }                      if (text.StartsWith(beginTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal) && text.Contains(endTag + Environment.NewLine + beginTag))                      {                          text = text.Replace(endTag + Environment.NewLine + beginTag' Environment.NewLine);                      }                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 0)                  {                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                        if (text.StartsWith(beginTag' StringComparison.Ordinal))                          text += endTag;                      else if (noOfLines == 2 && lastIndex == lastIndexWithNewLine)                          text += endTag;                      else                          text = text.Replace(beginTag' string.Empty);                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 1)                  {                      var cleanText = RemoveOpenCloseTags(text' TagItalic' TagBold' TagUnderline' TagCyrillicI);                      bool isFixed = false;                        // Foo.</i>                      if (text.EndsWith(endTag' StringComparison.Ordinal) && !cleanText.StartsWith("-") && !cleanText.Contains(Environment.NewLine + "-"))                      {                          text = beginTag + text;                          isFixed = true;                      }                        // - Foo</i> | - Foo.                      // - Bar.    | - Foo.</i>                      if (!isFixed && Utilities.GetNumberOfLines(cleanText) == 2)                      {                          int newLineIndex = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                          if (newLineIndex > 0)                          {                              var firstLine = text.Substring(0' newLineIndex).Trim();                              var secondLine = text.Substring(newLineIndex + 2).Trim();                              if (firstLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  firstLine = beginTag + firstLine;                                  isFixed = true;                              }                              if (secondLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  secondLine = beginTag + secondLine;                                  isFixed = true;                              }                              text = firstLine + Environment.NewLine + secondLine;                          }                      }                      if (!isFixed)                          text = text.Replace(endTag' string.Empty);                  }                    // - foo.</i>                  // - bar.</i>                  if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.Contains(endTag + Environment.NewLine' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      text = text.Replace(endTag' string.Empty);                      text = beginTag + text + endTag;                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.StartsWith(endTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      text = text.Remove(firstIndex' endTag.Length).Insert(firstIndex' beginTag);                  }                    // <i>Foo</i>                  // <i>Bar</i>                  if (italicBeginTagCount == 2 && italicEndTagCount == 2 && noOfLines == 2)                  {                      int index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      if (index > 0 && text.Length > index + (beginTag.Length + endTag.Length))                      {                          var firstLine = text.Substring(0' index).Trim();                          var secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                            if (firstLine.Length > 10 && firstLine.StartsWith("- <i>"' StringComparison.Ordinal) && firstLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = "<i>- " + firstLine.Remove(0' 5) + Environment.NewLine + secondLine;                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                          if (secondLine.Length > 10 && secondLine.StartsWith("- <i>"' StringComparison.Ordinal) && secondLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = firstLine + Environment.NewLine + "<i>- " + secondLine.Remove(0' 5);                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                            if (Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag))                          {                              text = text.Replace(beginTag' string.Empty).Replace(endTag' string.Empty).Trim();                              text = beginTag + text + endTag;                          }                      }                        //FALCONE:<i> I didn't think</i><br /><i>it was going to be you'</i>                      var colIdx = text.IndexOf(':');                      if (colIdx >= 0 && Utilities.CountTagInText(text' beginTag) + Utilities.CountTagInText(text' endTag) == 4 && text.Length > colIdx + 1 && !char.IsDigit(text[colIdx + 1]))                      {                          var firstLine = text.Substring(0' index);                          var secondLine = text.Substring(index).TrimStart();                            var secIdxCol = secondLine.IndexOf(':');                          if (secIdxCol < 0 || !Utilities.IsBetweenNumbers(secondLine' secIdxCol))                          {                              var idx = firstLine.IndexOf(':');                              if (idx > 1)                              {                                  var pre = text.Substring(0' idx + 1).TrimStart();                                  text = text.Remove(0' idx + 1);                                  text = FixInvalidItalicTags(text).Trim();                                  if (text.StartsWith("<i> "' StringComparison.OrdinalIgnoreCase))                                      text = Utilities.RemoveSpaceBeforeAfterTag(text' beginTag);                                  text = pre + " " + text;                              }                          }                      }                  }                    //<i>- You think they're they gone?<i>                  //<i>- That can't be.</i>                  if (italicBeginTagCount == 3 && italicEndTagCount == 1 && noOfLines == 2)                  {                      var newLineIdx = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      var firstLine = text.Substring(0' newLineIdx).Trim();                      var secondLine = text.Substring(newLineIdx).Trim();                        if ((Utilities.StartsAndEndsWithTag(firstLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag)) ||                          (Utilities.StartsAndEndsWithTag(secondLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag)))                      {                          text = text.Replace(beginTag' string.Empty);                          text = text.Replace(endTag' string.Empty);                          text = text.Replace("  "' " ").Trim();                          text = beginTag + text + endTag;                      }                  }                    if (noOfLines == 3)                  {                      var lines = text.SplitToLines();                      if ((italicBeginTagCount == 3 && italicEndTagCount == 2) || (italicBeginTagCount == 2 && italicEndTagCount == 3))                      {                          int numberOfItalics = 0;                          foreach (var line in lines)                          {                              if (line.StartsWith(beginTag' StringComparison.Ordinal))                                  numberOfItalics++;                              if (line.EndsWith(endTag' StringComparison.Ordinal))                                  numberOfItalics++;                          }                          if (numberOfItalics == 5)                          { // fix missing tag                              text = "<i>" + text.Replace("<i>"' string.Empty).Replace("</i>"' string.Empty) + "</i>";                          }                      }                  }                    text = text.Replace("<i></i>"' string.Empty);                  text = text.Replace("<i> </i>"' string.Empty);                  text = text.Replace("<i>  </i>"' string.Empty);              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The following statement contains a magic number: if (italicBeginTagCount + italicEndTagCount > 0)              {                  if (italicBeginTagCount == 1 && italicEndTagCount == 1 && text.IndexOf(beginTag' StringComparison.Ordinal) > text.IndexOf(endTag' StringComparison.Ordinal))                  {                      const string pattern = "___________@";                      text = text.Replace(beginTag' pattern);                      text = text.Replace(endTag' beginTag);                      text = text.Replace(pattern' endTag);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 0)                  {                      int firstIndex = text.IndexOf(beginTag' StringComparison.Ordinal);                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      if (noOfLines == 2 && lastIndex == lastIndexWithNewLine && firstIndex < 2)                          text = text.Replace(Environment.NewLine' endTag + Environment.NewLine) + endTag;                      else                          text = text.Remove(lastIndex' beginTag.Length).Insert(lastIndex' endTag);                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 2)                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      if (text.StartsWith("</i>-<i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i> -"' StringComparison.Ordinal) ||                          text.StartsWith("</i>-<i> -"' StringComparison.Ordinal))                          text = text.Remove(0' 5);                      else if (firstIndex == 0)                          text = text.Remove(0' 4);                      else                          text = text.Substring(0' firstIndex) + text.Substring(firstIndex + endTag.Length);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 1)                  {                      var lines = text.SplitToLines();                      if (lines.Length == 2 && lines[0].StartsWith(beginTag' StringComparison.Ordinal) && lines[0].EndsWith(endTag' StringComparison.Ordinal) &&                          lines[1].StartsWith(beginTag' StringComparison.Ordinal))                      {                          text = text.TrimEnd() + endTag;                      }                      else                      {                          int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                          if (text.Length > lastIndex + endTag.Length)                              text = text.Substring(0' lastIndex) + text.Substring(lastIndex - 1 + endTag.Length);                          else                              text = text.Substring(0' lastIndex - 1) + endTag;                      }                      if (text.StartsWith(beginTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal) && text.Contains(endTag + Environment.NewLine + beginTag))                      {                          text = text.Replace(endTag + Environment.NewLine + beginTag' Environment.NewLine);                      }                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 0)                  {                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                        if (text.StartsWith(beginTag' StringComparison.Ordinal))                          text += endTag;                      else if (noOfLines == 2 && lastIndex == lastIndexWithNewLine)                          text += endTag;                      else                          text = text.Replace(beginTag' string.Empty);                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 1)                  {                      var cleanText = RemoveOpenCloseTags(text' TagItalic' TagBold' TagUnderline' TagCyrillicI);                      bool isFixed = false;                        // Foo.</i>                      if (text.EndsWith(endTag' StringComparison.Ordinal) && !cleanText.StartsWith("-") && !cleanText.Contains(Environment.NewLine + "-"))                      {                          text = beginTag + text;                          isFixed = true;                      }                        // - Foo</i> | - Foo.                      // - Bar.    | - Foo.</i>                      if (!isFixed && Utilities.GetNumberOfLines(cleanText) == 2)                      {                          int newLineIndex = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                          if (newLineIndex > 0)                          {                              var firstLine = text.Substring(0' newLineIndex).Trim();                              var secondLine = text.Substring(newLineIndex + 2).Trim();                              if (firstLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  firstLine = beginTag + firstLine;                                  isFixed = true;                              }                              if (secondLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  secondLine = beginTag + secondLine;                                  isFixed = true;                              }                              text = firstLine + Environment.NewLine + secondLine;                          }                      }                      if (!isFixed)                          text = text.Replace(endTag' string.Empty);                  }                    // - foo.</i>                  // - bar.</i>                  if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.Contains(endTag + Environment.NewLine' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      text = text.Replace(endTag' string.Empty);                      text = beginTag + text + endTag;                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.StartsWith(endTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      text = text.Remove(firstIndex' endTag.Length).Insert(firstIndex' beginTag);                  }                    // <i>Foo</i>                  // <i>Bar</i>                  if (italicBeginTagCount == 2 && italicEndTagCount == 2 && noOfLines == 2)                  {                      int index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      if (index > 0 && text.Length > index + (beginTag.Length + endTag.Length))                      {                          var firstLine = text.Substring(0' index).Trim();                          var secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                            if (firstLine.Length > 10 && firstLine.StartsWith("- <i>"' StringComparison.Ordinal) && firstLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = "<i>- " + firstLine.Remove(0' 5) + Environment.NewLine + secondLine;                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                          if (secondLine.Length > 10 && secondLine.StartsWith("- <i>"' StringComparison.Ordinal) && secondLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = firstLine + Environment.NewLine + "<i>- " + secondLine.Remove(0' 5);                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                            if (Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag))                          {                              text = text.Replace(beginTag' string.Empty).Replace(endTag' string.Empty).Trim();                              text = beginTag + text + endTag;                          }                      }                        //FALCONE:<i> I didn't think</i><br /><i>it was going to be you'</i>                      var colIdx = text.IndexOf(':');                      if (colIdx >= 0 && Utilities.CountTagInText(text' beginTag) + Utilities.CountTagInText(text' endTag) == 4 && text.Length > colIdx + 1 && !char.IsDigit(text[colIdx + 1]))                      {                          var firstLine = text.Substring(0' index);                          var secondLine = text.Substring(index).TrimStart();                            var secIdxCol = secondLine.IndexOf(':');                          if (secIdxCol < 0 || !Utilities.IsBetweenNumbers(secondLine' secIdxCol))                          {                              var idx = firstLine.IndexOf(':');                              if (idx > 1)                              {                                  var pre = text.Substring(0' idx + 1).TrimStart();                                  text = text.Remove(0' idx + 1);                                  text = FixInvalidItalicTags(text).Trim();                                  if (text.StartsWith("<i> "' StringComparison.OrdinalIgnoreCase))                                      text = Utilities.RemoveSpaceBeforeAfterTag(text' beginTag);                                  text = pre + " " + text;                              }                          }                      }                  }                    //<i>- You think they're they gone?<i>                  //<i>- That can't be.</i>                  if (italicBeginTagCount == 3 && italicEndTagCount == 1 && noOfLines == 2)                  {                      var newLineIdx = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      var firstLine = text.Substring(0' newLineIdx).Trim();                      var secondLine = text.Substring(newLineIdx).Trim();                        if ((Utilities.StartsAndEndsWithTag(firstLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag)) ||                          (Utilities.StartsAndEndsWithTag(secondLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag)))                      {                          text = text.Replace(beginTag' string.Empty);                          text = text.Replace(endTag' string.Empty);                          text = text.Replace("  "' " ").Trim();                          text = beginTag + text + endTag;                      }                  }                    if (noOfLines == 3)                  {                      var lines = text.SplitToLines();                      if ((italicBeginTagCount == 3 && italicEndTagCount == 2) || (italicBeginTagCount == 2 && italicEndTagCount == 3))                      {                          int numberOfItalics = 0;                          foreach (var line in lines)                          {                              if (line.StartsWith(beginTag' StringComparison.Ordinal))                                  numberOfItalics++;                              if (line.EndsWith(endTag' StringComparison.Ordinal))                                  numberOfItalics++;                          }                          if (numberOfItalics == 5)                          { // fix missing tag                              text = "<i>" + text.Replace("<i>"' string.Empty).Replace("</i>"' string.Empty) + "</i>";                          }                      }                  }                    text = text.Replace("<i></i>"' string.Empty);                  text = text.Replace("<i> </i>"' string.Empty);                  text = text.Replace("<i>  </i>"' string.Empty);              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The following statement contains a magic number: if (italicBeginTagCount + italicEndTagCount > 0)              {                  if (italicBeginTagCount == 1 && italicEndTagCount == 1 && text.IndexOf(beginTag' StringComparison.Ordinal) > text.IndexOf(endTag' StringComparison.Ordinal))                  {                      const string pattern = "___________@";                      text = text.Replace(beginTag' pattern);                      text = text.Replace(endTag' beginTag);                      text = text.Replace(pattern' endTag);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 0)                  {                      int firstIndex = text.IndexOf(beginTag' StringComparison.Ordinal);                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      if (noOfLines == 2 && lastIndex == lastIndexWithNewLine && firstIndex < 2)                          text = text.Replace(Environment.NewLine' endTag + Environment.NewLine) + endTag;                      else                          text = text.Remove(lastIndex' beginTag.Length).Insert(lastIndex' endTag);                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 2)                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      if (text.StartsWith("</i>-<i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i> -"' StringComparison.Ordinal) ||                          text.StartsWith("</i>-<i> -"' StringComparison.Ordinal))                          text = text.Remove(0' 5);                      else if (firstIndex == 0)                          text = text.Remove(0' 4);                      else                          text = text.Substring(0' firstIndex) + text.Substring(firstIndex + endTag.Length);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 1)                  {                      var lines = text.SplitToLines();                      if (lines.Length == 2 && lines[0].StartsWith(beginTag' StringComparison.Ordinal) && lines[0].EndsWith(endTag' StringComparison.Ordinal) &&                          lines[1].StartsWith(beginTag' StringComparison.Ordinal))                      {                          text = text.TrimEnd() + endTag;                      }                      else                      {                          int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                          if (text.Length > lastIndex + endTag.Length)                              text = text.Substring(0' lastIndex) + text.Substring(lastIndex - 1 + endTag.Length);                          else                              text = text.Substring(0' lastIndex - 1) + endTag;                      }                      if (text.StartsWith(beginTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal) && text.Contains(endTag + Environment.NewLine + beginTag))                      {                          text = text.Replace(endTag + Environment.NewLine + beginTag' Environment.NewLine);                      }                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 0)                  {                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                        if (text.StartsWith(beginTag' StringComparison.Ordinal))                          text += endTag;                      else if (noOfLines == 2 && lastIndex == lastIndexWithNewLine)                          text += endTag;                      else                          text = text.Replace(beginTag' string.Empty);                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 1)                  {                      var cleanText = RemoveOpenCloseTags(text' TagItalic' TagBold' TagUnderline' TagCyrillicI);                      bool isFixed = false;                        // Foo.</i>                      if (text.EndsWith(endTag' StringComparison.Ordinal) && !cleanText.StartsWith("-") && !cleanText.Contains(Environment.NewLine + "-"))                      {                          text = beginTag + text;                          isFixed = true;                      }                        // - Foo</i> | - Foo.                      // - Bar.    | - Foo.</i>                      if (!isFixed && Utilities.GetNumberOfLines(cleanText) == 2)                      {                          int newLineIndex = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                          if (newLineIndex > 0)                          {                              var firstLine = text.Substring(0' newLineIndex).Trim();                              var secondLine = text.Substring(newLineIndex + 2).Trim();                              if (firstLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  firstLine = beginTag + firstLine;                                  isFixed = true;                              }                              if (secondLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  secondLine = beginTag + secondLine;                                  isFixed = true;                              }                              text = firstLine + Environment.NewLine + secondLine;                          }                      }                      if (!isFixed)                          text = text.Replace(endTag' string.Empty);                  }                    // - foo.</i>                  // - bar.</i>                  if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.Contains(endTag + Environment.NewLine' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      text = text.Replace(endTag' string.Empty);                      text = beginTag + text + endTag;                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.StartsWith(endTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      text = text.Remove(firstIndex' endTag.Length).Insert(firstIndex' beginTag);                  }                    // <i>Foo</i>                  // <i>Bar</i>                  if (italicBeginTagCount == 2 && italicEndTagCount == 2 && noOfLines == 2)                  {                      int index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      if (index > 0 && text.Length > index + (beginTag.Length + endTag.Length))                      {                          var firstLine = text.Substring(0' index).Trim();                          var secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                            if (firstLine.Length > 10 && firstLine.StartsWith("- <i>"' StringComparison.Ordinal) && firstLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = "<i>- " + firstLine.Remove(0' 5) + Environment.NewLine + secondLine;                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                          if (secondLine.Length > 10 && secondLine.StartsWith("- <i>"' StringComparison.Ordinal) && secondLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = firstLine + Environment.NewLine + "<i>- " + secondLine.Remove(0' 5);                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                            if (Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag))                          {                              text = text.Replace(beginTag' string.Empty).Replace(endTag' string.Empty).Trim();                              text = beginTag + text + endTag;                          }                      }                        //FALCONE:<i> I didn't think</i><br /><i>it was going to be you'</i>                      var colIdx = text.IndexOf(':');                      if (colIdx >= 0 && Utilities.CountTagInText(text' beginTag) + Utilities.CountTagInText(text' endTag) == 4 && text.Length > colIdx + 1 && !char.IsDigit(text[colIdx + 1]))                      {                          var firstLine = text.Substring(0' index);                          var secondLine = text.Substring(index).TrimStart();                            var secIdxCol = secondLine.IndexOf(':');                          if (secIdxCol < 0 || !Utilities.IsBetweenNumbers(secondLine' secIdxCol))                          {                              var idx = firstLine.IndexOf(':');                              if (idx > 1)                              {                                  var pre = text.Substring(0' idx + 1).TrimStart();                                  text = text.Remove(0' idx + 1);                                  text = FixInvalidItalicTags(text).Trim();                                  if (text.StartsWith("<i> "' StringComparison.OrdinalIgnoreCase))                                      text = Utilities.RemoveSpaceBeforeAfterTag(text' beginTag);                                  text = pre + " " + text;                              }                          }                      }                  }                    //<i>- You think they're they gone?<i>                  //<i>- That can't be.</i>                  if (italicBeginTagCount == 3 && italicEndTagCount == 1 && noOfLines == 2)                  {                      var newLineIdx = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      var firstLine = text.Substring(0' newLineIdx).Trim();                      var secondLine = text.Substring(newLineIdx).Trim();                        if ((Utilities.StartsAndEndsWithTag(firstLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag)) ||                          (Utilities.StartsAndEndsWithTag(secondLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag)))                      {                          text = text.Replace(beginTag' string.Empty);                          text = text.Replace(endTag' string.Empty);                          text = text.Replace("  "' " ").Trim();                          text = beginTag + text + endTag;                      }                  }                    if (noOfLines == 3)                  {                      var lines = text.SplitToLines();                      if ((italicBeginTagCount == 3 && italicEndTagCount == 2) || (italicBeginTagCount == 2 && italicEndTagCount == 3))                      {                          int numberOfItalics = 0;                          foreach (var line in lines)                          {                              if (line.StartsWith(beginTag' StringComparison.Ordinal))                                  numberOfItalics++;                              if (line.EndsWith(endTag' StringComparison.Ordinal))                                  numberOfItalics++;                          }                          if (numberOfItalics == 5)                          { // fix missing tag                              text = "<i>" + text.Replace("<i>"' string.Empty).Replace("</i>"' string.Empty) + "</i>";                          }                      }                  }                    text = text.Replace("<i></i>"' string.Empty);                  text = text.Replace("<i> </i>"' string.Empty);                  text = text.Replace("<i>  </i>"' string.Empty);              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The following statement contains a magic number: if (italicBeginTagCount + italicEndTagCount > 0)              {                  if (italicBeginTagCount == 1 && italicEndTagCount == 1 && text.IndexOf(beginTag' StringComparison.Ordinal) > text.IndexOf(endTag' StringComparison.Ordinal))                  {                      const string pattern = "___________@";                      text = text.Replace(beginTag' pattern);                      text = text.Replace(endTag' beginTag);                      text = text.Replace(pattern' endTag);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 0)                  {                      int firstIndex = text.IndexOf(beginTag' StringComparison.Ordinal);                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      if (noOfLines == 2 && lastIndex == lastIndexWithNewLine && firstIndex < 2)                          text = text.Replace(Environment.NewLine' endTag + Environment.NewLine) + endTag;                      else                          text = text.Remove(lastIndex' beginTag.Length).Insert(lastIndex' endTag);                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 2)                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      if (text.StartsWith("</i>-<i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i> -"' StringComparison.Ordinal) ||                          text.StartsWith("</i>-<i> -"' StringComparison.Ordinal))                          text = text.Remove(0' 5);                      else if (firstIndex == 0)                          text = text.Remove(0' 4);                      else                          text = text.Substring(0' firstIndex) + text.Substring(firstIndex + endTag.Length);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 1)                  {                      var lines = text.SplitToLines();                      if (lines.Length == 2 && lines[0].StartsWith(beginTag' StringComparison.Ordinal) && lines[0].EndsWith(endTag' StringComparison.Ordinal) &&                          lines[1].StartsWith(beginTag' StringComparison.Ordinal))                      {                          text = text.TrimEnd() + endTag;                      }                      else                      {                          int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                          if (text.Length > lastIndex + endTag.Length)                              text = text.Substring(0' lastIndex) + text.Substring(lastIndex - 1 + endTag.Length);                          else                              text = text.Substring(0' lastIndex - 1) + endTag;                      }                      if (text.StartsWith(beginTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal) && text.Contains(endTag + Environment.NewLine + beginTag))                      {                          text = text.Replace(endTag + Environment.NewLine + beginTag' Environment.NewLine);                      }                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 0)                  {                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                        if (text.StartsWith(beginTag' StringComparison.Ordinal))                          text += endTag;                      else if (noOfLines == 2 && lastIndex == lastIndexWithNewLine)                          text += endTag;                      else                          text = text.Replace(beginTag' string.Empty);                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 1)                  {                      var cleanText = RemoveOpenCloseTags(text' TagItalic' TagBold' TagUnderline' TagCyrillicI);                      bool isFixed = false;                        // Foo.</i>                      if (text.EndsWith(endTag' StringComparison.Ordinal) && !cleanText.StartsWith("-") && !cleanText.Contains(Environment.NewLine + "-"))                      {                          text = beginTag + text;                          isFixed = true;                      }                        // - Foo</i> | - Foo.                      // - Bar.    | - Foo.</i>                      if (!isFixed && Utilities.GetNumberOfLines(cleanText) == 2)                      {                          int newLineIndex = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                          if (newLineIndex > 0)                          {                              var firstLine = text.Substring(0' newLineIndex).Trim();                              var secondLine = text.Substring(newLineIndex + 2).Trim();                              if (firstLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  firstLine = beginTag + firstLine;                                  isFixed = true;                              }                              if (secondLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  secondLine = beginTag + secondLine;                                  isFixed = true;                              }                              text = firstLine + Environment.NewLine + secondLine;                          }                      }                      if (!isFixed)                          text = text.Replace(endTag' string.Empty);                  }                    // - foo.</i>                  // - bar.</i>                  if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.Contains(endTag + Environment.NewLine' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      text = text.Replace(endTag' string.Empty);                      text = beginTag + text + endTag;                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.StartsWith(endTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      text = text.Remove(firstIndex' endTag.Length).Insert(firstIndex' beginTag);                  }                    // <i>Foo</i>                  // <i>Bar</i>                  if (italicBeginTagCount == 2 && italicEndTagCount == 2 && noOfLines == 2)                  {                      int index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      if (index > 0 && text.Length > index + (beginTag.Length + endTag.Length))                      {                          var firstLine = text.Substring(0' index).Trim();                          var secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                            if (firstLine.Length > 10 && firstLine.StartsWith("- <i>"' StringComparison.Ordinal) && firstLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = "<i>- " + firstLine.Remove(0' 5) + Environment.NewLine + secondLine;                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                          if (secondLine.Length > 10 && secondLine.StartsWith("- <i>"' StringComparison.Ordinal) && secondLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = firstLine + Environment.NewLine + "<i>- " + secondLine.Remove(0' 5);                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                            if (Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag))                          {                              text = text.Replace(beginTag' string.Empty).Replace(endTag' string.Empty).Trim();                              text = beginTag + text + endTag;                          }                      }                        //FALCONE:<i> I didn't think</i><br /><i>it was going to be you'</i>                      var colIdx = text.IndexOf(':');                      if (colIdx >= 0 && Utilities.CountTagInText(text' beginTag) + Utilities.CountTagInText(text' endTag) == 4 && text.Length > colIdx + 1 && !char.IsDigit(text[colIdx + 1]))                      {                          var firstLine = text.Substring(0' index);                          var secondLine = text.Substring(index).TrimStart();                            var secIdxCol = secondLine.IndexOf(':');                          if (secIdxCol < 0 || !Utilities.IsBetweenNumbers(secondLine' secIdxCol))                          {                              var idx = firstLine.IndexOf(':');                              if (idx > 1)                              {                                  var pre = text.Substring(0' idx + 1).TrimStart();                                  text = text.Remove(0' idx + 1);                                  text = FixInvalidItalicTags(text).Trim();                                  if (text.StartsWith("<i> "' StringComparison.OrdinalIgnoreCase))                                      text = Utilities.RemoveSpaceBeforeAfterTag(text' beginTag);                                  text = pre + " " + text;                              }                          }                      }                  }                    //<i>- You think they're they gone?<i>                  //<i>- That can't be.</i>                  if (italicBeginTagCount == 3 && italicEndTagCount == 1 && noOfLines == 2)                  {                      var newLineIdx = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      var firstLine = text.Substring(0' newLineIdx).Trim();                      var secondLine = text.Substring(newLineIdx).Trim();                        if ((Utilities.StartsAndEndsWithTag(firstLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag)) ||                          (Utilities.StartsAndEndsWithTag(secondLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag)))                      {                          text = text.Replace(beginTag' string.Empty);                          text = text.Replace(endTag' string.Empty);                          text = text.Replace("  "' " ").Trim();                          text = beginTag + text + endTag;                      }                  }                    if (noOfLines == 3)                  {                      var lines = text.SplitToLines();                      if ((italicBeginTagCount == 3 && italicEndTagCount == 2) || (italicBeginTagCount == 2 && italicEndTagCount == 3))                      {                          int numberOfItalics = 0;                          foreach (var line in lines)                          {                              if (line.StartsWith(beginTag' StringComparison.Ordinal))                                  numberOfItalics++;                              if (line.EndsWith(endTag' StringComparison.Ordinal))                                  numberOfItalics++;                          }                          if (numberOfItalics == 5)                          { // fix missing tag                              text = "<i>" + text.Replace("<i>"' string.Empty).Replace("</i>"' string.Empty) + "</i>";                          }                      }                  }                    text = text.Replace("<i></i>"' string.Empty);                  text = text.Replace("<i> </i>"' string.Empty);                  text = text.Replace("<i>  </i>"' string.Empty);              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The following statement contains a magic number: if (italicBeginTagCount + italicEndTagCount > 0)              {                  if (italicBeginTagCount == 1 && italicEndTagCount == 1 && text.IndexOf(beginTag' StringComparison.Ordinal) > text.IndexOf(endTag' StringComparison.Ordinal))                  {                      const string pattern = "___________@";                      text = text.Replace(beginTag' pattern);                      text = text.Replace(endTag' beginTag);                      text = text.Replace(pattern' endTag);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 0)                  {                      int firstIndex = text.IndexOf(beginTag' StringComparison.Ordinal);                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      if (noOfLines == 2 && lastIndex == lastIndexWithNewLine && firstIndex < 2)                          text = text.Replace(Environment.NewLine' endTag + Environment.NewLine) + endTag;                      else                          text = text.Remove(lastIndex' beginTag.Length).Insert(lastIndex' endTag);                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 2)                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      if (text.StartsWith("</i>-<i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i> -"' StringComparison.Ordinal) ||                          text.StartsWith("</i>-<i> -"' StringComparison.Ordinal))                          text = text.Remove(0' 5);                      else if (firstIndex == 0)                          text = text.Remove(0' 4);                      else                          text = text.Substring(0' firstIndex) + text.Substring(firstIndex + endTag.Length);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 1)                  {                      var lines = text.SplitToLines();                      if (lines.Length == 2 && lines[0].StartsWith(beginTag' StringComparison.Ordinal) && lines[0].EndsWith(endTag' StringComparison.Ordinal) &&                          lines[1].StartsWith(beginTag' StringComparison.Ordinal))                      {                          text = text.TrimEnd() + endTag;                      }                      else                      {                          int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                          if (text.Length > lastIndex + endTag.Length)                              text = text.Substring(0' lastIndex) + text.Substring(lastIndex - 1 + endTag.Length);                          else                              text = text.Substring(0' lastIndex - 1) + endTag;                      }                      if (text.StartsWith(beginTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal) && text.Contains(endTag + Environment.NewLine + beginTag))                      {                          text = text.Replace(endTag + Environment.NewLine + beginTag' Environment.NewLine);                      }                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 0)                  {                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                        if (text.StartsWith(beginTag' StringComparison.Ordinal))                          text += endTag;                      else if (noOfLines == 2 && lastIndex == lastIndexWithNewLine)                          text += endTag;                      else                          text = text.Replace(beginTag' string.Empty);                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 1)                  {                      var cleanText = RemoveOpenCloseTags(text' TagItalic' TagBold' TagUnderline' TagCyrillicI);                      bool isFixed = false;                        // Foo.</i>                      if (text.EndsWith(endTag' StringComparison.Ordinal) && !cleanText.StartsWith("-") && !cleanText.Contains(Environment.NewLine + "-"))                      {                          text = beginTag + text;                          isFixed = true;                      }                        // - Foo</i> | - Foo.                      // - Bar.    | - Foo.</i>                      if (!isFixed && Utilities.GetNumberOfLines(cleanText) == 2)                      {                          int newLineIndex = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                          if (newLineIndex > 0)                          {                              var firstLine = text.Substring(0' newLineIndex).Trim();                              var secondLine = text.Substring(newLineIndex + 2).Trim();                              if (firstLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  firstLine = beginTag + firstLine;                                  isFixed = true;                              }                              if (secondLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  secondLine = beginTag + secondLine;                                  isFixed = true;                              }                              text = firstLine + Environment.NewLine + secondLine;                          }                      }                      if (!isFixed)                          text = text.Replace(endTag' string.Empty);                  }                    // - foo.</i>                  // - bar.</i>                  if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.Contains(endTag + Environment.NewLine' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      text = text.Replace(endTag' string.Empty);                      text = beginTag + text + endTag;                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.StartsWith(endTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      text = text.Remove(firstIndex' endTag.Length).Insert(firstIndex' beginTag);                  }                    // <i>Foo</i>                  // <i>Bar</i>                  if (italicBeginTagCount == 2 && italicEndTagCount == 2 && noOfLines == 2)                  {                      int index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      if (index > 0 && text.Length > index + (beginTag.Length + endTag.Length))                      {                          var firstLine = text.Substring(0' index).Trim();                          var secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                            if (firstLine.Length > 10 && firstLine.StartsWith("- <i>"' StringComparison.Ordinal) && firstLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = "<i>- " + firstLine.Remove(0' 5) + Environment.NewLine + secondLine;                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                          if (secondLine.Length > 10 && secondLine.StartsWith("- <i>"' StringComparison.Ordinal) && secondLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = firstLine + Environment.NewLine + "<i>- " + secondLine.Remove(0' 5);                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                            if (Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag))                          {                              text = text.Replace(beginTag' string.Empty).Replace(endTag' string.Empty).Trim();                              text = beginTag + text + endTag;                          }                      }                        //FALCONE:<i> I didn't think</i><br /><i>it was going to be you'</i>                      var colIdx = text.IndexOf(':');                      if (colIdx >= 0 && Utilities.CountTagInText(text' beginTag) + Utilities.CountTagInText(text' endTag) == 4 && text.Length > colIdx + 1 && !char.IsDigit(text[colIdx + 1]))                      {                          var firstLine = text.Substring(0' index);                          var secondLine = text.Substring(index).TrimStart();                            var secIdxCol = secondLine.IndexOf(':');                          if (secIdxCol < 0 || !Utilities.IsBetweenNumbers(secondLine' secIdxCol))                          {                              var idx = firstLine.IndexOf(':');                              if (idx > 1)                              {                                  var pre = text.Substring(0' idx + 1).TrimStart();                                  text = text.Remove(0' idx + 1);                                  text = FixInvalidItalicTags(text).Trim();                                  if (text.StartsWith("<i> "' StringComparison.OrdinalIgnoreCase))                                      text = Utilities.RemoveSpaceBeforeAfterTag(text' beginTag);                                  text = pre + " " + text;                              }                          }                      }                  }                    //<i>- You think they're they gone?<i>                  //<i>- That can't be.</i>                  if (italicBeginTagCount == 3 && italicEndTagCount == 1 && noOfLines == 2)                  {                      var newLineIdx = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      var firstLine = text.Substring(0' newLineIdx).Trim();                      var secondLine = text.Substring(newLineIdx).Trim();                        if ((Utilities.StartsAndEndsWithTag(firstLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag)) ||                          (Utilities.StartsAndEndsWithTag(secondLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag)))                      {                          text = text.Replace(beginTag' string.Empty);                          text = text.Replace(endTag' string.Empty);                          text = text.Replace("  "' " ").Trim();                          text = beginTag + text + endTag;                      }                  }                    if (noOfLines == 3)                  {                      var lines = text.SplitToLines();                      if ((italicBeginTagCount == 3 && italicEndTagCount == 2) || (italicBeginTagCount == 2 && italicEndTagCount == 3))                      {                          int numberOfItalics = 0;                          foreach (var line in lines)                          {                              if (line.StartsWith(beginTag' StringComparison.Ordinal))                                  numberOfItalics++;                              if (line.EndsWith(endTag' StringComparison.Ordinal))                                  numberOfItalics++;                          }                          if (numberOfItalics == 5)                          { // fix missing tag                              text = "<i>" + text.Replace("<i>"' string.Empty).Replace("</i>"' string.Empty) + "</i>";                          }                      }                  }                    text = text.Replace("<i></i>"' string.Empty);                  text = text.Replace("<i> </i>"' string.Empty);                  text = text.Replace("<i>  </i>"' string.Empty);              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The following statement contains a magic number: if (italicBeginTagCount + italicEndTagCount > 0)              {                  if (italicBeginTagCount == 1 && italicEndTagCount == 1 && text.IndexOf(beginTag' StringComparison.Ordinal) > text.IndexOf(endTag' StringComparison.Ordinal))                  {                      const string pattern = "___________@";                      text = text.Replace(beginTag' pattern);                      text = text.Replace(endTag' beginTag);                      text = text.Replace(pattern' endTag);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 0)                  {                      int firstIndex = text.IndexOf(beginTag' StringComparison.Ordinal);                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      if (noOfLines == 2 && lastIndex == lastIndexWithNewLine && firstIndex < 2)                          text = text.Replace(Environment.NewLine' endTag + Environment.NewLine) + endTag;                      else                          text = text.Remove(lastIndex' beginTag.Length).Insert(lastIndex' endTag);                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 2)                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      if (text.StartsWith("</i>-<i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i> -"' StringComparison.Ordinal) ||                          text.StartsWith("</i>-<i> -"' StringComparison.Ordinal))                          text = text.Remove(0' 5);                      else if (firstIndex == 0)                          text = text.Remove(0' 4);                      else                          text = text.Substring(0' firstIndex) + text.Substring(firstIndex + endTag.Length);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 1)                  {                      var lines = text.SplitToLines();                      if (lines.Length == 2 && lines[0].StartsWith(beginTag' StringComparison.Ordinal) && lines[0].EndsWith(endTag' StringComparison.Ordinal) &&                          lines[1].StartsWith(beginTag' StringComparison.Ordinal))                      {                          text = text.TrimEnd() + endTag;                      }                      else                      {                          int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                          if (text.Length > lastIndex + endTag.Length)                              text = text.Substring(0' lastIndex) + text.Substring(lastIndex - 1 + endTag.Length);                          else                              text = text.Substring(0' lastIndex - 1) + endTag;                      }                      if (text.StartsWith(beginTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal) && text.Contains(endTag + Environment.NewLine + beginTag))                      {                          text = text.Replace(endTag + Environment.NewLine + beginTag' Environment.NewLine);                      }                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 0)                  {                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                        if (text.StartsWith(beginTag' StringComparison.Ordinal))                          text += endTag;                      else if (noOfLines == 2 && lastIndex == lastIndexWithNewLine)                          text += endTag;                      else                          text = text.Replace(beginTag' string.Empty);                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 1)                  {                      var cleanText = RemoveOpenCloseTags(text' TagItalic' TagBold' TagUnderline' TagCyrillicI);                      bool isFixed = false;                        // Foo.</i>                      if (text.EndsWith(endTag' StringComparison.Ordinal) && !cleanText.StartsWith("-") && !cleanText.Contains(Environment.NewLine + "-"))                      {                          text = beginTag + text;                          isFixed = true;                      }                        // - Foo</i> | - Foo.                      // - Bar.    | - Foo.</i>                      if (!isFixed && Utilities.GetNumberOfLines(cleanText) == 2)                      {                          int newLineIndex = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                          if (newLineIndex > 0)                          {                              var firstLine = text.Substring(0' newLineIndex).Trim();                              var secondLine = text.Substring(newLineIndex + 2).Trim();                              if (firstLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  firstLine = beginTag + firstLine;                                  isFixed = true;                              }                              if (secondLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  secondLine = beginTag + secondLine;                                  isFixed = true;                              }                              text = firstLine + Environment.NewLine + secondLine;                          }                      }                      if (!isFixed)                          text = text.Replace(endTag' string.Empty);                  }                    // - foo.</i>                  // - bar.</i>                  if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.Contains(endTag + Environment.NewLine' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      text = text.Replace(endTag' string.Empty);                      text = beginTag + text + endTag;                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.StartsWith(endTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      text = text.Remove(firstIndex' endTag.Length).Insert(firstIndex' beginTag);                  }                    // <i>Foo</i>                  // <i>Bar</i>                  if (italicBeginTagCount == 2 && italicEndTagCount == 2 && noOfLines == 2)                  {                      int index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      if (index > 0 && text.Length > index + (beginTag.Length + endTag.Length))                      {                          var firstLine = text.Substring(0' index).Trim();                          var secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                            if (firstLine.Length > 10 && firstLine.StartsWith("- <i>"' StringComparison.Ordinal) && firstLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = "<i>- " + firstLine.Remove(0' 5) + Environment.NewLine + secondLine;                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                          if (secondLine.Length > 10 && secondLine.StartsWith("- <i>"' StringComparison.Ordinal) && secondLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = firstLine + Environment.NewLine + "<i>- " + secondLine.Remove(0' 5);                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                            if (Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag))                          {                              text = text.Replace(beginTag' string.Empty).Replace(endTag' string.Empty).Trim();                              text = beginTag + text + endTag;                          }                      }                        //FALCONE:<i> I didn't think</i><br /><i>it was going to be you'</i>                      var colIdx = text.IndexOf(':');                      if (colIdx >= 0 && Utilities.CountTagInText(text' beginTag) + Utilities.CountTagInText(text' endTag) == 4 && text.Length > colIdx + 1 && !char.IsDigit(text[colIdx + 1]))                      {                          var firstLine = text.Substring(0' index);                          var secondLine = text.Substring(index).TrimStart();                            var secIdxCol = secondLine.IndexOf(':');                          if (secIdxCol < 0 || !Utilities.IsBetweenNumbers(secondLine' secIdxCol))                          {                              var idx = firstLine.IndexOf(':');                              if (idx > 1)                              {                                  var pre = text.Substring(0' idx + 1).TrimStart();                                  text = text.Remove(0' idx + 1);                                  text = FixInvalidItalicTags(text).Trim();                                  if (text.StartsWith("<i> "' StringComparison.OrdinalIgnoreCase))                                      text = Utilities.RemoveSpaceBeforeAfterTag(text' beginTag);                                  text = pre + " " + text;                              }                          }                      }                  }                    //<i>- You think they're they gone?<i>                  //<i>- That can't be.</i>                  if (italicBeginTagCount == 3 && italicEndTagCount == 1 && noOfLines == 2)                  {                      var newLineIdx = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      var firstLine = text.Substring(0' newLineIdx).Trim();                      var secondLine = text.Substring(newLineIdx).Trim();                        if ((Utilities.StartsAndEndsWithTag(firstLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag)) ||                          (Utilities.StartsAndEndsWithTag(secondLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag)))                      {                          text = text.Replace(beginTag' string.Empty);                          text = text.Replace(endTag' string.Empty);                          text = text.Replace("  "' " ").Trim();                          text = beginTag + text + endTag;                      }                  }                    if (noOfLines == 3)                  {                      var lines = text.SplitToLines();                      if ((italicBeginTagCount == 3 && italicEndTagCount == 2) || (italicBeginTagCount == 2 && italicEndTagCount == 3))                      {                          int numberOfItalics = 0;                          foreach (var line in lines)                          {                              if (line.StartsWith(beginTag' StringComparison.Ordinal))                                  numberOfItalics++;                              if (line.EndsWith(endTag' StringComparison.Ordinal))                                  numberOfItalics++;                          }                          if (numberOfItalics == 5)                          { // fix missing tag                              text = "<i>" + text.Replace("<i>"' string.Empty).Replace("</i>"' string.Empty) + "</i>";                          }                      }                  }                    text = text.Replace("<i></i>"' string.Empty);                  text = text.Replace("<i> </i>"' string.Empty);                  text = text.Replace("<i>  </i>"' string.Empty);              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The following statement contains a magic number: if (italicBeginTagCount + italicEndTagCount > 0)              {                  if (italicBeginTagCount == 1 && italicEndTagCount == 1 && text.IndexOf(beginTag' StringComparison.Ordinal) > text.IndexOf(endTag' StringComparison.Ordinal))                  {                      const string pattern = "___________@";                      text = text.Replace(beginTag' pattern);                      text = text.Replace(endTag' beginTag);                      text = text.Replace(pattern' endTag);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 0)                  {                      int firstIndex = text.IndexOf(beginTag' StringComparison.Ordinal);                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      if (noOfLines == 2 && lastIndex == lastIndexWithNewLine && firstIndex < 2)                          text = text.Replace(Environment.NewLine' endTag + Environment.NewLine) + endTag;                      else                          text = text.Remove(lastIndex' beginTag.Length).Insert(lastIndex' endTag);                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 2)                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      if (text.StartsWith("</i>-<i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i> -"' StringComparison.Ordinal) ||                          text.StartsWith("</i>-<i> -"' StringComparison.Ordinal))                          text = text.Remove(0' 5);                      else if (firstIndex == 0)                          text = text.Remove(0' 4);                      else                          text = text.Substring(0' firstIndex) + text.Substring(firstIndex + endTag.Length);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 1)                  {                      var lines = text.SplitToLines();                      if (lines.Length == 2 && lines[0].StartsWith(beginTag' StringComparison.Ordinal) && lines[0].EndsWith(endTag' StringComparison.Ordinal) &&                          lines[1].StartsWith(beginTag' StringComparison.Ordinal))                      {                          text = text.TrimEnd() + endTag;                      }                      else                      {                          int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                          if (text.Length > lastIndex + endTag.Length)                              text = text.Substring(0' lastIndex) + text.Substring(lastIndex - 1 + endTag.Length);                          else                              text = text.Substring(0' lastIndex - 1) + endTag;                      }                      if (text.StartsWith(beginTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal) && text.Contains(endTag + Environment.NewLine + beginTag))                      {                          text = text.Replace(endTag + Environment.NewLine + beginTag' Environment.NewLine);                      }                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 0)                  {                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                        if (text.StartsWith(beginTag' StringComparison.Ordinal))                          text += endTag;                      else if (noOfLines == 2 && lastIndex == lastIndexWithNewLine)                          text += endTag;                      else                          text = text.Replace(beginTag' string.Empty);                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 1)                  {                      var cleanText = RemoveOpenCloseTags(text' TagItalic' TagBold' TagUnderline' TagCyrillicI);                      bool isFixed = false;                        // Foo.</i>                      if (text.EndsWith(endTag' StringComparison.Ordinal) && !cleanText.StartsWith("-") && !cleanText.Contains(Environment.NewLine + "-"))                      {                          text = beginTag + text;                          isFixed = true;                      }                        // - Foo</i> | - Foo.                      // - Bar.    | - Foo.</i>                      if (!isFixed && Utilities.GetNumberOfLines(cleanText) == 2)                      {                          int newLineIndex = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                          if (newLineIndex > 0)                          {                              var firstLine = text.Substring(0' newLineIndex).Trim();                              var secondLine = text.Substring(newLineIndex + 2).Trim();                              if (firstLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  firstLine = beginTag + firstLine;                                  isFixed = true;                              }                              if (secondLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  secondLine = beginTag + secondLine;                                  isFixed = true;                              }                              text = firstLine + Environment.NewLine + secondLine;                          }                      }                      if (!isFixed)                          text = text.Replace(endTag' string.Empty);                  }                    // - foo.</i>                  // - bar.</i>                  if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.Contains(endTag + Environment.NewLine' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      text = text.Replace(endTag' string.Empty);                      text = beginTag + text + endTag;                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.StartsWith(endTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      text = text.Remove(firstIndex' endTag.Length).Insert(firstIndex' beginTag);                  }                    // <i>Foo</i>                  // <i>Bar</i>                  if (italicBeginTagCount == 2 && italicEndTagCount == 2 && noOfLines == 2)                  {                      int index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      if (index > 0 && text.Length > index + (beginTag.Length + endTag.Length))                      {                          var firstLine = text.Substring(0' index).Trim();                          var secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                            if (firstLine.Length > 10 && firstLine.StartsWith("- <i>"' StringComparison.Ordinal) && firstLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = "<i>- " + firstLine.Remove(0' 5) + Environment.NewLine + secondLine;                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                          if (secondLine.Length > 10 && secondLine.StartsWith("- <i>"' StringComparison.Ordinal) && secondLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = firstLine + Environment.NewLine + "<i>- " + secondLine.Remove(0' 5);                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                            if (Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag))                          {                              text = text.Replace(beginTag' string.Empty).Replace(endTag' string.Empty).Trim();                              text = beginTag + text + endTag;                          }                      }                        //FALCONE:<i> I didn't think</i><br /><i>it was going to be you'</i>                      var colIdx = text.IndexOf(':');                      if (colIdx >= 0 && Utilities.CountTagInText(text' beginTag) + Utilities.CountTagInText(text' endTag) == 4 && text.Length > colIdx + 1 && !char.IsDigit(text[colIdx + 1]))                      {                          var firstLine = text.Substring(0' index);                          var secondLine = text.Substring(index).TrimStart();                            var secIdxCol = secondLine.IndexOf(':');                          if (secIdxCol < 0 || !Utilities.IsBetweenNumbers(secondLine' secIdxCol))                          {                              var idx = firstLine.IndexOf(':');                              if (idx > 1)                              {                                  var pre = text.Substring(0' idx + 1).TrimStart();                                  text = text.Remove(0' idx + 1);                                  text = FixInvalidItalicTags(text).Trim();                                  if (text.StartsWith("<i> "' StringComparison.OrdinalIgnoreCase))                                      text = Utilities.RemoveSpaceBeforeAfterTag(text' beginTag);                                  text = pre + " " + text;                              }                          }                      }                  }                    //<i>- You think they're they gone?<i>                  //<i>- That can't be.</i>                  if (italicBeginTagCount == 3 && italicEndTagCount == 1 && noOfLines == 2)                  {                      var newLineIdx = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      var firstLine = text.Substring(0' newLineIdx).Trim();                      var secondLine = text.Substring(newLineIdx).Trim();                        if ((Utilities.StartsAndEndsWithTag(firstLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag)) ||                          (Utilities.StartsAndEndsWithTag(secondLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag)))                      {                          text = text.Replace(beginTag' string.Empty);                          text = text.Replace(endTag' string.Empty);                          text = text.Replace("  "' " ").Trim();                          text = beginTag + text + endTag;                      }                  }                    if (noOfLines == 3)                  {                      var lines = text.SplitToLines();                      if ((italicBeginTagCount == 3 && italicEndTagCount == 2) || (italicBeginTagCount == 2 && italicEndTagCount == 3))                      {                          int numberOfItalics = 0;                          foreach (var line in lines)                          {                              if (line.StartsWith(beginTag' StringComparison.Ordinal))                                  numberOfItalics++;                              if (line.EndsWith(endTag' StringComparison.Ordinal))                                  numberOfItalics++;                          }                          if (numberOfItalics == 5)                          { // fix missing tag                              text = "<i>" + text.Replace("<i>"' string.Empty).Replace("</i>"' string.Empty) + "</i>";                          }                      }                  }                    text = text.Replace("<i></i>"' string.Empty);                  text = text.Replace("<i> </i>"' string.Empty);                  text = text.Replace("<i>  </i>"' string.Empty);              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The following statement contains a magic number: if (italicBeginTagCount + italicEndTagCount > 0)              {                  if (italicBeginTagCount == 1 && italicEndTagCount == 1 && text.IndexOf(beginTag' StringComparison.Ordinal) > text.IndexOf(endTag' StringComparison.Ordinal))                  {                      const string pattern = "___________@";                      text = text.Replace(beginTag' pattern);                      text = text.Replace(endTag' beginTag);                      text = text.Replace(pattern' endTag);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 0)                  {                      int firstIndex = text.IndexOf(beginTag' StringComparison.Ordinal);                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      if (noOfLines == 2 && lastIndex == lastIndexWithNewLine && firstIndex < 2)                          text = text.Replace(Environment.NewLine' endTag + Environment.NewLine) + endTag;                      else                          text = text.Remove(lastIndex' beginTag.Length).Insert(lastIndex' endTag);                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 2)                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      if (text.StartsWith("</i>-<i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i> -"' StringComparison.Ordinal) ||                          text.StartsWith("</i>-<i> -"' StringComparison.Ordinal))                          text = text.Remove(0' 5);                      else if (firstIndex == 0)                          text = text.Remove(0' 4);                      else                          text = text.Substring(0' firstIndex) + text.Substring(firstIndex + endTag.Length);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 1)                  {                      var lines = text.SplitToLines();                      if (lines.Length == 2 && lines[0].StartsWith(beginTag' StringComparison.Ordinal) && lines[0].EndsWith(endTag' StringComparison.Ordinal) &&                          lines[1].StartsWith(beginTag' StringComparison.Ordinal))                      {                          text = text.TrimEnd() + endTag;                      }                      else                      {                          int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                          if (text.Length > lastIndex + endTag.Length)                              text = text.Substring(0' lastIndex) + text.Substring(lastIndex - 1 + endTag.Length);                          else                              text = text.Substring(0' lastIndex - 1) + endTag;                      }                      if (text.StartsWith(beginTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal) && text.Contains(endTag + Environment.NewLine + beginTag))                      {                          text = text.Replace(endTag + Environment.NewLine + beginTag' Environment.NewLine);                      }                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 0)                  {                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                        if (text.StartsWith(beginTag' StringComparison.Ordinal))                          text += endTag;                      else if (noOfLines == 2 && lastIndex == lastIndexWithNewLine)                          text += endTag;                      else                          text = text.Replace(beginTag' string.Empty);                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 1)                  {                      var cleanText = RemoveOpenCloseTags(text' TagItalic' TagBold' TagUnderline' TagCyrillicI);                      bool isFixed = false;                        // Foo.</i>                      if (text.EndsWith(endTag' StringComparison.Ordinal) && !cleanText.StartsWith("-") && !cleanText.Contains(Environment.NewLine + "-"))                      {                          text = beginTag + text;                          isFixed = true;                      }                        // - Foo</i> | - Foo.                      // - Bar.    | - Foo.</i>                      if (!isFixed && Utilities.GetNumberOfLines(cleanText) == 2)                      {                          int newLineIndex = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                          if (newLineIndex > 0)                          {                              var firstLine = text.Substring(0' newLineIndex).Trim();                              var secondLine = text.Substring(newLineIndex + 2).Trim();                              if (firstLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  firstLine = beginTag + firstLine;                                  isFixed = true;                              }                              if (secondLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  secondLine = beginTag + secondLine;                                  isFixed = true;                              }                              text = firstLine + Environment.NewLine + secondLine;                          }                      }                      if (!isFixed)                          text = text.Replace(endTag' string.Empty);                  }                    // - foo.</i>                  // - bar.</i>                  if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.Contains(endTag + Environment.NewLine' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      text = text.Replace(endTag' string.Empty);                      text = beginTag + text + endTag;                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.StartsWith(endTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      text = text.Remove(firstIndex' endTag.Length).Insert(firstIndex' beginTag);                  }                    // <i>Foo</i>                  // <i>Bar</i>                  if (italicBeginTagCount == 2 && italicEndTagCount == 2 && noOfLines == 2)                  {                      int index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      if (index > 0 && text.Length > index + (beginTag.Length + endTag.Length))                      {                          var firstLine = text.Substring(0' index).Trim();                          var secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                            if (firstLine.Length > 10 && firstLine.StartsWith("- <i>"' StringComparison.Ordinal) && firstLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = "<i>- " + firstLine.Remove(0' 5) + Environment.NewLine + secondLine;                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                          if (secondLine.Length > 10 && secondLine.StartsWith("- <i>"' StringComparison.Ordinal) && secondLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = firstLine + Environment.NewLine + "<i>- " + secondLine.Remove(0' 5);                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                            if (Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag))                          {                              text = text.Replace(beginTag' string.Empty).Replace(endTag' string.Empty).Trim();                              text = beginTag + text + endTag;                          }                      }                        //FALCONE:<i> I didn't think</i><br /><i>it was going to be you'</i>                      var colIdx = text.IndexOf(':');                      if (colIdx >= 0 && Utilities.CountTagInText(text' beginTag) + Utilities.CountTagInText(text' endTag) == 4 && text.Length > colIdx + 1 && !char.IsDigit(text[colIdx + 1]))                      {                          var firstLine = text.Substring(0' index);                          var secondLine = text.Substring(index).TrimStart();                            var secIdxCol = secondLine.IndexOf(':');                          if (secIdxCol < 0 || !Utilities.IsBetweenNumbers(secondLine' secIdxCol))                          {                              var idx = firstLine.IndexOf(':');                              if (idx > 1)                              {                                  var pre = text.Substring(0' idx + 1).TrimStart();                                  text = text.Remove(0' idx + 1);                                  text = FixInvalidItalicTags(text).Trim();                                  if (text.StartsWith("<i> "' StringComparison.OrdinalIgnoreCase))                                      text = Utilities.RemoveSpaceBeforeAfterTag(text' beginTag);                                  text = pre + " " + text;                              }                          }                      }                  }                    //<i>- You think they're they gone?<i>                  //<i>- That can't be.</i>                  if (italicBeginTagCount == 3 && italicEndTagCount == 1 && noOfLines == 2)                  {                      var newLineIdx = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      var firstLine = text.Substring(0' newLineIdx).Trim();                      var secondLine = text.Substring(newLineIdx).Trim();                        if ((Utilities.StartsAndEndsWithTag(firstLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag)) ||                          (Utilities.StartsAndEndsWithTag(secondLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag)))                      {                          text = text.Replace(beginTag' string.Empty);                          text = text.Replace(endTag' string.Empty);                          text = text.Replace("  "' " ").Trim();                          text = beginTag + text + endTag;                      }                  }                    if (noOfLines == 3)                  {                      var lines = text.SplitToLines();                      if ((italicBeginTagCount == 3 && italicEndTagCount == 2) || (italicBeginTagCount == 2 && italicEndTagCount == 3))                      {                          int numberOfItalics = 0;                          foreach (var line in lines)                          {                              if (line.StartsWith(beginTag' StringComparison.Ordinal))                                  numberOfItalics++;                              if (line.EndsWith(endTag' StringComparison.Ordinal))                                  numberOfItalics++;                          }                          if (numberOfItalics == 5)                          { // fix missing tag                              text = "<i>" + text.Replace("<i>"' string.Empty).Replace("</i>"' string.Empty) + "</i>";                          }                      }                  }                    text = text.Replace("<i></i>"' string.Empty);                  text = text.Replace("<i> </i>"' string.Empty);                  text = text.Replace("<i>  </i>"' string.Empty);              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The following statement contains a magic number: if (italicBeginTagCount + italicEndTagCount > 0)              {                  if (italicBeginTagCount == 1 && italicEndTagCount == 1 && text.IndexOf(beginTag' StringComparison.Ordinal) > text.IndexOf(endTag' StringComparison.Ordinal))                  {                      const string pattern = "___________@";                      text = text.Replace(beginTag' pattern);                      text = text.Replace(endTag' beginTag);                      text = text.Replace(pattern' endTag);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 0)                  {                      int firstIndex = text.IndexOf(beginTag' StringComparison.Ordinal);                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      if (noOfLines == 2 && lastIndex == lastIndexWithNewLine && firstIndex < 2)                          text = text.Replace(Environment.NewLine' endTag + Environment.NewLine) + endTag;                      else                          text = text.Remove(lastIndex' beginTag.Length).Insert(lastIndex' endTag);                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 2)                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      if (text.StartsWith("</i>-<i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i> -"' StringComparison.Ordinal) ||                          text.StartsWith("</i>-<i> -"' StringComparison.Ordinal))                          text = text.Remove(0' 5);                      else if (firstIndex == 0)                          text = text.Remove(0' 4);                      else                          text = text.Substring(0' firstIndex) + text.Substring(firstIndex + endTag.Length);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 1)                  {                      var lines = text.SplitToLines();                      if (lines.Length == 2 && lines[0].StartsWith(beginTag' StringComparison.Ordinal) && lines[0].EndsWith(endTag' StringComparison.Ordinal) &&                          lines[1].StartsWith(beginTag' StringComparison.Ordinal))                      {                          text = text.TrimEnd() + endTag;                      }                      else                      {                          int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                          if (text.Length > lastIndex + endTag.Length)                              text = text.Substring(0' lastIndex) + text.Substring(lastIndex - 1 + endTag.Length);                          else                              text = text.Substring(0' lastIndex - 1) + endTag;                      }                      if (text.StartsWith(beginTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal) && text.Contains(endTag + Environment.NewLine + beginTag))                      {                          text = text.Replace(endTag + Environment.NewLine + beginTag' Environment.NewLine);                      }                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 0)                  {                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                        if (text.StartsWith(beginTag' StringComparison.Ordinal))                          text += endTag;                      else if (noOfLines == 2 && lastIndex == lastIndexWithNewLine)                          text += endTag;                      else                          text = text.Replace(beginTag' string.Empty);                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 1)                  {                      var cleanText = RemoveOpenCloseTags(text' TagItalic' TagBold' TagUnderline' TagCyrillicI);                      bool isFixed = false;                        // Foo.</i>                      if (text.EndsWith(endTag' StringComparison.Ordinal) && !cleanText.StartsWith("-") && !cleanText.Contains(Environment.NewLine + "-"))                      {                          text = beginTag + text;                          isFixed = true;                      }                        // - Foo</i> | - Foo.                      // - Bar.    | - Foo.</i>                      if (!isFixed && Utilities.GetNumberOfLines(cleanText) == 2)                      {                          int newLineIndex = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                          if (newLineIndex > 0)                          {                              var firstLine = text.Substring(0' newLineIndex).Trim();                              var secondLine = text.Substring(newLineIndex + 2).Trim();                              if (firstLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  firstLine = beginTag + firstLine;                                  isFixed = true;                              }                              if (secondLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  secondLine = beginTag + secondLine;                                  isFixed = true;                              }                              text = firstLine + Environment.NewLine + secondLine;                          }                      }                      if (!isFixed)                          text = text.Replace(endTag' string.Empty);                  }                    // - foo.</i>                  // - bar.</i>                  if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.Contains(endTag + Environment.NewLine' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      text = text.Replace(endTag' string.Empty);                      text = beginTag + text + endTag;                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.StartsWith(endTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      text = text.Remove(firstIndex' endTag.Length).Insert(firstIndex' beginTag);                  }                    // <i>Foo</i>                  // <i>Bar</i>                  if (italicBeginTagCount == 2 && italicEndTagCount == 2 && noOfLines == 2)                  {                      int index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      if (index > 0 && text.Length > index + (beginTag.Length + endTag.Length))                      {                          var firstLine = text.Substring(0' index).Trim();                          var secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                            if (firstLine.Length > 10 && firstLine.StartsWith("- <i>"' StringComparison.Ordinal) && firstLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = "<i>- " + firstLine.Remove(0' 5) + Environment.NewLine + secondLine;                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                          if (secondLine.Length > 10 && secondLine.StartsWith("- <i>"' StringComparison.Ordinal) && secondLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = firstLine + Environment.NewLine + "<i>- " + secondLine.Remove(0' 5);                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                            if (Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag))                          {                              text = text.Replace(beginTag' string.Empty).Replace(endTag' string.Empty).Trim();                              text = beginTag + text + endTag;                          }                      }                        //FALCONE:<i> I didn't think</i><br /><i>it was going to be you'</i>                      var colIdx = text.IndexOf(':');                      if (colIdx >= 0 && Utilities.CountTagInText(text' beginTag) + Utilities.CountTagInText(text' endTag) == 4 && text.Length > colIdx + 1 && !char.IsDigit(text[colIdx + 1]))                      {                          var firstLine = text.Substring(0' index);                          var secondLine = text.Substring(index).TrimStart();                            var secIdxCol = secondLine.IndexOf(':');                          if (secIdxCol < 0 || !Utilities.IsBetweenNumbers(secondLine' secIdxCol))                          {                              var idx = firstLine.IndexOf(':');                              if (idx > 1)                              {                                  var pre = text.Substring(0' idx + 1).TrimStart();                                  text = text.Remove(0' idx + 1);                                  text = FixInvalidItalicTags(text).Trim();                                  if (text.StartsWith("<i> "' StringComparison.OrdinalIgnoreCase))                                      text = Utilities.RemoveSpaceBeforeAfterTag(text' beginTag);                                  text = pre + " " + text;                              }                          }                      }                  }                    //<i>- You think they're they gone?<i>                  //<i>- That can't be.</i>                  if (italicBeginTagCount == 3 && italicEndTagCount == 1 && noOfLines == 2)                  {                      var newLineIdx = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      var firstLine = text.Substring(0' newLineIdx).Trim();                      var secondLine = text.Substring(newLineIdx).Trim();                        if ((Utilities.StartsAndEndsWithTag(firstLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag)) ||                          (Utilities.StartsAndEndsWithTag(secondLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag)))                      {                          text = text.Replace(beginTag' string.Empty);                          text = text.Replace(endTag' string.Empty);                          text = text.Replace("  "' " ").Trim();                          text = beginTag + text + endTag;                      }                  }                    if (noOfLines == 3)                  {                      var lines = text.SplitToLines();                      if ((italicBeginTagCount == 3 && italicEndTagCount == 2) || (italicBeginTagCount == 2 && italicEndTagCount == 3))                      {                          int numberOfItalics = 0;                          foreach (var line in lines)                          {                              if (line.StartsWith(beginTag' StringComparison.Ordinal))                                  numberOfItalics++;                              if (line.EndsWith(endTag' StringComparison.Ordinal))                                  numberOfItalics++;                          }                          if (numberOfItalics == 5)                          { // fix missing tag                              text = "<i>" + text.Replace("<i>"' string.Empty).Replace("</i>"' string.Empty) + "</i>";                          }                      }                  }                    text = text.Replace("<i></i>"' string.Empty);                  text = text.Replace("<i> </i>"' string.Empty);                  text = text.Replace("<i>  </i>"' string.Empty);              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The following statement contains a magic number: if (italicBeginTagCount + italicEndTagCount > 0)              {                  if (italicBeginTagCount == 1 && italicEndTagCount == 1 && text.IndexOf(beginTag' StringComparison.Ordinal) > text.IndexOf(endTag' StringComparison.Ordinal))                  {                      const string pattern = "___________@";                      text = text.Replace(beginTag' pattern);                      text = text.Replace(endTag' beginTag);                      text = text.Replace(pattern' endTag);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 0)                  {                      int firstIndex = text.IndexOf(beginTag' StringComparison.Ordinal);                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      if (noOfLines == 2 && lastIndex == lastIndexWithNewLine && firstIndex < 2)                          text = text.Replace(Environment.NewLine' endTag + Environment.NewLine) + endTag;                      else                          text = text.Remove(lastIndex' beginTag.Length).Insert(lastIndex' endTag);                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 2)                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      if (text.StartsWith("</i>-<i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i> -"' StringComparison.Ordinal) ||                          text.StartsWith("</i>-<i> -"' StringComparison.Ordinal))                          text = text.Remove(0' 5);                      else if (firstIndex == 0)                          text = text.Remove(0' 4);                      else                          text = text.Substring(0' firstIndex) + text.Substring(firstIndex + endTag.Length);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 1)                  {                      var lines = text.SplitToLines();                      if (lines.Length == 2 && lines[0].StartsWith(beginTag' StringComparison.Ordinal) && lines[0].EndsWith(endTag' StringComparison.Ordinal) &&                          lines[1].StartsWith(beginTag' StringComparison.Ordinal))                      {                          text = text.TrimEnd() + endTag;                      }                      else                      {                          int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                          if (text.Length > lastIndex + endTag.Length)                              text = text.Substring(0' lastIndex) + text.Substring(lastIndex - 1 + endTag.Length);                          else                              text = text.Substring(0' lastIndex - 1) + endTag;                      }                      if (text.StartsWith(beginTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal) && text.Contains(endTag + Environment.NewLine + beginTag))                      {                          text = text.Replace(endTag + Environment.NewLine + beginTag' Environment.NewLine);                      }                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 0)                  {                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                        if (text.StartsWith(beginTag' StringComparison.Ordinal))                          text += endTag;                      else if (noOfLines == 2 && lastIndex == lastIndexWithNewLine)                          text += endTag;                      else                          text = text.Replace(beginTag' string.Empty);                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 1)                  {                      var cleanText = RemoveOpenCloseTags(text' TagItalic' TagBold' TagUnderline' TagCyrillicI);                      bool isFixed = false;                        // Foo.</i>                      if (text.EndsWith(endTag' StringComparison.Ordinal) && !cleanText.StartsWith("-") && !cleanText.Contains(Environment.NewLine + "-"))                      {                          text = beginTag + text;                          isFixed = true;                      }                        // - Foo</i> | - Foo.                      // - Bar.    | - Foo.</i>                      if (!isFixed && Utilities.GetNumberOfLines(cleanText) == 2)                      {                          int newLineIndex = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                          if (newLineIndex > 0)                          {                              var firstLine = text.Substring(0' newLineIndex).Trim();                              var secondLine = text.Substring(newLineIndex + 2).Trim();                              if (firstLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  firstLine = beginTag + firstLine;                                  isFixed = true;                              }                              if (secondLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  secondLine = beginTag + secondLine;                                  isFixed = true;                              }                              text = firstLine + Environment.NewLine + secondLine;                          }                      }                      if (!isFixed)                          text = text.Replace(endTag' string.Empty);                  }                    // - foo.</i>                  // - bar.</i>                  if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.Contains(endTag + Environment.NewLine' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      text = text.Replace(endTag' string.Empty);                      text = beginTag + text + endTag;                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.StartsWith(endTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      text = text.Remove(firstIndex' endTag.Length).Insert(firstIndex' beginTag);                  }                    // <i>Foo</i>                  // <i>Bar</i>                  if (italicBeginTagCount == 2 && italicEndTagCount == 2 && noOfLines == 2)                  {                      int index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      if (index > 0 && text.Length > index + (beginTag.Length + endTag.Length))                      {                          var firstLine = text.Substring(0' index).Trim();                          var secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                            if (firstLine.Length > 10 && firstLine.StartsWith("- <i>"' StringComparison.Ordinal) && firstLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = "<i>- " + firstLine.Remove(0' 5) + Environment.NewLine + secondLine;                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                          if (secondLine.Length > 10 && secondLine.StartsWith("- <i>"' StringComparison.Ordinal) && secondLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = firstLine + Environment.NewLine + "<i>- " + secondLine.Remove(0' 5);                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                            if (Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag))                          {                              text = text.Replace(beginTag' string.Empty).Replace(endTag' string.Empty).Trim();                              text = beginTag + text + endTag;                          }                      }                        //FALCONE:<i> I didn't think</i><br /><i>it was going to be you'</i>                      var colIdx = text.IndexOf(':');                      if (colIdx >= 0 && Utilities.CountTagInText(text' beginTag) + Utilities.CountTagInText(text' endTag) == 4 && text.Length > colIdx + 1 && !char.IsDigit(text[colIdx + 1]))                      {                          var firstLine = text.Substring(0' index);                          var secondLine = text.Substring(index).TrimStart();                            var secIdxCol = secondLine.IndexOf(':');                          if (secIdxCol < 0 || !Utilities.IsBetweenNumbers(secondLine' secIdxCol))                          {                              var idx = firstLine.IndexOf(':');                              if (idx > 1)                              {                                  var pre = text.Substring(0' idx + 1).TrimStart();                                  text = text.Remove(0' idx + 1);                                  text = FixInvalidItalicTags(text).Trim();                                  if (text.StartsWith("<i> "' StringComparison.OrdinalIgnoreCase))                                      text = Utilities.RemoveSpaceBeforeAfterTag(text' beginTag);                                  text = pre + " " + text;                              }                          }                      }                  }                    //<i>- You think they're they gone?<i>                  //<i>- That can't be.</i>                  if (italicBeginTagCount == 3 && italicEndTagCount == 1 && noOfLines == 2)                  {                      var newLineIdx = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      var firstLine = text.Substring(0' newLineIdx).Trim();                      var secondLine = text.Substring(newLineIdx).Trim();                        if ((Utilities.StartsAndEndsWithTag(firstLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag)) ||                          (Utilities.StartsAndEndsWithTag(secondLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag)))                      {                          text = text.Replace(beginTag' string.Empty);                          text = text.Replace(endTag' string.Empty);                          text = text.Replace("  "' " ").Trim();                          text = beginTag + text + endTag;                      }                  }                    if (noOfLines == 3)                  {                      var lines = text.SplitToLines();                      if ((italicBeginTagCount == 3 && italicEndTagCount == 2) || (italicBeginTagCount == 2 && italicEndTagCount == 3))                      {                          int numberOfItalics = 0;                          foreach (var line in lines)                          {                              if (line.StartsWith(beginTag' StringComparison.Ordinal))                                  numberOfItalics++;                              if (line.EndsWith(endTag' StringComparison.Ordinal))                                  numberOfItalics++;                          }                          if (numberOfItalics == 5)                          { // fix missing tag                              text = "<i>" + text.Replace("<i>"' string.Empty).Replace("</i>"' string.Empty) + "</i>";                          }                      }                  }                    text = text.Replace("<i></i>"' string.Empty);                  text = text.Replace("<i> </i>"' string.Empty);                  text = text.Replace("<i>  </i>"' string.Empty);              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The following statement contains a magic number: if (italicBeginTagCount + italicEndTagCount > 0)              {                  if (italicBeginTagCount == 1 && italicEndTagCount == 1 && text.IndexOf(beginTag' StringComparison.Ordinal) > text.IndexOf(endTag' StringComparison.Ordinal))                  {                      const string pattern = "___________@";                      text = text.Replace(beginTag' pattern);                      text = text.Replace(endTag' beginTag);                      text = text.Replace(pattern' endTag);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 0)                  {                      int firstIndex = text.IndexOf(beginTag' StringComparison.Ordinal);                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      if (noOfLines == 2 && lastIndex == lastIndexWithNewLine && firstIndex < 2)                          text = text.Replace(Environment.NewLine' endTag + Environment.NewLine) + endTag;                      else                          text = text.Remove(lastIndex' beginTag.Length).Insert(lastIndex' endTag);                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 2)                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      if (text.StartsWith("</i>-<i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i> -"' StringComparison.Ordinal) ||                          text.StartsWith("</i>-<i> -"' StringComparison.Ordinal))                          text = text.Remove(0' 5);                      else if (firstIndex == 0)                          text = text.Remove(0' 4);                      else                          text = text.Substring(0' firstIndex) + text.Substring(firstIndex + endTag.Length);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 1)                  {                      var lines = text.SplitToLines();                      if (lines.Length == 2 && lines[0].StartsWith(beginTag' StringComparison.Ordinal) && lines[0].EndsWith(endTag' StringComparison.Ordinal) &&                          lines[1].StartsWith(beginTag' StringComparison.Ordinal))                      {                          text = text.TrimEnd() + endTag;                      }                      else                      {                          int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                          if (text.Length > lastIndex + endTag.Length)                              text = text.Substring(0' lastIndex) + text.Substring(lastIndex - 1 + endTag.Length);                          else                              text = text.Substring(0' lastIndex - 1) + endTag;                      }                      if (text.StartsWith(beginTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal) && text.Contains(endTag + Environment.NewLine + beginTag))                      {                          text = text.Replace(endTag + Environment.NewLine + beginTag' Environment.NewLine);                      }                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 0)                  {                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                        if (text.StartsWith(beginTag' StringComparison.Ordinal))                          text += endTag;                      else if (noOfLines == 2 && lastIndex == lastIndexWithNewLine)                          text += endTag;                      else                          text = text.Replace(beginTag' string.Empty);                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 1)                  {                      var cleanText = RemoveOpenCloseTags(text' TagItalic' TagBold' TagUnderline' TagCyrillicI);                      bool isFixed = false;                        // Foo.</i>                      if (text.EndsWith(endTag' StringComparison.Ordinal) && !cleanText.StartsWith("-") && !cleanText.Contains(Environment.NewLine + "-"))                      {                          text = beginTag + text;                          isFixed = true;                      }                        // - Foo</i> | - Foo.                      // - Bar.    | - Foo.</i>                      if (!isFixed && Utilities.GetNumberOfLines(cleanText) == 2)                      {                          int newLineIndex = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                          if (newLineIndex > 0)                          {                              var firstLine = text.Substring(0' newLineIndex).Trim();                              var secondLine = text.Substring(newLineIndex + 2).Trim();                              if (firstLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  firstLine = beginTag + firstLine;                                  isFixed = true;                              }                              if (secondLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  secondLine = beginTag + secondLine;                                  isFixed = true;                              }                              text = firstLine + Environment.NewLine + secondLine;                          }                      }                      if (!isFixed)                          text = text.Replace(endTag' string.Empty);                  }                    // - foo.</i>                  // - bar.</i>                  if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.Contains(endTag + Environment.NewLine' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      text = text.Replace(endTag' string.Empty);                      text = beginTag + text + endTag;                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.StartsWith(endTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      text = text.Remove(firstIndex' endTag.Length).Insert(firstIndex' beginTag);                  }                    // <i>Foo</i>                  // <i>Bar</i>                  if (italicBeginTagCount == 2 && italicEndTagCount == 2 && noOfLines == 2)                  {                      int index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      if (index > 0 && text.Length > index + (beginTag.Length + endTag.Length))                      {                          var firstLine = text.Substring(0' index).Trim();                          var secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                            if (firstLine.Length > 10 && firstLine.StartsWith("- <i>"' StringComparison.Ordinal) && firstLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = "<i>- " + firstLine.Remove(0' 5) + Environment.NewLine + secondLine;                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                          if (secondLine.Length > 10 && secondLine.StartsWith("- <i>"' StringComparison.Ordinal) && secondLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = firstLine + Environment.NewLine + "<i>- " + secondLine.Remove(0' 5);                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                            if (Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag))                          {                              text = text.Replace(beginTag' string.Empty).Replace(endTag' string.Empty).Trim();                              text = beginTag + text + endTag;                          }                      }                        //FALCONE:<i> I didn't think</i><br /><i>it was going to be you'</i>                      var colIdx = text.IndexOf(':');                      if (colIdx >= 0 && Utilities.CountTagInText(text' beginTag) + Utilities.CountTagInText(text' endTag) == 4 && text.Length > colIdx + 1 && !char.IsDigit(text[colIdx + 1]))                      {                          var firstLine = text.Substring(0' index);                          var secondLine = text.Substring(index).TrimStart();                            var secIdxCol = secondLine.IndexOf(':');                          if (secIdxCol < 0 || !Utilities.IsBetweenNumbers(secondLine' secIdxCol))                          {                              var idx = firstLine.IndexOf(':');                              if (idx > 1)                              {                                  var pre = text.Substring(0' idx + 1).TrimStart();                                  text = text.Remove(0' idx + 1);                                  text = FixInvalidItalicTags(text).Trim();                                  if (text.StartsWith("<i> "' StringComparison.OrdinalIgnoreCase))                                      text = Utilities.RemoveSpaceBeforeAfterTag(text' beginTag);                                  text = pre + " " + text;                              }                          }                      }                  }                    //<i>- You think they're they gone?<i>                  //<i>- That can't be.</i>                  if (italicBeginTagCount == 3 && italicEndTagCount == 1 && noOfLines == 2)                  {                      var newLineIdx = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      var firstLine = text.Substring(0' newLineIdx).Trim();                      var secondLine = text.Substring(newLineIdx).Trim();                        if ((Utilities.StartsAndEndsWithTag(firstLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag)) ||                          (Utilities.StartsAndEndsWithTag(secondLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag)))                      {                          text = text.Replace(beginTag' string.Empty);                          text = text.Replace(endTag' string.Empty);                          text = text.Replace("  "' " ").Trim();                          text = beginTag + text + endTag;                      }                  }                    if (noOfLines == 3)                  {                      var lines = text.SplitToLines();                      if ((italicBeginTagCount == 3 && italicEndTagCount == 2) || (italicBeginTagCount == 2 && italicEndTagCount == 3))                      {                          int numberOfItalics = 0;                          foreach (var line in lines)                          {                              if (line.StartsWith(beginTag' StringComparison.Ordinal))                                  numberOfItalics++;                              if (line.EndsWith(endTag' StringComparison.Ordinal))                                  numberOfItalics++;                          }                          if (numberOfItalics == 5)                          { // fix missing tag                              text = "<i>" + text.Replace("<i>"' string.Empty).Replace("</i>"' string.Empty) + "</i>";                          }                      }                  }                    text = text.Replace("<i></i>"' string.Empty);                  text = text.Replace("<i> </i>"' string.Empty);                  text = text.Replace("<i>  </i>"' string.Empty);              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The following statement contains a magic number: if (italicBeginTagCount + italicEndTagCount > 0)              {                  if (italicBeginTagCount == 1 && italicEndTagCount == 1 && text.IndexOf(beginTag' StringComparison.Ordinal) > text.IndexOf(endTag' StringComparison.Ordinal))                  {                      const string pattern = "___________@";                      text = text.Replace(beginTag' pattern);                      text = text.Replace(endTag' beginTag);                      text = text.Replace(pattern' endTag);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 0)                  {                      int firstIndex = text.IndexOf(beginTag' StringComparison.Ordinal);                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      if (noOfLines == 2 && lastIndex == lastIndexWithNewLine && firstIndex < 2)                          text = text.Replace(Environment.NewLine' endTag + Environment.NewLine) + endTag;                      else                          text = text.Remove(lastIndex' beginTag.Length).Insert(lastIndex' endTag);                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 2)                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      if (text.StartsWith("</i>-<i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i> -"' StringComparison.Ordinal) ||                          text.StartsWith("</i>-<i> -"' StringComparison.Ordinal))                          text = text.Remove(0' 5);                      else if (firstIndex == 0)                          text = text.Remove(0' 4);                      else                          text = text.Substring(0' firstIndex) + text.Substring(firstIndex + endTag.Length);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 1)                  {                      var lines = text.SplitToLines();                      if (lines.Length == 2 && lines[0].StartsWith(beginTag' StringComparison.Ordinal) && lines[0].EndsWith(endTag' StringComparison.Ordinal) &&                          lines[1].StartsWith(beginTag' StringComparison.Ordinal))                      {                          text = text.TrimEnd() + endTag;                      }                      else                      {                          int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                          if (text.Length > lastIndex + endTag.Length)                              text = text.Substring(0' lastIndex) + text.Substring(lastIndex - 1 + endTag.Length);                          else                              text = text.Substring(0' lastIndex - 1) + endTag;                      }                      if (text.StartsWith(beginTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal) && text.Contains(endTag + Environment.NewLine + beginTag))                      {                          text = text.Replace(endTag + Environment.NewLine + beginTag' Environment.NewLine);                      }                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 0)                  {                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                        if (text.StartsWith(beginTag' StringComparison.Ordinal))                          text += endTag;                      else if (noOfLines == 2 && lastIndex == lastIndexWithNewLine)                          text += endTag;                      else                          text = text.Replace(beginTag' string.Empty);                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 1)                  {                      var cleanText = RemoveOpenCloseTags(text' TagItalic' TagBold' TagUnderline' TagCyrillicI);                      bool isFixed = false;                        // Foo.</i>                      if (text.EndsWith(endTag' StringComparison.Ordinal) && !cleanText.StartsWith("-") && !cleanText.Contains(Environment.NewLine + "-"))                      {                          text = beginTag + text;                          isFixed = true;                      }                        // - Foo</i> | - Foo.                      // - Bar.    | - Foo.</i>                      if (!isFixed && Utilities.GetNumberOfLines(cleanText) == 2)                      {                          int newLineIndex = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                          if (newLineIndex > 0)                          {                              var firstLine = text.Substring(0' newLineIndex).Trim();                              var secondLine = text.Substring(newLineIndex + 2).Trim();                              if (firstLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  firstLine = beginTag + firstLine;                                  isFixed = true;                              }                              if (secondLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  secondLine = beginTag + secondLine;                                  isFixed = true;                              }                              text = firstLine + Environment.NewLine + secondLine;                          }                      }                      if (!isFixed)                          text = text.Replace(endTag' string.Empty);                  }                    // - foo.</i>                  // - bar.</i>                  if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.Contains(endTag + Environment.NewLine' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      text = text.Replace(endTag' string.Empty);                      text = beginTag + text + endTag;                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.StartsWith(endTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      text = text.Remove(firstIndex' endTag.Length).Insert(firstIndex' beginTag);                  }                    // <i>Foo</i>                  // <i>Bar</i>                  if (italicBeginTagCount == 2 && italicEndTagCount == 2 && noOfLines == 2)                  {                      int index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      if (index > 0 && text.Length > index + (beginTag.Length + endTag.Length))                      {                          var firstLine = text.Substring(0' index).Trim();                          var secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                            if (firstLine.Length > 10 && firstLine.StartsWith("- <i>"' StringComparison.Ordinal) && firstLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = "<i>- " + firstLine.Remove(0' 5) + Environment.NewLine + secondLine;                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                          if (secondLine.Length > 10 && secondLine.StartsWith("- <i>"' StringComparison.Ordinal) && secondLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = firstLine + Environment.NewLine + "<i>- " + secondLine.Remove(0' 5);                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                            if (Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag))                          {                              text = text.Replace(beginTag' string.Empty).Replace(endTag' string.Empty).Trim();                              text = beginTag + text + endTag;                          }                      }                        //FALCONE:<i> I didn't think</i><br /><i>it was going to be you'</i>                      var colIdx = text.IndexOf(':');                      if (colIdx >= 0 && Utilities.CountTagInText(text' beginTag) + Utilities.CountTagInText(text' endTag) == 4 && text.Length > colIdx + 1 && !char.IsDigit(text[colIdx + 1]))                      {                          var firstLine = text.Substring(0' index);                          var secondLine = text.Substring(index).TrimStart();                            var secIdxCol = secondLine.IndexOf(':');                          if (secIdxCol < 0 || !Utilities.IsBetweenNumbers(secondLine' secIdxCol))                          {                              var idx = firstLine.IndexOf(':');                              if (idx > 1)                              {                                  var pre = text.Substring(0' idx + 1).TrimStart();                                  text = text.Remove(0' idx + 1);                                  text = FixInvalidItalicTags(text).Trim();                                  if (text.StartsWith("<i> "' StringComparison.OrdinalIgnoreCase))                                      text = Utilities.RemoveSpaceBeforeAfterTag(text' beginTag);                                  text = pre + " " + text;                              }                          }                      }                  }                    //<i>- You think they're they gone?<i>                  //<i>- That can't be.</i>                  if (italicBeginTagCount == 3 && italicEndTagCount == 1 && noOfLines == 2)                  {                      var newLineIdx = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      var firstLine = text.Substring(0' newLineIdx).Trim();                      var secondLine = text.Substring(newLineIdx).Trim();                        if ((Utilities.StartsAndEndsWithTag(firstLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag)) ||                          (Utilities.StartsAndEndsWithTag(secondLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag)))                      {                          text = text.Replace(beginTag' string.Empty);                          text = text.Replace(endTag' string.Empty);                          text = text.Replace("  "' " ").Trim();                          text = beginTag + text + endTag;                      }                  }                    if (noOfLines == 3)                  {                      var lines = text.SplitToLines();                      if ((italicBeginTagCount == 3 && italicEndTagCount == 2) || (italicBeginTagCount == 2 && italicEndTagCount == 3))                      {                          int numberOfItalics = 0;                          foreach (var line in lines)                          {                              if (line.StartsWith(beginTag' StringComparison.Ordinal))                                  numberOfItalics++;                              if (line.EndsWith(endTag' StringComparison.Ordinal))                                  numberOfItalics++;                          }                          if (numberOfItalics == 5)                          { // fix missing tag                              text = "<i>" + text.Replace("<i>"' string.Empty).Replace("</i>"' string.Empty) + "</i>";                          }                      }                  }                    text = text.Replace("<i></i>"' string.Empty);                  text = text.Replace("<i> </i>"' string.Empty);                  text = text.Replace("<i>  </i>"' string.Empty);              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,FixInvalidItalicTags,The following statement contains a magic number: if (italicBeginTagCount + italicEndTagCount > 0)              {                  if (italicBeginTagCount == 1 && italicEndTagCount == 1 && text.IndexOf(beginTag' StringComparison.Ordinal) > text.IndexOf(endTag' StringComparison.Ordinal))                  {                      const string pattern = "___________@";                      text = text.Replace(beginTag' pattern);                      text = text.Replace(endTag' beginTag);                      text = text.Replace(pattern' endTag);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 0)                  {                      int firstIndex = text.IndexOf(beginTag' StringComparison.Ordinal);                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      if (noOfLines == 2 && lastIndex == lastIndexWithNewLine && firstIndex < 2)                          text = text.Replace(Environment.NewLine' endTag + Environment.NewLine) + endTag;                      else                          text = text.Remove(lastIndex' beginTag.Length).Insert(lastIndex' endTag);                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 2)                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      if (text.StartsWith("</i>-<i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i>-"' StringComparison.Ordinal) ||                          text.StartsWith("</i>- <i> -"' StringComparison.Ordinal) ||                          text.StartsWith("</i>-<i> -"' StringComparison.Ordinal))                          text = text.Remove(0' 5);                      else if (firstIndex == 0)                          text = text.Remove(0' 4);                      else                          text = text.Substring(0' firstIndex) + text.Substring(firstIndex + endTag.Length);                  }                    if (italicBeginTagCount == 2 && italicEndTagCount == 1)                  {                      var lines = text.SplitToLines();                      if (lines.Length == 2 && lines[0].StartsWith(beginTag' StringComparison.Ordinal) && lines[0].EndsWith(endTag' StringComparison.Ordinal) &&                          lines[1].StartsWith(beginTag' StringComparison.Ordinal))                      {                          text = text.TrimEnd() + endTag;                      }                      else                      {                          int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                          if (text.Length > lastIndex + endTag.Length)                              text = text.Substring(0' lastIndex) + text.Substring(lastIndex - 1 + endTag.Length);                          else                              text = text.Substring(0' lastIndex - 1) + endTag;                      }                      if (text.StartsWith(beginTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal) && text.Contains(endTag + Environment.NewLine + beginTag))                      {                          text = text.Replace(endTag + Environment.NewLine + beginTag' Environment.NewLine);                      }                  }                    if (italicBeginTagCount == 1 && italicEndTagCount == 0)                  {                      int lastIndexWithNewLine = text.LastIndexOf(Environment.NewLine + beginTag' StringComparison.Ordinal) + Environment.NewLine.Length;                      int lastIndex = text.LastIndexOf(beginTag' StringComparison.Ordinal);                        if (text.StartsWith(beginTag' StringComparison.Ordinal))                          text += endTag;                      else if (noOfLines == 2 && lastIndex == lastIndexWithNewLine)                          text += endTag;                      else                          text = text.Replace(beginTag' string.Empty);                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 1)                  {                      var cleanText = RemoveOpenCloseTags(text' TagItalic' TagBold' TagUnderline' TagCyrillicI);                      bool isFixed = false;                        // Foo.</i>                      if (text.EndsWith(endTag' StringComparison.Ordinal) && !cleanText.StartsWith("-") && !cleanText.Contains(Environment.NewLine + "-"))                      {                          text = beginTag + text;                          isFixed = true;                      }                        // - Foo</i> | - Foo.                      // - Bar.    | - Foo.</i>                      if (!isFixed && Utilities.GetNumberOfLines(cleanText) == 2)                      {                          int newLineIndex = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                          if (newLineIndex > 0)                          {                              var firstLine = text.Substring(0' newLineIndex).Trim();                              var secondLine = text.Substring(newLineIndex + 2).Trim();                              if (firstLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  firstLine = beginTag + firstLine;                                  isFixed = true;                              }                              if (secondLine.EndsWith(endTag' StringComparison.Ordinal))                              {                                  secondLine = beginTag + secondLine;                                  isFixed = true;                              }                              text = firstLine + Environment.NewLine + secondLine;                          }                      }                      if (!isFixed)                          text = text.Replace(endTag' string.Empty);                  }                    // - foo.</i>                  // - bar.</i>                  if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.Contains(endTag + Environment.NewLine' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      text = text.Replace(endTag' string.Empty);                      text = beginTag + text + endTag;                  }                    if (italicBeginTagCount == 0 && italicEndTagCount == 2 && text.StartsWith(endTag' StringComparison.Ordinal) && text.EndsWith(endTag' StringComparison.Ordinal))                  {                      int firstIndex = text.IndexOf(endTag' StringComparison.Ordinal);                      text = text.Remove(firstIndex' endTag.Length).Insert(firstIndex' beginTag);                  }                    // <i>Foo</i>                  // <i>Bar</i>                  if (italicBeginTagCount == 2 && italicEndTagCount == 2 && noOfLines == 2)                  {                      int index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      if (index > 0 && text.Length > index + (beginTag.Length + endTag.Length))                      {                          var firstLine = text.Substring(0' index).Trim();                          var secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                            if (firstLine.Length > 10 && firstLine.StartsWith("- <i>"' StringComparison.Ordinal) && firstLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = "<i>- " + firstLine.Remove(0' 5) + Environment.NewLine + secondLine;                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                          if (secondLine.Length > 10 && secondLine.StartsWith("- <i>"' StringComparison.Ordinal) && secondLine.EndsWith(endTag' StringComparison.Ordinal))                          {                              text = firstLine + Environment.NewLine + "<i>- " + secondLine.Remove(0' 5);                              text = text.Replace("<i>-  "' "<i>- ");                              index = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                              firstLine = text.Substring(0' index).Trim();                              secondLine = text.Substring(index + Environment.NewLine.Length).Trim();                          }                            if (Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag))                          {                              text = text.Replace(beginTag' string.Empty).Replace(endTag' string.Empty).Trim();                              text = beginTag + text + endTag;                          }                      }                        //FALCONE:<i> I didn't think</i><br /><i>it was going to be you'</i>                      var colIdx = text.IndexOf(':');                      if (colIdx >= 0 && Utilities.CountTagInText(text' beginTag) + Utilities.CountTagInText(text' endTag) == 4 && text.Length > colIdx + 1 && !char.IsDigit(text[colIdx + 1]))                      {                          var firstLine = text.Substring(0' index);                          var secondLine = text.Substring(index).TrimStart();                            var secIdxCol = secondLine.IndexOf(':');                          if (secIdxCol < 0 || !Utilities.IsBetweenNumbers(secondLine' secIdxCol))                          {                              var idx = firstLine.IndexOf(':');                              if (idx > 1)                              {                                  var pre = text.Substring(0' idx + 1).TrimStart();                                  text = text.Remove(0' idx + 1);                                  text = FixInvalidItalicTags(text).Trim();                                  if (text.StartsWith("<i> "' StringComparison.OrdinalIgnoreCase))                                      text = Utilities.RemoveSpaceBeforeAfterTag(text' beginTag);                                  text = pre + " " + text;                              }                          }                      }                  }                    //<i>- You think they're they gone?<i>                  //<i>- That can't be.</i>                  if (italicBeginTagCount == 3 && italicEndTagCount == 1 && noOfLines == 2)                  {                      var newLineIdx = text.IndexOf(Environment.NewLine' StringComparison.Ordinal);                      var firstLine = text.Substring(0' newLineIdx).Trim();                      var secondLine = text.Substring(newLineIdx).Trim();                        if ((Utilities.StartsAndEndsWithTag(firstLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(secondLine' beginTag' endTag)) ||                          (Utilities.StartsAndEndsWithTag(secondLine' beginTag' beginTag) && Utilities.StartsAndEndsWithTag(firstLine' beginTag' endTag)))                      {                          text = text.Replace(beginTag' string.Empty);                          text = text.Replace(endTag' string.Empty);                          text = text.Replace("  "' " ").Trim();                          text = beginTag + text + endTag;                      }                  }                    if (noOfLines == 3)                  {                      var lines = text.SplitToLines();                      if ((italicBeginTagCount == 3 && italicEndTagCount == 2) || (italicBeginTagCount == 2 && italicEndTagCount == 3))                      {                          int numberOfItalics = 0;                          foreach (var line in lines)                          {                              if (line.StartsWith(beginTag' StringComparison.Ordinal))                                  numberOfItalics++;                              if (line.EndsWith(endTag' StringComparison.Ordinal))                                  numberOfItalics++;                          }                          if (numberOfItalics == 5)                          { // fix missing tag                              text = "<i>" + text.Replace("<i>"' string.Empty).Replace("</i>"' string.Empty) + "</i>";                          }                      }                  }                    text = text.Replace("<i></i>"' string.Empty);                  text = text.Replace("<i> </i>"' string.Empty);                  text = text.Replace("<i>  </i>"' string.Empty);              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,HtmlUtil,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\HtmlUtil.cs,ToggleTag,The following statement contains a magic number: if (text.IndexOf("<" + tag + ">"' StringComparison.OrdinalIgnoreCase) >= 0 ||                  text.IndexOf("</" + tag + ">"' StringComparison.OrdinalIgnoreCase) >= 0)              {                  text = text.Replace("<" + tag + ">"' string.Empty);                  text = text.Replace("</" + tag + ">"' string.Empty);                  text = text.Replace("<" + tag.ToUpper() + ">"' string.Empty);                  text = text.Replace("</" + tag.ToUpper() + ">"' string.Empty);              }              else              {                  int indexOfEndBracket = text.IndexOf('}');                  if (text.StartsWith("{\\"' StringComparison.Ordinal) && indexOfEndBracket > 1 && indexOfEndBracket < 6)                  {                      text = $"{text.Substring(0' indexOfEndBracket + 1)}<{tag}>{text.Remove(0' indexOfEndBracket + 1)}</{tag}>";                  }                  else                  {                      text = $"<{tag}>{text}</{tag}>";                  }              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The following statement contains a magic number: switch (encoding.CodePage)              {                  case 860:                      return "pt"; // Portuguese                  case 28599:                  case 1254:                      return "tr"; // Turkish                  case 28598:                  case 1255:                      return "he"; // Hebrew                  case 28596:                  case 1256:                      return "ar"; // Arabic                  case 1258:                      return "vi"; // Vietnamese                  case 949:                  case 1361:                  case 20949:                  case 51949:                  case 50225:                      return "ko"; // Korean                  case 1253:                  case 28597:                      return "el"; // Greek                  case 50220:                  case 50221:                  case 50222:                  case 51932:                  case 20932:                  case 10001:                      return "ja"; // Japanese                  case 20000:                  case 20002:                  case 20936:                  case 950:                  case 52936:                  case 54936:                  case 51936:                      return "zh"; // Chinese                  default:                      return null;              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The following statement contains a magic number: switch (encoding.CodePage)              {                  case 860:                      return "pt"; // Portuguese                  case 28599:                  case 1254:                      return "tr"; // Turkish                  case 28598:                  case 1255:                      return "he"; // Hebrew                  case 28596:                  case 1256:                      return "ar"; // Arabic                  case 1258:                      return "vi"; // Vietnamese                  case 949:                  case 1361:                  case 20949:                  case 51949:                  case 50225:                      return "ko"; // Korean                  case 1253:                  case 28597:                      return "el"; // Greek                  case 50220:                  case 50221:                  case 50222:                  case 51932:                  case 20932:                  case 10001:                      return "ja"; // Japanese                  case 20000:                  case 20002:                  case 20936:                  case 950:                  case 52936:                  case 54936:                  case 51936:                      return "zh"; // Chinese                  default:                      return null;              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The following statement contains a magic number: switch (encoding.CodePage)              {                  case 860:                      return "pt"; // Portuguese                  case 28599:                  case 1254:                      return "tr"; // Turkish                  case 28598:                  case 1255:                      return "he"; // Hebrew                  case 28596:                  case 1256:                      return "ar"; // Arabic                  case 1258:                      return "vi"; // Vietnamese                  case 949:                  case 1361:                  case 20949:                  case 51949:                  case 50225:                      return "ko"; // Korean                  case 1253:                  case 28597:                      return "el"; // Greek                  case 50220:                  case 50221:                  case 50222:                  case 51932:                  case 20932:                  case 10001:                      return "ja"; // Japanese                  case 20000:                  case 20002:                  case 20936:                  case 950:                  case 52936:                  case 54936:                  case 51936:                      return "zh"; // Chinese                  default:                      return null;              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The following statement contains a magic number: switch (encoding.CodePage)              {                  case 860:                      return "pt"; // Portuguese                  case 28599:                  case 1254:                      return "tr"; // Turkish                  case 28598:                  case 1255:                      return "he"; // Hebrew                  case 28596:                  case 1256:                      return "ar"; // Arabic                  case 1258:                      return "vi"; // Vietnamese                  case 949:                  case 1361:                  case 20949:                  case 51949:                  case 50225:                      return "ko"; // Korean                  case 1253:                  case 28597:                      return "el"; // Greek                  case 50220:                  case 50221:                  case 50222:                  case 51932:                  case 20932:                  case 10001:                      return "ja"; // Japanese                  case 20000:                  case 20002:                  case 20936:                  case 950:                  case 52936:                  case 54936:                  case 51936:                      return "zh"; // Chinese                  default:                      return null;              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The following statement contains a magic number: switch (encoding.CodePage)              {                  case 860:                      return "pt"; // Portuguese                  case 28599:                  case 1254:                      return "tr"; // Turkish                  case 28598:                  case 1255:                      return "he"; // Hebrew                  case 28596:                  case 1256:                      return "ar"; // Arabic                  case 1258:                      return "vi"; // Vietnamese                  case 949:                  case 1361:                  case 20949:                  case 51949:                  case 50225:                      return "ko"; // Korean                  case 1253:                  case 28597:                      return "el"; // Greek                  case 50220:                  case 50221:                  case 50222:                  case 51932:                  case 20932:                  case 10001:                      return "ja"; // Japanese                  case 20000:                  case 20002:                  case 20936:                  case 950:                  case 52936:                  case 54936:                  case 51936:                      return "zh"; // Chinese                  default:                      return null;              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The following statement contains a magic number: switch (encoding.CodePage)              {                  case 860:                      return "pt"; // Portuguese                  case 28599:                  case 1254:                      return "tr"; // Turkish                  case 28598:                  case 1255:                      return "he"; // Hebrew                  case 28596:                  case 1256:                      return "ar"; // Arabic                  case 1258:                      return "vi"; // Vietnamese                  case 949:                  case 1361:                  case 20949:                  case 51949:                  case 50225:                      return "ko"; // Korean                  case 1253:                  case 28597:                      return "el"; // Greek                  case 50220:                  case 50221:                  case 50222:                  case 51932:                  case 20932:                  case 10001:                      return "ja"; // Japanese                  case 20000:                  case 20002:                  case 20936:                  case 950:                  case 52936:                  case 54936:                  case 51936:                      return "zh"; // Chinese                  default:                      return null;              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The following statement contains a magic number: switch (encoding.CodePage)              {                  case 860:                      return "pt"; // Portuguese                  case 28599:                  case 1254:                      return "tr"; // Turkish                  case 28598:                  case 1255:                      return "he"; // Hebrew                  case 28596:                  case 1256:                      return "ar"; // Arabic                  case 1258:                      return "vi"; // Vietnamese                  case 949:                  case 1361:                  case 20949:                  case 51949:                  case 50225:                      return "ko"; // Korean                  case 1253:                  case 28597:                      return "el"; // Greek                  case 50220:                  case 50221:                  case 50222:                  case 51932:                  case 20932:                  case 10001:                      return "ja"; // Japanese                  case 20000:                  case 20002:                  case 20936:                  case 950:                  case 52936:                  case 54936:                  case 51936:                      return "zh"; // Chinese                  default:                      return null;              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The following statement contains a magic number: switch (encoding.CodePage)              {                  case 860:                      return "pt"; // Portuguese                  case 28599:                  case 1254:                      return "tr"; // Turkish                  case 28598:                  case 1255:                      return "he"; // Hebrew                  case 28596:                  case 1256:                      return "ar"; // Arabic                  case 1258:                      return "vi"; // Vietnamese                  case 949:                  case 1361:                  case 20949:                  case 51949:                  case 50225:                      return "ko"; // Korean                  case 1253:                  case 28597:                      return "el"; // Greek                  case 50220:                  case 50221:                  case 50222:                  case 51932:                  case 20932:                  case 10001:                      return "ja"; // Japanese                  case 20000:                  case 20002:                  case 20936:                  case 950:                  case 52936:                  case 54936:                  case 51936:                      return "zh"; // Chinese                  default:                      return null;              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The following statement contains a magic number: switch (encoding.CodePage)              {                  case 860:                      return "pt"; // Portuguese                  case 28599:                  case 1254:                      return "tr"; // Turkish                  case 28598:                  case 1255:                      return "he"; // Hebrew                  case 28596:                  case 1256:                      return "ar"; // Arabic                  case 1258:                      return "vi"; // Vietnamese                  case 949:                  case 1361:                  case 20949:                  case 51949:                  case 50225:                      return "ko"; // Korean                  case 1253:                  case 28597:                      return "el"; // Greek                  case 50220:                  case 50221:                  case 50222:                  case 51932:                  case 20932:                  case 10001:                      return "ja"; // Japanese                  case 20000:                  case 20002:                  case 20936:                  case 950:                  case 52936:                  case 54936:                  case 51936:                      return "zh"; // Chinese                  default:                      return null;              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The following statement contains a magic number: switch (encoding.CodePage)              {                  case 860:                      return "pt"; // Portuguese                  case 28599:                  case 1254:                      return "tr"; // Turkish                  case 28598:                  case 1255:                      return "he"; // Hebrew                  case 28596:                  case 1256:                      return "ar"; // Arabic                  case 1258:                      return "vi"; // Vietnamese                  case 949:                  case 1361:                  case 20949:                  case 51949:                  case 50225:                      return "ko"; // Korean                  case 1253:                  case 28597:                      return "el"; // Greek                  case 50220:                  case 50221:                  case 50222:                  case 51932:                  case 20932:                  case 10001:                      return "ja"; // Japanese                  case 20000:                  case 20002:                  case 20936:                  case 950:                  case 52936:                  case 54936:                  case 51936:                      return "zh"; // Chinese                  default:                      return null;              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The following statement contains a magic number: switch (encoding.CodePage)              {                  case 860:                      return "pt"; // Portuguese                  case 28599:                  case 1254:                      return "tr"; // Turkish                  case 28598:                  case 1255:                      return "he"; // Hebrew                  case 28596:                  case 1256:                      return "ar"; // Arabic                  case 1258:                      return "vi"; // Vietnamese                  case 949:                  case 1361:                  case 20949:                  case 51949:                  case 50225:                      return "ko"; // Korean                  case 1253:                  case 28597:                      return "el"; // Greek                  case 50220:                  case 50221:                  case 50222:                  case 51932:                  case 20932:                  case 10001:                      return "ja"; // Japanese                  case 20000:                  case 20002:                  case 20936:                  case 950:                  case 52936:                  case 54936:                  case 51936:                      return "zh"; // Chinese                  default:                      return null;              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The following statement contains a magic number: switch (encoding.CodePage)              {                  case 860:                      return "pt"; // Portuguese                  case 28599:                  case 1254:                      return "tr"; // Turkish                  case 28598:                  case 1255:                      return "he"; // Hebrew                  case 28596:                  case 1256:                      return "ar"; // Arabic                  case 1258:                      return "vi"; // Vietnamese                  case 949:                  case 1361:                  case 20949:                  case 51949:                  case 50225:                      return "ko"; // Korean                  case 1253:                  case 28597:                      return "el"; // Greek                  case 50220:                  case 50221:                  case 50222:                  case 51932:                  case 20932:                  case 10001:                      return "ja"; // Japanese                  case 20000:                  case 20002:                  case 20936:                  case 950:                  case 52936:                  case 54936:                  case 51936:                      return "zh"; // Chinese                  default:                      return null;              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The following statement contains a magic number: switch (encoding.CodePage)              {                  case 860:                      return "pt"; // Portuguese                  case 28599:                  case 1254:                      return "tr"; // Turkish                  case 28598:                  case 1255:                      return "he"; // Hebrew                  case 28596:                  case 1256:                      return "ar"; // Arabic                  case 1258:                      return "vi"; // Vietnamese                  case 949:                  case 1361:                  case 20949:                  case 51949:                  case 50225:                      return "ko"; // Korean                  case 1253:                  case 28597:                      return "el"; // Greek                  case 50220:                  case 50221:                  case 50222:                  case 51932:                  case 20932:                  case 10001:                      return "ja"; // Japanese                  case 20000:                  case 20002:                  case 20936:                  case 950:                  case 52936:                  case 54936:                  case 51936:                      return "zh"; // Chinese                  default:                      return null;              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The following statement contains a magic number: switch (encoding.CodePage)              {                  case 860:                      return "pt"; // Portuguese                  case 28599:                  case 1254:                      return "tr"; // Turkish                  case 28598:                  case 1255:                      return "he"; // Hebrew                  case 28596:                  case 1256:                      return "ar"; // Arabic                  case 1258:                      return "vi"; // Vietnamese                  case 949:                  case 1361:                  case 20949:                  case 51949:                  case 50225:                      return "ko"; // Korean                  case 1253:                  case 28597:                      return "el"; // Greek                  case 50220:                  case 50221:                  case 50222:                  case 51932:                  case 20932:                  case 10001:                      return "ja"; // Japanese                  case 20000:                  case 20002:                  case 20936:                  case 950:                  case 52936:                  case 54936:                  case 51936:                      return "zh"; // Chinese                  default:                      return null;              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The following statement contains a magic number: switch (encoding.CodePage)              {                  case 860:                      return "pt"; // Portuguese                  case 28599:                  case 1254:                      return "tr"; // Turkish                  case 28598:                  case 1255:                      return "he"; // Hebrew                  case 28596:                  case 1256:                      return "ar"; // Arabic                  case 1258:                      return "vi"; // Vietnamese                  case 949:                  case 1361:                  case 20949:                  case 51949:                  case 50225:                      return "ko"; // Korean                  case 1253:                  case 28597:                      return "el"; // Greek                  case 50220:                  case 50221:                  case 50222:                  case 51932:                  case 20932:                  case 10001:                      return "ja"; // Japanese                  case 20000:                  case 20002:                  case 20936:                  case 950:                  case 52936:                  case 54936:                  case 51936:                      return "zh"; // Chinese                  default:                      return null;              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The following statement contains a magic number: switch (encoding.CodePage)              {                  case 860:                      return "pt"; // Portuguese                  case 28599:                  case 1254:                      return "tr"; // Turkish                  case 28598:                  case 1255:                      return "he"; // Hebrew                  case 28596:                  case 1256:                      return "ar"; // Arabic                  case 1258:                      return "vi"; // Vietnamese                  case 949:                  case 1361:                  case 20949:                  case 51949:                  case 50225:                      return "ko"; // Korean                  case 1253:                  case 28597:                      return "el"; // Greek                  case 50220:                  case 50221:                  case 50222:                  case 51932:                  case 20932:                  case 10001:                      return "ja"; // Japanese                  case 20000:                  case 20002:                  case 20936:                  case 950:                  case 52936:                  case 54936:                  case 51936:                      return "zh"; // Chinese                  default:                      return null;              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The following statement contains a magic number: switch (encoding.CodePage)              {                  case 860:                      return "pt"; // Portuguese                  case 28599:                  case 1254:                      return "tr"; // Turkish                  case 28598:                  case 1255:                      return "he"; // Hebrew                  case 28596:                  case 1256:                      return "ar"; // Arabic                  case 1258:                      return "vi"; // Vietnamese                  case 949:                  case 1361:                  case 20949:                  case 51949:                  case 50225:                      return "ko"; // Korean                  case 1253:                  case 28597:                      return "el"; // Greek                  case 50220:                  case 50221:                  case 50222:                  case 51932:                  case 20932:                  case 10001:                      return "ja"; // Japanese                  case 20000:                  case 20002:                  case 20936:                  case 950:                  case 52936:                  case 54936:                  case 51936:                      return "zh"; // Chinese                  default:                      return null;              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The following statement contains a magic number: switch (encoding.CodePage)              {                  case 860:                      return "pt"; // Portuguese                  case 28599:                  case 1254:                      return "tr"; // Turkish                  case 28598:                  case 1255:                      return "he"; // Hebrew                  case 28596:                  case 1256:                      return "ar"; // Arabic                  case 1258:                      return "vi"; // Vietnamese                  case 949:                  case 1361:                  case 20949:                  case 51949:                  case 50225:                      return "ko"; // Korean                  case 1253:                  case 28597:                      return "el"; // Greek                  case 50220:                  case 50221:                  case 50222:                  case 51932:                  case 20932:                  case 10001:                      return "ja"; // Japanese                  case 20000:                  case 20002:                  case 20936:                  case 950:                  case 52936:                  case 54936:                  case 51936:                      return "zh"; // Chinese                  default:                      return null;              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The following statement contains a magic number: switch (encoding.CodePage)              {                  case 860:                      return "pt"; // Portuguese                  case 28599:                  case 1254:                      return "tr"; // Turkish                  case 28598:                  case 1255:                      return "he"; // Hebrew                  case 28596:                  case 1256:                      return "ar"; // Arabic                  case 1258:                      return "vi"; // Vietnamese                  case 949:                  case 1361:                  case 20949:                  case 51949:                  case 50225:                      return "ko"; // Korean                  case 1253:                  case 28597:                      return "el"; // Greek                  case 50220:                  case 50221:                  case 50222:                  case 51932:                  case 20932:                  case 10001:                      return "ja"; // Japanese                  case 20000:                  case 20002:                  case 20936:                  case 950:                  case 52936:                  case 54936:                  case 51936:                      return "zh"; // Chinese                  default:                      return null;              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The following statement contains a magic number: switch (encoding.CodePage)              {                  case 860:                      return "pt"; // Portuguese                  case 28599:                  case 1254:                      return "tr"; // Turkish                  case 28598:                  case 1255:                      return "he"; // Hebrew                  case 28596:                  case 1256:                      return "ar"; // Arabic                  case 1258:                      return "vi"; // Vietnamese                  case 949:                  case 1361:                  case 20949:                  case 51949:                  case 50225:                      return "ko"; // Korean                  case 1253:                  case 28597:                      return "el"; // Greek                  case 50220:                  case 50221:                  case 50222:                  case 51932:                  case 20932:                  case 10001:                      return "ja"; // Japanese                  case 20000:                  case 20002:                  case 20936:                  case 950:                  case 52936:                  case 54936:                  case 51936:                      return "zh"; // Chinese                  default:                      return null;              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The following statement contains a magic number: switch (encoding.CodePage)              {                  case 860:                      return "pt"; // Portuguese                  case 28599:                  case 1254:                      return "tr"; // Turkish                  case 28598:                  case 1255:                      return "he"; // Hebrew                  case 28596:                  case 1256:                      return "ar"; // Arabic                  case 1258:                      return "vi"; // Vietnamese                  case 949:                  case 1361:                  case 20949:                  case 51949:                  case 50225:                      return "ko"; // Korean                  case 1253:                  case 28597:                      return "el"; // Greek                  case 50220:                  case 50221:                  case 50222:                  case 51932:                  case 20932:                  case 10001:                      return "ja"; // Japanese                  case 20000:                  case 20002:                  case 20936:                  case 950:                  case 52936:                  case 54936:                  case 51936:                      return "zh"; // Chinese                  default:                      return null;              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The following statement contains a magic number: switch (encoding.CodePage)              {                  case 860:                      return "pt"; // Portuguese                  case 28599:                  case 1254:                      return "tr"; // Turkish                  case 28598:                  case 1255:                      return "he"; // Hebrew                  case 28596:                  case 1256:                      return "ar"; // Arabic                  case 1258:                      return "vi"; // Vietnamese                  case 949:                  case 1361:                  case 20949:                  case 51949:                  case 50225:                      return "ko"; // Korean                  case 1253:                  case 28597:                      return "el"; // Greek                  case 50220:                  case 50221:                  case 50222:                  case 51932:                  case 20932:                  case 10001:                      return "ja"; // Japanese                  case 20000:                  case 20002:                  case 20936:                  case 950:                  case 52936:                  case 54936:                  case 51936:                      return "zh"; // Chinese                  default:                      return null;              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The following statement contains a magic number: switch (encoding.CodePage)              {                  case 860:                      return "pt"; // Portuguese                  case 28599:                  case 1254:                      return "tr"; // Turkish                  case 28598:                  case 1255:                      return "he"; // Hebrew                  case 28596:                  case 1256:                      return "ar"; // Arabic                  case 1258:                      return "vi"; // Vietnamese                  case 949:                  case 1361:                  case 20949:                  case 51949:                  case 50225:                      return "ko"; // Korean                  case 1253:                  case 28597:                      return "el"; // Greek                  case 50220:                  case 50221:                  case 50222:                  case 51932:                  case 20932:                  case 10001:                      return "ja"; // Japanese                  case 20000:                  case 20002:                  case 20936:                  case 950:                  case 52936:                  case 54936:                  case 51936:                      return "zh"; // Chinese                  default:                      return null;              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The following statement contains a magic number: switch (encoding.CodePage)              {                  case 860:                      return "pt"; // Portuguese                  case 28599:                  case 1254:                      return "tr"; // Turkish                  case 28598:                  case 1255:                      return "he"; // Hebrew                  case 28596:                  case 1256:                      return "ar"; // Arabic                  case 1258:                      return "vi"; // Vietnamese                  case 949:                  case 1361:                  case 20949:                  case 51949:                  case 50225:                      return "ko"; // Korean                  case 1253:                  case 28597:                      return "el"; // Greek                  case 50220:                  case 50221:                  case 50222:                  case 51932:                  case 20932:                  case 10001:                      return "ja"; // Japanese                  case 20000:                  case 20002:                  case 20936:                  case 950:                  case 52936:                  case 54936:                  case 51936:                      return "zh"; // Chinese                  default:                      return null;              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The following statement contains a magic number: switch (encoding.CodePage)              {                  case 860:                      return "pt"; // Portuguese                  case 28599:                  case 1254:                      return "tr"; // Turkish                  case 28598:                  case 1255:                      return "he"; // Hebrew                  case 28596:                  case 1256:                      return "ar"; // Arabic                  case 1258:                      return "vi"; // Vietnamese                  case 949:                  case 1361:                  case 20949:                  case 51949:                  case 50225:                      return "ko"; // Korean                  case 1253:                  case 28597:                      return "el"; // Greek                  case 50220:                  case 50221:                  case 50222:                  case 51932:                  case 20932:                  case 10001:                      return "ja"; // Japanese                  case 20000:                  case 20002:                  case 20936:                  case 950:                  case 52936:                  case 54936:                  case 51936:                      return "zh"; // Chinese                  default:                      return null;              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The following statement contains a magic number: switch (encoding.CodePage)              {                  case 860:                      return "pt"; // Portuguese                  case 28599:                  case 1254:                      return "tr"; // Turkish                  case 28598:                  case 1255:                      return "he"; // Hebrew                  case 28596:                  case 1256:                      return "ar"; // Arabic                  case 1258:                      return "vi"; // Vietnamese                  case 949:                  case 1361:                  case 20949:                  case 51949:                  case 50225:                      return "ko"; // Korean                  case 1253:                  case 28597:                      return "el"; // Greek                  case 50220:                  case 50221:                  case 50222:                  case 51932:                  case 20932:                  case 10001:                      return "ja"; // Japanese                  case 20000:                  case 20002:                  case 20936:                  case 950:                  case 52936:                  case 54936:                  case 51936:                      return "zh"; // Chinese                  default:                      return null;              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The following statement contains a magic number: switch (encoding.CodePage)              {                  case 860:                      return "pt"; // Portuguese                  case 28599:                  case 1254:                      return "tr"; // Turkish                  case 28598:                  case 1255:                      return "he"; // Hebrew                  case 28596:                  case 1256:                      return "ar"; // Arabic                  case 1258:                      return "vi"; // Vietnamese                  case 949:                  case 1361:                  case 20949:                  case 51949:                  case 50225:                      return "ko"; // Korean                  case 1253:                  case 28597:                      return "el"; // Greek                  case 50220:                  case 50221:                  case 50222:                  case 51932:                  case 20932:                  case 10001:                      return "ja"; // Japanese                  case 20000:                  case 20002:                  case 20936:                  case 950:                  case 52936:                  case 54936:                  case 51936:                      return "zh"; // Chinese                  default:                      return null;              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The following statement contains a magic number: switch (encoding.CodePage)              {                  case 860:                      return "pt"; // Portuguese                  case 28599:                  case 1254:                      return "tr"; // Turkish                  case 28598:                  case 1255:                      return "he"; // Hebrew                  case 28596:                  case 1256:                      return "ar"; // Arabic                  case 1258:                      return "vi"; // Vietnamese                  case 949:                  case 1361:                  case 20949:                  case 51949:                  case 50225:                      return "ko"; // Korean                  case 1253:                  case 28597:                      return "el"; // Greek                  case 50220:                  case 50221:                  case 50222:                  case 51932:                  case 20932:                  case 10001:                      return "ja"; // Japanese                  case 20000:                  case 20002:                  case 20936:                  case 950:                  case 52936:                  case 54936:                  case 51936:                      return "zh"; // Chinese                  default:                      return null;              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The following statement contains a magic number: if (count > bestCount)              {                  int norwegianCount = GetCount(text' "ut"' "deg"' "meg"' "merkelig"' "mye"' "spørre");                  int dutchCount = GetCount(text' AutoDetectWordsDutch);                  if (norwegianCount < 2 && dutchCount < count)                      return "da";              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The following statement contains a magic number: if (count > bestCount)              {                  int danishCount = GetCount(text' "siger"' "dig"' "mig"' "mærkelig"' "tilbage"' "spørge");                  int dutchCount = GetCount(text' AutoDetectWordsDutch);                  if (danishCount < 2 && dutchCount < count)                      return "no";              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The following statement contains a magic number: if (count > bestCount)              {                  int frenchCount = GetCount(text' "[Cc]'est"' "pas"' "vous"' "pour"' "suis"' "Pourquoi"' "maison"' "souviens"' "quelque"); // not spanish words                  int portugueseCount = GetCount(text' "[NnCc]ão"' "Então"' "h?ouve"' "pessoal"' "rapariga"' "tivesse"' "fizeste"'                                                       "jantar"' "conheço"' "atenção"' "foste"' "milhões"' "devias"' "ganhar"' "raios"); // not spanish words                  if (frenchCount < 2 && portugueseCount < 2)                      return "es";              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The following statement contains a magic number: if (count > bestCount)              {                  int frenchCount = GetCount(text' "[Cc]'est"' "pas"' "vous"' "pour"' "suis"' "Pourquoi"' "maison"' "souviens"' "quelque"); // not spanish words                  int portugueseCount = GetCount(text' "[NnCc]ão"' "Então"' "h?ouve"' "pessoal"' "rapariga"' "tivesse"' "fizeste"'                                                       "jantar"' "conheço"' "atenção"' "foste"' "milhões"' "devias"' "ganhar"' "raios"); // not spanish words                  if (frenchCount < 2 && portugueseCount < 2)                      return "es";              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The following statement contains a magic number: if (count > bestCount)              {                  int frenchCount = GetCount(text' "[Cc]'est"' "pas"' "vous"' "pour"' "suis"' "Pourquoi"' "maison"' "souviens"' "quelque"); // not italian words                  if (frenchCount < 2)                      return "it";              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The following statement contains a magic number: if (count > bestCount)              {                  int romanianCount = GetCount(text' "[Vv]reau"' "[Ss]înt"' "[Aa]cum"' "pentru"' "domnule"' "aici");                  if (romanianCount < 5)                      return "fr";              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The following statement contains a magic number: if (count > 10 || count > bestCount)                  return "th";
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The following statement contains a magic number: if (count > 10 || count > bestCount)                  return "ko";
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The following statement contains a magic number: if (count > bestCount * 2)                  return "ja";
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The following statement contains a magic number: if (count > bestCount * 2)                  return "zh";
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguage,The following statement contains a magic number: if (count > bestCount * 1.2)                  return "lv";
Magic Number,Nikse.SubtitleEdit.PluginLogic,LanguageAutoDetect,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\LanguageAutoDetect.cs,AutoDetectGoogleLanguageOrNull,The following statement contains a magic number: string languageId = AutoDetectGoogleLanguage(s.GetAllTexts()' s.Paragraphs.Count / 14);
Magic Number,Nikse.SubtitleEdit.PluginLogic,SubRip,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\SubRip.cs,LoadSubtitle,The following statement contains a magic number: for (int i = 0; i < lines.Count; i++)              {                  _lineNumber++;                  string line = lines[i].TrimEnd();                  line = line.Trim(Convert.ToChar(127)); // 127=delete acscii                    string next = string.Empty;                  if (i + 1 < lines.Count)                      next = lines[i + 1];                    // A new line is missing between two paragraphs (buggy srt file)                  if (_expecting == ExpectingLine.Text && i + 1 < lines.Count &&                      _paragraph != null && !string.IsNullOrEmpty(_paragraph.Text) && Utilities.IsInteger(line) &&                      _regexTimeCodes.IsMatch(lines[i + 1]))                  {                      _errorCount++;                      ReadLine(subtitle' string.Empty' string.Empty);                  }                  if (_expecting == ExpectingLine.Number && _regexTimeCodes.IsMatch(line))                  {                      _errorCount++;                      _expecting = ExpectingLine.TimeCodes;                      doRenum = true;                  }                  ReadLine(subtitle' line' next);              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,SubRip,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\SubRip.cs,LoadSubtitle,The following statement contains a magic number: if (_errorCount < 100)                  if (doRenum)                      subtitle.Renumber(1);
Magic Number,Nikse.SubtitleEdit.PluginLogic,SubRip,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\SubRip.cs,TryReadTimeCodesLine,The following statement contains a magic number: if (line.Length > 30 && line[29] == ' ')                  line = line.Substring(0' 29);
Magic Number,Nikse.SubtitleEdit.PluginLogic,SubRip,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\SubRip.cs,TryReadTimeCodesLine,The following statement contains a magic number: if (line.Length > 30 && line[29] == ' ')                  line = line.Substring(0' 29);
Magic Number,Nikse.SubtitleEdit.PluginLogic,SubRip,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\SubRip.cs,TryReadTimeCodesLine,The following statement contains a magic number: if (line.Length > 30 && line[29] == ' ')                  line = line.Substring(0' 29);
Magic Number,Nikse.SubtitleEdit.PluginLogic,SubRip,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\SubRip.cs,TryReadTimeCodesLine,The following statement contains a magic number: if (line.Length >= 29 && ":;".Contains(line[8].ToString()))                  line = line.Substring(0' 8) + ''' + line.Substring(8 + 1);
Magic Number,Nikse.SubtitleEdit.PluginLogic,SubRip,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\SubRip.cs,TryReadTimeCodesLine,The following statement contains a magic number: if (line.Length >= 29 && ":;".Contains(line[8].ToString()))                  line = line.Substring(0' 8) + ''' + line.Substring(8 + 1);
Magic Number,Nikse.SubtitleEdit.PluginLogic,SubRip,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\SubRip.cs,TryReadTimeCodesLine,The following statement contains a magic number: if (line.Length >= 29 && ":;".Contains(line[8].ToString()))                  line = line.Substring(0' 8) + ''' + line.Substring(8 + 1);
Magic Number,Nikse.SubtitleEdit.PluginLogic,SubRip,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\SubRip.cs,TryReadTimeCodesLine,The following statement contains a magic number: if (line.Length >= 29 && ":;".Contains(line[8].ToString()))                  line = line.Substring(0' 8) + ''' + line.Substring(8 + 1);
Magic Number,Nikse.SubtitleEdit.PluginLogic,SubRip,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\SubRip.cs,TryReadTimeCodesLine,The following statement contains a magic number: if (line.Length >= 29 && line.Length <= 30 && ":;".Contains(line[25].ToString()))                  line = line.Substring(0' 25) + ''' + line.Substring(25 + 1);
Magic Number,Nikse.SubtitleEdit.PluginLogic,SubRip,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\SubRip.cs,TryReadTimeCodesLine,The following statement contains a magic number: if (line.Length >= 29 && line.Length <= 30 && ":;".Contains(line[25].ToString()))                  line = line.Substring(0' 25) + ''' + line.Substring(25 + 1);
Magic Number,Nikse.SubtitleEdit.PluginLogic,SubRip,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\SubRip.cs,TryReadTimeCodesLine,The following statement contains a magic number: if (line.Length >= 29 && line.Length <= 30 && ":;".Contains(line[25].ToString()))                  line = line.Substring(0' 25) + ''' + line.Substring(25 + 1);
Magic Number,Nikse.SubtitleEdit.PluginLogic,SubRip,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\SubRip.cs,TryReadTimeCodesLine,The following statement contains a magic number: if (line.Length >= 29 && line.Length <= 30 && ":;".Contains(line[25].ToString()))                  line = line.Substring(0' 25) + ''' + line.Substring(25 + 1);
Magic Number,Nikse.SubtitleEdit.PluginLogic,SubRip,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\SubRip.cs,TryReadTimeCodesLine,The following statement contains a magic number: if (line.Length >= 29 && line.Length <= 30 && ":;".Contains(line[25].ToString()))                  line = line.Substring(0' 25) + ''' + line.Substring(25 + 1);
Magic Number,Nikse.SubtitleEdit.PluginLogic,SubRip,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\SubRip.cs,TryReadTimeCodesLine,The following statement contains a magic number: if (_regexTimeCodes.IsMatch(line) || _regexTimeCodes2.IsMatch(line))              {                  string[] parts = line.Replace("-->"' ":").Replace(" "' string.Empty).Split(':'' ''');                  try                  {                      int startHours = int.Parse(parts[0]);                      int startMinutes = int.Parse(parts[1]);                      int startSeconds = int.Parse(parts[2]);                      int startMilliseconds = int.Parse(parts[3]);                        int endHours = int.Parse(parts[4]);                      int endMinutes = int.Parse(parts[5]);                      int endSeconds = int.Parse(parts[6]);                      int endMilliseconds = int.Parse(parts[7]);                        paragraph.StartTime = new TimeCode(startHours' startMinutes' startSeconds' startMilliseconds);                      paragraph.EndTime = new TimeCode(endHours' endMinutes' endSeconds' endMilliseconds);                      return true;                  }                  catch                  {                      return false;                  }              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,SubRip,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\SubRip.cs,TryReadTimeCodesLine,The following statement contains a magic number: if (_regexTimeCodes.IsMatch(line) || _regexTimeCodes2.IsMatch(line))              {                  string[] parts = line.Replace("-->"' ":").Replace(" "' string.Empty).Split(':'' ''');                  try                  {                      int startHours = int.Parse(parts[0]);                      int startMinutes = int.Parse(parts[1]);                      int startSeconds = int.Parse(parts[2]);                      int startMilliseconds = int.Parse(parts[3]);                        int endHours = int.Parse(parts[4]);                      int endMinutes = int.Parse(parts[5]);                      int endSeconds = int.Parse(parts[6]);                      int endMilliseconds = int.Parse(parts[7]);                        paragraph.StartTime = new TimeCode(startHours' startMinutes' startSeconds' startMilliseconds);                      paragraph.EndTime = new TimeCode(endHours' endMinutes' endSeconds' endMilliseconds);                      return true;                  }                  catch                  {                      return false;                  }              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,SubRip,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\SubRip.cs,TryReadTimeCodesLine,The following statement contains a magic number: if (_regexTimeCodes.IsMatch(line) || _regexTimeCodes2.IsMatch(line))              {                  string[] parts = line.Replace("-->"' ":").Replace(" "' string.Empty).Split(':'' ''');                  try                  {                      int startHours = int.Parse(parts[0]);                      int startMinutes = int.Parse(parts[1]);                      int startSeconds = int.Parse(parts[2]);                      int startMilliseconds = int.Parse(parts[3]);                        int endHours = int.Parse(parts[4]);                      int endMinutes = int.Parse(parts[5]);                      int endSeconds = int.Parse(parts[6]);                      int endMilliseconds = int.Parse(parts[7]);                        paragraph.StartTime = new TimeCode(startHours' startMinutes' startSeconds' startMilliseconds);                      paragraph.EndTime = new TimeCode(endHours' endMinutes' endSeconds' endMilliseconds);                      return true;                  }                  catch                  {                      return false;                  }              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,SubRip,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\SubRip.cs,TryReadTimeCodesLine,The following statement contains a magic number: if (_regexTimeCodes.IsMatch(line) || _regexTimeCodes2.IsMatch(line))              {                  string[] parts = line.Replace("-->"' ":").Replace(" "' string.Empty).Split(':'' ''');                  try                  {                      int startHours = int.Parse(parts[0]);                      int startMinutes = int.Parse(parts[1]);                      int startSeconds = int.Parse(parts[2]);                      int startMilliseconds = int.Parse(parts[3]);                        int endHours = int.Parse(parts[4]);                      int endMinutes = int.Parse(parts[5]);                      int endSeconds = int.Parse(parts[6]);                      int endMilliseconds = int.Parse(parts[7]);                        paragraph.StartTime = new TimeCode(startHours' startMinutes' startSeconds' startMilliseconds);                      paragraph.EndTime = new TimeCode(endHours' endMinutes' endSeconds' endMilliseconds);                      return true;                  }                  catch                  {                      return false;                  }              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,SubRip,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\SubRip.cs,TryReadTimeCodesLine,The following statement contains a magic number: if (_regexTimeCodes.IsMatch(line) || _regexTimeCodes2.IsMatch(line))              {                  string[] parts = line.Replace("-->"' ":").Replace(" "' string.Empty).Split(':'' ''');                  try                  {                      int startHours = int.Parse(parts[0]);                      int startMinutes = int.Parse(parts[1]);                      int startSeconds = int.Parse(parts[2]);                      int startMilliseconds = int.Parse(parts[3]);                        int endHours = int.Parse(parts[4]);                      int endMinutes = int.Parse(parts[5]);                      int endSeconds = int.Parse(parts[6]);                      int endMilliseconds = int.Parse(parts[7]);                        paragraph.StartTime = new TimeCode(startHours' startMinutes' startSeconds' startMilliseconds);                      paragraph.EndTime = new TimeCode(endHours' endMinutes' endSeconds' endMilliseconds);                      return true;                  }                  catch                  {                      return false;                  }              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,SubRip,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\SubRip.cs,TryReadTimeCodesLine,The following statement contains a magic number: if (_regexTimeCodes.IsMatch(line) || _regexTimeCodes2.IsMatch(line))              {                  string[] parts = line.Replace("-->"' ":").Replace(" "' string.Empty).Split(':'' ''');                  try                  {                      int startHours = int.Parse(parts[0]);                      int startMinutes = int.Parse(parts[1]);                      int startSeconds = int.Parse(parts[2]);                      int startMilliseconds = int.Parse(parts[3]);                        int endHours = int.Parse(parts[4]);                      int endMinutes = int.Parse(parts[5]);                      int endSeconds = int.Parse(parts[6]);                      int endMilliseconds = int.Parse(parts[7]);                        paragraph.StartTime = new TimeCode(startHours' startMinutes' startSeconds' startMilliseconds);                      paragraph.EndTime = new TimeCode(endHours' endMinutes' endSeconds' endMilliseconds);                      return true;                  }                  catch                  {                      return false;                  }              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,RemoveHtmlFontTag,The following statement contains a magic number: while (idx >= 0)              {                  var endIdx = s.IndexOf('>'' idx + 5);                  if (endIdx < idx) break;                  s = s.Remove(idx' endIdx - idx + 1);                  idx = s.IndexOf("<font"' idx' StringComparison.OrdinalIgnoreCase);              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,FixExtraSpaces,The following statement contains a magic number: for (int i = len - 1; i >= 0; i--)              {                  char ch = s[i];                  if (k < 2)                  {                      if (ch == 0x20)                      {                          k = i + 1;                      }                  }                  else if (ch != 0x20)                  {                      // Two or more white-spaces found!                      if (k - (i + 1) > 1)                      {                          // Keep only one white-space.                          s = s.Remove(i + 1' k - (i + 2));                      }                        // No white-space after/before line break.                      if ((ch == '\n' || ch == '\r') && i + 1 < s.Length && s[i + 1] == 0x20)                      {                          s = s.Remove(i + 1' 1);                      }                      // Reset remove length.                      k = -1;                  }                  if (ch == 0x20 && i + 1 < s.Length && (s[i + 1] == '\n' || s[i + 1] == '\r'))                  {                      s = s.Remove(i' 1);                  }              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,FixExtraSpaces,The following statement contains a magic number: for (int i = len - 1; i >= 0; i--)              {                  char ch = s[i];                  if (k < 2)                  {                      if (ch == 0x20)                      {                          k = i + 1;                      }                  }                  else if (ch != 0x20)                  {                      // Two or more white-spaces found!                      if (k - (i + 1) > 1)                      {                          // Keep only one white-space.                          s = s.Remove(i + 1' k - (i + 2));                      }                        // No white-space after/before line break.                      if ((ch == '\n' || ch == '\r') && i + 1 < s.Length && s[i + 1] == 0x20)                      {                          s = s.Remove(i + 1' 1);                      }                      // Reset remove length.                      k = -1;                  }                  if (ch == 0x20 && i + 1 < s.Length && (s[i + 1] == '\n' || s[i + 1] == '\r'))                  {                      s = s.Remove(i' 1);                  }              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,IsBetweenNumbers,The following statement contains a magic number: if (string.IsNullOrEmpty(s) || position < 1 || position + 2 > s.Length)                  return false;
Magic Number,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,AutoBreakLine,The following statement contains a magic number: return AutoBreakLine(text' 43' 22' language);
Magic Number,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,AutoBreakLine,The following statement contains a magic number: return AutoBreakLine(text' 43' 22' language);
Magic Number,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,AutoBreakLineMoreThanTwoLines,The following statement contains a magic number: if (text == null || text.Length < 3)                  return text;
Magic Number,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,AutoBreakLineMoreThanTwoLines,The following statement contains a magic number: if ((arr.Length < 2 && arr[0].Length <= maximumLineLength) || (arr[0].Length <= maximumLineLength && arr[1].Length <= maximumLineLength))                  return s;
Magic Number,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,AutoBreakLineMoreThanTwoLines,The following statement contains a magic number: for (int numberOfLines = 3; numberOfLines < 9999; numberOfLines++)              {                  int average = s.Length / numberOfLines + 1;                  for (int len = average; len < maximumLineLength; len++)                  {                      List<int> list = SplitToX(words' numberOfLines' len);                      bool allOk = true;                      foreach (var lineLength in list)                      {                          if (lineLength > maximumLineLength)                              allOk = false;                      }                      if (allOk)                      {                          int index = 0;                          foreach (var item in list)                          {                              index += item;                              htmlTags.Add(index' Environment.NewLine);                          }                          s = ReInsertHtmlTags(s' htmlTags);                          s = s.Replace(" " + Environment.NewLine' Environment.NewLine);                          s = s.Replace(Environment.NewLine + " "' Environment.NewLine);                          s = s.Replace(Environment.NewLine + "</i>"' "</i>" + Environment.NewLine);                          s = s.Replace(Environment.NewLine + "</b>"' "</b>" + Environment.NewLine);                          s = s.Replace(Environment.NewLine + "</u>"' "</u>" + Environment.NewLine);                          s = s.Replace(Environment.NewLine + "</font>"' "</font>" + Environment.NewLine);                          return s.TrimEnd();                      }                  }              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,AutoBreakLineMoreThanTwoLines,The following statement contains a magic number: for (int numberOfLines = 3; numberOfLines < 9999; numberOfLines++)              {                  int average = s.Length / numberOfLines + 1;                  for (int len = average; len < maximumLineLength; len++)                  {                      List<int> list = SplitToX(words' numberOfLines' len);                      bool allOk = true;                      foreach (var lineLength in list)                      {                          if (lineLength > maximumLineLength)                              allOk = false;                      }                      if (allOk)                      {                          int index = 0;                          foreach (var item in list)                          {                              index += item;                              htmlTags.Add(index' Environment.NewLine);                          }                          s = ReInsertHtmlTags(s' htmlTags);                          s = s.Replace(" " + Environment.NewLine' Environment.NewLine);                          s = s.Replace(Environment.NewLine + " "' Environment.NewLine);                          s = s.Replace(Environment.NewLine + "</i>"' "</i>" + Environment.NewLine);                          s = s.Replace(Environment.NewLine + "</b>"' "</b>" + Environment.NewLine);                          s = s.Replace(Environment.NewLine + "</u>"' "</u>" + Environment.NewLine);                          s = s.Replace(Environment.NewLine + "</font>"' "</font>" + Environment.NewLine);                          return s.TrimEnd();                      }                  }              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,SplitToX,The following statement contains a magic number: foreach (string word in words)              {                  if (currentCount + word.Length + 3 > average && currentIdx < count)                  {                      list.Add(currentCount);                      currentIdx++;                      currentCount = 0;                  }                  currentCount += word.Length + 1;              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,AutoBreakLine,The following statement contains a magic number: if (text == null || text.Length < 3)                  return text;
Magic Number,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,AutoBreakLine,The following statement contains a magic number: if (text.Contains('-') && text.Contains(Environment.NewLine))              {                  var noTagLines = HtmlUtil.RemoveHtmlTags(text' true).SplitToLines();                  if (noTagLines.Length == 2)                  {                      var arr0 = noTagLines[0].Trim().TrimEnd('"'' '\'').TrimEnd();                      if (arr0.StartsWith('-') && noTagLines[1].TrimStart().StartsWith('-') && arr0.Length > 1 && (".?!)]".Contains(arr0[arr0.Length - 1]) || arr0.EndsWith("--"' StringComparison.Ordinal) || arr0.EndsWith('–')))                          return text;                  }              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,AutoBreakLine,The following statement contains a magic number: int mid = s.Length / 2;
Magic Number,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,AutoBreakLine,The following statement contains a magic number: if (s.Contains(" - "))              {                  for (int j = 0; j <= (maximumLength / 2) + 5; j++)                  {                      if (mid + j + 4 < s.Length)                      {                          if (s[mid + j] == '-' && s[mid + j + 1] == ' ' && s[mid + j - 1] == ' ')                          {                              string rest = s.Substring(mid + j + 1).TrimStart();                              if (rest.Length > 0 && char.IsUpper(rest[0]))                              {                                  splitPos = mid + j;                                  break;                              }                          }                      }                      if (mid - (j + 1) > 4)                      {                          if (s[mid - j] == '-' && s[mid - j + 1] == ' ' && s[mid - j - 1] == ' ')                          {                              string rest = s.Substring(mid - j + 1).TrimStart();                              if (rest.Length > 0 && char.IsUpper(rest[0]))                              {                                  if (mid - j > 5 && s[mid - j - 1] == ' ')                                  {                                      if ("!?.".Contains(s[mid - j - 2]))                                      {                                          splitPos = mid - j;                                          break;                                      }                                      var first = s.Substring(0' mid - j - 1);                                      if (first.EndsWith(".\""' StringComparison.Ordinal) || first.EndsWith("!\""' StringComparison.Ordinal) || first.EndsWith("?\""' StringComparison.Ordinal))                                      {                                          splitPos = mid - j;                                          break;                                      }                                  }                              }                          }                      }                  }              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,AutoBreakLine,The following statement contains a magic number: if (s.Contains(" - "))              {                  for (int j = 0; j <= (maximumLength / 2) + 5; j++)                  {                      if (mid + j + 4 < s.Length)                      {                          if (s[mid + j] == '-' && s[mid + j + 1] == ' ' && s[mid + j - 1] == ' ')                          {                              string rest = s.Substring(mid + j + 1).TrimStart();                              if (rest.Length > 0 && char.IsUpper(rest[0]))                              {                                  splitPos = mid + j;                                  break;                              }                          }                      }                      if (mid - (j + 1) > 4)                      {                          if (s[mid - j] == '-' && s[mid - j + 1] == ' ' && s[mid - j - 1] == ' ')                          {                              string rest = s.Substring(mid - j + 1).TrimStart();                              if (rest.Length > 0 && char.IsUpper(rest[0]))                              {                                  if (mid - j > 5 && s[mid - j - 1] == ' ')                                  {                                      if ("!?.".Contains(s[mid - j - 2]))                                      {                                          splitPos = mid - j;                                          break;                                      }                                      var first = s.Substring(0' mid - j - 1);                                      if (first.EndsWith(".\""' StringComparison.Ordinal) || first.EndsWith("!\""' StringComparison.Ordinal) || first.EndsWith("?\""' StringComparison.Ordinal))                                      {                                          splitPos = mid - j;                                          break;                                      }                                  }                              }                          }                      }                  }              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,AutoBreakLine,The following statement contains a magic number: if (s.Contains(" - "))              {                  for (int j = 0; j <= (maximumLength / 2) + 5; j++)                  {                      if (mid + j + 4 < s.Length)                      {                          if (s[mid + j] == '-' && s[mid + j + 1] == ' ' && s[mid + j - 1] == ' ')                          {                              string rest = s.Substring(mid + j + 1).TrimStart();                              if (rest.Length > 0 && char.IsUpper(rest[0]))                              {                                  splitPos = mid + j;                                  break;                              }                          }                      }                      if (mid - (j + 1) > 4)                      {                          if (s[mid - j] == '-' && s[mid - j + 1] == ' ' && s[mid - j - 1] == ' ')                          {                              string rest = s.Substring(mid - j + 1).TrimStart();                              if (rest.Length > 0 && char.IsUpper(rest[0]))                              {                                  if (mid - j > 5 && s[mid - j - 1] == ' ')                                  {                                      if ("!?.".Contains(s[mid - j - 2]))                                      {                                          splitPos = mid - j;                                          break;                                      }                                      var first = s.Substring(0' mid - j - 1);                                      if (first.EndsWith(".\""' StringComparison.Ordinal) || first.EndsWith("!\""' StringComparison.Ordinal) || first.EndsWith("?\""' StringComparison.Ordinal))                                      {                                          splitPos = mid - j;                                          break;                                      }                                  }                              }                          }                      }                  }              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,AutoBreakLine,The following statement contains a magic number: if (s.Contains(" - "))              {                  for (int j = 0; j <= (maximumLength / 2) + 5; j++)                  {                      if (mid + j + 4 < s.Length)                      {                          if (s[mid + j] == '-' && s[mid + j + 1] == ' ' && s[mid + j - 1] == ' ')                          {                              string rest = s.Substring(mid + j + 1).TrimStart();                              if (rest.Length > 0 && char.IsUpper(rest[0]))                              {                                  splitPos = mid + j;                                  break;                              }                          }                      }                      if (mid - (j + 1) > 4)                      {                          if (s[mid - j] == '-' && s[mid - j + 1] == ' ' && s[mid - j - 1] == ' ')                          {                              string rest = s.Substring(mid - j + 1).TrimStart();                              if (rest.Length > 0 && char.IsUpper(rest[0]))                              {                                  if (mid - j > 5 && s[mid - j - 1] == ' ')                                  {                                      if ("!?.".Contains(s[mid - j - 2]))                                      {                                          splitPos = mid - j;                                          break;                                      }                                      var first = s.Substring(0' mid - j - 1);                                      if (first.EndsWith(".\""' StringComparison.Ordinal) || first.EndsWith("!\""' StringComparison.Ordinal) || first.EndsWith("?\""' StringComparison.Ordinal))                                      {                                          splitPos = mid - j;                                          break;                                      }                                  }                              }                          }                      }                  }              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,AutoBreakLine,The following statement contains a magic number: if (s.Contains(" - "))              {                  for (int j = 0; j <= (maximumLength / 2) + 5; j++)                  {                      if (mid + j + 4 < s.Length)                      {                          if (s[mid + j] == '-' && s[mid + j + 1] == ' ' && s[mid + j - 1] == ' ')                          {                              string rest = s.Substring(mid + j + 1).TrimStart();                              if (rest.Length > 0 && char.IsUpper(rest[0]))                              {                                  splitPos = mid + j;                                  break;                              }                          }                      }                      if (mid - (j + 1) > 4)                      {                          if (s[mid - j] == '-' && s[mid - j + 1] == ' ' && s[mid - j - 1] == ' ')                          {                              string rest = s.Substring(mid - j + 1).TrimStart();                              if (rest.Length > 0 && char.IsUpper(rest[0]))                              {                                  if (mid - j > 5 && s[mid - j - 1] == ' ')                                  {                                      if ("!?.".Contains(s[mid - j - 2]))                                      {                                          splitPos = mid - j;                                          break;                                      }                                      var first = s.Substring(0' mid - j - 1);                                      if (first.EndsWith(".\""' StringComparison.Ordinal) || first.EndsWith("!\""' StringComparison.Ordinal) || first.EndsWith("?\""' StringComparison.Ordinal))                                      {                                          splitPos = mid - j;                                          break;                                      }                                  }                              }                          }                      }                  }              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,AutoBreakLine,The following statement contains a magic number: if (s.Contains(" - "))              {                  for (int j = 0; j <= (maximumLength / 2) + 5; j++)                  {                      if (mid + j + 4 < s.Length)                      {                          if (s[mid + j] == '-' && s[mid + j + 1] == ' ' && s[mid + j - 1] == ' ')                          {                              string rest = s.Substring(mid + j + 1).TrimStart();                              if (rest.Length > 0 && char.IsUpper(rest[0]))                              {                                  splitPos = mid + j;                                  break;                              }                          }                      }                      if (mid - (j + 1) > 4)                      {                          if (s[mid - j] == '-' && s[mid - j + 1] == ' ' && s[mid - j - 1] == ' ')                          {                              string rest = s.Substring(mid - j + 1).TrimStart();                              if (rest.Length > 0 && char.IsUpper(rest[0]))                              {                                  if (mid - j > 5 && s[mid - j - 1] == ' ')                                  {                                      if ("!?.".Contains(s[mid - j - 2]))                                      {                                          splitPos = mid - j;                                          break;                                      }                                      var first = s.Substring(0' mid - j - 1);                                      if (first.EndsWith(".\""' StringComparison.Ordinal) || first.EndsWith("!\""' StringComparison.Ordinal) || first.EndsWith("?\""' StringComparison.Ordinal))                                      {                                          splitPos = mid - j;                                          break;                                      }                                  }                              }                          }                      }                  }              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,AutoBreakLine,The following statement contains a magic number: if (splitPos < 0)              {                  const string expectedChars1 = ".!?0123456789";                  const string expectedChars2 = ".!?";                  for (int j = 0; j < 15; j++)                  {                      if (mid + j + 1 < s.Length && mid + j > 0)                      {                          if (expectedChars2.Contains(s[mid + j]) && !IsPartOfNumber(s' mid + j) && CanBreak(s' mid + j + 1' language))                          {                              splitPos = mid + j + 1;                              if (expectedChars1.Contains(s[splitPos]))                              { // do not break double/tripple end lines like "!!!" or "..."                                  splitPos++;                                  if (expectedChars1.Contains(s[mid + j + 1]))                                      splitPos++;                              }                              break;                          }                          if (expectedChars2.Contains(s[mid - j]) && !IsPartOfNumber(s' mid - j) && CanBreak(s' mid - j' language))                          {                              splitPos = mid - j;                              splitPos++;                              break;                          }                      }                  }              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,AutoBreakLine,The following statement contains a magic number: if (splitPos < 0)              {                  const string expectedChars1 = ".!?' ";                  const string expectedChars2 = " .!?";                  const string expectedChars3 = ".!?";                  for (int j = 0; j < 25; j++)                  {                      if (mid + j + 1 < s.Length && mid + j > 0)                      {                          if (expectedChars1.Contains(s[mid + j]) && !IsPartOfNumber(s' mid + j) && s.Length > mid + j + 2 && CanBreak(s' mid + j' language))                          {                              splitPos = mid + j;                              if (expectedChars2.Contains(s[mid + j + 1]))                              {                                  splitPos++;                                  if (expectedChars2.Contains(s[mid + j + 2]))                                      splitPos++;                              }                              break;                          }                          if (expectedChars1.Contains(s[mid - j]) && !IsPartOfNumber(s' mid - j) && s.Length > mid + j + 2 && CanBreak(s' mid - j' language))                          {                              splitPos = mid - j;                              if (expectedChars3.Contains(s[splitPos]))                                  splitPos--;                              if (expectedChars3.Contains(s[splitPos]))                                  splitPos--;                              if (expectedChars3.Contains(s[splitPos]))                                  splitPos--;                              break;                          }                      }                  }              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,AutoBreakLine,The following statement contains a magic number: if (splitPos < 0)              {                  const string expectedChars1 = ".!?' ";                  const string expectedChars2 = " .!?";                  const string expectedChars3 = ".!?";                  for (int j = 0; j < 25; j++)                  {                      if (mid + j + 1 < s.Length && mid + j > 0)                      {                          if (expectedChars1.Contains(s[mid + j]) && !IsPartOfNumber(s' mid + j) && s.Length > mid + j + 2 && CanBreak(s' mid + j' language))                          {                              splitPos = mid + j;                              if (expectedChars2.Contains(s[mid + j + 1]))                              {                                  splitPos++;                                  if (expectedChars2.Contains(s[mid + j + 2]))                                      splitPos++;                              }                              break;                          }                          if (expectedChars1.Contains(s[mid - j]) && !IsPartOfNumber(s' mid - j) && s.Length > mid + j + 2 && CanBreak(s' mid - j' language))                          {                              splitPos = mid - j;                              if (expectedChars3.Contains(s[splitPos]))                                  splitPos--;                              if (expectedChars3.Contains(s[splitPos]))                                  splitPos--;                              if (expectedChars3.Contains(s[splitPos]))                                  splitPos--;                              break;                          }                      }                  }              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,AutoBreakLine,The following statement contains a magic number: if (splitPos < 0)              {                  const string expectedChars1 = ".!?' ";                  const string expectedChars2 = " .!?";                  const string expectedChars3 = ".!?";                  for (int j = 0; j < 25; j++)                  {                      if (mid + j + 1 < s.Length && mid + j > 0)                      {                          if (expectedChars1.Contains(s[mid + j]) && !IsPartOfNumber(s' mid + j) && s.Length > mid + j + 2 && CanBreak(s' mid + j' language))                          {                              splitPos = mid + j;                              if (expectedChars2.Contains(s[mid + j + 1]))                              {                                  splitPos++;                                  if (expectedChars2.Contains(s[mid + j + 2]))                                      splitPos++;                              }                              break;                          }                          if (expectedChars1.Contains(s[mid - j]) && !IsPartOfNumber(s' mid - j) && s.Length > mid + j + 2 && CanBreak(s' mid - j' language))                          {                              splitPos = mid - j;                              if (expectedChars3.Contains(s[splitPos]))                                  splitPos--;                              if (expectedChars3.Contains(s[splitPos]))                                  splitPos--;                              if (expectedChars3.Contains(s[splitPos]))                                  splitPos--;                              break;                          }                      }                  }              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,AutoBreakLine,The following statement contains a magic number: if (splitPos < 0)              {                  const string expectedChars1 = ".!?' ";                  const string expectedChars2 = " .!?";                  const string expectedChars3 = ".!?";                  for (int j = 0; j < 25; j++)                  {                      if (mid + j + 1 < s.Length && mid + j > 0)                      {                          if (expectedChars1.Contains(s[mid + j]) && !IsPartOfNumber(s' mid + j) && s.Length > mid + j + 2 && CanBreak(s' mid + j' language))                          {                              splitPos = mid + j;                              if (expectedChars2.Contains(s[mid + j + 1]))                              {                                  splitPos++;                                  if (expectedChars2.Contains(s[mid + j + 2]))                                      splitPos++;                              }                              break;                          }                          if (expectedChars1.Contains(s[mid - j]) && !IsPartOfNumber(s' mid - j) && s.Length > mid + j + 2 && CanBreak(s' mid - j' language))                          {                              splitPos = mid - j;                              if (expectedChars3.Contains(s[splitPos]))                                  splitPos--;                              if (expectedChars3.Contains(s[splitPos]))                                  splitPos--;                              if (expectedChars3.Contains(s[splitPos]))                                  splitPos--;                              break;                          }                      }                  }              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,AutoBreakLine,The following statement contains a magic number: if (splitPos < s.Length - 2)                  s = s.Substring(0' splitPos) + Environment.NewLine + s.Substring(splitPos);
Magic Number,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,AutoBreakLine,The following statement contains a magic number: if (idx > 2)              {                  var endIdx = s.IndexOf('>'' idx + 2);                  if (endIdx > idx)                  {                      var tag = s.Substring(idx + Environment.NewLine.Length' endIdx - (idx + Environment.NewLine.Length) + 1);                      s = s.Insert(idx' tag);                      s = s.Remove(idx + tag.Length + Environment.NewLine.Length' tag.Length);                  }              }
Magic Number,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,AutoBreakLine,The following statement contains a magic number: if (idx > 2)              {                  var endIdx = s.IndexOf('>'' idx + 2);                  if (endIdx > idx)                  {                      var tag = s.Substring(idx + Environment.NewLine.Length' endIdx - (idx + Environment.NewLine.Length) + 1);                      s = s.Insert(idx' tag);                      s = s.Remove(idx + tag.Length + Environment.NewLine.Length' tag.Length);                  }              }
Magic Number,SubtitleEdit.Logic,StringExtensions,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\StringExtensions.cs,LineEndsWithHtmlTag,The following statement contains a magic number: if (len < 6 || text[len - 1] != '>')                  return false;
Magic Number,SubtitleEdit.Logic,StringExtensions,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\StringExtensions.cs,LineEndsWithHtmlTag,The following statement contains a magic number: if (threeLengthTag && len > 3 && text[len - 4] == '<' && text[len - 3] == '/')                  return true;
Magic Number,SubtitleEdit.Logic,StringExtensions,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\StringExtensions.cs,LineEndsWithHtmlTag,The following statement contains a magic number: if (threeLengthTag && len > 3 && text[len - 4] == '<' && text[len - 3] == '/')                  return true;
Magic Number,SubtitleEdit.Logic,StringExtensions,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\StringExtensions.cs,LineEndsWithHtmlTag,The following statement contains a magic number: if (threeLengthTag && len > 3 && text[len - 4] == '<' && text[len - 3] == '/')                  return true;
Magic Number,SubtitleEdit.Logic,StringExtensions,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\StringExtensions.cs,LineEndsWithHtmlTag,The following statement contains a magic number: if (includeFont && len > 8 && text[len - 7] == '<' && text[len - 6] == '/')                  return true;
Magic Number,SubtitleEdit.Logic,StringExtensions,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\StringExtensions.cs,LineEndsWithHtmlTag,The following statement contains a magic number: if (includeFont && len > 8 && text[len - 7] == '<' && text[len - 6] == '/')                  return true;
Magic Number,SubtitleEdit.Logic,StringExtensions,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\StringExtensions.cs,LineEndsWithHtmlTag,The following statement contains a magic number: if (includeFont && len > 8 && text[len - 7] == '<' && text[len - 6] == '/')                  return true;
Magic Number,SubtitleEdit.Logic,StringExtensions,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\StringExtensions.cs,LineBreakStartsWithHtmlTag,The following statement contains a magic number: if (newLineIdx < 0 || text.Length < newLineIdx + 5)                  return false;
Magic Number,SubtitleEdit.Logic,StringExtensions,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\StringExtensions.cs,LineBreakStartsWithHtmlTag,The following statement contains a magic number: text = text.Substring(newLineIdx + 2);
Magic Number,SubtitleEdit.Logic,StringExtensions,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\StringExtensions.cs,StartsWithHtmlTag,The following statement contains a magic number: if (threeLengthTag && text.Length >= 3 && text[0] == '<' && text[2] == '>' && (text[1] == 'i' || text[1] == 'I' || text[1] == 'u' || text[1] == 'U' || text[1] == 'b' || text[1] == 'B'))                  return true;
Magic Number,SubtitleEdit.Logic,StringExtensions,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\StringExtensions.cs,StartsWithHtmlTag,The following statement contains a magic number: if (threeLengthTag && text.Length >= 3 && text[0] == '<' && text[2] == '>' && (text[1] == 'i' || text[1] == 'I' || text[1] == 'u' || text[1] == 'U' || text[1] == 'b' || text[1] == 'B'))                  return true;
Magic Number,SubtitleEdit.Logic,StringExtensions,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\StringExtensions.cs,StartsWithHtmlTag,The following statement contains a magic number: if (includeFont && text.Length > 5 && text.StartsWith("<font"' StringComparison.OrdinalIgnoreCase))                  return text.IndexOf('>'' 5) >= 5;
Magic Number,SubtitleEdit.Logic,StringExtensions,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\StringExtensions.cs,StartsWithHtmlTag,The following statement contains a magic number: if (includeFont && text.Length > 5 && text.StartsWith("<font"' StringComparison.OrdinalIgnoreCase))                  return text.IndexOf('>'' 5) >= 5;
Magic Number,SubtitleEdit.Logic,StringExtensions,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\StringExtensions.cs,StartsWithHtmlTag,The following statement contains a magic number: if (includeFont && text.Length > 5 && text.StartsWith("<font"' StringComparison.OrdinalIgnoreCase))                  return text.IndexOf('>'' 5) >= 5;
Magic Number,SubtitleEdit.Logic,StringExtensions,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\StringExtensions.cs,FastIndexOf,The following statement contains a magic number: while (first != -1)              {                  // Check if the following character is the same like                  // the 2nd character of "pattern"                  if (source[first + 1] != c1)                  {                      first = source.IndexOf(c0' ++first' limit - first);                      continue;                  }                  // Check the rest of "pattern" (starting with the 3rd character)                  bool found = true;                  for (var j = 2; j < pattern.Length; j++)                      if (source[first + j] != pattern[j])                      {                          found = false;                          break;                      }                  // If the whole word was found' return its index' otherwise try again                  if (found) return first;                  first = source.IndexOf(c0' ++first' limit - first);              }
Magic Number,SubtitleEdit.Logic,StringExtensions,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\StringExtensions.cs,FixExtraSpaces,The following statement contains a magic number: for (int i = len - 1; i >= 0; i--)              {                  char ch = s[i];                  if (k < 2)                  {                      if (ch == 0x20)                      {                          k = i + 1;                      }                  }                  else if (ch != 0x20)                  {                      // Two or more white-spaces found!                      if (k - (i + 1) > 1)                      {                          // Keep only one white-space.                          s = s.Remove(i + 1' k - (i + 2));                      }                        // No white-space after/before line break.                      if ((ch == '\n' || ch == '\r') && i + 1 < s.Length && s[i + 1] == 0x20)                      {                          s = s.Remove(i + 1' 1);                      }                      // Reset remove length.                      k = -1;                  }                  if (ch == 0x20 && i + 1 < s.Length && (s[i + 1] == '\n' || s[i + 1] == '\r'))                  {                      s = s.Remove(i' 1);                  }              }
Magic Number,SubtitleEdit.Logic,StringExtensions,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\StringExtensions.cs,FixExtraSpaces,The following statement contains a magic number: for (int i = len - 1; i >= 0; i--)              {                  char ch = s[i];                  if (k < 2)                  {                      if (ch == 0x20)                      {                          k = i + 1;                      }                  }                  else if (ch != 0x20)                  {                      // Two or more white-spaces found!                      if (k - (i + 1) > 1)                      {                          // Keep only one white-space.                          s = s.Remove(i + 1' k - (i + 2));                      }                        // No white-space after/before line break.                      if ((ch == '\n' || ch == '\r') && i + 1 < s.Length && s[i + 1] == 0x20)                      {                          s = s.Remove(i + 1' 1);                      }                      // Reset remove length.                      k = -1;                  }                  if (ch == 0x20 && i + 1 < s.Length && (s[i + 1] == '\n' || s[i + 1] == '\r'))                  {                      s = s.Remove(i' 1);                  }              }
Missing Default,Nikse.SubtitleEdit.PluginLogic,SubRip,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\SubRip.cs,ReadLine,The following switch statement is missing a default case: switch (_expecting)              {                  case ExpectingLine.Number:                      if (Utilities.IsInteger(line))                      {                          _paragraph.Number = int.Parse(line);                          _expecting = ExpectingLine.TimeCodes;                      }                      else if (line.Trim().Length > 0)                      {                          _errorCount++;                      }                      break;                    case ExpectingLine.TimeCodes:                      if (TryReadTimeCodesLine(line' _paragraph))                      {                          _paragraph.Text = string.Empty;                          _expecting = ExpectingLine.Text;                      }                      else if (line.Trim().Length > 0)                      {                          _errorCount++;                          _expecting = ExpectingLine.Number; // lets go to next paragraph                      }                      break;                    case ExpectingLine.Text:                      if (line.Trim().Length > 0)                      {                          if (_paragraph.Text.Length > 0)                              _paragraph.Text += Environment.NewLine;                          _paragraph.Text += RemoveBadChars(line).TrimEnd().Replace(Environment.NewLine + Environment.NewLine' Environment.NewLine);                      }                      else if (IsText(next))                      {                          if (_paragraph.Text.Length > 0)                              _paragraph.Text += Environment.NewLine;                          _paragraph.Text += RemoveBadChars(line).TrimEnd().Replace(Environment.NewLine + Environment.NewLine' Environment.NewLine);                      }                      else if (string.IsNullOrEmpty(line) && string.IsNullOrEmpty(_paragraph.Text))                      {                          _paragraph.Text = string.Empty;                          if (!string.IsNullOrEmpty(next) && (Utilities.IsInteger(next) || _regexTimeCodes.IsMatch(next)))                          {                              subtitle.Paragraphs.Add(_paragraph);                              _paragraph = new Paragraph();                              _expecting = ExpectingLine.Number;                          }                      }                      else                      {                          subtitle.Paragraphs.Add(_paragraph);                          _paragraph = new Paragraph();                          _expecting = ExpectingLine.Number;                      }                      break;              }
Missing Default,Nikse.SubtitleEdit.PluginLogic,Utilities,C:\repos\SubtitleEdit_plugins\DeeplTranslate\DLL\Logic\Utilities.cs,RemoveSpaceBeforeAfterTag,The following switch statement is missing a default case: switch (openTag)              {                  case "<i>":                      closeTag = "</i>";                      break;                  case "<b>":                      closeTag = "</b>";                      break;                  case "<u>":                      closeTag = "</u>";                      break;              }
